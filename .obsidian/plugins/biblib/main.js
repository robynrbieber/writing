/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Am=Object.create;var Ci=Object.defineProperty;var Sm=Object.getOwnPropertyDescriptor;var Cm=Object.getOwnPropertyNames;var Om=Object.getPrototypeOf,km=Object.prototype.hasOwnProperty;var Oi=(e,t)=>()=>(e&&(t=e(e=0)),t);var R=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Ca=(e,t)=>{for(var r in t)Ci(e,r,{get:t[r],enumerable:!0})},tl=(e,t,r,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of Cm(t))!km.call(e,s)&&s!==r&&Ci(e,s,{get:()=>t[s],enumerable:!(i=Sm(t,s))||i.enumerable});return e};var Ue=(e,t,r)=>(r=e!=null?Am(Om(e)):{},tl(t||!e||!e.__esModule?Ci(r,"default",{value:e,enumerable:!0}):r,e)),rl=e=>tl(Ci({},"__esModule",{value:!0}),e);function sr(e){if(e.trim()==="[]"||e.trim()==="[ ]")return"[]";if(e.startsWith("[")&&e.endsWith("]"))try{return JSON.parse(e),e}catch(t){if(e.replace(/\s/g,"")==="[]")return"[]";let r=e.substring(1,e.length-1).trim();if(!r)return"[]";let i=/,(?=(?:[^"]*"[^"]*")*[^"]*$)/,s=r.split(i).map(a=>a.trim());return s=s.filter(a=>a!==""),s.length===0?"[]":(s=s.map(a=>a.startsWith('"')&&a.endsWith('"')?a:a.includes("[[")&&a.includes("]]")?`"${a.replace(/"/g,'\\"')}"`:a),"["+s.join(",")+"]")}return e}function sl(e,t){let r,i;if(t.trim().startsWith("[")&&t.trim().endsWith("]"))try{let s=JSON.parse(t.trim());r=`---
field: ${JSON.stringify(s)}
---`,i="This template produces a valid JSON array that will be properly parsed as an array in frontmatter."}catch(s){r=`---
field: "${t.trim()}"
---`,i="This looks like an array but is not valid JSON. The template needs to include commas between items. It will be treated as a regular string."}else t.trim().startsWith("-")&&t.includes(`
`)?(r=`---
field:
`+t.trim().split(`
`).map(a=>`  ${a}`).join(`
`)+`
---`,i="In BibLib, this format with dashes is NOT automatically parsed as an array. To create arrays, use the JSON syntax with square brackets."):t.includes(",")&&!t.includes(`
`)&&!t.includes("{")&&!t.includes("}")?(r=`---
field: ${t}
---`,i="Comma-separated values are treated as a single string in frontmatter, not as an array."):t.includes(`
`)?(r=`---
field: |
`+t.split(`
`).map(s=>`  ${s}`).join(`
`)+`
---`,i="Multi-line text is stored using the pipe syntax (|) in YAML, which preserves line breaks."):(r=`---
field: ${t}
---`,i="Simple strings are stored as-is in YAML frontmatter.");return{yamlRepresentation:r,yamlBehaviorExplanation:i}}var Yr=Oi(()=>{});var al={};Ca(al,{TemplateEngine:()=>Ae});var Ae,Pt=Oi(()=>{Yr();Ae=class{static render(t,r,i={}){let s=t;return s=this.processPositiveBlocks(s,r),s=this.processNegativeBlocks(s,r),s=this.processVariables(s,r),i.sanitizeForCitekey&&(/^[a-zA-Z0-9_]/.test(s)||(s="_"+s),s=s.replace(/[^a-zA-Z0-9_:.#$%&\-+?<>~/]/g,""),s=s.replace(/[:.#$%&\-+?<>~/]+$/g,"")),i.yamlArray&&t.startsWith("[")&&t.endsWith("]")?sr(s):s}static processPositiveBlocks(t,r){let i=/\{\{#([^}]+)\}\}(.*?)\{\{\/\1\}\}/gs;return t.replace(i,(s,a,n)=>{let o=a.trim(),u=this.getNestedValue(r,o);return Array.isArray(u)?u.length===0?"":u.map((c,p)=>{let f={...r,".":c,"@index":p,"@number":p+1,"@first":p===0,"@last":p===u.length-1,"@odd":p%2===1,"@even":p%2===0,"@length":u.length},h=this.processPositiveBlocks(n,f);return h=this.processNegativeBlocks(h,f),h=this.processVariables(h,f),h}).join(""):u?n:""})}static processNegativeBlocks(t,r){let i=/\{\{\^([^}]+)\}\}(.*?)\{\{\/\1\}\}/gs;return t.replace(i,(s,a,n)=>{let o=a.trim(),u=this.getNestedValue(r,o);return u==null||u===""||Array.isArray(u)&&u.length===0?n:""})}static processVariables(t,r){t=t.replace(/\{\{(rand)(?:\|(\d+))?\}\}/g,(s,a,n)=>{let o=n?parseInt(n,10):5;return this.generateRandomString(o)});let i=/\{\{([^#^}|]+)(?:\|([^}]+))?\}\}/g;return t.replace(i,(s,a,n)=>{let o=a.trim();if(o.startsWith("#")||o.startsWith("^"))return"";let u=this.getNestedValue(r,o);if(u==null)return"";if(n)return this.formatValue(u,n.trim());if(typeof u=="object")try{return JSON.stringify(u)}catch(c){return"[Object]"}return String(u)})}static getNestedValue(t,r){if(t[r]!==void 0)return t[r];let i=r.split("."),s=t;for(let a of i){if(s==null)return;s=s[a]}return s}static formatValue(t,r){let i=r.split(":"),s=i[0],a=i.slice(1);if(s.startsWith("rand")){let o=s.match(/^rand(\d+)$/);if(o){let u=parseInt(o[1],10);return this.generateRandomString(u)}}let n=String(t);switch(s){case"upper":case"uppercase":return n.toUpperCase();case"lower":case"lowercase":return n.toLowerCase();case"capitalize":return n.replace(/(?:^|\s)\S/g,f=>f.toUpperCase());case"sentence":return n.charAt(0).toUpperCase()+n.slice(1);case"title":return n.replace(/(?:^|\s)\S/g,f=>f.toUpperCase());case"truncate":let o=a.length>0?parseInt(a[0],10):30;return n.length>o?n.substring(0,o):n;case"ellipsis":let u=a.length>0?parseInt(a[0],10):30;return n.length>u?n.substring(0,u)+"...":n;case"replace":if(a.length>=2){let f=a[0],h=a[1];return n.replace(new RegExp(f,"g"),h)}return n;case"trim":return n.trim();case"prefix":return a.length>0?a[0]+n:n;case"suffix":return a.length>0?n+a[0]:n;case"pad":if(a.length>=2){let f=parseInt(a[0],10),h=a[1]||" ";return n.padStart(f,h)}return n;case"slice":if(a.length>=2){let f=parseInt(a[0],10),h=parseInt(a[1],10);return n.slice(f,h)}else if(a.length==1){let f=parseInt(a[0],10);return n.slice(f)}return n;case"number":try{let f=parseFloat(n);if(isNaN(f))return n;let h=a.length>0?parseInt(a[0],10):void 0;return h!==void 0?f.toFixed(h):f.toString()}catch(f){return n}case"json":try{return JSON.stringify(t)}catch(f){return"[Invalid JSON]"}case"count":return Array.isArray(t)?String(t.length):"0";case"date":try{let f=new Date(t);if(a.length>0){let h=a[0];if(h==="iso")return f.toISOString();if(h==="short")return f.toLocaleDateString();if(h==="long")return f.toLocaleDateString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric"});if(h==="year")return f.getFullYear().toString();if(h==="month")return(f.getMonth()+1).toString();if(h==="day")return f.getDate().toString()}return f.toLocaleDateString()}catch(f){return n}case"abbr":case"abbr1":return n.charAt(0);case"abbr2":return n.substring(0,2);case"abbr3":return n.substring(0,3);case"abbr4":return n.substring(0,4);case"titleword":return this.extractTitleWord(n,1);case"shorttitle":return this.extractTitleWord(n,3);case"split":if(a.length>=1){let f=a[0]||",";return n.split(f).join(",")}return n;case"join":if(Array.isArray(t)&&a.length>=1){let f=a[0]||",";return t.join(f)}return Array.isArray(t)?t.join(","):n;case"urlencode":return encodeURIComponent(n);case"urldecode":return decodeURIComponent(n);default:if(i.length>1)return n;let c=s.match(/^truncate(\d+)$/);if(c){let f=parseInt(c[1],10);return n.length>f?n.substring(0,f):n}let p=s.match(/^abbr(\d+)$/);if(p){let f=parseInt(p[1],10);return n.substring(0,f)}return n}}static extractTitleWord(t,r=1){if(!t)return"";let s=t.replace(/<[^>]+>/g,"").split(/\s+/),a=new Set(["a","an","the","and","or","but","on","in","at","to","for","with","of","from","by","as","into","like","near","over","past","since","upon"]),n=s.map(c=>c.replace(/^[^a-zA-Z0-9]+|[^a-zA-Z0-9]+$/g,"")).filter(c=>c&&!a.has(c.toLowerCase())),o;if(n.length>0)o=n.slice(0,r);else if(s.length>0)o=s.slice(0,r).map(c=>c.replace(/^[^a-zA-Z0-9]+|[^a-zA-Z0-9]+$/g,"")).filter(c=>c);else return"";return o.join("").toLowerCase().replace(/[^a-z0-9]/gi,"")}static generateRandomString(t=5){let r="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",i="",s=Math.max(1,Math.min(32,t));for(let a=0;a<s;a++){let n=Math.floor(Math.random()*r.length);i+=r.charAt(n)}return i}}});var ol=R(qe=>{"use strict";Object.defineProperty(qe,"__esModule",{value:!0});qe.undo=qe.save=qe.retrieveVersion=qe.retrieveLastVersion=qe.currentVersion=void 0;var Qm=Nm(Ii());function Nm(e){return e&&e.__esModule?e:{default:e}}var Im=function(){return this.log.length};qe.currentVersion=Im;var Dm=function(e=1){if(e<=0||e>this.currentVersion())return null;{let[t,r]=this.log[e-1],i=new Qm.default(JSON.parse(t),JSON.parse(r));return i.log=this.log.slice(0,e),i}};qe.retrieveVersion=Dm;var Pm=function(e=1){return this.retrieveVersion(this.currentVersion()-e)};qe.undo=Pm;var Rm=function(){return this.retrieveVersion(this.currentVersion())};qe.retrieveLastVersion=Rm;var Lm=function(){return this.log.push([JSON.stringify(this.data),JSON.stringify(this._options)]),this};qe.save=Lm});var ka=R(Di=>{"use strict";Object.defineProperty(Di,"__esModule",{value:!0});Di.validateOptions=Bm;Di.validateOutputOptions=hl;var ll=["real","string"],ul=["json","html","string","rtf"],cl=["csl","bibtex","bibtxt","citation-*","ris","ndjson"],pl=["string","function"];function hl(e){if(typeof e!="object")throw new TypeError("Options not an object!");let{format:t,type:r,style:i,lang:s,append:a,prepend:n}=e;if(t&&!ll.includes(t))throw new TypeError(`Option format ("${t}") should be one of: ${ll}`);if(r&&!ul.includes(r))throw new TypeError(`Option type ("${r}") should be one of: ${ul}`);if(i&&!cl.includes(i)&&!/^citation/.test(i))throw new TypeError(`Option style ("${i}") should be one of: ${cl}`);if(s&&typeof s!="string")throw new TypeError(`Option lang should be a string, but is a ${typeof s}`);if(n&&!pl.includes(typeof n))throw new TypeError(`Option prepend should be a string or a function, but is a ${typeof n}`);if(a&&!pl.includes(typeof a))throw new TypeError(`Option append should be a string or a function, but is a ${typeof a}`);if(/^citation/.test(i)&&r==="json")throw new Error(`Combination type/style of json/citation-* is not valid: ${r}/${i}`);return!0}function Bm(e){if(typeof e!="object")throw new TypeError("Options should be an object");if(e.output)hl(e.output);else{if(e.maxChainLength&&typeof e.maxChainLength!="number")throw new TypeError("Option maxChainLength should be a number");if(e.forceType&&typeof e.forceType!="string")throw new TypeError("Option forceType should be a string");if(e.generateGraph!=null&&typeof e.generateGraph!="boolean")throw new TypeError("Option generateGraph should be a boolean");if(e.strict!=null&&typeof e.strict!="boolean")throw new TypeError("Option strict should be a boolean");if(e.target!=null&&typeof e.target!="string")throw new TypeError("Option target should be a boolean")}return!0}});var fl=R(nr=>{"use strict";Object.defineProperty(nr,"__esModule",{value:!0});nr.options=nr.defaultOptions=void 0;var Fm=ka(),Mm={format:"real",type:"json",style:"csl",lang:"en-US"};nr.defaultOptions=Mm;var Um=function(e,t){return(0,Fm.validateOutputOptions)(e),t&&this.save(),Object.assign(this._options,e),this};nr.options=Um});var Na=R(or=>{"use strict";Object.defineProperty(or,"__esModule",{value:!0});or.typeOf=or.dataTypeOf=void 0;var Qa=e=>{switch(e){case void 0:return"Undefined";case null:return"Null";default:return e.constructor.name}};or.typeOf=Qa;var qm=e=>{switch(typeof e){case"string":return"String";case"object":if(Array.isArray(e))return"Array";if(Qa(e)==="Object")return"SimpleObject";if(Qa(e)!=="Null")return"ComplexObject";default:return"Primitive"}};or.dataTypeOf=qm});var Ia=R(lr=>{"use strict";Object.defineProperty(lr,"__esModule",{value:!0});lr.removeGraph=lr.applyGraph=void 0;var jm=(e,t)=>{if(e._graph){let r=t.findIndex(({type:i})=>i==="@else/list+object");r!==-1&&t.splice(r+1,0,...e._graph.slice(0,-1))}return e._graph=t,e};lr.applyGraph=jm;var Gm=e=>(delete e._graph,e);lr.removeGraph=Gm});var Rt=R(Pi=>{"use strict";Object.defineProperty(Pi,"__esModule",{value:!0});Pi.default=void 0;var ur={_output(e,t,r){this._log.push(t,r),!(this._levels.indexOf(e)<this._levels.indexOf(this.level))&&this._console.log(t,...r)},_console:null,_log:[],_levels:["http","debug","unmapped","info","warn","error","silent"],level:"silent"};for(let e of ur._levels)ur[e]=(t,...r)=>ur._output(e,t,r);typeof console.Console=="function"?ur._console=new console.Console(process.stderr):ur._console=console;var $m=ur;Pi.default=$m});var Wr=R(Ce=>{"use strict";Object.defineProperty(Ce,"__esModule",{value:!0});Ce.typeMatcher=Ce.type=Ce.treeTypeParser=Ce.removeTypeParser=Ce.listTypeParser=Ce.hasTypeParser=Ce.addTypeParser=void 0;var ml=Hm(Rt()),zm=Na();function Hm(e){return e&&e.__esModule?e:{default:e}}var Ze={},Lt={},cr={},dl=(e,t)=>{switch(t){case"Array":return e.length===0||e.every(r=>bl(r)==="@csl/object")?"@csl/list+object":"@else/list+object";case"SimpleObject":case"ComplexObject":return"@csl/object";default:return"@invalid"}},gl=(e=[],t)=>{for(let r of e)if(Ze[r].predicate(t))return gl(Ze[r].extensions,t)||r},bl=e=>{let t=(0,zm.dataTypeOf)(e);return t==="Array"&&e.length===0?dl(e,t):gl(Lt[t],e)||dl(e,t)};Ce.type=bl;var Vm=(e,{dataType:t,predicate:r,extends:i})=>{let s=[];e in cr&&(s=cr[e],delete cr[e],ml.default.debug("[core]",`Subclasses "${s}" finally registered to parent type "${e}"`));let a={predicate:r,extensions:s};if(Ze[e]=a,i){let n=Ze[i];n?n.extensions.push(e):(cr[i]||(cr[i]=[]),cr[i].push(e),ml.default.debug("[core]",`Subclass "${e}" is waiting on parent type "${i}"`))}else(Lt[t]||(Lt[t]=[])).push(e)};Ce.addTypeParser=Vm;var Ym=e=>Object.prototype.hasOwnProperty.call(Ze,e);Ce.hasTypeParser=Ym;var Jm=e=>{delete Ze[e],[...Object.keys(Lt).map(r=>Lt[r]),...Object.keys(Ze).map(r=>Ze[r].extensions).filter(r=>r.length>0)].forEach(r=>{let i=r.indexOf(e);i>-1&&r.splice(i,1)})};Ce.removeTypeParser=Jm;var Wm=()=>Object.keys(Ze);Ce.listTypeParser=Wm;var Xm=()=>{let e=t=>({name:t,children:Ze[t].extensions.map(e)});return{name:"Type tree",children:Object.keys(Lt).map(t=>({name:t,children:Lt[t].map(e)}))}};Ce.treeTypeParser=Xm;var Km=/^(?:@(.+?))(?:\/(?:(.+?)\+)?(?:(.+)))?$/;Ce.typeMatcher=Km});var Pa=R(bt=>{"use strict";Object.defineProperty(bt,"__esModule",{value:!0});bt.TypeParser=bt.FormatParser=bt.DataParser=void 0;var yl=Wr();function Zm(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Ri=class{constructor(t){Zm(this,"validDataTypes",["String","Array","SimpleObject","ComplexObject","Primitive"]),this.data=t}validateDataType(){let t=this.data.dataType;if(t&&!this.validDataTypes.includes(t))throw new RangeError(`dataType was ${t}; expected one of ${this.validDataTypes}`)}validateParseType(){let t=this.data.predicate;if(t&&!(t instanceof RegExp||typeof t=="function"))throw new TypeError(`predicate was ${typeof t}; expected RegExp or function`)}validateTokenList(){let t=this.data.tokenList;if(t&&typeof t!="object")throw new TypeError(`tokenList was ${typeof t}; expected object or RegExp`)}validatePropertyConstraint(){let t=this.data.propertyConstraint;if(t&&typeof t!="object")throw new TypeError(`propertyConstraint was ${typeof t}; expected array or object`)}validateElementConstraint(){let t=this.data.elementConstraint;if(t&&typeof t!="string")throw new TypeError(`elementConstraint was ${typeof t}; expected string`)}validateExtends(){let t=this.data.extends;if(t&&typeof t!="string")throw new TypeError(`extends was ${typeof t}; expected string`)}validate(){if(this.data===null||typeof this.data!="object")throw new TypeError(`typeParser was ${typeof this.data}; expected object`);this.validateDataType(),this.validateParseType(),this.validateTokenList(),this.validatePropertyConstraint(),this.validateElementConstraint(),this.validateExtends()}parseTokenList(){let t=this.data.tokenList;if(t)t instanceof RegExp&&(t={token:t});else return[];let{token:r,split:i=/\s+/,trim:s=!0,every:a=!0}=t,n=c=>s?c.trim():c,o=a?"every":"some";return[c=>n(c).split(i)[o](p=>r.test(p))]}parsePropertyConstraint(){return[].concat(this.data.propertyConstraint||[]).map(({props:r,match:i,value:s})=>{switch(r=[].concat(r),i){case"any":case"some":return a=>r.some(n=>n in a&&(!s||s(a[n])));case"none":return a=>!r.some(n=>n in a&&(!s||s(a[n])));case"every":default:return a=>r.every(n=>n in a&&(!s||s(a[n])))}})}parseElementConstraint(){let t=this.data.elementConstraint;return t?[r=>r.every(i=>(0,yl.type)(i)===t)]:[]}parsePredicate(){return this.data.predicate instanceof RegExp?[this.data.predicate.test.bind(this.data.predicate)]:this.data.predicate?[this.data.predicate]:[]}getCombinedPredicate(){let t=[...this.parsePredicate(),...this.parseTokenList(),...this.parsePropertyConstraint(),...this.parseElementConstraint()];return t.length===0?()=>!0:t.length===1?t[0]:r=>t.every(i=>i(r))}getDataType(){return this.data.dataType?this.data.dataType:this.data.predicate instanceof RegExp||this.data.tokenList?"String":this.data.elementConstraint?"Array":"Primitive"}get dataType(){return this.getDataType()}get predicate(){return this.getCombinedPredicate()}get extends(){return this.data.extends}};bt.TypeParser=Ri;var Xr=class{constructor(t,{async:r}={}){this.parser=t,this.async=r}validate(){let t=this.parser;if(typeof t!="function")throw new TypeError(`parser was ${typeof t}; expected function`)}};bt.DataParser=Xr;var Da=class{constructor(t,r={}){this.format=t,r.parseType&&(this.typeParser=new Ri(r.parseType)),r.parse&&(this.dataParser=new Xr(r.parse,{async:!1})),r.parseAsync&&(this.asyncDataParser=new Xr(r.parseAsync,{async:!0}))}validateFormat(){let t=this.format;if(!yl.typeMatcher.test(t))throw new TypeError(`format name was "${t}"; didn't match expected pattern`)}validate(){this.validateFormat(),this.typeParser&&this.typeParser.validate(),this.dataParser&&this.dataParser.validate(),this.asyncDataParser&&this.asyncDataParser.validate()}};bt.FormatParser=Da});var El=R(et=>{"use strict";Object.defineProperty(et,"__esModule",{value:!0});et.default=et.parse=et.types=et.scope=void 0;function vl(e,t){return rd(e)||td(e,t)||ed()}function ed(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function td(e,t){var r=[],i=!0,s=!1,a=void 0;try{for(var n=e[Symbol.iterator](),o;!(i=(o=n.next()).done)&&(r.push(o.value),!(t&&r.length===t));i=!0);}catch(u){s=!0,a=u}finally{try{!i&&n.return!=null&&n.return()}finally{if(s)throw a}}return r}function rd(e){if(Array.isArray(e))return e}var _l=e=>e.replace(/$|( )|(?!^)(?=[A-Z])/g,"\\.?$1"),La=e=>`(?:${e.join("|")})\\b`,Ba=(e,t)=>new RegExp(`(?:^| )(${e}$)`,t),id=["mr","mrs","ms","miss","dr","herr","monsieur","hr","frau","a v m","admiraal","admiral","air cdre","air commodore","air marshal","air vice marshal","alderman","alhaji","ambassador","baron","barones","brig","brig gen","brig general","brigadier","brigadier general","brother","canon","capt","captain","cardinal","cdr","chief","cik","cmdr","coach","col","col dr","colonel","commandant","commander","commissioner","commodore","comte","comtessa","congressman","conseiller","consul","conte","contessa","corporal","councillor","count","countess","crown prince","crown princess","dame","datin","dato","datuk","datuk seri","deacon","deaconess","dean","dhr","dipl ing","doctor","dott","dott sa","dr","dr ing","dra","drs","embajador","embajadora","en","encik","eng","eur ing","exma sra","exmo sr","f o","father","first lieutient","first officer","flt lieut","flying officer","fr","frau","fraulein","fru","gen","generaal","general","governor","graaf","gravin","group captain","grp capt","h e dr","h h","h m","h r h","hajah","haji","hajim","her highness","her majesty","herr","high chief","his highness","his holiness","his majesty","hon","hr","hra","ing","ir","jonkheer","judge","justice","khun ying","kolonel","lady","lcda","lic","lieut","lieut cdr","lieut col","lieut gen","lord","m","m l","m r","madame","mademoiselle","maj gen","major","master","mevrouw","miss","mlle","mme","monsieur","monsignor","mr","mrs","ms","mstr","nti","pastor","president","prince","princess","princesse","prinses","prof","prof dr","prof sir","professor","puan","puan sri","rabbi","rear admiral","rev","rev canon","rev dr","rev mother","reverend","rva","senator","sergeant","sheikh","sheikha","sig","sig na","sig ra","sir","sister","sqn ldr","sr","sr d","sra","srta","sultan","tan sri","tan sri dato","tengku","teuku","than puying","the hon dr","the hon justice","the hon miss","the hon mr","the hon mrs","the hon ms","the hon sir","the very rev","toh puan","tun","vice admiral","viscount","viscountess","wg cdr"],sd=["I","II","III","IV","V","Senior","Junior","Jr","Sr","PhD","Ph\\.D","APR","RPh","PE","MD","MA","DMD","CME","BVM","CFRE","CLU","CPA","CSC","CSJ","DC","DD","DDS","DO","DVM","EdD","Esq","JD","LLD","OD","OSB","PC","Ret","RGS","RN","RNC","SHCJ","SJ","SNJM","SSMO","USA","USAF","USAFR","USAR","USCG","USMC","USMCR","USN","USNR"],ad=["Vere","Von","Van","De","Del","Della","Di","Da","Pietro","Vanden","Du","St.","St","La","Lo","Ter","O","O'","Mac","Fitz"],nd=La(id.map(_l)),Ra=La(sd.map(_l)),od=La(ad),ld=new RegExp(`^((?:${nd} )*)(.*)$`,"i"),ud=Ba(`(?:${Ra}, )*(?:${Ra})`,"i"),cd=Ba(`${/(?:[A-Z\xC0-\xD6\xD8-\xDE\u0100\u0102\u0104\u0106\u0108\u010A\u010C\u010E\u0110\u0112\u0114\u0116\u0118\u011A\u011C\u011E\u0120\u0122\u0124\u0126\u0128\u012A\u012C\u012E\u0130\u0132\u0134\u0136\u0139\u013B\u013D\u013F\u0141\u0143\u0145\u0147\u014A\u014C\u014E\u0150\u0152\u0154\u0156\u0158\u015A\u015C\u015E\u0160\u0162\u0164\u0166\u0168\u016A\u016C\u016E\u0170\u0172\u0174\u0176\u0178\u0179\u017B\u017D\u0181\u0182\u0184\u0186\u0187\u0189-\u018B\u018E-\u0191\u0193\u0194\u0196-\u0198\u019C\u019D\u019F\u01A0\u01A2\u01A4\u01A6\u01A7\u01A9\u01AC\u01AE\u01AF\u01B1-\u01B3\u01B5\u01B7\u01B8\u01BC\u01C4\u01C7\u01CA\u01CD\u01CF\u01D1\u01D3\u01D5\u01D7\u01D9\u01DB\u01DE\u01E0\u01E2\u01E4\u01E6\u01E8\u01EA\u01EC\u01EE\u01F1\u01F4\u01F6-\u01F8\u01FA\u01FC\u01FE\u0200\u0202\u0204\u0206\u0208\u020A\u020C\u020E\u0210\u0212\u0214\u0216\u0218\u021A\u021C\u021E\u0220\u0222\u0224\u0226\u0228\u022A\u022C\u022E\u0230\u0232\u023A\u023B\u023D\u023E\u0241\u0243-\u0246\u0248\u024A\u024C\u024E\u0370\u0372\u0376\u037F\u0386\u0388-\u038A\u038C\u038E\u038F\u0391-\u03A1\u03A3-\u03AB\u03CF\u03D2-\u03D4\u03D8\u03DA\u03DC\u03DE\u03E0\u03E2\u03E4\u03E6\u03E8\u03EA\u03EC\u03EE\u03F4\u03F7\u03F9\u03FA\u03FD-\u042F\u0460\u0462\u0464\u0466\u0468\u046A\u046C\u046E\u0470\u0472\u0474\u0476\u0478\u047A\u047C\u047E\u0480\u048A\u048C\u048E\u0490\u0492\u0494\u0496\u0498\u049A\u049C\u049E\u04A0\u04A2\u04A4\u04A6\u04A8\u04AA\u04AC\u04AE\u04B0\u04B2\u04B4\u04B6\u04B8\u04BA\u04BC\u04BE\u04C0\u04C1\u04C3\u04C5\u04C7\u04C9\u04CB\u04CD\u04D0\u04D2\u04D4\u04D6\u04D8\u04DA\u04DC\u04DE\u04E0\u04E2\u04E4\u04E6\u04E8\u04EA\u04EC\u04EE\u04F0\u04F2\u04F4\u04F6\u04F8\u04FA\u04FC\u04FE\u0500\u0502\u0504\u0506\u0508\u050A\u050C\u050E\u0510\u0512\u0514\u0516\u0518\u051A\u051C\u051E\u0520\u0522\u0524\u0526\u0528\u052A\u052C\u052E\u0531-\u0556\u10A0-\u10C5\u10C7\u10CD\u13A0-\u13F5\u1C90-\u1CBA\u1CBD-\u1CBF\u1E00\u1E02\u1E04\u1E06\u1E08\u1E0A\u1E0C\u1E0E\u1E10\u1E12\u1E14\u1E16\u1E18\u1E1A\u1E1C\u1E1E\u1E20\u1E22\u1E24\u1E26\u1E28\u1E2A\u1E2C\u1E2E\u1E30\u1E32\u1E34\u1E36\u1E38\u1E3A\u1E3C\u1E3E\u1E40\u1E42\u1E44\u1E46\u1E48\u1E4A\u1E4C\u1E4E\u1E50\u1E52\u1E54\u1E56\u1E58\u1E5A\u1E5C\u1E5E\u1E60\u1E62\u1E64\u1E66\u1E68\u1E6A\u1E6C\u1E6E\u1E70\u1E72\u1E74\u1E76\u1E78\u1E7A\u1E7C\u1E7E\u1E80\u1E82\u1E84\u1E86\u1E88\u1E8A\u1E8C\u1E8E\u1E90\u1E92\u1E94\u1E9E\u1EA0\u1EA2\u1EA4\u1EA6\u1EA8\u1EAA\u1EAC\u1EAE\u1EB0\u1EB2\u1EB4\u1EB6\u1EB8\u1EBA\u1EBC\u1EBE\u1EC0\u1EC2\u1EC4\u1EC6\u1EC8\u1ECA\u1ECC\u1ECE\u1ED0\u1ED2\u1ED4\u1ED6\u1ED8\u1EDA\u1EDC\u1EDE\u1EE0\u1EE2\u1EE4\u1EE6\u1EE8\u1EEA\u1EEC\u1EEE\u1EF0\u1EF2\u1EF4\u1EF6\u1EF8\u1EFA\u1EFC\u1EFE\u1F08-\u1F0F\u1F18-\u1F1D\u1F28-\u1F2F\u1F38-\u1F3F\u1F48-\u1F4D\u1F59\u1F5B\u1F5D\u1F5F\u1F68-\u1F6F\u1FB8-\u1FBB\u1FC8-\u1FCB\u1FD8-\u1FDB\u1FE8-\u1FEC\u1FF8-\u1FFB\u2102\u2107\u210B-\u210D\u2110-\u2112\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u2130-\u2133\u213E\u213F\u2145\u2160-\u216F\u2183\u24B6-\u24CF\u2C00-\u2C2E\u2C60\u2C62-\u2C64\u2C67\u2C69\u2C6B\u2C6D-\u2C70\u2C72\u2C75\u2C7E-\u2C80\u2C82\u2C84\u2C86\u2C88\u2C8A\u2C8C\u2C8E\u2C90\u2C92\u2C94\u2C96\u2C98\u2C9A\u2C9C\u2C9E\u2CA0\u2CA2\u2CA4\u2CA6\u2CA8\u2CAA\u2CAC\u2CAE\u2CB0\u2CB2\u2CB4\u2CB6\u2CB8\u2CBA\u2CBC\u2CBE\u2CC0\u2CC2\u2CC4\u2CC6\u2CC8\u2CCA\u2CCC\u2CCE\u2CD0\u2CD2\u2CD4\u2CD6\u2CD8\u2CDA\u2CDC\u2CDE\u2CE0\u2CE2\u2CEB\u2CED\u2CF2\uA640\uA642\uA644\uA646\uA648\uA64A\uA64C\uA64E\uA650\uA652\uA654\uA656\uA658\uA65A\uA65C\uA65E\uA660\uA662\uA664\uA666\uA668\uA66A\uA66C\uA680\uA682\uA684\uA686\uA688\uA68A\uA68C\uA68E\uA690\uA692\uA694\uA696\uA698\uA69A\uA722\uA724\uA726\uA728\uA72A\uA72C\uA72E\uA732\uA734\uA736\uA738\uA73A\uA73C\uA73E\uA740\uA742\uA744\uA746\uA748\uA74A\uA74C\uA74E\uA750\uA752\uA754\uA756\uA758\uA75A\uA75C\uA75E\uA760\uA762\uA764\uA766\uA768\uA76A\uA76C\uA76E\uA779\uA77B\uA77D\uA77E\uA780\uA782\uA784\uA786\uA78B\uA78D\uA790\uA792\uA796\uA798\uA79A\uA79C\uA79E\uA7A0\uA7A2\uA7A4\uA7A6\uA7A8\uA7AA-\uA7AE\uA7B0-\uA7B4\uA7B6\uA7B8\uFF21-\uFF3A]|\uD801[\uDC00-\uDC27\uDCB0-\uDCD3]|\uD803[\uDC80-\uDCB2]|\uD806[\uDCA0-\uDCBF]|\uD81B[\uDE40-\uDE5F]|\uD835[\uDC00-\uDC19\uDC34-\uDC4D\uDC68-\uDC81\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB5\uDCD0-\uDCE9\uDD04\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD38\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD6C-\uDD85\uDDA0-\uDDB9\uDDD4-\uDDED\uDE08-\uDE21\uDE3C-\uDE55\uDE70-\uDE89\uDEA8-\uDEC0\uDEE2-\uDEFA\uDF1C-\uDF34\uDF56-\uDF6E\uDF90-\uDFA8\uDFCA]|\uD83A[\uDD00-\uDD21]|\uD83C[\uDD30-\uDD49\uDD50-\uDD69\uDD70-\uDD89])/.source}.*`),pd=Ba(`(?:${/(?:[a-z\xAA\xB5\xBA\xDF-\xF6\xF8-\xFF\u0101\u0103\u0105\u0107\u0109\u010B\u010D\u010F\u0111\u0113\u0115\u0117\u0119\u011B\u011D\u011F\u0121\u0123\u0125\u0127\u0129\u012B\u012D\u012F\u0131\u0133\u0135\u0137\u0138\u013A\u013C\u013E\u0140\u0142\u0144\u0146\u0148\u0149\u014B\u014D\u014F\u0151\u0153\u0155\u0157\u0159\u015B\u015D\u015F\u0161\u0163\u0165\u0167\u0169\u016B\u016D\u016F\u0171\u0173\u0175\u0177\u017A\u017C\u017E-\u0180\u0183\u0185\u0188\u018C\u018D\u0192\u0195\u0199-\u019B\u019E\u01A1\u01A3\u01A5\u01A8\u01AA\u01AB\u01AD\u01B0\u01B4\u01B6\u01B9\u01BA\u01BD-\u01BF\u01C6\u01C9\u01CC\u01CE\u01D0\u01D2\u01D4\u01D6\u01D8\u01DA\u01DC\u01DD\u01DF\u01E1\u01E3\u01E5\u01E7\u01E9\u01EB\u01ED\u01EF\u01F0\u01F3\u01F5\u01F9\u01FB\u01FD\u01FF\u0201\u0203\u0205\u0207\u0209\u020B\u020D\u020F\u0211\u0213\u0215\u0217\u0219\u021B\u021D\u021F\u0221\u0223\u0225\u0227\u0229\u022B\u022D\u022F\u0231\u0233-\u0239\u023C\u023F\u0240\u0242\u0247\u0249\u024B\u024D\u024F-\u0293\u0295-\u02B8\u02C0\u02C1\u02E0-\u02E4\u0345\u0371\u0373\u0377\u037A-\u037D\u0390\u03AC-\u03CE\u03D0\u03D1\u03D5-\u03D7\u03D9\u03DB\u03DD\u03DF\u03E1\u03E3\u03E5\u03E7\u03E9\u03EB\u03ED\u03EF-\u03F3\u03F5\u03F8\u03FB\u03FC\u0430-\u045F\u0461\u0463\u0465\u0467\u0469\u046B\u046D\u046F\u0471\u0473\u0475\u0477\u0479\u047B\u047D\u047F\u0481\u048B\u048D\u048F\u0491\u0493\u0495\u0497\u0499\u049B\u049D\u049F\u04A1\u04A3\u04A5\u04A7\u04A9\u04AB\u04AD\u04AF\u04B1\u04B3\u04B5\u04B7\u04B9\u04BB\u04BD\u04BF\u04C2\u04C4\u04C6\u04C8\u04CA\u04CC\u04CE\u04CF\u04D1\u04D3\u04D5\u04D7\u04D9\u04DB\u04DD\u04DF\u04E1\u04E3\u04E5\u04E7\u04E9\u04EB\u04ED\u04EF\u04F1\u04F3\u04F5\u04F7\u04F9\u04FB\u04FD\u04FF\u0501\u0503\u0505\u0507\u0509\u050B\u050D\u050F\u0511\u0513\u0515\u0517\u0519\u051B\u051D\u051F\u0521\u0523\u0525\u0527\u0529\u052B\u052D\u052F\u0560-\u0588\u10D0-\u10FA\u10FD-\u10FF\u13F8-\u13FD\u1C80-\u1C88\u1D00-\u1DBF\u1E01\u1E03\u1E05\u1E07\u1E09\u1E0B\u1E0D\u1E0F\u1E11\u1E13\u1E15\u1E17\u1E19\u1E1B\u1E1D\u1E1F\u1E21\u1E23\u1E25\u1E27\u1E29\u1E2B\u1E2D\u1E2F\u1E31\u1E33\u1E35\u1E37\u1E39\u1E3B\u1E3D\u1E3F\u1E41\u1E43\u1E45\u1E47\u1E49\u1E4B\u1E4D\u1E4F\u1E51\u1E53\u1E55\u1E57\u1E59\u1E5B\u1E5D\u1E5F\u1E61\u1E63\u1E65\u1E67\u1E69\u1E6B\u1E6D\u1E6F\u1E71\u1E73\u1E75\u1E77\u1E79\u1E7B\u1E7D\u1E7F\u1E81\u1E83\u1E85\u1E87\u1E89\u1E8B\u1E8D\u1E8F\u1E91\u1E93\u1E95-\u1E9D\u1E9F\u1EA1\u1EA3\u1EA5\u1EA7\u1EA9\u1EAB\u1EAD\u1EAF\u1EB1\u1EB3\u1EB5\u1EB7\u1EB9\u1EBB\u1EBD\u1EBF\u1EC1\u1EC3\u1EC5\u1EC7\u1EC9\u1ECB\u1ECD\u1ECF\u1ED1\u1ED3\u1ED5\u1ED7\u1ED9\u1EDB\u1EDD\u1EDF\u1EE1\u1EE3\u1EE5\u1EE7\u1EE9\u1EEB\u1EED\u1EEF\u1EF1\u1EF3\u1EF5\u1EF7\u1EF9\u1EFB\u1EFD\u1EFF-\u1F07\u1F10-\u1F15\u1F20-\u1F27\u1F30-\u1F37\u1F40-\u1F45\u1F50-\u1F57\u1F60-\u1F67\u1F70-\u1F7D\u1F80-\u1F87\u1F90-\u1F97\u1FA0-\u1FA7\u1FB0-\u1FB4\u1FB6\u1FB7\u1FBE\u1FC2-\u1FC4\u1FC6\u1FC7\u1FD0-\u1FD3\u1FD6\u1FD7\u1FE0-\u1FE7\u1FF2-\u1FF4\u1FF6\u1FF7\u2071\u207F\u2090-\u209C\u210A\u210E\u210F\u2113\u212F\u2134\u2139\u213C\u213D\u2146-\u2149\u214E\u2170-\u217F\u2184\u24D0-\u24E9\u2C30-\u2C5E\u2C61\u2C65\u2C66\u2C68\u2C6A\u2C6C\u2C71\u2C73\u2C74\u2C76-\u2C7D\u2C81\u2C83\u2C85\u2C87\u2C89\u2C8B\u2C8D\u2C8F\u2C91\u2C93\u2C95\u2C97\u2C99\u2C9B\u2C9D\u2C9F\u2CA1\u2CA3\u2CA5\u2CA7\u2CA9\u2CAB\u2CAD\u2CAF\u2CB1\u2CB3\u2CB5\u2CB7\u2CB9\u2CBB\u2CBD\u2CBF\u2CC1\u2CC3\u2CC5\u2CC7\u2CC9\u2CCB\u2CCD\u2CCF\u2CD1\u2CD3\u2CD5\u2CD7\u2CD9\u2CDB\u2CDD\u2CDF\u2CE1\u2CE3\u2CE4\u2CEC\u2CEE\u2CF3\u2D00-\u2D25\u2D27\u2D2D\uA641\uA643\uA645\uA647\uA649\uA64B\uA64D\uA64F\uA651\uA653\uA655\uA657\uA659\uA65B\uA65D\uA65F\uA661\uA663\uA665\uA667\uA669\uA66B\uA66D\uA681\uA683\uA685\uA687\uA689\uA68B\uA68D\uA68F\uA691\uA693\uA695\uA697\uA699\uA69B-\uA69D\uA723\uA725\uA727\uA729\uA72B\uA72D\uA72F-\uA731\uA733\uA735\uA737\uA739\uA73B\uA73D\uA73F\uA741\uA743\uA745\uA747\uA749\uA74B\uA74D\uA74F\uA751\uA753\uA755\uA757\uA759\uA75B\uA75D\uA75F\uA761\uA763\uA765\uA767\uA769\uA76B\uA76D\uA76F-\uA778\uA77A\uA77C\uA77F\uA781\uA783\uA785\uA787\uA78C\uA78E\uA791\uA793-\uA795\uA797\uA799\uA79B\uA79D\uA79F\uA7A1\uA7A3\uA7A5\uA7A7\uA7A9\uA7AF\uA7B5\uA7B7\uA7B9\uA7F8-\uA7FA\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABBF\uFB00-\uFB06\uFB13-\uFB17\uFF41-\uFF5A]|\uD801[\uDC28-\uDC4F\uDCD8-\uDCFB]|\uD803[\uDCC0-\uDCF2]|\uD806[\uDCC0-\uDCDF]|\uD81B[\uDE60-\uDE7F]|\uD835[\uDC1A-\uDC33\uDC4E-\uDC54\uDC56-\uDC67\uDC82-\uDC9B\uDCB6-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDCCF\uDCEA-\uDD03\uDD1E-\uDD37\uDD52-\uDD6B\uDD86-\uDD9F\uDDBA-\uDDD3\uDDEE-\uDE07\uDE22-\uDE3B\uDE56-\uDE6F\uDE8A-\uDEA5\uDEC2-\uDEDA\uDEDC-\uDEE1\uDEFC-\uDF14\uDF16-\uDF1B\uDF36-\uDF4E\uDF50-\uDF55\uDF70-\uDF88\uDF8A-\uDF8F\uDFAA-\uDFC2\uDFC4-\uDFC9\uDFCB]|\uD83A[\uDD22-\uDD43])/.source}.*|${od}.*|\\S*)`),hd=function(t=""){typeof t!="string"&&(t=t+"");let r="",i="",s="";if(/[^.], /.test(t)){let g=t.split(", ");s=g.shift();let d=RegExp(Ra).exec(g.join(", "));r=g.splice(d&&d.index!==0?0:-1,1)[0],i=g.join(", ")}else{let g=t.split(ud,2),d=g.shift().split(pd,2);r=d[0],s=d[1],i=g.pop()}let a=r.match(ld),n=vl(a,3),o=n[1],u=n[2],c=i,p=s.split(cd,2).reverse(),f=vl(p,2),h=f[0],m=f[1];if(!u&&h)return h.includes(" ")?{literal:h}:{family:h};if(h){let g={"dropping-particle":o,given:u,suffix:c,"non-dropping-particle":m,family:h};return Object.keys(g).forEach(d=>{g[d]||delete g[d]}),g}else return{literal:t}};et.default=et.parse=hd;var fd="@name";et.scope=fd;var md="@name";et.types=md});var xl=R(Li=>{"use strict";Object.defineProperty(Li,"__esModule",{value:!0});Li.default=void 0;var Fa=["dropping-particle","given"],Ma=["suffix"],wl=["non-dropping-particle","family"],dd=function(t,r=!1){let i=s=>s.map(a=>t[a]||"").filter(Boolean).join(" ");if(t.literal)return t.literal;if(r){let s=i(Ma)?`, ${i(Ma)}`:"",a=i(Fa)?`, ${i(Fa)}`:"";return i(wl)+s+a}else return`${i([...Fa,...Ma,...wl])}`},gd=dd;Li.default=gd});var pr=R(Bi=>{"use strict";Object.defineProperty(Bi,"__esModule",{value:!0});Object.defineProperty(Bi,"parse",{enumerable:!0,get:function(){return bd.default}});Object.defineProperty(Bi,"format",{enumerable:!0,get:function(){return yd.default}});var bd=Tl(El()),yd=Tl(xl());function Tl(e){return e&&e.__esModule?e:{default:e}}});var Ga=R(Fi=>{"use strict";Object.defineProperty(Fi,"__esModule",{value:!0});Fi.clean=void 0;var vd=pr();function Al(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}function Sl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Al(Object(r),!0).forEach(function(i){_d(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Al(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function _d(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Ed=1,Ne=2,Bt=3,Ol=4,Ua={article:!0,"article-journal":!0,"article-magazine":!0,"article-newspaper":!0,bill:!0,book:!0,broadcast:!0,chapter:!0,classic:!0,collection:!0,dataset:!0,document:!0,entry:!0,"entry-dictionary":!0,"entry-encyclopedia":!0,event:!0,figure:!0,graphic:!0,hearing:!0,interview:!0,legal_case:!0,legislation:!0,manuscript:!0,map:!0,motion_picture:!0,musical_score:!0,pamphlet:!0,"paper-conference":!0,patent:!0,performance:!0,periodical:!0,personal_communication:!0,post:!0,"post-weblog":!0,regulation:!0,report:!0,review:!0,"review-book":!0,software:!0,song:!0,speech:!0,standard:!0,thesis:!0,treaty:!0,webpage:!0,"journal-article":"article-journal","book-chapter":"chapter","posted-content":"manuscript","proceedings-article":"paper-conference"},Cl={author:Ne,"collection-editor":Ne,composer:Ne,"container-author":Ne,editor:Ne,"editorial-director":Ne,director:Ne,interviewer:Ne,illustrator:Ne,"original-author":Ne,"reviewed-author":Ne,recipient:Ne,translator:Ne,accessed:Bt,container:Bt,"event-date":Bt,issued:Bt,"original-date":Bt,submitted:Bt,type:Ol,categories:"object",id:["string","number"],language:"string",journalAbbreviation:"string",shortTitle:"string",abstract:"string",annote:"string",archive:"string",archive_location:"string","archive-place":"string",authority:"string","call-number":"string","chapter-number":"string","citation-number":"string","citation-label":"string","collection-number":"string","collection-title":"string","container-title":"string","container-title-short":"string",dimensions:"string",DOI:"string",edition:["string","number"],event:"string","event-place":"string","first-reference-note-number":"string",genre:"string",ISBN:"string",ISSN:"string",issue:["string","number"],jurisdiction:"string",keyword:"string",locator:"string",medium:"string",note:"string",number:["string","number"],"number-of-pages":"string","number-of-volumes":["string","number"],"original-publisher":"string","original-publisher-place":"string","original-title":"string",page:"string","page-first":"string",PMCID:"string",PMID:"string",publisher:"string","publisher-place":"string",references:"string","reviewed-title":"string",scale:"string",section:"string",source:"string",status:"string",title:"string","title-short":"string",URL:"string",version:"string",volume:["string","number"],"year-suffix":"string"},kl=function(e,t){if(typeof e=="object"&&e!==null&&(e.literal||e.given||e.family))return e;if(t){if(typeof e=="string")return(0,vd.parse)(e)}else return},wd=function(e,t){if(e instanceof Array){let r=e.map(i=>kl(i,t)).filter(Boolean);return r.length?r:void 0}},qa=function(e,t){return e.every(r=>typeof r=="number")?e:!t||e.some(r=>isNaN(parseInt(r)))?void 0:e.map(r=>parseInt(r))},xd=function(e,t){let r="date-parts";if(!(typeof e!="object"||e===null)){if(e[r]instanceof Array&&e[r].every(i=>i instanceof Array)){let i=e[r].map(s=>qa(s,t)).filter(Boolean);return i.length?Sl(Sl({},e),{},{"date-parts":i}):void 0}else if(e instanceof Array&&e.every(i=>i[r]instanceof Array)){let i=e.map(s=>qa(s[r],t)).filter(Boolean);return i.length?{"date-parts":i}:void 0}else if(e[r]instanceof Array){let i=qa(e[r],t);return i&&{"date-parts":[i]}}else if("literal"in e||"raw"in e)return e}},Td=function(e,t){return e=ja("language",e,t),Ua[e]===!0?e:t&&e in Ua?Ua[e]:void 0},ja=function(e,t,r){let i=[].concat(Cl[e]);switch(Cl[e]){case Ed:return kl(t,r);case Ne:return wd(t,r);case Bt:return xd(t,r);case Ol:return Td(t,r)}if(/^_/.test(e))return t;if(r){if(typeof t=="string"&&i.includes("number")&&!i.includes("string")&&!isNaN(+t))return parseFloat(t);if(typeof t=="number"&&i.includes("string")&&!i.includes("number"))return t.toString();if(Array.isArray(t)&&t.length)return ja(e,t[0],r)}if(i.includes(typeof t))return t},Ad=function(e,t=!0){return e.map(function(r){let i={};for(let s in r){let a=ja(s,r[s],t);a!==void 0&&(i[s]=a)}return i})};Fi.clean=Ad});var Ui=R(Kr=>{"use strict";Object.defineProperty(Kr,"__esModule",{value:!0});Kr.deepCopy=Mi;Kr.default=void 0;function Mi(e,t=new Set){if(typeof e!="object"||e===null||e.constructor!==Object&&e.constructor!==Array)return e;if(t.has(e))throw new TypeError("Recursively copying circular structure");t.add(e);let r;if(e.constructor===Array)r=e.map(i=>Mi(i,t));else{let i={};for(let s in e)i[s]=Mi(e[s],t);r=i}return t.delete(e),r}var Sd=Mi;Kr.default=Sd});var za=R(tt=>{"use strict";Object.defineProperty(tt,"__esModule",{value:!0});tt.chainLinkAsync=tt.chainLink=tt.chainAsync=tt.chain=void 0;var $a=Nl(Ui()),Cd=Nl(Rt()),Od=Ha(),qi=Wr(),Gi=$i(),Ql=Ia();function Nl(e){return e&&e.__esModule?e:{default:e}}function kd(e){return e.reduce((t,r)=>{let i=t[t.length-1];return i&&i.type===r.type?i.count=i.count+1||2:t.push(r),t},[]).map(t=>(t.count>1?t.count+"x ":"")+t.type).join(" -> ")}var ji=class{constructor(t,r={}){this.options=Object.assign({generateGraph:!0,forceType:(0,qi.type)(t),maxChainLength:10,strict:!0,target:"@csl/list+object"},r),this.type=this.options.forceType,this.data=typeof t=="object"?(0,$a.default)(t):t,this.graph=[{type:this.type,data:t}],this.iteration=0}iterate(){if(this.iteration!==0){let t=(0,Od.get)(this.type);t&&t.outputs?this.type=t.outputs:this.type=(0,qi.type)(this.data),this.graph.push({type:this.type})}return this.error||this.type===this.options.target?!1:this.iteration>=this.options.maxChainLength?(this.error=new RangeError(`Max. number of parsing iterations reached (${kd(this.graph)})`),!1):(this.iteration++,!0)}end(){if(this.error){if(Cd.default.error("[core]",this.error.message),this.options.strict!==!1)throw this.error;return[]}else return this.options.target==="@csl/list+object"?this.data.map(this.options.generateGraph?t=>(0,Ql.applyGraph)(t,this.graph):Ql.removeGraph):this.data}},Qd=(...e)=>{let t=new ji(...e);for(;t.iterate();)try{t.data=(0,Gi.data)(t.data,t.type)}catch(r){t.error=r}return t.end()};tt.chain=Qd;var Nd=e=>{let t=(0,qi.type)(e),r=t.match(/array|object/)?(0,$a.default)(e):e;return(0,Gi.data)(r,t)};tt.chainLink=Nd;var Id=async(...e)=>{let t=new ji(...e);for(;t.iterate();)t.data=await(0,Gi.dataAsync)(t.data,t.type).catch(r=>{t.error=r});return t.end()};tt.chainAsync=Id;var Dd=async e=>{let t=(0,qi.type)(e),r=t.match(/array|object/)?(0,$a.default)(e):e;return(0,Gi.dataAsync)(r,t)};tt.chainLinkAsync=Dd});var $i=R(Ie=>{"use strict";Object.defineProperty(Ie,"__esModule",{value:!0});Ie.removeDataParser=Ie.listDataParser=Ie.hasDataParser=Ie.dataAsync=Ie.data=Ie.addDataParser=void 0;var Il=za(),Dl=e=>[].concat(...e),hr={},fr={},Va={"@csl/object":e=>[e],"@csl/list+object":e=>e,"@else/list+object":e=>Dl(e.map(Il.chain)),"@invalid":()=>{throw new Error("This format is not supported or recognized")}},Ya={"@else/list+object":async e=>Dl(await Promise.all(e.map(Il.chainAsync)))},Pl=(e,t)=>{if(typeof hr[t]=="function")return hr[t](e);if(typeof Va[t]=="function")return Va[t](e);throw new TypeError(`No synchronous parser found for ${t}`)};Ie.data=Pl;var Pd=async(e,t)=>{if(typeof fr[t]=="function")return fr[t](e);if(typeof Ya[t]=="function")return Ya[t](e);if(Rl(t,!1))return Pl(e,t);throw new TypeError(`No parser found for ${t}`)};Ie.dataAsync=Pd;var Rd=(e,{parser:t,async:r})=>{r?fr[e]=t:hr[e]=t};Ie.addDataParser=Rd;var Rl=(e,t)=>t?fr[e]||Ya[e]:hr[e]||Va[e];Ie.hasDataParser=Rl;var Ld=(e,t)=>{delete(t?fr:hr)[e]};Ie.removeDataParser=Ld;var Bd=e=>Object.keys(e?fr:hr);Ie.listDataParser=Bd});var Ha=R(je=>{"use strict";Object.defineProperty(je,"__esModule",{value:!0});je.remove=je.list=je.has=je.get=je.add=void 0;var Fd=Pa(),Ll=Wr(),zi=$i(),Ft={},Md=(e,t)=>{let r=new Fd.FormatParser(e,t);r.validate();let i=Ft[e]||(Ft[e]={});r.typeParser&&((0,Ll.addTypeParser)(e,r.typeParser),i.type=!0),r.dataParser&&((0,zi.addDataParser)(e,r.dataParser),i.data=!0),r.asyncDataParser&&((0,zi.addDataParser)(e,r.asyncDataParser),i.asyncData=!0),t.outputs&&(i.outputs=t.outputs)};je.add=Md;var Ud=e=>Ft[e];je.get=Ud;var qd=e=>{let t=Ft[e];t&&(t.type&&(0,Ll.removeTypeParser)(e),t.data&&(0,zi.removeDataParser)(e),t.asyncData&&(0,zi.removeDataParser)(e,!0),delete Ft[e])};je.remove=qd;var jd=e=>e in Ft;je.has=jd;var Gd=()=>Object.keys(Ft);je.list=Gd});var Za=R(Oe=>{"use strict";Object.defineProperty(Oe,"__esModule",{value:!0});var Hi={util:!0};Oe.util=void 0;var $d=Vi(Na()),zd=Vi(Ia()),Hd=Vi(Pa()),Vd=Vi(Ga()),Ja=Ha();Object.keys(Ja).forEach(function(e){e==="default"||e==="__esModule"||Object.prototype.hasOwnProperty.call(Hi,e)||e in Oe&&Oe[e]===Ja[e]||Object.defineProperty(Oe,e,{enumerable:!0,get:function(){return Ja[e]}})});var Wa=za();Object.keys(Wa).forEach(function(e){e==="default"||e==="__esModule"||Object.prototype.hasOwnProperty.call(Hi,e)||e in Oe&&Oe[e]===Wa[e]||Object.defineProperty(Oe,e,{enumerable:!0,get:function(){return Wa[e]}})});var Xa=Wr();Object.keys(Xa).forEach(function(e){e==="default"||e==="__esModule"||Object.prototype.hasOwnProperty.call(Hi,e)||e in Oe&&Oe[e]===Xa[e]||Object.defineProperty(Oe,e,{enumerable:!0,get:function(){return Xa[e]}})});var Ka=$i();Object.keys(Ka).forEach(function(e){e==="default"||e==="__esModule"||Object.prototype.hasOwnProperty.call(Hi,e)||e in Oe&&Oe[e]===Ka[e]||Object.defineProperty(Oe,e,{enumerable:!0,get:function(){return Ka[e]}})});function Bl(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,r=new WeakMap;return(Bl=function(i){return i?r:t})(e)}function Vi(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||typeof e!="object"&&typeof e!="function")return{default:e};var r=Bl(t);if(r&&r.has(e))return r.get(e);var i={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(a!=="default"&&Object.prototype.hasOwnProperty.call(e,a)){var n=s?Object.getOwnPropertyDescriptor(e,a):null;n&&(n.get||n.set)?Object.defineProperty(i,a,n):i[a]=e[a]}return i.default=e,r&&r.set(e,i),i}var Yd=Object.assign({},$d,zd,Hd,Vd);Oe.util=Yd});var en=R(Yi=>{"use strict";Object.defineProperty(Yi,"__esModule",{value:!0});Yi.default=void 0;var Jd=function(e,t){let r;for(;r===void 0||e.includes(r);)r=`${t}${Math.random().toString().slice(2)}`;return r},Wd=Jd;Yi.default=Wd});var Ul=R(Ge=>{"use strict";Object.defineProperty(Ge,"__esModule",{value:!0});Ge.setAsync=Ge.set=Ge.reset=Ge.addAsync=Ge.add=void 0;var Fl=Za(),Ml=Xd(en());function Xd(e){return e&&e.__esModule?e:{default:e}}var Kd=function(e,t={},r=!1){return(t===!0||r===!0)&&this.save(),this.data.push(...(0,Fl.chain)(e,t)),this.data.filter(i=>!Object.prototype.hasOwnProperty.call(i,"id")).forEach(i=>{i.id=(0,Ml.default)(this.getIds(),"temp_id_")}),this};Ge.add=Kd;var Zd=async function(e,t={},r=!1){return(t===!0||r===!0)&&this.save(),this.data.push(...await(0,Fl.chainAsync)(e,t)),this.data.filter(i=>!Object.prototype.hasOwnProperty.call(i,"id")).forEach(i=>{i.id=(0,Ml.default)(this.getIds(),"temp_id_")}),this};Ge.addAsync=Zd;var eg=function(e,t={},r=!1){return(t===!0||r===!0)&&this.save(),this.data=[],typeof t!="boolean"?this.add(e,t):this.add(e)};Ge.set=eg;var tg=async function(e,t={},r=!1){return(t===!0||r===!0)&&this.save(),this.data=[],typeof t!="boolean"?this.addAsync(e,t):this.addAsync(e)};Ge.setAsync=tg;var rg=function(e){return e&&this.save(),this.data=[],this._options={},this};Ge.reset=rg});var tn=R(mr=>{"use strict";Object.defineProperty(mr,"__esModule",{value:!0});mr.getLabel=mr.default=void 0;var ql=e=>{if("citation-label"in e)return e["citation-label"];let t="";return e.author&&(t+=e.author[0].family||e.author[0].literal),e.issued&&e.issued["date-parts"]&&e.issued["date-parts"][0]&&(t+=e.issued["date-parts"][0][0]),e["year-suffix"]?t+=e["year-suffix"]:e.title&&(t+=e.title.replace(/<\/?.*?>/g,"").match(/^(?:(?:the|a|an)\s+)?(\S+)/i)[1]),t};mr.getLabel=ql;var ig={label(e){return e.reduce((t,r)=>(t[r.id]=ql(r),t),{})}};mr.default=ig});var Gl=R(Ji=>{"use strict";Object.defineProperty(Ji,"__esModule",{value:!0});Ji.sort=void 0;var sg=tn(),ag=pr(),jl=function(e,t,r=t==="label"){let i=r?(0,sg.getLabel)(e):e[t];switch(t){case"author":case"editor":return i.map(s=>s.literal||s.family||(0,ag.format)(s));case"accessed":case"issued":return i["date-parts"][0];case"page":return i.split("-").map(s=>parseInt(s));case"edition":case"issue":case"volume":return i=parseInt(i),isNaN(i)?-1/0:i;default:return i||-1/0}},ng=function(e,t,r,i=/^!/.test(r)){r=r.replace(/^!/,"");let s=jl(e,r),a=jl(t,r);return(i?-1:1)*(s>a?1:s<a?-1:0)},og=function(...e){return(t,r)=>{let i=e.slice(),s=0;for(;!s&&i.length;)s=ng(t,r,i.shift());return s}},lg=function(e=[],t){return t&&this.save(),this.data.sort(typeof e=="function"?e:og(...e,"label")),this};Ji.sort=lg});var $l=R(Wi=>{"use strict";Object.defineProperty(Wi,"__esModule",{value:!0});Wi.default=void 0;var ug=cg(Ii());function cg(e){return e&&e.__esModule?e:{default:e}}var pg=function(e,t,r){typeof t=="function"&&!r&&(r=t,t=void 0);let i=(0,ug.default)().setAsync(e,t);if(typeof r=="function"){i.then(r);return}else return i},hg=pg;Wi.default=hg});var sn=R(dr=>{"use strict";Object.defineProperty(dr,"__esModule",{value:!0});var fg={async:!0};Object.defineProperty(dr,"async",{enumerable:!0,get:function(){return mg.default}});var mg=dg($l()),rn=ka();Object.keys(rn).forEach(function(e){e==="default"||e==="__esModule"||Object.prototype.hasOwnProperty.call(fg,e)||e in dr&&dr[e]===rn[e]||Object.defineProperty(dr,e,{enumerable:!0,get:function(){return rn[e]}})});function dg(e){return e&&e.__esModule?e:{default:e}}});var Ki=R(Xi=>{"use strict";Object.defineProperty(Xi,"__esModule",{value:!0});Xi.default=void 0;var an=class{constructor(t={}){this.data=t}set(t,r){return this.data[t]=r,this}add(...t){return this.set(...t)}delete(t){return delete this.data[t],this}remove(...t){return this.delete(...t)}get(t){return this.data[t]}has(t){return Object.prototype.hasOwnProperty.call(this.data,t)}list(){return Object.keys(this.data)}},gg=an;Xi.default=gg});var nn=R(De=>{"use strict";Object.defineProperty(De,"__esModule",{value:!0});De.remove=De.register=De.list=De.has=De.format=De.add=void 0;var bg=yg(Ki());function yg(e){return e&&e.__esModule?e:{default:e}}var vg=(e,t)=>{if(typeof e!="string")throw new TypeError(`Invalid output format name, expected string, got ${typeof e}`);if(typeof t!="function")throw new TypeError(`Invalid formatter, expected function, got ${typeof t}`)},Mt=new bg.default;De.register=Mt;var _g=(e,t)=>{vg(e,t),Mt.set(e,t)};De.add=_g;var Eg=e=>{Mt.remove(e)};De.remove=Eg;var wg=e=>Mt.has(e);De.has=wg;var xg=()=>Mt.list();De.list=xg;var Tg=(e,t,...r)=>{if(!Mt.has(e))throw new Error(`Output format "${e}" unavailable`);return Mt.get(e)(t,...r)};De.format=Tg});var zl=R(Zr=>{"use strict";Object.defineProperty(Zr,"__esModule",{value:!0});Zr.format=kg;Zr.get=Qg;Zr.getIds=Og;var Ag=sn(),Sg=nn(),Cg=Ga();function Og(){return this.data.map(e=>e.id)}function kg(e,...t){return(0,Sg.format)(e,(0,Cg.clean)(this.data),...t)}function Qg(e={}){(0,Ag.validateOutputOptions)(e);let t=Object.assign({},this.defaultOptions,this._options.output,e),{type:r,style:i}=t,[s,a]=i.split("-"),n=s==="citation"?"bibliography":s==="csl"?"data":s,o=r==="string"?"text":r==="json"?"object":r,u;switch(n){case"bibliography":{let{lang:f,append:h,prepend:m}=t;u={template:a,lang:f,format:o,append:h,prepend:m};break}case"data":case"bibtex":case"bibtxt":case"ndjson":case"ris":u={type:o};break;default:throw new Error(`Invalid style "${n}"`)}let c=this.format(n,Object.assign(u,e._newOptions)),{format:p}=t;if(p==="real"&&o==="html"&&typeof document!="undefined"&&typeof document.createElement=="function"){let f=document.createElement("div");return f.innerHTML=c,f.firstChild}else return p==="string"&&typeof c=="object"?JSON.stringify(c):c}});var Ii=R(Zi=>{"use strict";Object.defineProperty(Zi,"__esModule",{value:!0});Zi.default=void 0;var Ng=br(ol()),Ig=br(fl()),Dg=br(Ul()),Pg=br(Gl()),Rg=br(zl()),Lg=br(sn());function Hl(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,r=new WeakMap;return(Hl=function(i){return i?r:t})(e)}function br(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||typeof e!="object"&&typeof e!="function")return{default:e};var r=Hl(t);if(r&&r.has(e))return r.get(e);var i={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(a!=="default"&&Object.prototype.hasOwnProperty.call(e,a)){var n=s?Object.getOwnPropertyDescriptor(e,a):null;n&&(n.get||n.set)?Object.defineProperty(i,a,n):i[a]=e[a]}return i.default=e,r&&r.set(e,i),i}function gr(e,t={}){return this instanceof gr?(this._options=t,this.log=[],this.data=[],this.set(e,t),this.options(t),this):new gr(e,t)}Object.assign(gr.prototype,Ng,Ig,Dg,Pg,Rg);gr.prototype[Symbol.iterator]=function*(){yield*this.data};Object.assign(gr,Lg);var Bg=gr;Zi.default=Bg});var Vl=R(Ee=>{"use strict";Object.defineProperty(Ee,"__esModule",{value:!0});Ee.textDict=Ee.remove=Ee.register=Ee.list=Ee.htmlDict=Ee.has=Ee.get=Ee.add=void 0;var Fg=Mg(Ki());function Mg(e){return e&&e.__esModule?e:{default:e}}var Ug=(e,t)=>{if(typeof e!="string")throw new TypeError(`Invalid dict name, expected string, got ${typeof e}`);if(typeof t!="object")throw new TypeError(`Invalid dict, expected object, got ${typeof t}`);for(let r in t){let i=t[r];if(!Array.isArray(i)||i.some(s=>typeof s!="string"))throw new TypeError(`Invalid dict entry "${r}", expected array of strings`)}},Ut=new Fg.default({html:{bibliographyContainer:['<div class="csl-bib-body">',"</div>"],entry:['<div class="csl-entry">',"</div>"],list:['<ul style="list-style-type:none">',"</ul>"],listItem:["<li>","</li>"]},text:{bibliographyContainer:["",`
`],entry:["",`
`],list:[`
`,""],listItem:["	",`
`]}});Ee.register=Ut;var qg=(e,t)=>{Ug(e,t),Ut.set(e,t)};Ee.add=qg;var jg=e=>{Ut.remove(e)};Ee.remove=jg;var Gg=e=>Ut.has(e);Ee.has=Gg;var $g=()=>Ut.list();Ee.list=$g;var zg=e=>{if(!Ut.has(e))throw new Error(`Dict "${e}" unavailable`);return Ut.get(e)};Ee.get=zg;var Hg={wr_start:'<div class="csl-bib-body">',wr_end:"</div>",en_start:'<div class="csl-entry">',en_end:"</div>",ul_start:'<ul style="list-style-type:none">',ul_end:"</ul>",li_start:"<li>",li_end:"</li>"};Ee.htmlDict=Hg;var Vg={wr_start:"",wr_end:`
`,en_start:"",en_end:`
`,ul_start:`
`,ul_end:"",li_start:"	",li_end:`
`};Ee.textDict=Vg});var Yl=R($e=>{"use strict";Object.defineProperty($e,"__esModule",{value:!0});$e.remove=$e.list=$e.has=$e.get=$e.add=void 0;var ei={},Yg=(e,t)=>{ei[e]=t};$e.add=Yg;var Jg=e=>ei[e];$e.get=Jg;var Wg=e=>Object.prototype.hasOwnProperty.call(ei,e);$e.has=Wg;var Xg=e=>{delete ei[e]};$e.remove=Xg;var Kg=()=>Object.keys(ei);$e.list=Kg});var ts=R(we=>{"use strict";Object.defineProperty(we,"__esModule",{value:!0});we.remove=we.output=we.list=we.input=we.has=we.dict=we.config=we.add=void 0;var Jl=es(Za());we.input=Jl;var Wl=es(nn());we.output=Wl;var Xl=es(Vl());we.dict=Xl;var Kl=es(Yl());we.config=Kl;function Zl(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,r=new WeakMap;return(Zl=function(i){return i?r:t})(e)}function es(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||typeof e!="object"&&typeof e!="function")return{default:e};var r=Zl(t);if(r&&r.has(e))return r.get(e);var i={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(a!=="default"&&Object.prototype.hasOwnProperty.call(e,a)){var n=s?Object.getOwnPropertyDescriptor(e,a):null;n&&(n.get||n.set)?Object.defineProperty(i,a,n):i[a]=e[a]}return i.default=e,r&&r.set(e,i),i}var on={input:Jl,output:Wl,dict:Xl,config:Kl},ti={},Zg=(e,t={})=>{let r=ti[e]={};for(let i in t){if(i==="config"){r.config={[e]:t.config},on.config.add(e,t.config);continue}let s=r[i]={},a=t[i];for(let n in a){let o=a[n];s[n]=!0,on[i].add(n,o)}}};we.add=Zg;var eb=e=>{let t=ti[e];for(let r in t){let i=t[r];for(let s in i)on[r].remove(s)}delete ti[e]};we.remove=eb;var tb=e=>e in ti;we.has=tb;var rb=()=>Object.keys(ti);we.list=rb});var ru=R(rs=>{"use strict";rs.byteLength=sb;rs.toByteArray=nb;rs.fromByteArray=ub;var rt=[],ze=[],ib=typeof Uint8Array!="undefined"?Uint8Array:Array,ln="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(qt=0,eu=ln.length;qt<eu;++qt)rt[qt]=ln[qt],ze[ln.charCodeAt(qt)]=qt;var qt,eu;ze[45]=62;ze[95]=63;function tu(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");r===-1&&(r=t);var i=r===t?0:4-r%4;return[r,i]}function sb(e){var t=tu(e),r=t[0],i=t[1];return(r+i)*3/4-i}function ab(e,t,r){return(t+r)*3/4-r}function nb(e){var t,r=tu(e),i=r[0],s=r[1],a=new ib(ab(e,i,s)),n=0,o=s>0?i-4:i,u;for(u=0;u<o;u+=4)t=ze[e.charCodeAt(u)]<<18|ze[e.charCodeAt(u+1)]<<12|ze[e.charCodeAt(u+2)]<<6|ze[e.charCodeAt(u+3)],a[n++]=t>>16&255,a[n++]=t>>8&255,a[n++]=t&255;return s===2&&(t=ze[e.charCodeAt(u)]<<2|ze[e.charCodeAt(u+1)]>>4,a[n++]=t&255),s===1&&(t=ze[e.charCodeAt(u)]<<10|ze[e.charCodeAt(u+1)]<<4|ze[e.charCodeAt(u+2)]>>2,a[n++]=t>>8&255,a[n++]=t&255),a}function ob(e){return rt[e>>18&63]+rt[e>>12&63]+rt[e>>6&63]+rt[e&63]}function lb(e,t,r){for(var i,s=[],a=t;a<r;a+=3)i=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(e[a+2]&255),s.push(ob(i));return s.join("")}function ub(e){for(var t,r=e.length,i=r%3,s=[],a=16383,n=0,o=r-i;n<o;n+=a)s.push(lb(e,n,n+a>o?o:n+a));return i===1?(t=e[r-1],s.push(rt[t>>2]+rt[t<<4&63]+"==")):i===2&&(t=(e[r-2]<<8)+e[r-1],s.push(rt[t>>10]+rt[t>>4&63]+rt[t<<2&63]+"=")),s.join("")}});var iu=R(un=>{un.read=function(e,t,r,i,s){var a,n,o=s*8-i-1,u=(1<<o)-1,c=u>>1,p=-7,f=r?s-1:0,h=r?-1:1,m=e[t+f];for(f+=h,a=m&(1<<-p)-1,m>>=-p,p+=o;p>0;a=a*256+e[t+f],f+=h,p-=8);for(n=a&(1<<-p)-1,a>>=-p,p+=i;p>0;n=n*256+e[t+f],f+=h,p-=8);if(a===0)a=1-c;else{if(a===u)return n?NaN:(m?-1:1)*(1/0);n=n+Math.pow(2,i),a=a-c}return(m?-1:1)*n*Math.pow(2,a-i)};un.write=function(e,t,r,i,s,a){var n,o,u,c=a*8-s-1,p=(1<<c)-1,f=p>>1,h=s===23?Math.pow(2,-24)-Math.pow(2,-77):0,m=i?0:a-1,g=i?1:-1,d=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,n=p):(n=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-n))<1&&(n--,u*=2),n+f>=1?t+=h/u:t+=h*Math.pow(2,1-f),t*u>=2&&(n++,u/=2),n+f>=p?(o=0,n=p):n+f>=1?(o=(t*u-1)*Math.pow(2,s),n=n+f):(o=t*Math.pow(2,f-1)*Math.pow(2,s),n=0));s>=8;e[r+m]=o&255,m+=g,o/=256,s-=8);for(n=n<<s|o,c+=s;c>0;e[r+m]=n&255,m+=g,n/=256,c-=8);e[r+m-g]|=d*128}});var gu=R(vr=>{"use strict";var cn=ru(),yr=iu(),su=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;vr.Buffer=M;vr.SlowBuffer=db;vr.INSPECT_MAX_BYTES=50;var is=2147483647;vr.kMaxLength=is;M.TYPED_ARRAY_SUPPORT=cb();!M.TYPED_ARRAY_SUPPORT&&typeof console!="undefined"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function cb(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),e.foo()===42}catch(r){return!1}}Object.defineProperty(M.prototype,"parent",{enumerable:!0,get:function(){if(M.isBuffer(this))return this.buffer}});Object.defineProperty(M.prototype,"offset",{enumerable:!0,get:function(){if(M.isBuffer(this))return this.byteOffset}});function ut(e){if(e>is)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,M.prototype),t}function M(e,t,r){if(typeof e=="number"){if(typeof t=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return mn(e)}return ou(e,t,r)}M.poolSize=8192;function ou(e,t,r){if(typeof e=="string")return hb(e,t);if(ArrayBuffer.isView(e))return fb(e);if(e==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(it(e,ArrayBuffer)||e&&it(e.buffer,ArrayBuffer)||typeof SharedArrayBuffer!="undefined"&&(it(e,SharedArrayBuffer)||e&&it(e.buffer,SharedArrayBuffer)))return hn(e,t,r);if(typeof e=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var i=e.valueOf&&e.valueOf();if(i!=null&&i!==e)return M.from(i,t,r);var s=mb(e);if(s)return s;if(typeof Symbol!="undefined"&&Symbol.toPrimitive!=null&&typeof e[Symbol.toPrimitive]=="function")return M.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}M.from=function(e,t,r){return ou(e,t,r)};Object.setPrototypeOf(M.prototype,Uint8Array.prototype);Object.setPrototypeOf(M,Uint8Array);function lu(e){if(typeof e!="number")throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function pb(e,t,r){return lu(e),e<=0?ut(e):t!==void 0?typeof r=="string"?ut(e).fill(t,r):ut(e).fill(t):ut(e)}M.alloc=function(e,t,r){return pb(e,t,r)};function mn(e){return lu(e),ut(e<0?0:dn(e)|0)}M.allocUnsafe=function(e){return mn(e)};M.allocUnsafeSlow=function(e){return mn(e)};function hb(e,t){if((typeof t!="string"||t==="")&&(t="utf8"),!M.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var r=uu(e,t)|0,i=ut(r),s=i.write(e,t);return s!==r&&(i=i.slice(0,s)),i}function pn(e){for(var t=e.length<0?0:dn(e.length)|0,r=ut(t),i=0;i<t;i+=1)r[i]=e[i]&255;return r}function fb(e){if(it(e,Uint8Array)){var t=new Uint8Array(e);return hn(t.buffer,t.byteOffset,t.byteLength)}return pn(e)}function hn(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');var i;return t===void 0&&r===void 0?i=new Uint8Array(e):r===void 0?i=new Uint8Array(e,t):i=new Uint8Array(e,t,r),Object.setPrototypeOf(i,M.prototype),i}function mb(e){if(M.isBuffer(e)){var t=dn(e.length)|0,r=ut(t);return r.length===0||e.copy(r,0,0,t),r}if(e.length!==void 0)return typeof e.length!="number"||gn(e.length)?ut(0):pn(e);if(e.type==="Buffer"&&Array.isArray(e.data))return pn(e.data)}function dn(e){if(e>=is)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+is.toString(16)+" bytes");return e|0}function db(e){return+e!=e&&(e=0),M.alloc(+e)}M.isBuffer=function(t){return t!=null&&t._isBuffer===!0&&t!==M.prototype};M.compare=function(t,r){if(it(t,Uint8Array)&&(t=M.from(t,t.offset,t.byteLength)),it(r,Uint8Array)&&(r=M.from(r,r.offset,r.byteLength)),!M.isBuffer(t)||!M.isBuffer(r))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===r)return 0;for(var i=t.length,s=r.length,a=0,n=Math.min(i,s);a<n;++a)if(t[a]!==r[a]){i=t[a],s=r[a];break}return i<s?-1:s<i?1:0};M.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}};M.concat=function(t,r){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(t.length===0)return M.alloc(0);var i;if(r===void 0)for(r=0,i=0;i<t.length;++i)r+=t[i].length;var s=M.allocUnsafe(r),a=0;for(i=0;i<t.length;++i){var n=t[i];if(it(n,Uint8Array))a+n.length>s.length?M.from(n).copy(s,a):Uint8Array.prototype.set.call(s,n,a);else if(M.isBuffer(n))n.copy(s,a);else throw new TypeError('"list" argument must be an Array of Buffers');a+=n.length}return s};function uu(e,t){if(M.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||it(e,ArrayBuffer))return e.byteLength;if(typeof e!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,i=arguments.length>2&&arguments[2]===!0;if(!i&&r===0)return 0;for(var s=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return fn(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return r*2;case"hex":return r>>>1;case"base64":return du(e).length;default:if(s)return i?-1:fn(e).length;t=(""+t).toLowerCase(),s=!0}}M.byteLength=uu;function gb(e,t,r){var i=!1;if((t===void 0||t<0)&&(t=0),t>this.length||((r===void 0||r>this.length)&&(r=this.length),r<=0)||(r>>>=0,t>>>=0,r<=t))return"";for(e||(e="utf8");;)switch(e){case"hex":return Sb(this,t,r);case"utf8":case"utf-8":return pu(this,t,r);case"ascii":return Tb(this,t,r);case"latin1":case"binary":return Ab(this,t,r);case"base64":return wb(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Cb(this,t,r);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}M.prototype._isBuffer=!0;function jt(e,t,r){var i=e[t];e[t]=e[r],e[r]=i}M.prototype.swap16=function(){var t=this.length;if(t%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var r=0;r<t;r+=2)jt(this,r,r+1);return this};M.prototype.swap32=function(){var t=this.length;if(t%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var r=0;r<t;r+=4)jt(this,r,r+3),jt(this,r+1,r+2);return this};M.prototype.swap64=function(){var t=this.length;if(t%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var r=0;r<t;r+=8)jt(this,r,r+7),jt(this,r+1,r+6),jt(this,r+2,r+5),jt(this,r+3,r+4);return this};M.prototype.toString=function(){var t=this.length;return t===0?"":arguments.length===0?pu(this,0,t):gb.apply(this,arguments)};M.prototype.toLocaleString=M.prototype.toString;M.prototype.equals=function(t){if(!M.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t?!0:M.compare(this,t)===0};M.prototype.inspect=function(){var t="",r=vr.INSPECT_MAX_BYTES;return t=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(t+=" ... "),"<Buffer "+t+">"};su&&(M.prototype[su]=M.prototype.inspect);M.prototype.compare=function(t,r,i,s,a){if(it(t,Uint8Array)&&(t=M.from(t,t.offset,t.byteLength)),!M.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(r===void 0&&(r=0),i===void 0&&(i=t?t.length:0),s===void 0&&(s=0),a===void 0&&(a=this.length),r<0||i>t.length||s<0||a>this.length)throw new RangeError("out of range index");if(s>=a&&r>=i)return 0;if(s>=a)return-1;if(r>=i)return 1;if(r>>>=0,i>>>=0,s>>>=0,a>>>=0,this===t)return 0;for(var n=a-s,o=i-r,u=Math.min(n,o),c=this.slice(s,a),p=t.slice(r,i),f=0;f<u;++f)if(c[f]!==p[f]){n=c[f],o=p[f];break}return n<o?-1:o<n?1:0};function cu(e,t,r,i,s){if(e.length===0)return-1;if(typeof r=="string"?(i=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,gn(r)&&(r=s?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(s)return-1;r=e.length-1}else if(r<0)if(s)r=0;else return-1;if(typeof t=="string"&&(t=M.from(t,i)),M.isBuffer(t))return t.length===0?-1:au(e,t,r,i,s);if(typeof t=="number")return t=t&255,typeof Uint8Array.prototype.indexOf=="function"?s?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):au(e,[t],r,i,s);throw new TypeError("val must be string, number or Buffer")}function au(e,t,r,i,s){var a=1,n=e.length,o=t.length;if(i!==void 0&&(i=String(i).toLowerCase(),i==="ucs2"||i==="ucs-2"||i==="utf16le"||i==="utf-16le")){if(e.length<2||t.length<2)return-1;a=2,n/=2,o/=2,r/=2}function u(m,g){return a===1?m[g]:m.readUInt16BE(g*a)}var c;if(s){var p=-1;for(c=r;c<n;c++)if(u(e,c)===u(t,p===-1?0:c-p)){if(p===-1&&(p=c),c-p+1===o)return p*a}else p!==-1&&(c-=c-p),p=-1}else for(r+o>n&&(r=n-o),c=r;c>=0;c--){for(var f=!0,h=0;h<o;h++)if(u(e,c+h)!==u(t,h)){f=!1;break}if(f)return c}return-1}M.prototype.includes=function(t,r,i){return this.indexOf(t,r,i)!==-1};M.prototype.indexOf=function(t,r,i){return cu(this,t,r,i,!0)};M.prototype.lastIndexOf=function(t,r,i){return cu(this,t,r,i,!1)};function bb(e,t,r,i){r=Number(r)||0;var s=e.length-r;i?(i=Number(i),i>s&&(i=s)):i=s;var a=t.length;i>a/2&&(i=a/2);for(var n=0;n<i;++n){var o=parseInt(t.substr(n*2,2),16);if(gn(o))return n;e[r+n]=o}return n}function yb(e,t,r,i){return ss(fn(t,e.length-r),e,r,i)}function vb(e,t,r,i){return ss(Qb(t),e,r,i)}function _b(e,t,r,i){return ss(du(t),e,r,i)}function Eb(e,t,r,i){return ss(Nb(t,e.length-r),e,r,i)}M.prototype.write=function(t,r,i,s){if(r===void 0)s="utf8",i=this.length,r=0;else if(i===void 0&&typeof r=="string")s=r,i=this.length,r=0;else if(isFinite(r))r=r>>>0,isFinite(i)?(i=i>>>0,s===void 0&&(s="utf8")):(s=i,i=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var a=this.length-r;if((i===void 0||i>a)&&(i=a),t.length>0&&(i<0||r<0)||r>this.length)throw new RangeError("Attempt to write outside buffer bounds");s||(s="utf8");for(var n=!1;;)switch(s){case"hex":return bb(this,t,r,i);case"utf8":case"utf-8":return yb(this,t,r,i);case"ascii":case"latin1":case"binary":return vb(this,t,r,i);case"base64":return _b(this,t,r,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Eb(this,t,r,i);default:if(n)throw new TypeError("Unknown encoding: "+s);s=(""+s).toLowerCase(),n=!0}};M.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function wb(e,t,r){return t===0&&r===e.length?cn.fromByteArray(e):cn.fromByteArray(e.slice(t,r))}function pu(e,t,r){r=Math.min(e.length,r);for(var i=[],s=t;s<r;){var a=e[s],n=null,o=a>239?4:a>223?3:a>191?2:1;if(s+o<=r){var u,c,p,f;switch(o){case 1:a<128&&(n=a);break;case 2:u=e[s+1],(u&192)===128&&(f=(a&31)<<6|u&63,f>127&&(n=f));break;case 3:u=e[s+1],c=e[s+2],(u&192)===128&&(c&192)===128&&(f=(a&15)<<12|(u&63)<<6|c&63,f>2047&&(f<55296||f>57343)&&(n=f));break;case 4:u=e[s+1],c=e[s+2],p=e[s+3],(u&192)===128&&(c&192)===128&&(p&192)===128&&(f=(a&15)<<18|(u&63)<<12|(c&63)<<6|p&63,f>65535&&f<1114112&&(n=f))}}n===null?(n=65533,o=1):n>65535&&(n-=65536,i.push(n>>>10&1023|55296),n=56320|n&1023),i.push(n),s+=o}return xb(i)}var nu=4096;function xb(e){var t=e.length;if(t<=nu)return String.fromCharCode.apply(String,e);for(var r="",i=0;i<t;)r+=String.fromCharCode.apply(String,e.slice(i,i+=nu));return r}function Tb(e,t,r){var i="";r=Math.min(e.length,r);for(var s=t;s<r;++s)i+=String.fromCharCode(e[s]&127);return i}function Ab(e,t,r){var i="";r=Math.min(e.length,r);for(var s=t;s<r;++s)i+=String.fromCharCode(e[s]);return i}function Sb(e,t,r){var i=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>i)&&(r=i);for(var s="",a=t;a<r;++a)s+=Ib[e[a]];return s}function Cb(e,t,r){for(var i=e.slice(t,r),s="",a=0;a<i.length-1;a+=2)s+=String.fromCharCode(i[a]+i[a+1]*256);return s}M.prototype.slice=function(t,r){var i=this.length;t=~~t,r=r===void 0?i:~~r,t<0?(t+=i,t<0&&(t=0)):t>i&&(t=i),r<0?(r+=i,r<0&&(r=0)):r>i&&(r=i),r<t&&(r=t);var s=this.subarray(t,r);return Object.setPrototypeOf(s,M.prototype),s};function xe(e,t,r){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}M.prototype.readUintLE=M.prototype.readUIntLE=function(t,r,i){t=t>>>0,r=r>>>0,i||xe(t,r,this.length);for(var s=this[t],a=1,n=0;++n<r&&(a*=256);)s+=this[t+n]*a;return s};M.prototype.readUintBE=M.prototype.readUIntBE=function(t,r,i){t=t>>>0,r=r>>>0,i||xe(t,r,this.length);for(var s=this[t+--r],a=1;r>0&&(a*=256);)s+=this[t+--r]*a;return s};M.prototype.readUint8=M.prototype.readUInt8=function(t,r){return t=t>>>0,r||xe(t,1,this.length),this[t]};M.prototype.readUint16LE=M.prototype.readUInt16LE=function(t,r){return t=t>>>0,r||xe(t,2,this.length),this[t]|this[t+1]<<8};M.prototype.readUint16BE=M.prototype.readUInt16BE=function(t,r){return t=t>>>0,r||xe(t,2,this.length),this[t]<<8|this[t+1]};M.prototype.readUint32LE=M.prototype.readUInt32LE=function(t,r){return t=t>>>0,r||xe(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+this[t+3]*16777216};M.prototype.readUint32BE=M.prototype.readUInt32BE=function(t,r){return t=t>>>0,r||xe(t,4,this.length),this[t]*16777216+(this[t+1]<<16|this[t+2]<<8|this[t+3])};M.prototype.readIntLE=function(t,r,i){t=t>>>0,r=r>>>0,i||xe(t,r,this.length);for(var s=this[t],a=1,n=0;++n<r&&(a*=256);)s+=this[t+n]*a;return a*=128,s>=a&&(s-=Math.pow(2,8*r)),s};M.prototype.readIntBE=function(t,r,i){t=t>>>0,r=r>>>0,i||xe(t,r,this.length);for(var s=r,a=1,n=this[t+--s];s>0&&(a*=256);)n+=this[t+--s]*a;return a*=128,n>=a&&(n-=Math.pow(2,8*r)),n};M.prototype.readInt8=function(t,r){return t=t>>>0,r||xe(t,1,this.length),this[t]&128?(255-this[t]+1)*-1:this[t]};M.prototype.readInt16LE=function(t,r){t=t>>>0,r||xe(t,2,this.length);var i=this[t]|this[t+1]<<8;return i&32768?i|4294901760:i};M.prototype.readInt16BE=function(t,r){t=t>>>0,r||xe(t,2,this.length);var i=this[t+1]|this[t]<<8;return i&32768?i|4294901760:i};M.prototype.readInt32LE=function(t,r){return t=t>>>0,r||xe(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24};M.prototype.readInt32BE=function(t,r){return t=t>>>0,r||xe(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]};M.prototype.readFloatLE=function(t,r){return t=t>>>0,r||xe(t,4,this.length),yr.read(this,t,!0,23,4)};M.prototype.readFloatBE=function(t,r){return t=t>>>0,r||xe(t,4,this.length),yr.read(this,t,!1,23,4)};M.prototype.readDoubleLE=function(t,r){return t=t>>>0,r||xe(t,8,this.length),yr.read(this,t,!0,52,8)};M.prototype.readDoubleBE=function(t,r){return t=t>>>0,r||xe(t,8,this.length),yr.read(this,t,!1,52,8)};function Pe(e,t,r,i,s,a){if(!M.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>s||t<a)throw new RangeError('"value" argument is out of bounds');if(r+i>e.length)throw new RangeError("Index out of range")}M.prototype.writeUintLE=M.prototype.writeUIntLE=function(t,r,i,s){if(t=+t,r=r>>>0,i=i>>>0,!s){var a=Math.pow(2,8*i)-1;Pe(this,t,r,i,a,0)}var n=1,o=0;for(this[r]=t&255;++o<i&&(n*=256);)this[r+o]=t/n&255;return r+i};M.prototype.writeUintBE=M.prototype.writeUIntBE=function(t,r,i,s){if(t=+t,r=r>>>0,i=i>>>0,!s){var a=Math.pow(2,8*i)-1;Pe(this,t,r,i,a,0)}var n=i-1,o=1;for(this[r+n]=t&255;--n>=0&&(o*=256);)this[r+n]=t/o&255;return r+i};M.prototype.writeUint8=M.prototype.writeUInt8=function(t,r,i){return t=+t,r=r>>>0,i||Pe(this,t,r,1,255,0),this[r]=t&255,r+1};M.prototype.writeUint16LE=M.prototype.writeUInt16LE=function(t,r,i){return t=+t,r=r>>>0,i||Pe(this,t,r,2,65535,0),this[r]=t&255,this[r+1]=t>>>8,r+2};M.prototype.writeUint16BE=M.prototype.writeUInt16BE=function(t,r,i){return t=+t,r=r>>>0,i||Pe(this,t,r,2,65535,0),this[r]=t>>>8,this[r+1]=t&255,r+2};M.prototype.writeUint32LE=M.prototype.writeUInt32LE=function(t,r,i){return t=+t,r=r>>>0,i||Pe(this,t,r,4,4294967295,0),this[r+3]=t>>>24,this[r+2]=t>>>16,this[r+1]=t>>>8,this[r]=t&255,r+4};M.prototype.writeUint32BE=M.prototype.writeUInt32BE=function(t,r,i){return t=+t,r=r>>>0,i||Pe(this,t,r,4,4294967295,0),this[r]=t>>>24,this[r+1]=t>>>16,this[r+2]=t>>>8,this[r+3]=t&255,r+4};M.prototype.writeIntLE=function(t,r,i,s){if(t=+t,r=r>>>0,!s){var a=Math.pow(2,8*i-1);Pe(this,t,r,i,a-1,-a)}var n=0,o=1,u=0;for(this[r]=t&255;++n<i&&(o*=256);)t<0&&u===0&&this[r+n-1]!==0&&(u=1),this[r+n]=(t/o>>0)-u&255;return r+i};M.prototype.writeIntBE=function(t,r,i,s){if(t=+t,r=r>>>0,!s){var a=Math.pow(2,8*i-1);Pe(this,t,r,i,a-1,-a)}var n=i-1,o=1,u=0;for(this[r+n]=t&255;--n>=0&&(o*=256);)t<0&&u===0&&this[r+n+1]!==0&&(u=1),this[r+n]=(t/o>>0)-u&255;return r+i};M.prototype.writeInt8=function(t,r,i){return t=+t,r=r>>>0,i||Pe(this,t,r,1,127,-128),t<0&&(t=255+t+1),this[r]=t&255,r+1};M.prototype.writeInt16LE=function(t,r,i){return t=+t,r=r>>>0,i||Pe(this,t,r,2,32767,-32768),this[r]=t&255,this[r+1]=t>>>8,r+2};M.prototype.writeInt16BE=function(t,r,i){return t=+t,r=r>>>0,i||Pe(this,t,r,2,32767,-32768),this[r]=t>>>8,this[r+1]=t&255,r+2};M.prototype.writeInt32LE=function(t,r,i){return t=+t,r=r>>>0,i||Pe(this,t,r,4,2147483647,-2147483648),this[r]=t&255,this[r+1]=t>>>8,this[r+2]=t>>>16,this[r+3]=t>>>24,r+4};M.prototype.writeInt32BE=function(t,r,i){return t=+t,r=r>>>0,i||Pe(this,t,r,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[r]=t>>>24,this[r+1]=t>>>16,this[r+2]=t>>>8,this[r+3]=t&255,r+4};function hu(e,t,r,i,s,a){if(r+i>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function fu(e,t,r,i,s){return t=+t,r=r>>>0,s||hu(e,t,r,4,34028234663852886e22,-34028234663852886e22),yr.write(e,t,r,i,23,4),r+4}M.prototype.writeFloatLE=function(t,r,i){return fu(this,t,r,!0,i)};M.prototype.writeFloatBE=function(t,r,i){return fu(this,t,r,!1,i)};function mu(e,t,r,i,s){return t=+t,r=r>>>0,s||hu(e,t,r,8,17976931348623157e292,-17976931348623157e292),yr.write(e,t,r,i,52,8),r+8}M.prototype.writeDoubleLE=function(t,r,i){return mu(this,t,r,!0,i)};M.prototype.writeDoubleBE=function(t,r,i){return mu(this,t,r,!1,i)};M.prototype.copy=function(t,r,i,s){if(!M.isBuffer(t))throw new TypeError("argument should be a Buffer");if(i||(i=0),!s&&s!==0&&(s=this.length),r>=t.length&&(r=t.length),r||(r=0),s>0&&s<i&&(s=i),s===i||t.length===0||this.length===0)return 0;if(r<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("Index out of range");if(s<0)throw new RangeError("sourceEnd out of bounds");s>this.length&&(s=this.length),t.length-r<s-i&&(s=t.length-r+i);var a=s-i;return this===t&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(r,i,s):Uint8Array.prototype.set.call(t,this.subarray(i,s),r),a};M.prototype.fill=function(t,r,i,s){if(typeof t=="string"){if(typeof r=="string"?(s=r,r=0,i=this.length):typeof i=="string"&&(s=i,i=this.length),s!==void 0&&typeof s!="string")throw new TypeError("encoding must be a string");if(typeof s=="string"&&!M.isEncoding(s))throw new TypeError("Unknown encoding: "+s);if(t.length===1){var a=t.charCodeAt(0);(s==="utf8"&&a<128||s==="latin1")&&(t=a)}}else typeof t=="number"?t=t&255:typeof t=="boolean"&&(t=Number(t));if(r<0||this.length<r||this.length<i)throw new RangeError("Out of range index");if(i<=r)return this;r=r>>>0,i=i===void 0?this.length:i>>>0,t||(t=0);var n;if(typeof t=="number")for(n=r;n<i;++n)this[n]=t;else{var o=M.isBuffer(t)?t:M.from(t,s),u=o.length;if(u===0)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(n=0;n<i-r;++n)this[n+r]=o[n%u]}return this};var Ob=/[^+/0-9A-Za-z-_]/g;function kb(e){if(e=e.split("=")[0],e=e.trim().replace(Ob,""),e.length<2)return"";for(;e.length%4!==0;)e=e+"=";return e}function fn(e,t){t=t||1/0;for(var r,i=e.length,s=null,a=[],n=0;n<i;++n){if(r=e.charCodeAt(n),r>55295&&r<57344){if(!s){if(r>56319){(t-=3)>-1&&a.push(239,191,189);continue}else if(n+1===i){(t-=3)>-1&&a.push(239,191,189);continue}s=r;continue}if(r<56320){(t-=3)>-1&&a.push(239,191,189),s=r;continue}r=(s-55296<<10|r-56320)+65536}else s&&(t-=3)>-1&&a.push(239,191,189);if(s=null,r<128){if((t-=1)<0)break;a.push(r)}else if(r<2048){if((t-=2)<0)break;a.push(r>>6|192,r&63|128)}else if(r<65536){if((t-=3)<0)break;a.push(r>>12|224,r>>6&63|128,r&63|128)}else if(r<1114112){if((t-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,r&63|128)}else throw new Error("Invalid code point")}return a}function Qb(e){for(var t=[],r=0;r<e.length;++r)t.push(e.charCodeAt(r)&255);return t}function Nb(e,t){for(var r,i,s,a=[],n=0;n<e.length&&!((t-=2)<0);++n)r=e.charCodeAt(n),i=r>>8,s=r%256,a.push(s),a.push(i);return a}function du(e){return cn.toByteArray(kb(e))}function ss(e,t,r,i){for(var s=0;s<i&&!(s+r>=t.length||s>=e.length);++s)t[s+r]=e[s];return s}function it(e,t){return e instanceof t||e!=null&&e.constructor!=null&&e.constructor.name!=null&&e.constructor.name===t.name}function gn(e){return e!==e}var Ib=function(){for(var e="0123456789abcdef",t=new Array(256),r=0;r<16;++r)for(var i=r*16,s=0;s<16;++s)t[i+s]=e[r]+e[s];return t}()});var yu=R((xx,bu)=>{var{Buffer:ls}=gu();function zt(...e){let[t,r]=Db(...e),i=new XMLHttpRequest;i.withCredentials=r.credentials==="include",i.timeout=r.timeout,i.open(r.method||"GET",t,!1);try{i.responseType="arraybuffer"}catch(a){}for(let a of r.headers)i.setRequestHeader(...a);i.send(r.body||null);let s=i.getAllResponseHeaders();return s=s&&s.split(`\r
`).filter(Boolean).map(a=>a.split(": ",2)),new zt.Response(i.response,{url:i.responseURL,status:i.status,statusText:i.statusText,headers:s,redirected:i.responseURL!==t})}function Db(e,t){let r=[];return e instanceof zt.Request?(r.push(e.url),r.push({method:e.method,headers:e.headers,body:e.body})):r.push(e,{}),Object.assign(r[1],t),r[1].headers=new zt.Headers(r[1].headers||{}),r}var $t=Symbol("SyncFetch Internals"),as=class e extends Request{constructor(t,r={},i=r.body){super(t,r),this[$t]={body:i?ls.from(i):null}}clone(){return Gt(this),new e(this.url,this)}},ns=class e extends Response{constructor(t,r={}){t=t?ls.from(t):null,super(Rb(t),r),this[$t]={url:r.url,redirected:r.redirected,body:t}}get url(){return this[$t].url}get redirected(){return this[$t].redirected}clone(){return Gt(this),new e(this[$t].body,{url:this.url,headers:this.headers,status:this.status,statusText:this.statusText,redirected:this.redirected})}},os=class e{constructor(t){this[$t]={body:ls.from(t)}}static mixin(t){for(let r of Object.getOwnPropertyNames(e.prototype)){if(r==="constructor")continue;let i=Object.getOwnPropertyDescriptor(e.prototype,r);Object.defineProperty(t,r,{...i,enumerable:!0})}}arrayBuffer(){Gt(this);let t=ri(this);return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}blob(){Gt(this);let t=this.headers&&this.headers.get("content-type");return new Blob([ri(this)],t&&{type:t})}text(){return Gt(this),ri(this).toString()}json(){Gt(this);try{return JSON.parse(ri(this).toString())}catch(t){throw new TypeError(`invalid json response body at ${this.url} reason: ${t.message}`,"invalid-json")}}buffer(){return Gt(this),ri(this).clone()}};function Gt(e){if(e.bodyUsed)throw new TypeError(`body used already for: ${e.url}`)}function ri(e){return Pb(e,"arrayBuffer")(),e[$t].body||ls.alloc(0)}function Pb(e,t){return Object.getPrototypeOf(Object.getPrototypeOf(e))[t].bind(e)}function Rb(e){return new ReadableStream({start(t){t.enqueue(e),t.close()}})}os.mixin(as.prototype);os.mixin(ns.prototype);zt.Headers=self.Headers;zt.Request=as;zt.Response=ns;bu.exports=zt});var _u=R((us,vu)=>{(function(e,t){typeof us=="object"&&typeof vu!="undefined"?t(us):typeof define=="function"&&define.amd?define(["exports"],t):t(e.WHATWGFetch={})})(us,function(e){"use strict";var t=typeof globalThis!="undefined"&&globalThis||typeof self!="undefined"&&self||typeof global!="undefined"&&global||{},r={searchParams:"URLSearchParams"in t,iterable:"Symbol"in t&&"iterator"in Symbol,blob:"FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(A){return!1}}(),formData:"FormData"in t,arrayBuffer:"ArrayBuffer"in t};function i(A){return A&&DataView.prototype.isPrototypeOf(A)}if(r.arrayBuffer)var s=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],a=ArrayBuffer.isView||function(A){return A&&s.indexOf(Object.prototype.toString.call(A))>-1};function n(A){if(typeof A!="string"&&(A=String(A)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(A)||A==="")throw new TypeError('Invalid character in header field name: "'+A+'"');return A.toLowerCase()}function o(A){return typeof A!="string"&&(A=String(A)),A}function u(A){var y={next:function(){var _=A.shift();return{done:_===void 0,value:_}}};return r.iterable&&(y[Symbol.iterator]=function(){return y}),y}function c(A){this.map={},A instanceof c?A.forEach(function(y,_){this.append(_,y)},this):Array.isArray(A)?A.forEach(function(y){if(y.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+y.length);this.append(y[0],y[1])},this):A&&Object.getOwnPropertyNames(A).forEach(function(y){this.append(y,A[y])},this)}c.prototype.append=function(A,y){A=n(A),y=o(y);var _=this.map[A];this.map[A]=_?_+", "+y:y},c.prototype.delete=function(A){delete this.map[n(A)]},c.prototype.get=function(A){return A=n(A),this.has(A)?this.map[A]:null},c.prototype.has=function(A){return this.map.hasOwnProperty(n(A))},c.prototype.set=function(A,y){this.map[n(A)]=o(y)},c.prototype.forEach=function(A,y){for(var _ in this.map)this.map.hasOwnProperty(_)&&A.call(y,this.map[_],_,this)},c.prototype.keys=function(){var A=[];return this.forEach(function(y,_){A.push(_)}),u(A)},c.prototype.values=function(){var A=[];return this.forEach(function(y){A.push(y)}),u(A)},c.prototype.entries=function(){var A=[];return this.forEach(function(y,_){A.push([_,y])}),u(A)},r.iterable&&(c.prototype[Symbol.iterator]=c.prototype.entries);function p(A){if(!A._noBody){if(A.bodyUsed)return Promise.reject(new TypeError("Already read"));A.bodyUsed=!0}}function f(A){return new Promise(function(y,_){A.onload=function(){y(A.result)},A.onerror=function(){_(A.error)}})}function h(A){var y=new FileReader,_=f(y);return y.readAsArrayBuffer(A),_}function m(A){var y=new FileReader,_=f(y),k=/charset=([A-Za-z0-9_-]+)/.exec(A.type),Q=k?k[1]:"utf-8";return y.readAsText(A,Q),_}function g(A){for(var y=new Uint8Array(A),_=new Array(y.length),k=0;k<y.length;k++)_[k]=String.fromCharCode(y[k]);return _.join("")}function d(A){if(A.slice)return A.slice(0);var y=new Uint8Array(A.byteLength);return y.set(new Uint8Array(A)),y.buffer}function v(){return this.bodyUsed=!1,this._initBody=function(A){this.bodyUsed=this.bodyUsed,this._bodyInit=A,A?typeof A=="string"?this._bodyText=A:r.blob&&Blob.prototype.isPrototypeOf(A)?this._bodyBlob=A:r.formData&&FormData.prototype.isPrototypeOf(A)?this._bodyFormData=A:r.searchParams&&URLSearchParams.prototype.isPrototypeOf(A)?this._bodyText=A.toString():r.arrayBuffer&&r.blob&&i(A)?(this._bodyArrayBuffer=d(A.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):r.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(A)||a(A))?this._bodyArrayBuffer=d(A):this._bodyText=A=Object.prototype.toString.call(A):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof A=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):r.searchParams&&URLSearchParams.prototype.isPrototypeOf(A)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},r.blob&&(this.blob=function(){var A=p(this);if(A)return A;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var A=p(this);return A||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(r.blob)return this.blob().then(h);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var A=p(this);if(A)return A;if(this._bodyBlob)return m(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(g(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},r.formData&&(this.formData=function(){return this.text().then(w)}),this.json=function(){return this.text().then(JSON.parse)},this}var b=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function E(A){var y=A.toUpperCase();return b.indexOf(y)>-1?y:A}function x(A,y){if(!(this instanceof x))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');y=y||{};var _=y.body;if(A instanceof x){if(A.bodyUsed)throw new TypeError("Already read");this.url=A.url,this.credentials=A.credentials,y.headers||(this.headers=new c(A.headers)),this.method=A.method,this.mode=A.mode,this.signal=A.signal,!_&&A._bodyInit!=null&&(_=A._bodyInit,A.bodyUsed=!0)}else this.url=String(A);if(this.credentials=y.credentials||this.credentials||"same-origin",(y.headers||!this.headers)&&(this.headers=new c(y.headers)),this.method=E(y.method||this.method||"GET"),this.mode=y.mode||this.mode||null,this.signal=y.signal||this.signal||function(){if("AbortController"in t){var O=new AbortController;return O.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&_)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(_),(this.method==="GET"||this.method==="HEAD")&&(y.cache==="no-store"||y.cache==="no-cache")){var k=/([?&])_=[^&]*/;if(k.test(this.url))this.url=this.url.replace(k,"$1_="+new Date().getTime());else{var Q=/\?/;this.url+=(Q.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}x.prototype.clone=function(){return new x(this,{body:this._bodyInit})};function w(A){var y=new FormData;return A.trim().split("&").forEach(function(_){if(_){var k=_.split("="),Q=k.shift().replace(/\+/g," "),O=k.join("=").replace(/\+/g," ");y.append(decodeURIComponent(Q),decodeURIComponent(O))}}),y}function S(A){var y=new c,_=A.replace(/\r?\n[\t ]+/g," ");return _.split("\r").map(function(k){return k.indexOf(`
`)===0?k.substr(1,k.length):k}).forEach(function(k){var Q=k.split(":"),O=Q.shift().trim();if(O){var N=Q.join(":").trim();try{y.append(O,N)}catch(B){console.warn("Response "+B.message)}}}),y}v.call(x.prototype);function T(A,y){if(!(this instanceof T))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(y||(y={}),this.type="default",this.status=y.status===void 0?200:y.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=y.statusText===void 0?"":""+y.statusText,this.headers=new c(y.headers),this.url=y.url||"",this._initBody(A)}v.call(T.prototype),T.prototype.clone=function(){return new T(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new c(this.headers),url:this.url})},T.error=function(){var A=new T(null,{status:200,statusText:""});return A.ok=!1,A.status=0,A.type="error",A};var I=[301,302,303,307,308];T.redirect=function(A,y){if(I.indexOf(y)===-1)throw new RangeError("Invalid status code");return new T(null,{status:y,headers:{location:A}})},e.DOMException=t.DOMException;try{new e.DOMException}catch(A){e.DOMException=function(y,_){this.message=y,this.name=_;var k=Error(y);this.stack=k.stack},e.DOMException.prototype=Object.create(Error.prototype),e.DOMException.prototype.constructor=e.DOMException}function C(A,y){return new Promise(function(_,k){var Q=new x(A,y);if(Q.signal&&Q.signal.aborted)return k(new e.DOMException("Aborted","AbortError"));var O=new XMLHttpRequest;function N(){O.abort()}O.onload=function(){var P={statusText:O.statusText,headers:S(O.getAllResponseHeaders()||"")};Q.url.indexOf("file://")===0&&(O.status<200||O.status>599)?P.status=200:P.status=O.status,P.url="responseURL"in O?O.responseURL:P.headers.get("X-Request-URL");var F="response"in O?O.response:O.responseText;setTimeout(function(){_(new T(F,P))},0)},O.onerror=function(){setTimeout(function(){k(new TypeError("Network request failed"))},0)},O.ontimeout=function(){setTimeout(function(){k(new TypeError("Network request timed out"))},0)},O.onabort=function(){setTimeout(function(){k(new e.DOMException("Aborted","AbortError"))},0)};function B(P){try{return P===""&&t.location.href?t.location.href:P}catch(F){return P}}if(O.open(Q.method,B(Q.url),!0),Q.credentials==="include"?O.withCredentials=!0:Q.credentials==="omit"&&(O.withCredentials=!1),"responseType"in O&&(r.blob?O.responseType="blob":r.arrayBuffer&&(O.responseType="arraybuffer")),y&&typeof y.headers=="object"&&!(y.headers instanceof c||t.Headers&&y.headers instanceof t.Headers)){var q=[];Object.getOwnPropertyNames(y.headers).forEach(function(P){q.push(n(P)),O.setRequestHeader(P,o(y.headers[P]))}),Q.headers.forEach(function(P,F){q.indexOf(F)===-1&&O.setRequestHeader(F,P)})}else Q.headers.forEach(function(P,F){O.setRequestHeader(F,P)});Q.signal&&(Q.signal.addEventListener("abort",N),O.onreadystatechange=function(){O.readyState===4&&Q.signal.removeEventListener("abort",N)}),O.send(typeof Q._bodyInit=="undefined"?null:Q._bodyInit)})}C.polyfill=!0,t.fetch||(t.fetch=C,t.Headers=c,t.Request=x,t.Response=T),e.Headers=c,e.Request=x,e.Response=T,e.fetch=C,Object.defineProperty(e,"__esModule",{value:!0})})});var wu=R((Tx,Eu)=>{_u();Eu.exports=self.fetch.bind(self)});var bn=R((Ax,Lb)=>{Lb.exports={name:"@citation-js/core",version:"0.5.7",description:"Convert different bibliographic metadata sources",keywords:["citation-js","citation","bibliography"],author:"Lars Willighagen <lars.willighagen@gmail.com>",license:"MIT",main:"lib/index.js",module:"lib-mjs/index.js",directories:{lib:"src",test:"__tests__"},homepage:"https://citation.js.org/",repository:"https://github.com/citation-js/citation-js/tree/master/packages/core",bugs:{url:"https://github.com/citation-js/citation-js/issues"},engines:{node:">=10"},files:["lib","lib-mjs"],scripts:{test:"mocha -c -R dot test/*.spec.js"},dependencies:{"@citation-js/date":"^0.5.0","@citation-js/name":"^0.4.2","isomorphic-fetch":"^3.0.0","sync-fetch":"^0.3.0"},devDependencies:{"@babel/plugin-proposal-class-properties":"^7.12.1"},gitHead:"e253e74b1bb444a2b29fd14a4fd818617b7c55b3"}});var Qu=R(Ht=>{"use strict";Object.defineProperty(Ht,"__esModule",{value:!0});Ht.default=void 0;Ht.fetchFile=ku;Ht.fetchFileAsync=Mb;Ht.setUserAgent=Ub;var xu=vn(yu());wu();var Tu=vn(Rt()),Bb=vn(bn());function vn(e){return e&&e.__esModule?e:{default:e}}var Au=typeof location!="undefined"&&typeof document!="undefined",yn=Au?"":`Citation.js/${Bb.default.version} Node.js/${process.version}`;function Su(e){let t={},r=e instanceof Headers||e instanceof xu.default.Headers?Array.from(e):Object.entries(e);for(let[i,s]of r)t[i.toLowerCase()]=s.toString();return t}function Cu(e={}){let t={headers:{accept:"*/*"},method:"GET",checkContentType:e.checkContentType};if(yn&&!Au&&(t.headers["user-agent"]=yn),e.body){t.method="POST";let r=typeof e.body!="string";t.body=r?JSON.stringify(e.body):e.body,t.headers["content-type"]=r?"application/json":"text/plain"}return e.headers&&Object.assign(t.headers,Su(e.headers)),t}function Fb(e,t){if(!e.accept||e.accept==="*/*"||!t["content-type"])return!0;let[r,i]=t["content-type"].split(";")[0].trim().split("/");return e.accept.split(",").map(s=>s.split(";")[0].trim().split("/")).some(([s,a])=>(s===r||s==="*")&&(a===i||a==="*"))}function Ou(e,t){let{status:r,headers:i}=e,s;if(r>=400?s=new Error(`Server responded with status code ${r}`):t.checkContentType===!0&&!Fb(t.headers,Su(i))&&(s=new Error(`Server responded with content-type ${i.get("content-type")}`)),s)throw s.status=r,s.headers=i,s.body=e.body,s;return e}function ku(e,t){let r=Cu(t);return Tu.default.http("[core]",r.method,e,r),Ou((0,xu.default)(e,r),r).text()}async function Mb(e,t){let r=Cu(t);return Tu.default.http("[core]",r.method,e,r),fetch(e,r).then(i=>Ou(i,r)).then(i=>i.text())}function Ub(e){yn=e}var qb=ku;Ht.default=qb});var Nu=R(cs=>{"use strict";Object.defineProperty(cs,"__esModule",{value:!0});cs.default=void 0;var _n=class e{constructor(t){this.stack=t,this.index=0,this.current=this.stack[this.index]}static getPatternText(t){return`"${t instanceof RegExp?t.source:t}"`}static getMatchCallback(t){if(Array.isArray(t)){let r=t.map(e.getMatchCallback);return i=>r.some(s=>s(i))}else return t instanceof Function?t:t instanceof RegExp?r=>t.test(r):r=>t===r}tokensLeft(){return this.stack.length-this.index}matches(t){return e.getMatchCallback(t)(this.current,this.index,this.stack)}matchesSequence(t){let r=this.stack.slice(this.index,this.index+t.length).join("");return typeof t=="string"?r===t:t.every((i,s)=>e.getMatchCallback(i)(r[s]))}consumeToken(t=/^[\s\S]$/,{inverse:r=!1,spaced:i=!0}={}){i&&this.consumeWhitespace();let s=this.current;if(e.getMatchCallback(t)(s,this.index,this.stack))this.current=this.stack[++this.index];else throw new SyntaxError(`Unexpected token at index ${this.index}: Expected ${e.getPatternText(t)}, got "${s}"`);return i&&this.consumeWhitespace(),s}consumeWhitespace(t=/^\s$/,{optional:r=!0}={}){return this.consume(t,{min:+!r})}consumeN(t){if(this.tokensLeft()<t)throw new SyntaxError("Not enough tokens left");let r=this.index;for(;t--;)this.current=this.stack[++this.index];return this.stack.slice(r,this.index).join("")}consumeSequence(t){if(this.matchesSequence(t))return this.consumeN(t.length);throw new SyntaxError(`Expected "${t}", got "${this.consumeN(t.length)}"`)}consume(t=/^[\s\S]$/,{min:r=0,max:i=1/0,inverse:s=!1,tokenMap:a,tokenFilter:n}={}){let o=this.index,u=e.getMatchCallback(t);for(;u(this.current,this.index,this.stack)!==s;)this.current=this.stack[++this.index];let c=this.stack.slice(o,this.index);if(c.length<r)throw new SyntaxError(`Not enough ${e.getPatternText(t)}`);if(c.length>i)throw new SyntaxError(`Too many ${e.getPatternText(t)}`);return a&&(c=c.map(a)),n&&(c=c.filter(n)),c.join("")}},jb=_n;cs.default=jb});var Iu=R(ps=>{"use strict";Object.defineProperty(ps,"__esModule",{value:!0});ps.Grammar=void 0;var Gb=Ui(),En=class{constructor(t,r){this.rules=t,this.defaultState=r,this.mainRule=Object.keys(t)[0],this.log=[]}parse(t,r){return this.lexer=t,this.token=this.lexer.next(),this.state=(0,Gb.deepCopy)(this.defaultState),this.log=[],this.consumeRule(r||this.mainRule)}matchEndOfFile(){return!this.token}matchToken(t){return this.token&&t===this.token.type}consumeToken(t,r){let i=this.token;if(!t||i&&i.type===t)return this.token=this.lexer.next(),i;if(r)return;{let s=i?`"${i.type}"`:"EOF",a=new SyntaxError(this.lexer.formatError(i,`expected "${t}", got ${s}`));throw a.message+=` (${this.log.join("->")})`,a}}consumeRule(t){this.log.push(t);let r=this.rules[t].call(this);return this.log.pop(),r}};ps.Grammar=En});var Pu=R(hs=>{"use strict";Object.defineProperty(hs,"__esModule",{value:!0});hs.Translator=void 0;function $b(e){return function(r){return typeof e=="boolean"?e:Object.keys(e).every(i=>{let s=e[i];return s===!0?i in r:s===!1?!(i in r):typeof s=="function"?s(r[i]):Array.isArray(s)?s.includes(r[i]):r[i]===s})}}function zb(e,t){let r,i,s,a;if(typeof e=="string")r=i=e;else if(e)r=t?e.target:e.source,i=t?e.source:e.target,e.convert&&(s=t?e.convert.toSource:e.convert.toTarget),e.when&&(a=t?e.when.target:e.when.source,a!=null&&(a=$b(a)));else return null;return r=[].concat(r).filter(Boolean),i=[].concat(i).filter(Boolean),{inputProp:r,outputProp:i,convert:s,condition:a}}function Du(e,t){return t=t===_r.CONVERT_TO_SOURCE,e=e.map(r=>zb(r,t)).filter(Boolean),function(i){let s={};for(let{inputProp:a,outputProp:n,convert:o,condition:u}of e){if(n.length===0)continue;if(u&&!u(i))continue;if(a.length!==0&&a.every(p=>!(p in i)))continue;let c=a.map(p=>i[p]);if(o)try{let p=o.apply(i,c);c=n.length===1?[p]:p}catch(p){throw new Error(`Failed to convert ${a} to ${n}`,{cause:p})}n.forEach((p,f)=>{let h=c[f];h!==void 0&&(s[p]=h)})}return s}}var _r=class e{constructor(t){this.convertToSource=Du(t,e.CONVERT_TO_SOURCE),this.convertToTarget=Du(t,e.CONVERT_TO_TARGET)}};hs.Translator=_r;_r.CONVERT_TO_SOURCE=Symbol("convert to source");_r.CONVERT_TO_TARGET=Symbol("convert to target")});var ms=R(Ye=>{"use strict";Object.defineProperty(Ye,"__esModule",{value:!0});Object.defineProperty(Ye,"Grammar",{enumerable:!0,get:function(){return Wb.Grammar}});Object.defineProperty(Ye,"Register",{enumerable:!0,get:function(){return Jb.default}});Object.defineProperty(Ye,"TokenStack",{enumerable:!0,get:function(){return Yb.default}});Object.defineProperty(Ye,"Translator",{enumerable:!0,get:function(){return Xb.Translator}});Object.defineProperty(Ye,"deepCopy",{enumerable:!0,get:function(){return Hb.default}});Object.defineProperty(Ye,"fetchFile",{enumerable:!0,get:function(){return wn.fetchFile}});Object.defineProperty(Ye,"fetchFileAsync",{enumerable:!0,get:function(){return wn.fetchFileAsync}});Object.defineProperty(Ye,"fetchId",{enumerable:!0,get:function(){return Vb.default}});Object.defineProperty(Ye,"setUserAgent",{enumerable:!0,get:function(){return wn.setUserAgent}});var Hb=fs(Ui()),wn=Qu(),Vb=fs(en()),Yb=fs(Nu()),Jb=fs(Ki()),Wb=Iu(),Xb=Pu();function fs(e){return e&&e.__esModule?e:{default:e}}});var Ru=R(ds=>{"use strict";Object.defineProperty(ds,"__esModule",{value:!0});ds.parse=void 0;var Kb=()=>[];ds.parse=Kb});var Bu=R(gs=>{"use strict";Object.defineProperty(gs,"__esModule",{value:!0});Object.defineProperty(gs,"parse",{enumerable:!0,get:function(){return Lu.fetchFile}});Object.defineProperty(gs,"parseAsync",{enumerable:!0,get:function(){return Lu.fetchFileAsync}});var Lu=ms()});var Fu=R(Er=>{"use strict";Object.defineProperty(Er,"__esModule",{value:!0});Er.parse=Er.default=void 0;var Zb=ey(Rt());function ey(e){return e&&e.__esModule?e:{default:e}}var ty=[[/((?:\[|:|,)\s*)'((?:\\'|[^'])*?[^\\])?'(?=\s*(?:\]|}|,))/g,'$1"$2"'],[/((?:(?:"|]|}|\/[gmiuys]|\.|(?:\d|\.|-)*\d)\s*,|{)\s*)(?:"([^":\n]+?)"|'([^":\n]+?)'|([^":\n]+?))(\s*):/g,'$1"$2$3$4"$5:']],ry=function(e){if(typeof e!="string")return JSON.parse(e);try{return JSON.parse(e)}catch(t){return Zb.default.debug("[plugin-common]","Invalid JSON, switching to experimental parser"),ty.forEach(([r,i])=>{e=e.replace(r,i)}),JSON.parse(e)}};Er.default=Er.parse=ry});var Mu=R(xn=>{"use strict";Object.defineProperty(xn,"__esModule",{value:!0});xn.parse=iy;function iy(e){return e.val()||e.text()||e.html()}});var Uu=R(Tn=>{"use strict";Object.defineProperty(Tn,"__esModule",{value:!0});Tn.parse=sy;function sy(e){return e.value||e.textContent}});var Sn=R(yt=>{"use strict";Object.defineProperty(yt,"__esModule",{value:!0});yt.ref=yt.parsers=yt.formats=void 0;var bs=ii(Ru()),An=ii(Bu()),qu=ii(Fu()),ju=ii(Mu()),Gu=ii(Uu());function $u(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,r=new WeakMap;return($u=function(i){return i?r:t})(e)}function ii(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||typeof e!="object"&&typeof e!="function")return{default:e};var r=$u(t);if(r&&r.has(e))return r.get(e);var i={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(a!=="default"&&Object.prototype.hasOwnProperty.call(e,a)){var n=s?Object.getOwnPropertyDescriptor(e,a):null;n&&(n.get||n.set)?Object.defineProperty(i,a,n):i[a]=e[a]}return i.default=e,r&&r.set(e,i),i}var ay="@else";yt.ref=ay;var ny={empty:bs,url:An,json:qu,jquery:ju,html:Gu};yt.parsers=ny;var oy={"@empty/text":{parse:bs.parse,parseType:{dataType:"String",predicate:e=>e===""}},"@empty/whitespace+text":{parse:bs.parse,parseType:{dataType:"String",predicate:/^\s+$/}},"@empty":{parse:bs.parse,parseType:{dataType:"Primitive",predicate:e=>e==null}},"@else/json":{parse:qu.parse,parseType:{dataType:"String",predicate:/^\s*(\{[\S\s]*\}|\[[\S\s]*\])\s*$/}},"@else/url":{parse:An.parse,parseAsync:An.parseAsync,parseType:{dataType:"String",predicate:/^https?:\/\/(([\w-]+\.)*[\w-]+)(:\d+)?(\/[^?/]*)*(\?[^#]*)?(#.*)?$/i}},"@else/jquery":{parse:ju.parse,parseType:{dataType:"ComplexObject",predicate(e){return typeof jQuery!="undefined"&&e instanceof jQuery}}},"@else/html":{parse:Gu.parse,parseType:{dataType:"ComplexObject",predicate(e){return typeof HTMLElement!="undefined"&&e instanceof HTMLElement}}}};yt.formats=oy});var Ku=R(si=>{"use strict";Object.defineProperty(si,"__esModule",{value:!0});si.default=void 0;si.getJsonWrapper=py;var Hu=Yu(ts()),ly=Yu(ms()),uy=cy(Rt());function cy(e){return e&&e.__esModule?e:{default:e}}function Vu(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,r=new WeakMap;return(Vu=function(i){return i?r:t})(e)}function Yu(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||typeof e!="object"&&typeof e!="function")return{default:e};var r=Vu(t);if(r&&r.has(e))return r.get(e);var i={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(a!=="default"&&Object.prototype.hasOwnProperty.call(e,a)){var n=s?Object.getOwnPropertyDescriptor(e,a):null;n&&(n.get||n.set)?Object.defineProperty(i,a,n):i[a]=e[a]}return i.default=e,r&&r.set(e,i),i}var Ju=(e,t,r)=>e+(t<r.length-1?",":""),Wu=function(e,t){let r=Array.isArray(e),i;return r?i=e.map(s=>zu(s,t)):i=Object.keys(e).filter(s=>JSON.stringify(e[s])).map(s=>`"${s}": ${zu(e[s],t)}`),i=i.map(Ju).map(s=>t.listItem.join(s)),i=t.list.join(i.join("")),r?`[${i}]`:`{${i}}`},zu=function(e,t){return typeof e=="object"&&e!==null?e.length===0?"[]":Object.keys(e).length===0?"{}":Wu(e,t):JSON.stringify(e)},Xu=function(e,t){let r=e.map(i=>Wu(i,t));return r=r.map(Ju).map(i=>t.entry.join(i)),r=r.join(""),t.bibliographyContainer.join(`[${r}]`)};function py(e){return Xu(e,Hu.dict.get("html"))}var hy={data(e,{type:t,format:r=t||"text"}={}){return r==="object"?ly.deepCopy(e):r==="text"?JSON.stringify(e,null,2):(uy.default.warn("[core]","This feature (JSON output with special formatting) is unstable. See https://github.com/larsgw/citation.js/issues/144"),Xu(e,Hu.dict.get(r)))},ndjson(e){return e.map(t=>JSON.stringify(t)).join(`
`)}};si.default=hy});var vs=R(ys=>{"use strict";Object.defineProperty(ys,"__esModule",{value:!0});ys.default=void 0;var fy=Zu(Ku()),my=Zu(tn());function Zu(e){return e&&e.__esModule?e:{default:e}}var dy=Object.assign({},fy.default,my.default);ys.default=dy});var rc=R(()=>{"use strict";var gy=vy(ts()),ec=Sn(),by=yy(vs());function yy(e){return e&&e.__esModule?e:{default:e}}function tc(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,r=new WeakMap;return(tc=function(i){return i?r:t})(e)}function vy(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||typeof e!="object"&&typeof e!="function")return{default:e};var r=tc(t);if(r&&r.has(e))return r.get(e);var i={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(a!=="default"&&Object.prototype.hasOwnProperty.call(e,a)){var n=s?Object.getOwnPropertyDescriptor(e,a):null;n&&(n.get||n.set)?Object.defineProperty(i,a,n):i[a]=e[a]}return i.default=e,r&&r.set(e,i),i}gy.add(ec.ref,{input:ec.formats,output:by.default})});var me=R(st=>{"use strict";Object.defineProperty(st,"__esModule",{value:!0});Object.defineProperty(st,"Cite",{enumerable:!0,get:function(){return _y.default}});Object.defineProperty(st,"logger",{enumerable:!0,get:function(){return xy.default}});st.version=st.util=st.plugins=void 0;var _y=Cn(Ii()),Ey=sc(ts());st.plugins=Ey;var wy=sc(ms());st.util=wy;var xy=Cn(Rt()),Ty=Cn(bn());rc();function ic(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,r=new WeakMap;return(ic=function(i){return i?r:t})(e)}function sc(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||typeof e!="object"&&typeof e!="function")return{default:e};var r=ic(t);if(r&&r.has(e))return r.get(e);var i={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(a!=="default"&&Object.prototype.hasOwnProperty.call(e,a)){var n=s?Object.getOwnPropertyDescriptor(e,a):null;n&&(n.get||n.set)?Object.defineProperty(i,a,n):i[a]=e[a]}return i.default=e,r&&r.set(e,i),i}function Cn(e){return e&&e.__esModule?e:{default:e}}var Ay=Ty.default.version;st.version=Ay});var oc=R(_s=>{"use strict";Object.defineProperty(_s,"__esModule",{value:!0});_s.default=void 0;function wr(e,t){return ky(e)||Oy(e,t)||Cy(e,t)||Sy()}function Sy(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Cy(e,t){if(e){if(typeof e=="string")return ac(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ac(e,t)}}function ac(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function Oy(e,t){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],s=!0,a=!1,n,o;try{for(r=r.call(e);!(s=(n=r.next()).done)&&(i.push(n.value),!(t&&i.length===t));s=!0);}catch(u){a=!0,o=u}finally{try{!s&&r.return!=null&&r.return()}finally{if(a)throw o}}return i}}function ky(e){if(Array.isArray(e))return e}var Qy={jan:1,feb:2,mar:3,apr:4,may:5,jun:6,jul:7,aug:8,sep:9,oct:10,nov:11,dec:12},Ny=/ (?:to|[-/]) | ?(?:--|[]) ?/,nc=/^(\d{4}-\d{2}-\d{2})\/(\d{4}-\d{2}-\d{2})$/;function Vt(e){return Qy[e.toLowerCase().slice(0,3)]}function Iy(e){let t=new Date(e);return typeof e=="number"&&!isNaN(t.valueOf())?[t.getFullYear(),t.getMonth()+1,t.getDate()]:null}var Dy=function(t){let r=/^(\d{4}|[-+]\d{6,})-(\d{2})(?:-(\d{2}))?/;if(typeof t!="string"||!r.test(t))return null;let i=t.match(r),s=wr(i,4),a=s[1],n=s[2],o=s[3];return+n?+o?[a,n,o]:[a,n]:[a]},Py=function(t){let r=/^(?:[a-z]{3},\s*)?(\d{1,2}) ([a-z]{3}) (\d{4,})/i;if(typeof t!="string"||!r.test(t))return null;let i=t.match(r),s=wr(i,4),a=s[1],n=s[2],o=s[3];return n=Vt(n),n?[o,n,a]:null};function Ry(e){let t=/^(\d{1,2})\/(\d{1,2})\/(\d{2}(?:\d{2})?)/;if(typeof e!="string"||!t.test(e))return null;let r=e.match(t),i=wr(r,4),s=i[1],a=i[2],n=i[3];return new Date(n,s,a).getMonth()===parseInt(s)?[n,s,a]:null}function Ly(e){let t=/^(\d{1,2})[ .\-/](\d{1,2}|[a-z]{3,10})[ .\-/](-?\d+)/i,r=/^(-?\d+)[ .\-/](\d{1,2}|[a-z]{3,10})[ .\-/](\d{1,2})/i,i,s,a;if(typeof e!="string")return null;if(t.test(e)){var n=e.match(t),o=wr(n,4);a=o[1],s=o[2],i=o[3]}else if(r.test(e)){var u=e.match(r),c=wr(u,4);i=c[1],s=c[2],a=c[3]}else return null;if(Vt(s))s=Vt(s);else if(isNaN(s))return null;return[i,s,a]}function By(e){let t=/^([a-z]{3,10}|-?\d+)[^\w-]+([a-z]{3,10}|-?\d+)$/i;if(typeof e=="string"&&t.test(e)){let r=e.match(t).slice(1,3),i;if(Vt(r[1]))i=Vt(r.pop());else if(Vt(r[0]))i=Vt(r.shift());else{if(r.some(isNaN)||r.every(a=>+a<0))return null;+r[0]<0||+r[0]>+r[1]&&+r[1]>0?i=r.pop():i=r.shift()}return[r.pop(),i]}else return null}function Fy(e){if(typeof e!="string")return null;let t=e.match(/^(\d+) ?(a\.?d\.?|b\.?c\.?)$/i);if(t){let r=t.slice(1),i=wr(r,2),s=i[0],a=i[1];return[s*(a.toLowerCase()[0]==="a"?1:-1)]}else return/^-?\d+$/.test(e)?[e]:null}function My(e){let t=Iy(e)||Dy(e)||Py(e)||Ry(e)||Ly(e)||By(e)||Fy(e);return t&&t.map(r=>parseInt(r))}function Uy(e){return nc.test(e)?e.match(nc).slice(1,3):e.split(Ny)}function qy(e,t){let r=[],i=typeof e=="string"&&Uy(e);t?r.push(e,t):i&&i.length===2?r.push(...i):r.push(e);let s=r.map(My);return s.filter(Boolean).length===r.length?{"date-parts":s}:{raw:t?r.join("/"):e}}var jy=qy;_s.default=jy});var lc=R(Es=>{"use strict";Object.defineProperty(Es,"__esModule",{value:!0});Es.default=void 0;function On(e,t,r){if(e.length>=t)return e;for(;e.length<t;)e=r+e;return e.slice(-t)}var Gy=function(t,r="-"){if(!t["date-parts"])return t.raw;let i=t["date-parts"][0].map(s=>s.toString());switch(i.length){case 3:i[2]=On(i[2],2,"0");case 2:i[1]=On(i[1],2,"0");case 1:i[0]=On(i[0],4,"0");break}return i.join(r)},$y=Gy;Es.default=$y});var vt=R(ws=>{"use strict";Object.defineProperty(ws,"__esModule",{value:!0});Object.defineProperty(ws,"format",{enumerable:!0,get:function(){return Hy.default}});Object.defineProperty(ws,"parse",{enumerable:!0,get:function(){return zy.default}});var zy=uc(oc()),Hy=uc(lc());function uc(e){return e&&e.__esModule?e:{default:e}}});var fc=R(xr=>{"use strict";Object.defineProperty(xr,"__esModule",{value:!0});xr.record=xr.quickscrapeRecord=void 0;var cc=vt(),Vy=pr();function kn(e){let{firstname:t,lastname:r,firstName:i=t,lastName:s=r}=e;if(i&&s)return{given:i,family:s};if(e.name)return(0,Vy.parse)(e.name)}var Yy=["PMID","PMCID","DOI","ISBN"],Jy=["ISSN"];function pc(e,t){let r={};for(let i in e){let s=i.toUpperCase();t.includes(s)&&(r[s]=e[i])}if(e.identifier)for(let{id:i,type:s=""}of e.identifier)s=s.toUpperCase(),t.includes(s)&&(r[s]=i);return r}var Wy={article:"article",book:"book",booklet:"book",proceedings:"book",mastersthesis:"thesis",inbook:"chapter",incollection:"chapter",conference:"paper-conference",inproceedings:"paper-conference",online:"website",patent:"patent",phdthesis:"thesis",techreport:"report",unpublished:"manuscript",manual:void 0,misc:void 0};function Xy(){return{type:"article-journal"}}function hc(e){let t={type:Wy[e.type]||"book"};if(e.title&&(t.title=e.title),e.author&&(t.author=e.author.map(kn).filter(Boolean)),e.editor&&(t.editor=e.editor.map(kn).filter(Boolean)),e.reviewer&&(e.author&&(t["reviewed-author"]=t.author),t.author=e.reviewer.map(kn).filter(Boolean)),Array.isArray(e.keywords)?t.keyword=e.keywords.join():e.keywords&&(t.keyword=e.keywords),e.publisher&&(t.publisher=e.publisher.name||e.publisher),e.date&&Object.keys(e.date).length>0){let r=e.date;r.submitted&&(t.submitted=(0,cc.parse)(r.submitted)),r.published&&(t.issued=(0,cc.parse)(r.published))}else e.year&&(t.issued={"date-parts":[[+e.year]]});if(e.journal){let r=e.journal;r.name&&(t["container-title"]=r.name),r.volume&&(t.volume=+r.volume),r.issue&&(t.issue=+r.issue),Object.assign(t,pc(r,Jy)),r.firstpage&&(t["page-first"]=r.firstpage),r.pages?t.page=r.pages.replace("--","-"):r.firstpage&&r.lastpage&&(t.page=r.firstpage+"-"+r.lastpage)}return e.link&&typeof e.link[0]=="object"&&(t.URL=e.link[0].url),Object.assign(t,pc(e,Yy)),e.cid?t.id=e.cid:t.DOI&&(t.id=t.DOI),t}var Ky=function(e){return Object.assign(hc(e),Xy(e))};xr.quickscrapeRecord=Ky;var Zy=function(e){return hc(e)};xr.record=Zy});var Nn=R(_t=>{"use strict";Object.defineProperty(_t,"__esModule",{value:!0});_t.ref=_t.parsers=_t.formats=void 0;var Qn=tv(fc()),ev=me();function mc(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,r=new WeakMap;return(mc=function(i){return i?r:t})(e)}function tv(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||typeof e!="object"&&typeof e!="function")return{default:e};var r=mc(t);if(r&&r.has(e))return r.get(e);var i={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(a!=="default"&&Object.prototype.hasOwnProperty.call(e,a)){var n=s?Object.getOwnPropertyDescriptor(e,a):null;n&&(n.get||n.set)?Object.defineProperty(i,a,n):i[a]=e[a]}return i.default=e,r&&r.set(e,i),i}var rv=["fulltext_html","fulltext_xml","fulltext_pdf"],dc="@bibjson";_t.ref=dc;var iv={json:Qn};_t.parsers=iv;var gc={"@bibjson/quickscrape+record+object":{parse:Qn.quickscrapeRecord,parseType:{propertyConstraint:{props:"link",value(e){return rv.some(t=>e.find(({type:r})=>r===t))}},extends:"@bibjson/record+object"}},"@bibjson/record+object":{parse:Qn.record,parseType:{dataType:"SimpleObject",propertyConstraint:[{props:"title"},{props:["author","editor"],match:"some",value(e){return Array.isArray(e)&&e[0]&&"name"in e[0]}}]}},"@bibjson/collection+object":{parse(e){return e.records},parseType:{dataType:"SimpleObject",propertyConstraint:[{props:"metadata",value(e){return"collection"in e}},{props:"records",value(e){return Array.isArray(e)}}]}}};_t.formats=gc;ev.plugins.add(dc,{input:gc})});var In=R((bc,xs)=>{(function(e,t){typeof define=="function"&&define.amd?define([],t):typeof xs=="object"&&xs.exports?xs.exports=t():e.moo=t()})(bc,function(){"use strict";var e=Object.prototype.hasOwnProperty,t=Object.prototype.toString,r=typeof new RegExp().sticky=="boolean";function i(y){return y&&t.call(y)==="[object RegExp]"}function s(y){return y&&typeof y=="object"&&!i(y)&&!Array.isArray(y)}function a(y){return y.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function n(y){var _=new RegExp("|"+y);return _.exec("").length-1}function o(y){return"("+y+")"}function u(y){if(!y.length)return"(?!)";var _=y.map(function(k){return"(?:"+k+")"}).join("|");return"(?:"+_+")"}function c(y){if(typeof y=="string")return"(?:"+a(y)+")";if(i(y)){if(y.ignoreCase)throw new Error("RegExp /i flag not allowed");if(y.global)throw new Error("RegExp /g flag is implied");if(y.sticky)throw new Error("RegExp /y flag is implied");if(y.multiline)throw new Error("RegExp /m flag is implied");return y.source}else throw new Error("Not a pattern: "+y)}function p(y,_){return y.length>_?y:Array(_-y.length+1).join(" ")+y}function f(y,_){for(var k=y.length,Q=0;;){var O=y.lastIndexOf(`
`,k-1);if(O===-1||(Q++,k=O,Q===_)||k===0)break}var N=Q<_?0:k+1;return y.substring(N).split(`
`)}function h(y){for(var _=Object.getOwnPropertyNames(y),k=[],Q=0;Q<_.length;Q++){var O=_[Q],N=y[O],B=[].concat(N);if(O==="include"){for(var q=0;q<B.length;q++)k.push({include:B[q]});continue}var P=[];B.forEach(function(F){s(F)?(P.length&&k.push(g(O,P)),k.push(g(O,F)),P=[]):P.push(F)}),P.length&&k.push(g(O,P))}return k}function m(y){for(var _=[],k=0;k<y.length;k++){var Q=y[k];if(Q.include){for(var O=[].concat(Q.include),N=0;N<O.length;N++)_.push({include:O[N]});continue}if(!Q.type)throw new Error("Rule has no type: "+JSON.stringify(Q));_.push(g(Q.type,Q))}return _}function g(y,_){if(s(_)||(_={match:_}),_.include)throw new Error("Matching rules cannot also include states");var k={defaultType:y,lineBreaks:!!_.error||!!_.fallback,pop:!1,next:null,push:null,error:!1,fallback:!1,value:null,type:null,shouldThrow:!1};for(var Q in _)e.call(_,Q)&&(k[Q]=_[Q]);if(typeof k.type=="string"&&y!==k.type)throw new Error("Type transform cannot be a string (type '"+k.type+"' for token '"+y+"')");var O=k.match;return k.match=Array.isArray(O)?O:O?[O]:[],k.match.sort(function(N,B){return i(N)&&i(B)?0:i(B)?-1:i(N)?1:B.length-N.length}),k}function d(y){return Array.isArray(y)?m(y):h(y)}var v=g("error",{lineBreaks:!0,shouldThrow:!0});function b(y,_){for(var k=null,Q=Object.create(null),O=!0,N=null,B=[],q=[],P=0;P<y.length;P++)y[P].fallback&&(O=!1);for(var P=0;P<y.length;P++){var F=y[P];if(F.include)throw new Error("Inheritance is not allowed in stateless lexers");if(F.error||F.fallback){if(k)throw!F.fallback==!k.fallback?new Error("Multiple "+(F.fallback?"fallback":"error")+" rules not allowed (for token '"+F.defaultType+"')"):new Error("fallback and error are mutually exclusive (for token '"+F.defaultType+"')");k=F}var j=F.match.slice();if(O)for(;j.length&&typeof j[0]=="string"&&j[0].length===1;){var D=j.shift();Q[D.charCodeAt(0)]=F}if(F.pop||F.push||F.next){if(!_)throw new Error("State-switching options are not allowed in stateless lexers (for token '"+F.defaultType+"')");if(F.fallback)throw new Error("State-switching options are not allowed on fallback tokens (for token '"+F.defaultType+"')")}if(j.length!==0){O=!1,B.push(F);for(var L=0;L<j.length;L++){var U=j[L];if(i(U)){if(N===null)N=U.unicode;else if(N!==U.unicode&&F.fallback===!1)throw new Error("If one rule is /u then all must be")}}var H=u(j.map(c)),G=new RegExp(H);if(G.test(""))throw new Error("RegExp matches empty string: "+G);var $=n(H);if($>0)throw new Error("RegExp has capture groups: "+G+`
Use (?: \u2026 ) instead`);if(!F.lineBreaks&&G.test(`
`))throw new Error("Rule should declare lineBreaks: "+G);q.push(o(H))}}var z=k&&k.fallback,Y=r&&!z?"ym":"gm",J=r||z?"":"|";N===!0&&(Y+="u");var ee=new RegExp(u(q)+J,Y);return{regexp:ee,groups:B,fast:Q,error:k||v}}function E(y){var _=b(d(y));return new T({start:_},"start")}function x(y,_,k){var Q=y&&(y.push||y.next);if(Q&&!k[Q])throw new Error("Missing state '"+Q+"' (in token '"+y.defaultType+"' of state '"+_+"')");if(y&&y.pop&&+y.pop!=1)throw new Error("pop must be 1 (in token '"+y.defaultType+"' of state '"+_+"')")}function w(y,_){var k=y.$all?d(y.$all):[];delete y.$all;var Q=Object.getOwnPropertyNames(y);_||(_=Q[0]);for(var O=Object.create(null),N=0;N<Q.length;N++){var B=Q[N];O[B]=d(y[B]).concat(k)}for(var N=0;N<Q.length;N++)for(var B=Q[N],q=O[B],P=Object.create(null),F=0;F<q.length;F++){var j=q[F];if(j.include){var D=[F,1];if(j.include!==B&&!P[j.include]){P[j.include]=!0;var L=O[j.include];if(!L)throw new Error("Cannot include nonexistent state '"+j.include+"' (in state '"+B+"')");for(var U=0;U<L.length;U++){var H=L[U];q.indexOf(H)===-1&&D.push(H)}}q.splice.apply(q,D),F--}}for(var G=Object.create(null),N=0;N<Q.length;N++){var B=Q[N];G[B]=b(O[B],!0)}for(var N=0;N<Q.length;N++){for(var $=Q[N],z=G[$],Y=z.groups,F=0;F<Y.length;F++)x(Y[F],$,G);for(var J=Object.getOwnPropertyNames(z.fast),F=0;F<J.length;F++)x(z.fast[J[F]],$,G)}return new T(G,_)}function S(y){for(var _=typeof Map!="undefined",k=_?new Map:Object.create(null),Q=Object.getOwnPropertyNames(y),O=0;O<Q.length;O++){var N=Q[O],B=y[N],q=Array.isArray(B)?B:[B];q.forEach(function(P){if(typeof P!="string")throw new Error("keyword must be string (in keyword '"+N+"')");_?k.set(P,N):k[P]=N})}return function(P){return _?k.get(P):k[P]}}var T=function(y,_){this.startState=_,this.states=y,this.buffer="",this.stack=[],this.reset()};T.prototype.reset=function(y,_){return this.buffer=y||"",this.index=0,this.line=_?_.line:1,this.col=_?_.col:1,this.queuedToken=_?_.queuedToken:null,this.queuedText=_?_.queuedText:"",this.queuedThrow=_?_.queuedThrow:null,this.setState(_?_.state:this.startState),this.stack=_&&_.stack?_.stack.slice():[],this},T.prototype.save=function(){return{line:this.line,col:this.col,state:this.state,stack:this.stack.slice(),queuedToken:this.queuedToken,queuedText:this.queuedText,queuedThrow:this.queuedThrow}},T.prototype.setState=function(y){if(!(!y||this.state===y)){this.state=y;var _=this.states[y];this.groups=_.groups,this.error=_.error,this.re=_.regexp,this.fast=_.fast}},T.prototype.popState=function(){this.setState(this.stack.pop())},T.prototype.pushState=function(y){this.stack.push(this.state),this.setState(y)};var I=r?function(y,_){return y.exec(_)}:function(y,_){var k=y.exec(_);return k[0].length===0?null:k};T.prototype._getGroup=function(y){for(var _=this.groups.length,k=0;k<_;k++)if(y[k+1]!==void 0)return this.groups[k];throw new Error("Cannot find token type for matched text")};function C(){return this.value}if(T.prototype.next=function(){var y=this.index;if(this.queuedGroup){var _=this._token(this.queuedGroup,this.queuedText,y);return this.queuedGroup=null,this.queuedText="",_}var k=this.buffer;if(y!==k.length){var B=this.fast[k.charCodeAt(y)];if(B)return this._token(B,k.charAt(y),y);var Q=this.re;Q.lastIndex=y;var O=I(Q,k),N=this.error;if(O==null)return this._token(N,k.slice(y,k.length),y);var B=this._getGroup(O),q=O[0];return N.fallback&&O.index!==y?(this.queuedGroup=B,this.queuedText=q,this._token(N,k.slice(y,O.index),y)):this._token(B,q,y)}},T.prototype._token=function(y,_,k){var Q=0;if(y.lineBreaks){var O=/\n/g,N=1;if(_===`
`)Q=1;else for(;O.exec(_);)Q++,N=O.lastIndex}var B={type:typeof y.type=="function"&&y.type(_)||y.defaultType,value:typeof y.value=="function"?y.value(_):_,text:_,toString:C,offset:k,lineBreaks:Q,line:this.line,col:this.col},q=_.length;if(this.index+=q,this.line+=Q,Q!==0?this.col=q-N+1:this.col+=q,y.shouldThrow){var P=new Error(this.formatError(B,"invalid syntax"));throw P}return y.pop?this.popState():y.push?this.pushState(y.push):y.next&&this.setState(y.next),B},typeof Symbol!="undefined"&&Symbol.iterator){var A=function(y){this.lexer=y};A.prototype.next=function(){var y=this.lexer.next();return{value:y,done:!y}},A.prototype[Symbol.iterator]=function(){return this},T.prototype[Symbol.iterator]=function(){return new A(this)}}return T.prototype.formatError=function(y,_){if(y==null)var k=this.buffer.slice(this.index),y={text:k,offset:this.index,lineBreaks:k.indexOf(`
`)===-1?0:1,line:this.line,col:this.col};var Q=2,O=Math.max(y.line-Q,1),N=y.line+Q,B=String(N).length,q=f(this.buffer,this.line-y.line+Q+1).slice(0,5),P=[];P.push(_+" at line "+y.line+" col "+y.col+":"),P.push("");for(var F=0;F<q.length;F++){var j=q[F],D=O+F;P.push(p(String(D),B)+"  "+j),D===y.line&&P.push(p("",B+y.col+1)+"^")}return P.join(`
`)},T.prototype.clone=function(){return new T(this.states,this.state)},T.prototype.has=function(y){return!0},{compile:E,states:w,error:Object.freeze({error:!0}),fallback:Object.freeze({fallback:!0}),keywords:S}})});var yc=R((Vx,sv)=>{sv.exports={biblatex:{article:["author","title","journaltitle",["year","date"]],book:["author","title",["year","date"]],mvbook:["author","title",["year","date"]],inbook:["author","title","booktitle",["year","date"]],booklet:[["author","editor"],"title",["year","date"]],collection:["editor","title",["year","date"]],mvcollection:["editor","title",["year","date"]],incollection:["author","title","booktitle",["year","date"]],dataset:[["author","editor"],"title",["year","date"]],online:[["author","editor"],"title",["year","date"],["doi","eprint","url"]],patent:["author","title","number",["year","date"]],periodical:["editor","title",["year","date"]],proceedings:["title",["year","date"]],mvproceedings:["title",["year","date"]],inproceedings:["author","title","booktitle",["year","date"]],report:["author","title","type","institution",["year","date"]],thesis:["author","title","type","institution",["year","date"]],unpublished:["author","title",["year","date"]],conference:["author","title","booktitle",["year","date"]],electronic:[["author","editor"],"title",["year","date"],["doi","eprint","url"]],mastersthesis:["author","title","institution",["year","date"]],phdthesis:["author","title","institution",["year","date"]],techreport:["author","title","institution",["year","date"]],www:[["author","editor"],"title",["year","date"],["doi","eprint","url"]]},bibtex:{article:["author","title","journal","year"],book:[["author","editor"],"title","publisher","year"],booklet:["title"],inbook:[["author","editor"],"title",["chapter","pages"],"publisher","year"],incollection:["author","title","booktitle","publisher","year"],inproceedings:["author","title","booktitle","year"],mastersthesis:["author","title","school","year"],phdthesis:["author","title","school","year"],proceedings:["title","year"],techreport:["author","title","institution","year"],unpublished:["author","title","note"]}}});var vc=R((Yx,av)=>{av.exports={abstract:["field","literal"],addendum:["field","literal"],afterword:["list","name"],annotation:["field","literal"],annotator:["list","name"],author:["list","name"],authortype:["field","key"],bookauthor:["list","name"],bookpagination:["field","key"],booksubtitle:["field","literal"],booktitle:["field","title"],booktitleaddon:["field","literal"],chapter:["field","literal"],commentator:["list","name"],date:["field","date"],doi:["field","verbatim"],edition:["field","literal"],editor:["list","name"],editora:["list","name"],editorb:["list","name"],editorc:["list","name"],editortype:["field","key"],editoratype:["field","key"],editorbtype:["field","key"],editorctype:["field","key"],eid:["field","literal"],entrysubtype:["field","literal"],eprint:["field","verbatim"],eprintclass:["field","literal"],eprinttype:["field","literal"],eventdate:["field","date"],eventtitle:["field","title"],eventtitleaddon:["field","literal"],file:["field","verbatim"],foreword:["list","name"],holder:["list","name"],howpublished:["field","literal"],indextitle:["field","literal"],institution:["list","literal"],introduction:["list","name"],isan:["field","literal"],isbn:["field","literal"],ismn:["field","literal"],isrn:["field","literal"],issn:["field","literal"],issue:["field","literal"],issuesubtitle:["field","literal"],issuetitle:["field","literal"],iswc:["field","literal"],journalsubtitle:["field","literal"],journaltitle:["field","literal"],label:["field","literal"],language:["list","key"],library:["field","literal"],location:["list","literal"],mainsubtitle:["field","literal"],maintitle:["field","title"],maintitleaddon:["field","literal"],month:["field","literal"],nameaddon:["field","literal"],note:["field","literal"],number:["field","literal"],organization:["list","literal"],origdate:["field","date"],origlanguage:["list","key"],origlocation:["list","literal"],origpublisher:["list","literal"],origtitle:["field","title"],pages:["field","range"],pagetotal:["field","literal"],pagination:["field","key"],part:["field","literal"],publisher:["list","literal"],pubstate:["field","key"],reprinttitle:["field","literal"],series:["field","title"],shortauthor:["list","name"],shorteditor:["list","name"],shorthand:["field","literal"],shorthandintro:["field","literal"],shortjournal:["field","literal"],shortseries:["field","literal"],shorttitle:["field","title"],subtitle:["field","literal"],title:["field","title"],titleaddon:["field","literal"],translator:["list","name"],type:["field","title"],url:["field","uri"],urldate:["field","date"],venue:["field","literal"],version:["field","literal"],volume:["field","integer"],volumes:["field","integer"],year:["field","literal"],crossref:["field","entry key"],entryset:["separated","literal"],execute:["field","code"],gender:["field","gender"],langid:["field","identifier"],langidopts:["field","literal"],ids:["separated","entry key"],indexsorttitle:["field","literal"],keywords:["separated","literal"],options:["separated","options"],presort:["field","string"],related:["separated","literal"],relatedoptions:["separated","literal"],relatedtype:["field","identifier"],relatedstring:["field","literal"],sortkey:["field","literal"],sortname:["list","name"],sortshorthand:["field","literal"],sorttitle:["field","literal"],sortyear:["field","integer"],xdata:["separated","entry key"],xref:["field","entry key"],namea:["list","name"],nameb:["list","name"],namec:["list","name"],nameatype:["field","key"],namebtype:["field","key"],namectype:["field","key"],lista:["list","literal"],listb:["list","literal"],listc:["list","literal"],listd:["list","literal"],liste:["list","literal"],listf:["list","literal"],usera:["field","literal"],userb:["field","literal"],userc:["field","literal"],userd:["field","literal"],usere:["field","literal"],userf:["field","literal"],verba:["field","literal"],verbb:["field","literal"],verbc:["field","literal"],address:["list","literal"],annote:["field","literal"],archiveprefix:["field","literal"],journal:["field","literal"],key:["field","literal"],pdf:["field","verbatim"],primaryclass:["field","literal"],school:["list","literal"],numpages:["field","integer"],pmid:["field","literal"],pmcid:["field","literal"]}});var _c=R((Jx,nv)=>{nv.exports={diacritics:{"`":"\u0300","'":"\u0301","^":"\u0302","~":"\u0303","=":"\u0304",u:"\u0306",".":"\u0307",'"':"\u0308",r:"\u030A",H:"\u030B",v:"\u030C",b:"\u0332",d:"\u0323",c:"\u0327",k:"\u0328",t:"\u0361",textcommabelow:"\u0326"},commands:{textquotesingle:"'",textasciigrave:"`",textquotedbl:'"',textdollar:"$",textless:"<",textgreater:">",textbackslash:"\\",textasciicircum:"^",textunderscore:"_",textbraceleft:"{",textbar:"|",textbraceright:"}",textasciitilde:"~",textexclamdown:"\xA1",textcent:"\xA2",textsterling:"\xA3",textcurrency:"\xA4",textyen:"\xA5",textbrokenbar:"\xA6",textsection:"\xA7",textasciidieresis:"\xA8",textcopyright:"\xA9",textordfeminine:"\xAA",guillemetleft:"\xAB",guillemotleft:"\xAB",textlnot:"\xAC",textregistered:"\xAE",textasciimacron:"\xAF",textdegree:"\xB0",textpm:"\xB1",texttwosuperior:"\xB2",textthreesuperior:"\xB3",textasciiacute:"\xB4",textmu:"\xB5",textparagraph:"\xB6",textperiodcentered:"\xB7",textonesuperior:"\xB9",textordmasculine:"\xBA",guillemetright:"\xBB",guillemotright:"\xBB",textonequarter:"\xBC",textonehalf:"\xBD",textthreequarters:"\xBE",textquestiondown:"\xBF",AE:"\xC6",DH:"\xD0",texttimes:"\xD7",O:"\xD8",TH:"\xDE",ss:"\xDF",ae:"\xE6",dh:"\xF0",textdiv:"\xF7",o:"\xF8",th:"\xFE",DJ:"\u0110",dj:"\u0111",i:"\u0131",IJ:"\u0132",ij:"\u0133",L:"\u0141",l:"\u0142",NG:"\u014A",ng:"\u014B",OE:"\u0152",oe:"\u0153",textflorin:"\u0192",j:"\u0237",textasciicaron:"\u02C7",textasciibreve:"\u02D8",textacutedbl:"\u02DD",textgravedbl:"\u02F5",texttildelow:"\u02F7",textbaht:"\u0E3F",SS:"\u1E9E",textcompwordmark:"\u200C",textendash:"\u2013",textemdash:"\u2014",textbardbl:"\u2016",textquoteleft:"\u2018",textquoteright:"\u2019",quotesinglbase:"\u201A",textquotedblleft:"\u201C",textquotedblright:"\u201D",quotedblbase:"\u201E",textdagger:"\u2020",textdaggerdbl:"\u2021",textbullet:"\u2022",textellipsis:"\u2026",textperthousand:"\u2030",textpertenthousand:"\u2031",guilsinglleft:"\u2039",guilsinglright:"\u203A",textreferencemark:"\u203B",textinterrobang:"\u203D",textfractionsolidus:"\u2044",textlquill:"\u2045",textrquill:"\u2046",textdiscount:"\u2052",textcolonmonetary:"\u20A1",textlira:"\u20A4",textnaira:"\u20A6",textwon:"\u20A9",textdong:"\u20AB",texteuro:"\u20AC",textpeso:"\u20B1",textcelsius:"\u2103",textnumero:"\u2116",textcircledP:"\u2117",textrecipe:"\u211E",textservicemark:"\u2120",texttrademark:"\u2122",textohm:"\u2126",textmho:"\u2127",textestimated:"\u212E",textleftarrow:"\u2190",textuparrow:"\u2191",textrightarrow:"\u2192",textdownarrow:"\u2193",textminus:"\u2212",Hwithstroke:"\u0126",hwithstroke:"\u0127",textasteriskcentered:"\u2217",textsurd:"\u221A",textlangle:"\u2329",textrangle:"\u232A",textblank:"\u2422",textvisiblespace:"\u2423",textopenbullet:"\u25E6",textbigcircle:"\u25EF",textmusicalnote:"\u266A",textmarried:"\u26AD",textdivorced:"\u26AE",textinterrobangdown:"\u2E18",textcommabelow:null,copyright:"\xA9",Gamma:"\u0393",Delta:"\u0394",Theta:"\u0398",Lambda:"\u039B",Xi:"\u039E",Pi:"\u03A0",Sigma:"\u03A3",Phi:"\u03A6",Psi:"\u03A8",Omega:"\u03A9",alpha:"\u03B1",beta:"\u03B2",gamma:"\u03B3",delta:"\u03B4",varepsilon:"\u03B5",zeta:"\u03B6",eta:"\u03B7",theta:"\u03B8",iota:"\u03B9",kappa:"\u03BA",lambda:"\u03BB",mu:"\u03BC",nu:"\u03BD",xi:"\u03BE",pi:"\u03C0",rho:"\u03C1",varsigma:"\u03C2",sigma:"\u03C3",tau:"\u03C4",upsilon:"\u03C5",varphi:"\u03C6",chi:"\u03C7",psi:"\u03C8",omega:"\u03C9",vartheta:"\u03D1",Upsilon:"\u03D2",phi:"\u03D5",varpi:"\u03D6",varrho:"\u03F1",epsilon:"\u03F5"}}});var Tr=R(se=>{"use strict";Object.defineProperty(se,"__esModule",{value:!0});se.sentenceCaseLanguages=se.required=se.mathScripts=se.mathScriptFormatting=se.ligatures=se.ligaturePattern=se.formattingEnvs=se.formattingCommands=se.formatting=se.fieldTypes=se.diacritics=se.defaultStrings=se.commands=se.argumentCommands=void 0;var ov=Dn(yc()),lv=Dn(vc()),Ec=Dn(_c());function Dn(e){return e&&e.__esModule?e:{default:e}}var uv=ov.default;se.required=uv;var cv=lv.default;se.fieldTypes=cv;var pv=Ec.default.diacritics;se.diacritics=pv;var hv=Ec.default.commands;se.commands=hv;var fv={jan:"01",feb:"02",mar:"03",apr:"04",may:"05",jun:"06",jul:"07",aug:"08",sep:"09",oct:"10",nov:"11",dec:"12",acmcs:"ACM Computing Surveys",acta:"Acta Informatica",cacm:"Communications of the ACM",ibmjrd:"IBM Journal of Research and Development",ibmsj:"IBM Systems Journal",ieeese:"IEEE Transactions on Software Engineering",ieeetc:"IEEE Transactions on Computers",ieeetcad:"IEEE Transactions on Computer-Aided Design of Integrated Circuits",ipl:"Information Processing Letters",jacm:"Journal of the ACM",jcss:"Journal of Computer and System Sciences",scp:"Science of Computer Programming",sicomp:"SIAM Journal on Computing",tocs:"ACM Transactions on Computer Systems",tods:"ACM Transactions on Database Systems",tog:"ACM Transactions on Graphics",toms:"ACM Transactions on Mathematical Software",toois:"ACM Transactions on Office Information Systems",toplas:"ACM Transactions on Programming Languages and Systems",tcs:"Theoretical Computer Science"};se.defaultStrings=fv;var mv={it:"italics",itshape:"italics",sl:"italics",slshape:"italics",em:"italics",bf:"bold",bfseries:"bold",sc:"smallcaps",scshape:"smallcaps",rm:void 0,sf:void 0,tt:void 0};se.formattingEnvs=mv;var dv={textit:"italics",textsl:"italics",emph:"italics",mkbibitalic:"italics",mkbibemph:"italics",textbf:"bold",strong:"bold",mkbibbold:"bold",textsc:"smallcaps",textsuperscript:"superscript",textsubscript:"subscript",enquote:"quotes",mkbibquote:"quotes",textmd:void 0,textrm:void 0,textsf:void 0,texttt:void 0,textup:void 0};se.formattingCommands=dv;var gv={italics:["<i>","</i>"],bold:["<b>","</b>"],superscript:["<sup>","</sup>"],subscript:["<sub>","</sub>"],smallcaps:['<span style="font-variant:small-caps;">',"</span>"],nocase:['<span class="nocase">',"</span>"],quotes:["\u201C","\u201D"]};se.formatting=gv;var bv={ElsevierGlyph(e){return String.fromCharCode(parseInt(e,16))},href(e,t){return e},url(e){return e}};se.argumentCommands=bv;var yv=/---?|''|``|~/g;se.ligaturePattern=yv;var vv={"--":"\u2013","---":"\u2014","``":"\u201C","''":"\u201D","~":"\xA0"};se.ligatures=vv;var _v={"^":"superscript",sp:"superscript",_:"subscript",sb:"subscript",mathrm:void 0};se.mathScriptFormatting=_v;var Ev={"^":{0:"\u2070",1:"\xB9",2:"\xB2",3:"\xB3",4:"\u2074",5:"\u2075",6:"\u2076",7:"\u2077",8:"\u2078",9:"\u2079","+":"\u207A","-":"\u207B","=":"\u207C","(":"\u207D",")":"\u207E",i:"\u2071",n:"\u207F"},_:{0:"\u2080",1:"\u2081",2:"\u2082",3:"\u2083",4:"\u2084",5:"\u2085",6:"\u2086",7:"\u2087",8:"\u2088",9:"\u2089","+":"\u208A","-":"\u208B","=":"\u208C","(":"\u208D",")":"\u208E",a:"\u2090",e:"\u2091",o:"\u2092",x:"\u2093",\u0259:"\u2094",h:"\u2095",k:"\u2096",l:"\u2097",m:"\u2098",n:"\u2099",s:"\u209A",p:"\u209B",t:"\u209C"}};se.mathScripts=Ev;var wv=["american","british","canadian","english","australian","newzealand","usenglish","ukenglish","en","eng","en-au","en-bz","en-ca","en-cb","en-gb","en-ie","en-jm","en-nz","en-ph","en-tt","en-us","en-za","en-zw","anglais"];se.sentenceCaseLanguages=wv});var Sc=R(ai=>{"use strict";Object.defineProperty(ai,"__esModule",{value:!0});ai.bibtexGrammar=void 0;ai.parse=kv;var wc=me(),xv=Av(In()),Tv=Tr();function Av(e){return e&&e.__esModule?e:{default:e}}function xc(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}function Et(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?xc(Object(r),!0).forEach(function(i){Sv(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xc(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Sv(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Tc=/[a-zA-Z_][a-zA-Z0-9_:-]*/,Ts={comment:/%.*/,whitespace:{match:/\s+/,lineBreaks:!0}},Cv=xv.default.states({main:{junk:{match:/@[cC][oO][mM][mM][eE][nN][tT].+|[^@]+/,lineBreaks:!0},at:{match:"@",push:"entry"}},entry:Et(Et({},Ts),{},{otherEntryType:{match:/[sS][tT][rR][iI][nN][gG]|[pP][rR][eE][aA][mM][bB][lL][eE]/,next:"otherEntryContents"},dataEntryType:{match:Tc,next:"dataEntryContents"}}),otherEntryContents:Et(Et({},Ts),{},{lbrace:{match:/[{(]/,next:"fields"}}),dataEntryContents:Et(Et({},Ts),{},{lbrace:{match:/[{(]/,next:"dataEntryContents"},label:/[^,\s]+/,comma:{match:",",next:"fields"}}),fields:Et(Et({},Ts),{},{identifier:Tc,number:/-?\d+/,hash:"#",equals:"=",comma:",",quote:{match:'"',push:"quotedLiteral"},lbrace:{match:"{",push:"bracedLiteral"},rbrace:{match:/[})]/,pop:!0}}),quotedLiteral:{lbrace:{match:"{",push:"bracedLiteral"},quote:{match:'"',pop:!0},text:{match:/(?:\\[\\{]|[^{"])+/,lineBreaks:!0}},bracedLiteral:{lbrace:{match:"{",push:"bracedLiteral"},rbrace:{match:"}",pop:!0},text:{match:/(?:\\[\\{}]|[^{}])+/,lineBreaks:!0}}}),Ov={"(":")","{":"}"},Ac=new wc.util.Grammar({Main(){let e=[];for(;;){for(;this.matchToken("junk");)this.consumeToken("junk");if(this.matchEndOfFile())break;e.push(this.consumeRule("Entry"))}return e.filter(Boolean)},_(){let e;for(;e!==this.token;)e=this.token,this.consumeToken("whitespace",!0),this.consumeToken("comment",!0)},Entry(){this.consumeToken("at"),this.consumeRule("_");let e=(this.matchToken("otherEntryType")?this.consumeToken("otherEntryType"):this.consumeToken("dataEntryType")).value.toLowerCase();this.consumeRule("_");let t=this.consumeToken("lbrace").value;this.consumeRule("_");let r;if(e==="string"){let[s,a]=this.consumeRule("Field");this.state.strings[s]=a}else if(e==="preamble")this.consumeRule("Expression");else{let s=this.consumeToken("label").value;this.consumeRule("_"),this.consumeToken("comma"),this.consumeRule("_");let a=this.consumeRule("EntryBody");r={type:e,label:s,properties:a}}this.consumeRule("_");let i=this.consumeToken("rbrace").value;return i!==Ov[t]&&wc.logger.warn("[plugin-bibtex]",`entry started with "${t}", but ends with "${i}"`),r},EntryBody(){let e={};for(;this.matchToken("identifier");){let[t,r]=this.consumeRule("Field");if(e[t]=r,this.consumeRule("_"),this.consumeToken("comma",!0))this.consumeRule("_");else break}return e},Field(){let e=this.consumeToken("identifier").value.toLowerCase();this.consumeRule("_"),this.consumeToken("equals"),this.consumeRule("_");let t=this.consumeRule("Expression");return[e,t]},Expression(){let e=this.consumeRule("ExpressionPart");for(this.consumeRule("_");this.matchToken("hash");)this.consumeToken("hash"),this.consumeRule("_"),e+=this.consumeRule("ExpressionPart").toString(),this.consumeRule("_");return e},ExpressionPart(){return this.matchToken("identifier")?this.state.strings[this.consumeToken("identifier").value.toLowerCase()]||"":this.matchToken("number")?parseInt(this.consumeToken("number")):this.matchToken("quote")?this.consumeRule("QuoteString"):this.consumeRule("BracketString")},QuoteString(){let e="";for(this.consumeToken("quote");!this.matchToken("quote");)e+=this.consumeRule("Text");return this.consumeToken("quote"),e},BracketString(){let e="";for(this.consumeToken("lbrace");!this.matchToken("rbrace");)e+=this.consumeRule("Text");return this.consumeToken("rbrace"),e},Text(){return this.matchToken("lbrace")?`{${this.consumeRule("BracketString")}}`:this.consumeToken("text").value}},{strings:Tv.defaultStrings});ai.bibtexGrammar=Ac;function kv(e){return Ac.parse(Cv.reset(e))}});var Pn=R(wt=>{"use strict";Object.defineProperty(wt,"__esModule",{value:!0});wt.textEntry=wt.text=wt.parse=void 0;var As={splitEntries:/\n\s*(?=\[)/g,parseEntry:/^\[(.+?)\]\s*(?:\n([\s\S]+))?$/,splitPairs:/((?=.)\s)*\n\s*/g,splitPair:/:(.*)/},Cc=e=>{let[,t,r]=e.match(As.parseEntry)||[];if(!t||!r)return{};{let i={type:"book",label:t,properties:{}};return r.trim().split(As.splitPairs).filter(s=>s).forEach(s=>{let[a,n]=s.split(As.splitPair);n&&(a=a.trim(),n=n.trim(),a==="type"?i.type=n:i.properties[a]=n)}),i}};wt.textEntry=Cc;var Qv=e=>e.trim().split(As.splitEntries).map(Cc);wt.text=wt.parse=Qv});var Rn=R((Zx,Nv)=>{Nv.exports={source:{article:"article-journal",book:"book",mvbook:"book",inbook:"chapter",bookinbook:"book",booklet:"book",collection:"book",mvcollection:"book",incollection:"chapter",dataset:"dataset",online:"webpage",patent:"patent",periodical:"article-journal",proceedings:"book",mvproceedings:"book",inproceedings:"paper-conference",reference:"book",mvreference:"book",inreference:"entry",report:"report",software:"book",thesis:"thesis",unpublished:"manuscript",artwork:"graphic",audio:"song",image:"figure",jurisdiction:"legal_case",legislation:"legislation",legal:"treaty",letter:"personal_communication",movie:"motion_picture",music:"musical_score",review:"review",video:"motion_picture",conference:"paper-conference",electronic:"webpage",mastersthesis:"thesis",phdthesis:"thesis",techreport:"report",www:"webpage"},target:{article:"article","article-journal":"article","article-magazine":"article","article-newspaper":"article",bill:"legislation",book:"book",broadcast:"audio",chapter:"inbook",dataset:"dataset",entry:"inreference","entry-dictionary":"inreference","entry-encyclopedia":"inreference",figure:"artwork",graphic:"artwork",interview:"audio",legal_case:"jurisdiction",legislation:"legislation",manuscript:"unpublished",motion_picture:"movie",musical_score:"music","paper-conference":"inproceedings",patent:"patent",personal_communication:"letter",post:"online","post-weblog":"online",report:"report",review:"review","review-book":"review",song:"music",speech:"audio",thesis:"thesis",treaty:"legal",webpage:"online"}}});var ni=R((eT,Iv)=>{Iv.exports={source:{article:"article-journal",book:"book",booklet:"book",conference:"paper-conference",inbook:"chapter",incollection:"chapter",inproceedings:"paper-conference",mastersthesis:"thesis",phdthesis:"thesis",proceedings:"book",techreport:"report",unpublished:"manuscript"},target:{article:"article","article-journal":"article","article-magazine":"article","article-newspaper":"article",book:"book",chapter:"inbook",manuscript:"unpublished","paper-conference":"inproceedings",report:"techreport",review:"article","review-book":"article"}}});var oi=R(Ss=>{"use strict";Object.defineProperty(Ss,"__esModule",{value:!0});Ss.default=void 0;var Dv=kc(Rn()),Pv=kc(ni()),Rv=Lv(Tr());function Oc(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,r=new WeakMap;return(Oc=function(i){return i?r:t})(e)}function Lv(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||typeof e!="object"&&typeof e!="function")return{default:e};var r=Oc(t);if(r&&r.has(e))return r.get(e);var i={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(a!=="default"&&Object.prototype.hasOwnProperty.call(e,a)){var n=s?Object.getOwnPropertyDescriptor(e,a):null;n&&(n.get||n.set)?Object.defineProperty(i,a,n):i[a]=e[a]}return i.default=e,r&&r.set(e,i),i}function kc(e){return e&&e.__esModule?e:{default:e}}var Bv={constants:Rv,types:{biblatex:Dv.default,bibtex:Pv.default},parse:{biblatex:!0,strict:!1,sentenceCase:"never"},format:{useIdAsLabel:!1}};Ss.default=Bv});var li=R(Se=>{"use strict";Object.defineProperty(Se,"__esModule",{value:!0});Se.TYPE_KEYS=Se.TYPE=Se.STANDARD_NUMBERS_PATTERN=Se.MONTHS=Se.LABEL=Se.Converters=void 0;Se.formatLabel=Rc;Se.parseDate=Dc;Se.parseMonth=Pc;var Fv=me(),Mv=Uv(oi());function Uv(e){return e&&e.__esModule?e:{default:e}}var qv=new Set(["the","a","an"]),Ln=/(?:<\/?.*?>|[\u0020-\u002F\u003A-\u0040\u005B-\u005E\u0060\u007B-\u007F])+/g,jv=/[^\u0020-\u007F]+/g;function Qc(e){return e?e.normalize("NFKD").replace(jv,"").split(Ln).find(t=>t.length&&!qv.has(t.toLowerCase())):""}var Nc=new Fv.util.Translator([{source:"given",target:"given"},{source:"family",target:"family"},{source:"suffix",target:"suffix"},{source:"prefix",target:"non-dropping-particle"},{source:"family",target:"literal",when:{source:!1,target:{family:!1,given:!1}}}]),Gv=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],$v="BibTeX type";Se.TYPE=$v;var zv="BibTeX label";Se.LABEL=zv;var Yt={jan:1,feb:2,mar:3,apr:4,may:5,jun:6,jul:7,aug:8,sep:9,oct:10,nov:11,dec:12,january:1,february:2,march:3,april:4,may:5,june:6,july:7,august:8,september:9,october:10,november:11,december:12};Se.MONTHS=Yt;var Hv={bathesis:"Bachelor's thesis",mathesis:"Master's thesis",phdthesis:"PhD thesis",candthesis:"Candidate thesis",techreport:"technical report",resreport:"research report",software:"computer software",datacd:"data cd",audiocd:"audio cd",patent:"patent",patentde:"German patent",patenteu:"European patent",patentfr:"French patent",patentuk:"British patent",patentus:"U.S. patent",patreq:"patent request",patreqde:"German patent request",patreqeu:"European patent request",patreqfr:"French patent request",patrequk:"British patent request",patrequs:"U.S. patent request"};Se.TYPE_KEYS=Hv;var Ic=/(^(?:ISAN )?(?:[0-9a-f]{4}-){4}[0-9a-z](?:-(?:[0-9a-f]{4}-){2}[0-9a-z])?$)|(^(?:979-?0-?|M-?)(?:\d{9}|(?=[\d-]{11}$)\d+-\d+-\d)$)|(^ISRN .{1,36}$)|(^(?:ISWC )?T-?\d{9}-?\d$)/i;Se.STANDARD_NUMBERS_PATTERN=Ic;function Dc(e){let t=e.split("T")[0].replace(/[?~%]$/,"").split("-"),r=+t[0].replace(/^Y(?=-?\d{4}\d+)/,"").replace(/X/g,"0"),i=+t[1],s=+t[2];return!i||i>20?[r]:s?[r,i,s]:[r,i]}function Pc(e){if(e==null)return[];if(+e)return[parseInt(e,10)];if(e=e.trim().toLowerCase(),e in Yt)return[Yt[e]];let t=e.split(/\s+/),r,i;return t[0]in Yt?(r=Yt[t[0]],i=parseInt(t[1])):t[1]in Yt&&(r=Yt[t[1]],i=parseInt(t[0])),i?[r,i]:r?[r]:[]}function Rc(e,t,r,i){let s="";return e&&e[0]&&(s+=Qc(e[0].family||e[0].literal)),t&&t["date-parts"]&&t["date-parts"][0]&&(s+=t["date-parts"][0][0]),r?s+=r:i&&(s+=Qc(i)),s}var Vv={PICK:{toTarget(...e){return e.find(Boolean)},toSource(e){return[e]}},DATE:{toTarget(e){let t=e.split("/").map(r=>r&&r!==".."?Dc(r):void 0);return isNaN(t[0][0])?{literal:e}:{"date-parts":t}},toSource(e){if("date-parts"in e)return e["date-parts"].map(t=>t.map(r=>r.toString().padStart(2,"0")).join("-")).join("/")}},YEAR_MONTH:{toTarget(e,t,r){return isNaN(+e)?{literal:e}:!isNaN(+r)&&!isNaN(+t)?{"date-parts":[[+e,+t,+r]]}:{"date-parts":[[+e,...Pc(t)]]}},toSource(e){if("date-parts"in e){let[t,r,i]=e["date-parts"][0];return[t.toString(),r?i?`${Gv[r-1]} ${i}`:r:void 0]}else return[]}},EPRINT:{toTarget(e,t){if(t==="pubmed")return e},toSource(e){return[e,"pubmed"]}},HOW_PUBLISHED:{toTarget(e){if(e.startsWith("http"))return e}},KEYWORDS:{toTarget(e){return e.join(",")},toSource(e){return e.split(",")}},LABEL:{toTarget(e){return[e,e]},toSource(e,t,r,i,s,a){let n;return e===null?n="null":e===void 0?n="undefined":n=e.toString().replace(Ln,""),Mv.default.format.useIdAsLabel?n:t&&!Ln.test(t)?t:Rc(r,i,s,a)||n}},NAMES:{toTarget(e){return e.map(Nc.convertToTarget)},toSource(e){return e.map(Nc.convertToSource)}},STANDARD_NUMBERS:{toTarget(...e){return e.find(Boolean)},toSource(e){let t=e.toString().match(Ic);return t?t.slice(1,5):[]}},STATUS:{toSource(e){if(/^(inpreparation|submitted|forthcoming|inpress|prepublished)$/i.test(e))return e}},TITLE:{toTarget(e,t,r){return t&&(e+=": "+t),e},toSource(e){return[e]}}};Se.Converters=Vv});var Bc=R(Cs=>{"use strict";Object.defineProperty(Cs,"__esModule",{value:!0});Cs.default=void 0;var Yv=me(),Jv=vt(),Lc=Wv(Rn()),Z=li();function Wv(e){return e&&e.__esModule?e:{default:e}}var Xv=[{source:"note",target:"accessed",when:{source:!1,target:{note:!1}},convert:{toSource(e){return`[Online; accessed ${(0,Jv.format)(e)}]`}}},{source:"numpages",target:"number-of-pages",when:{source:{pagetotal:!1},target:!1}},{source:"pmid",target:"PMID",when:{source:{eprinttype(e){return e!=="pmid"},archiveprefix(e){return e!=="pmid"}},target:!1}},{source:"pmcid",target:"PMCID",when:{target:!1}}],Kv=[{source:"annote",target:"annote",when:{source:{annotation:!1},target:!1}},{source:"address",target:"publisher-place",convert:Z.Converters.PICK,when:{source:{location:!1},target:!1}},{source:["eprint","archiveprefix"],target:"PMID",convert:Z.Converters.EPRINT,when:{source:{eprinttype:!1},target:!1}},{source:"journal",target:"container-title",when:{source:{maintitle:!1,booktitle:!1,journaltitle:!1},target:!1}},{source:"school",target:"publisher",convert:Z.Converters.PICK,when:{source:{institution:!1,organization:!1,publisher:!1},target:!1}}],Zv=new Yv.util.Translator([...Kv,...Xv,{source:"abstract",target:"abstract"},{source:"urldate",target:"accessed",convert:Z.Converters.DATE},{source:"annotation",target:"annote"},{source:"author",target:"author",convert:Z.Converters.NAMES},{source:"library",target:"call-number"},{source:"chapter",target:"chapter-number"},{source:"bookauthor",target:"container-author",convert:Z.Converters.NAMES},{source:["maintitle","mainsubtitle","maintitleaddon"],target:"container-title",when:{source:!0,target:{"number-of-volumes":!0}},convert:Z.Converters.TITLE},{source:["booktitle","booksubtitle","booktitleaddon"],target:"container-title",when:{source:{maintitle:!1},target:{"number-of-volumes":!1,type(e){return!e.startsWith("article")}}},convert:Z.Converters.TITLE},{source:["journaltitle","journalsubtitle","journaltitleaddon"],target:"container-title",when:{source:{[Z.TYPE]:"article"},target:{type:["article","article-newspaper","article-journal","article-magazine"]}},convert:Z.Converters.TITLE},{source:"shortjournal",target:"container-title-short",when:{source:{[Z.TYPE]:"article"},target:{type:["article","article-newspaper","article-journal","article-magazine"]}}},{source:"shortjournal",target:"journalAbbreviation",when:{source:!1,target:{"container-title-short":!1}}},{source:"number",target:"collection-number",when:{source:{[Z.TYPE]:["book","mvbook","inbook","bookinbook","suppbook","collection","mvcollection","incollection","suppcollection","manual","suppperiodical","proceedings","mvproceedings","refererence"]},target:{type:["bill","book","broadcast","chapter","dataset","entry","entry-dictionary","entry-encyclopedia","figure","graphic","interview","legislation","legal_case","manuscript","map","motion_picture","musical_score","pamphlet","post","post-weblog","personal_communication","review","review-book","song","speech","thesis","treaty","webpage"]}}},{source:"series",target:"collection-title"},{source:"shortseries",target:"collection-title-short"},{source:"doi",target:"DOI"},{source:"edition",target:"edition"},{source:"editor",target:"editor",convert:Z.Converters.NAMES},{source:[Z.TYPE,"entrysubtype","type"],target:["type","genre"],convert:{toTarget(e,t,r){return r||(e==="masterthesis"&&(r="mathesis"),e==="phdthesis"&&(r="phdthesis"),e==="techreport"&&(r="techreport")),[Lc.default.source[e]||"book",r||t]},toSource(e,t){let r=Lc.default.target[e]||"misc";return t in Z.TYPE_KEYS?[r,void 0,t]:[r,t]}}},{source:Z.TYPE,when:{target:{type:!1}},convert:{toSource(){return"misc"}}},{source:"eventdate",target:"event-date",convert:Z.Converters.DATE},{source:"venue",target:"event-place"},{source:"eventtitle",target:"event"},{source:Z.LABEL,target:["id","citation-label","author","issued","year-suffix","title"],convert:Z.Converters.LABEL},{source:"isbn",target:"ISBN"},{source:"issn",target:"ISSN"},{source:"issue",target:"issue",when:{source:{number:!1,[Z.TYPE]:["article","periodical"]},target:{issue(e){return typeof e=="string"&&!e.match(/\d+/)},type:["article","article-journal","article-newspaper","article-magazine"]}}},{source:"number",target:"issue",when:{source:{[Z.TYPE]:["article","periodical","inproceedings"]},target:{issue(e){return e&&(typeof e=="number"||e.match(/\d+/))},type:["article","article-journal","article-newspaper","article-magazine","paper-conference"]}}},{source:"date",target:"issued",convert:Z.Converters.DATE},{source:["year","month","day"],target:"issued",convert:Z.Converters.YEAR_MONTH,when:{source:{date:!1},target:!1}},{source:"location",target:"jurisdiction",when:{source:{type:"patent"},target:{type:"patent"}}},{source:"keywords",target:"keyword",convert:Z.Converters.KEYWORDS},{source:"language",target:"language",convert:Z.Converters.PICK},{source:"note",target:"note"},{source:["isan","ismn","isrn","iswc"],target:"number",convert:Z.Converters.STANDARD_NUMBERS,when:{source:{[Z.TYPE](e){return e!=="patent"}},target:{type(e){return e!=="patent"}}}},{source:"number",target:"number",when:{source:{[Z.TYPE]:["patent","report","techreport","legislation"]},target:{type:["patent","report","legislation"]}}},{source:"origdate",target:"original-date",convert:Z.Converters.DATE},{source:"origlocation",target:"original-publisher-place",convert:Z.Converters.PICK},{source:"origpublisher",target:"original-publisher",convert:Z.Converters.PICK},{source:"origtitle",target:"original-title"},{source:["pages","eid"],target:"page",convert:{toTarget(e,t){return t?t.replace(/^e?/i,"e"):e.replace(/[]/,"-")},toSource(e){return/^e/i.test(e)?[e,e]:[e.replace("-","--")]}}},{source:"pagetotal",target:"number-of-pages"},{source:["eprint","eprinttype"],target:"PMID",convert:Z.Converters.EPRINT},{source:"location",target:"publisher-place",convert:Z.Converters.PICK},{source:"publisher",target:"publisher",convert:Z.Converters.PICK,when:{source:!0,target:{type:["article","article-journal","article-magazine","article-newspaper","bill","book","broadcast","chapter","dataset","entry","entry-dictionary","entry-encyclopedia","figure","graphic","interview","legal_case","legislation","manuscript","map","motion_picture","musical_score","pamphlet","paper-conference","patent","personal_communication","post","post-weblog","regulation","review","review-book","song","speech","treaty"]}}},{source:"organization",target:"publisher",convert:Z.Converters.PICK,when:{source:{publisher:!1},target:{type:"webpage"}}},{source:"institution",target:"publisher",convert:Z.Converters.PICK,when:{source:{publisher:!1,organization:!1},target:{type:["report","thesis"]}}},{source:"howpublished",target:"publisher",convert:Z.Converters.PICK,when:{source:{publisher:!1,organization:!1,institution:!1},target:{type:"manuscript"}}},{source:["pages","bookpagination"],target:"section",when:{source:{bookpagination:"section"},target:{page:!1}},convert:{toTarget(e){return e},toSource(e){return[e,"section"]}}},{source:"pubstate",target:"status",convert:Z.Converters.STATUS},{source:"shorttitle",target:"title-short"},{source:["title","subtitle","titleaddon"],target:"title",convert:Z.Converters.TITLE},{source:"translator",target:"translator",convert:Z.Converters.NAMES},{source:"url",target:"URL"},{source:"howpublished",target:"URL",convert:Z.Converters.HOW_PUBLISHED,when:{source:{url:!1},target:!1}},{source:"version",target:"version"},{source:"volume",target:"volume"},{source:"volumes",target:"number-of-volumes"}]);Cs.default=Zv});var Mc=R(Os=>{"use strict";Object.defineProperty(Os,"__esModule",{value:!0});Os.default=void 0;var e0=me(),t0=vt(),Fc=r0(ni()),Te=li();function r0(e){return e&&e.__esModule?e:{default:e}}var i0=new e0.util.Translator([{source:"note",target:"accessed",when:{source:!1,target:{note:!1}},convert:{toSource(e){return`[Online; accessed ${(0,t0.format)(e)}]`}}},{source:"annote",target:"annote"},{source:"address",target:"publisher-place",convert:Te.Converters.PICK},{source:"author",target:"author",convert:Te.Converters.NAMES},{source:"chapter",target:"chapter-number"},{source:"number",target:"collection-number",when:{source:{[Te.TYPE]:["book","mvbook","inbook","collection","mvcollection","incollection","suppcollection","manual","suppperiodical","proceedings","mvproceedings","refererence"]},target:{type:["bill","book","broadcast","chapter","dataset","entry","entry-dictionary","entry-encyclopedia","figure","graphic","interview","legislation","legal_case","manuscript","map","motion_picture","musical_score","pamphlet","post","post-weblog","personal_communication","review","review-book","song","speech","thesis","treaty","webpage"]}}},{source:"series",target:"collection-title"},{source:"booktitle",target:"container-title",when:{target:{type:["chapter","paper-conference"]}}},{source:"journal",target:"container-title",when:{source:{[Te.TYPE]:"article"},target:{type:["article","article-newspaper","article-journal","article-magazine"]}}},{source:"edition",target:"edition"},{source:"editor",target:"editor",convert:Te.Converters.NAMES},{source:Te.LABEL,target:["id","citation-label","author","issued","year-suffix","title"],convert:Te.Converters.LABEL},{source:"number",target:"issue",when:{source:{[Te.TYPE]:["article","periodical","inproceedings"]},target:{issue(e){return typeof e=="number"||typeof e=="string"&&e.match(/\d+/)},type:["article","article-journal","article-newspaper","article-magazine","paper-conference"]}}},{source:["year","month","day"],target:"issued",convert:Te.Converters.YEAR_MONTH},{source:"note",target:"note"},{source:"number",target:"number",when:{source:{[Te.TYPE]:["patent","report","techreport"]},target:{type:["patent","report"]}}},{source:"pages",target:"page",convert:{toTarget(e){return e.replace(/[]/,"-")},toSource(e){return e.replace("-","--")}}},{source:"publisher",target:"publisher",convert:Te.Converters.PICK,when:{target:{type:["article","article-journal","article-magazine","article-newspaper","bill","book","broadcast","chapter","dataset","entry","entry-dictionary","entry-encyclopedia","figure","graphic","interview","legal_case","legislation","map","motion_picture","musical_score","pamphlet","patent","personal_communication","post","post-weblog","review","review-book","song","speech","treaty","webpage"]}}},{source:"organization",target:"publisher",convert:Te.Converters.PICK,when:{source:{publisher:!1},target:{type:"paper-conference"}}},{source:"institution",target:"publisher",convert:Te.Converters.PICK,when:{source:{publisher:!1,organization:!1},target:{type:"report"}}},{source:"school",target:"publisher",convert:Te.Converters.PICK,when:{source:{institution:!1,organization:!1,publisher:!1},target:{type:"thesis"}}},{source:"howpublished",target:"publisher",convert:Te.Converters.PICK,when:{source:{publisher:!1,organization:!1,institution:!1,school:!1},target:{type:"manuscript"}}},{source:"title",target:"title"},{source:[Te.TYPE,"type"],target:["type","genre"],convert:{toTarget(e,t){let r=Fc.default.source[e]||"book";return t?[r,t]:e==="mastersthesis"?[r,"Master's thesis"]:e==="phdthesis"?[r,"PhD thesis"]:[r]},toSource(e,t){let r=Fc.default.target[e]||"misc";return/^(master'?s|diploma) thesis$/i.test(t)?["mastersthesis"]:/^(phd|doctoral) thesis$/i.test(t)?["phdthesis"]:[r,t]}}},{source:Te.TYPE,when:{target:{type:!1}},convert:{toSource(){return"misc"}}},{source:"howpublished",target:"URL",convert:Te.Converters.HOW_PUBLISHED,when:{target:{publisher:!1}}},{source:"volume",target:"volume"}]);Os.default=i0});var Bn=R(Sr=>{"use strict";Object.defineProperty(Sr,"__esModule",{value:!0});Sr.format=f0;Sr.formatBibtex=p0;Sr.parse=h0;Sr.parseBibtex=c0;var Ar=li(),qc=Gc(Bc()),jc=Gc(Mc());function Gc(e){return e&&e.__esModule?e:{default:e}}function s0(e,t){if(e==null)return{};var r=a0(e,t),i,s;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)i=a[s],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}function a0(e,t){if(e==null)return{};var r={},i=Object.keys(e),s,a;for(a=0;a<i.length;a++)s=i[a],!(t.indexOf(s)>=0)&&(r[s]=e[s]);return r}function n0(e){var t=o0(e,"string");return typeof t=="symbol"?t:String(t)}function o0(e,t){if(typeof e!="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Uc(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}function l0(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Uc(Object(r),!0).forEach(function(i){u0(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Uc(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function u0(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function $c(e,t){if(e.crossref in t){let r=t[e.crossref].properties;return r===e?e:Object.assign({},$c(r,t),e)}return e}function zc(e,t){let r={};for(let i of e)r[i.label]=i;return e.map(({type:i,label:s,properties:a})=>t.convertToTarget(l0({[Ar.TYPE]:i,[Ar.LABEL]:s},$c(a,r))))}function Hc(e,t){return e.map(r=>{let i=t.convertToSource(r),{[Ar.TYPE]:s,[Ar.LABEL]:a}=i,n=s0(i,[Ar.TYPE,Ar.LABEL].map(n0));return{type:s,label:a,properties:n}})}function c0(e){return zc(e,jc.default)}function p0(e){return Hc(e,jc.default)}function h0(e){return zc(e,qc.default)}function f0(e){return Hc(e,qc.default)}});var Yc=R(Cr=>{"use strict";Object.defineProperty(Cr,"__esModule",{value:!0});Cr.formatNameParts=Jt;Cr.getStringCase=m0;Cr.orderNameParts=Vc;Cr.orderNamePieces=d0;function m0(e){let t=e.toUpperCase(),r=e.toLowerCase();for(let i=0;i<e.length;i++)if(t[i]!==r[i])return t[i]===e[i];return null}function Jt(e){if(e.length===0)return;let t="";for(;e.length>1;){let{value:i,hyphenated:s}=e.shift();t+=i+(s?"-":" ")}let r=t+e[0].value;return r[0]&&r}function Vc(e,t=!0){let r=[],i=[];if(t)for(;e.length>1&&e[0].upperCase!==!1;){for(r.push(...i),i.length=0;e.length>1&&e[0].upperCase!==!1&&!e[0].hyphenated;)r.push(e.shift());for(;e.length>0&&e[0].upperCase!==!1&&e[0].hyphenated;)i.push(e.shift())}let s=[],a=[];for(;e.length>1;){for(s.push(...a),a.length=0;e.length>1&&e[0].upperCase===!1;)s.push(e.shift());for(;e.length>0&&e[0].upperCase!==!1;)a.push(e.shift())}return i.length&&a.unshift(...i),e.length&&a.push(e[0]),[Jt(r),Jt(s),Jt(a)]}function d0(e){if(e[0][0].label){let a={};for(let[{value:n,label:o}]of e)a[o]=n;return a}let t={},[r,i,s]=Vc(e[0],e.length===1);return s&&(t.family=s),i&&(t.prefix=i),e.length===3?(t.given=Jt(e[2]),t.suffix=Jt(e[1])):e.length===2?t.given=Jt(e[1]):r&&(t.given=r),t}});var ep=R(ci=>{"use strict";Object.defineProperty(ci,"__esModule",{value:!0});ci.parse=S0;ci.valueGrammar=void 0;var g0=me(),b0=Kc(In()),y0=Kc(oi()),ue=v0(Tr()),ks=Yc();function Xc(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,r=new WeakMap;return(Xc=function(i){return i?r:t})(e)}function v0(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||typeof e!="object"&&typeof e!="function")return{default:e};var r=Xc(t);if(r&&r.has(e))return r.get(e);var i={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(a!=="default"&&Object.prototype.hasOwnProperty.call(e,a)){var n=s?Object.getOwnPropertyDescriptor(e,a):null;n&&(n.get||n.set)?Object.defineProperty(i,a,n):i[a]=e[a]}return i.default=e,r&&r.set(e,i),i}function Kc(e){return e&&e.__esModule?e:{default:e}}function Jc(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}function He(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Jc(Object(r),!0).forEach(function(i){_0(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Jc(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function _0(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var E0={"\\begin":"commandBegin","\\end":"commandEnd"},Or={command:{match:/\\(?:[a-zA-Z]+|.) */,type:e=>E0[e],value:e=>e.slice(1).trim()},lbrace:{match:"{",push:"bracedLiteral"},mathShift:{match:"$",push:"mathLiteral"},whitespace:{match:/[\s]+|~/,lineBreaks:!0,value(e){return e==="~"?"\xA0":" "}}},w0=b0.default.states({stringLiteral:He(He({},Or),{},{text:/[^{$}\s~\\]+/}),namesLiteral:He(He({and:/\s+and\s+/,comma:",",hyphen:"-",equals:"="},Or),{},{text:/[^{$}\s~\\,=-]+/}),listLiteral:He(He({and:/\s+and\s+/},Or),{},{text:/[^{$}\s~\\]+/}),separatedLiteral:He(He({comma:","},Or),{},{text:/[^{$}\s~\\,]+/}),bracedLiteral:He(He({},Or),{},{rbrace:{match:"}",pop:!0},text:/[^{$}\s~\\]+/}),mathLiteral:He(He({},Or),{},{mathShift:{match:"$",pop:!0},script:/[\^_]/,text:/[^{$}\s~\\^_]+/})});function Qs(e){return e[0],e}function ui(e,t){return t in ue.formatting?e&&ue.formatting[t].join(e):e}var Zc=new g0.util.Grammar({String(){let e="";for(;!this.matchEndOfFile();)e+=this.consumeRule("Text");return Qs(e)},StringNames(){let e=[];for(;;){if(this.consumeToken("whitespace",!0),e.push(this.consumeRule("Name")),this.consumeToken("whitespace",!0),this.matchEndOfFile())return e;this.consumeToken("and")}},Name(){let e=[];for(;;){if(e.push(this.consumeRule("NamePiece")),this.matchEndOfFile()||this.matchToken("and"))return(0,ks.orderNamePieces)(e);this.consumeToken("comma"),this.consumeToken("whitespace",!0)}},NamePiece(){let e=[];for(;;){let t=this.consumeRule("NameToken");if(t.label)return t.label=(0,ks.formatNameParts)([...e,{value:t.label}]),[t];if(e.push(t),this.matchEndOfFile()||this.matchToken("and")||this.matchToken("comma"))return e;for(;this.matchToken("hyphen")||this.matchToken("whitespace");)this.consumeToken()}},NameToken(){let e=null,t="";for(;;)if(e===null&&this.matchToken("text")){let r=this.consumeToken().value;t+=r,e=(0,ks.getStringCase)(r)}else{if(this.matchEndOfFile()||this.matchToken("and")||this.matchToken("comma")||this.matchToken("whitespace"))return{value:t,upperCase:e};if(this.matchToken("hyphen"))return{value:t,upperCase:e,hyphenated:!0};if(this.matchToken("equals")){this.consumeToken("equals");let r=this.consumeRule("NamePiece");return r[0].label&&(t+="="+r[0].label),{value:(0,ks.formatNameParts)(r),label:t}}else t+=this.consumeRule("Text")}},StringList(){let e=[];for(;!this.matchEndOfFile();){let t="";for(;!this.matchEndOfFile()&&!this.matchToken("and");)t+=this.consumeRule("Text");e.push(Qs(t)),this.consumeToken("and",!0)}return e.length===1?e[0]:e},StringSeparated(){let e=[];for(;!this.matchEndOfFile();){let t="";for(;!this.matchEndOfFile()&&!this.matchToken("comma");)t+=this.consumeRule("Text");e.push(t.trim()),this.consumeToken("comma",!0),this.consumeToken("whitespace",!0)}return e},StringVerbatim(){let e="";for(;!this.matchEndOfFile();)e+=this.consumeToken().text;return Qs(e)},StringUri(){let e=this.consumeRule("StringVerbatim");try{return decodeURI(e)===e?encodeURI(e):e}catch(t){return encodeURI(e)}},StringTitleCase(){this.state.sentenceCase=!0;let e="";for(;!this.matchEndOfFile();)e+=this.consumeRule("Text");return Qs(e)},BracketString(){var e;let t="";this.consumeToken("lbrace");let r=this.state.sentenceCase;for(this.state.sentenceCase=r&&this.matchToken("command"),(e=this.state).partlyLowercase&&(e.partlyLowercase=this.state.sentenceCase);!this.matchToken("rbrace");)t+=this.consumeRule("Text");let s=r&&!this.state.sentenceCase&&this.state.partlyLowercase;return this.state.sentenceCase=r,this.consumeToken("rbrace"),s?ui(t,"nocase"):t},MathString(){let e="";for(this.consumeToken("mathShift");!this.matchToken("mathShift");){if(this.matchToken("script")){let t=this.consumeToken("script").value,r=this.consumeRule("Text").split("");if(r.every(i=>i in ue.mathScripts[t]))e+=r.map(i=>ue.mathScripts[t][i]).join("");else{let i=ue.mathScriptFormatting[t];e+=ue.formatting[i].join(r.join(""))}continue}if(this.matchToken("command")){let t=this.token.value;if(t in ue.mathScriptFormatting){this.consumeToken("command");let r=this.consumeRule("BracketString");e+=ui(r,ue.mathScriptFormatting[t]);continue}}e+=this.consumeRule("Text")}return this.consumeToken("mathShift"),e},Text(){if(this.matchToken("lbrace"))return this.consumeRule("BracketString");if(this.matchToken("mathShift"))return this.consumeRule("MathString");if(this.matchToken("whitespace"))return this.consumeToken("whitespace").value;if(this.matchToken("commandBegin"))return this.consumeRule("EnclosedEnv");if(this.matchToken("command"))return this.consumeRule("Command");let e=this.consumeToken("text").value.replace(ue.ligaturePattern,o=>ue.ligatures[o]),t=this.state.afterPunctuation;if(this.state.afterPunctuation=/[?!.:]$/.test(e),!this.state.sentenceCase){var r;return(r=this.state).partlyLowercase||(r.partlyLowercase=e===e.toLowerCase()&&e!==e.toUpperCase()),e}let[i,...s]=e,a=s.join(""),n=a.toLowerCase();return a!==n?e:t?i+n:e.toLowerCase()},Command(){let e=this.consumeToken("command"),t=e.value;if(t in ue.formattingEnvs){let r=this.consumeRule("Env"),i=ue.formattingEnvs[t];return ui(r,i)}else if(t in ue.formattingCommands){let r=this.consumeRule("BracketString"),i=ue.formattingCommands[t];return ui(r,i)}else{if(t in ue.commands)return ue.commands[t];if(t in ue.diacritics&&!this.matchEndOfFile()){let r=this.consumeRule("Text");return(r[0]+ue.diacritics[t]).normalize("NFC")+r.slice(1)}else if(t in ue.argumentCommands){let r=ue.argumentCommands[t],i=[],s=r.length;for(;s-- >0;)this.consumeToken("whitespace",!0),i.push(this.consumeRule("BracketString"));return r(...i)}else return/^[&%$#_{}]$/.test(t)?e.text.slice(1):e.text}},Env(){let e="";for(;!this.matchEndOfFile()&&!this.matchToken("rbrace");)e+=this.consumeRule("Text");return e},EnclosedEnv(){this.consumeToken("commandBegin");let e=this.consumeRule("BracketString"),t="";for(;!this.matchToken("commandEnd");)t+=this.consumeRule("Text");let r=this.consumeToken("commandEnd"),i=this.consumeRule("BracketString");if(e!==i)throw new SyntaxError(this.lexer.formatError(r,`environment started with "${e}", ended with "${i}"`));return ui(t,ue.formattingEnvs[e])}},{sentenceCase:!1,partlyLowercase:!1,afterPunctuation:!0});ci.valueGrammar=Zc;function Wc(e){return ue.sentenceCaseLanguages.includes(e.toLowerCase())}function x0(e){return Array.isArray(e)?e.every(Wc):Wc(e)}function T0(e,t){if(e[1]==="name")return e[0]==="list"?"StringNames":"Name";if(e[1]==="title"){let r=y0.default.parse.sentenceCase;return r==="always"||r==="english"&&x0(t)?"StringTitleCase":"String"}switch(e[0]==="field"?e[1]:e[0]){case"list":return"StringList";case"separated":return"StringSeparated";case"verbatim":return"StringVerbatim";case"uri":return"StringUri";case"title":case"literal":default:return"String"}}function A0(e){if(e[1]==="name")return"namesLiteral";switch(e[0]){case"list":return"listLiteral";case"separated":return"separatedLiteral";case"field":default:return"stringLiteral"}}function S0(e,t,r=[]){let i=ue.fieldTypes[t]||[];return Zc.parse(w0.reset(e,{state:A0(i),line:0,col:0}),T0(i,r))}});var Fn=R(Ns=>{"use strict";Object.defineProperty(Ns,"__esModule",{value:!0});Ns.parse=k0;Ns.parseBibtex=Q0;var sp=C0(oi()),ap=Bn(),tp=ep(),np=Tr();function C0(e){return e&&e.__esModule?e:{default:e}}function rp(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}function ip(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?rp(Object(r),!0).forEach(function(i){O0(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rp(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function O0(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function op(e,t){let r=[];for(let{type:i,label:s,properties:a}of e)if(i in t){let n=[];for(let o of t[i])Array.isArray(o)&&!o.some(u=>u in a)?n.push(o.join("/")):typeof o=="string"&&!(o in a)&&n.push(o);n.length&&r.push([s,`missing fields: ${n.join(", ")}`])}else r.push([s,`invalid type: "${i}"`]);if(r.length)throw new RangeError(["Invalid entries:"].concat(r.map(([i,s])=>`  - ${i} has ${s}`)).join(`
`))}function lp(e){let t={};"language"in e.properties&&(t.language=(0,tp.parse)(e.properties.language,"language"));for(let r in e.properties){let i=e.properties[r];i!==""&&(t[r]=(0,tp.parse)(i+"",r,t.language))}return ip(ip({},e),{},{properties:t})}function k0(e){return sp.default.parse.strict&&op(e,np.required.biblatex),(0,ap.parse)(e.map(lp))}function Q0(e){return sp.default.parse.strict&&op(e,np.required.bibtex),(0,ap.parseBibtex)(e.map(lp))}});var Mn=R(kr=>{"use strict";Object.defineProperty(kr,"__esModule",{value:!0});kr.ref=kr.formats=void 0;var up=Sc(),N0=Pn(),Is=Fn(),I0="@bibtex";kr.ref=I0;var D0={"@biblatex/text":{parse:up.parse,parseType:{dataType:"String",predicate:/@\s{0,5}[A-Za-z]{1,13}\s{0,5}\{\s{0,5}[^@{}"=,\\\s]{0,100}\s{0,5},[\s\S]*\}/}},"@biblatex/entry+object":{parse(e){return(0,Is.parse)([e])},parseType:{dataType:"SimpleObject",propertyConstraint:{props:["type","label","properties"]}}},"@biblatex/entries+list":{parse:Is.parse,parseType:{elementConstraint:"@biblatex/entry+object"}},"@bibtex/text":{parse:up.parse,outputs:"@bibtex/entries+list"},"@bibtex/entry+object":{parse(e){return(0,Is.parseBibtex)([e])}},"@bibtex/entries+list":{parse:Is.parseBibtex},"@bibtxt/text":{parse:N0.parse,parseType:{dataType:"String",predicate:/^\s*(\[(?!\s*[{[]).*?\]\s*(\n\s*[^[]((?!:)\S)+\s*:\s*.+?\s*)*\s*)+$/}}};kr.formats=D0});var hp=R(Gn=>{"use strict";Object.defineProperty(Gn,"__esModule",{value:!0});Gn.format=M0;var ct=Tr(),xt={};for(let e in ct.commands)xt[ct.commands[e]]=e;for(let e in ct.diacritics)xt[ct.diacritics[e]]=e;for(let e in ct.ligatures)xt[ct.ligatures[e]]=e;var P0=/[^a-zA-Z0-9\s!"#%&'()*+,\-./:;=?@[\]{}\u0300-\u0308\u030a-\u030c\u0332\u0323\u0327\u0328\u0361\u0326]/g,R0=/.[\u0300-\u0308\u030a-\u030c\u0332\u0323\u0327\u0328\u0361\u0326]+/g,qn={separated:",",list:" and "},cp={i:"\\textit{",b:"\\textbf{",sc:"\\textsc{",sup:"\\textsuperscript{",sub:"\\textsubscript{",'span style="font-variant:small-caps;"':"\\textsc{",'span class="nocase"':"{"};function jn(e){return e.normalize("NFKD").replace(P0,t=>t in xt?xt[t]in ct.ligatures?xt[t]:`\\${xt[t]}{}`:"").replace(R0,t=>Array.from(t).reduce((r,i)=>`{\\${xt[i]} ${r}}`))}function pp(e){let t=[],r=e.split(/<(\/?(?:i|b|sc|sup|sub|span)|span .*?)>/g);return r=r.map((i,s)=>s%2===0?jn(i):i in cp?(t.push("/"+i.split(" ")[0]),cp[i]):i===t[t.length-1]?(t.pop(),"}"):""),r.join("")}function L0(e){if(e.family&&!e.prefix&&!e.given&!e.suffix)return e.family.includes(qn.list)?e.family:`{${e.family}}`;let t=[""];return e.prefix&&e.family&&(t[0]+=e.prefix+" "),e.family&&(t[0]+=e.family),e.suffix?(t.push(e.suffix),t.push(e.given||"")):t.push(e.given),jn(t.join(", ").trim())}function B0(e){return pp(e).split(/(:\s*)/).map((t,r)=>r%2?t:t.replace(/(?!^)\b[a-z]*[A-Z].*?\b/g,"{$&}")).join("")}function Un(e,t){switch(t){case"title":return B0(e);case"literal":return pp(e.toString());case"name":return L0(e);case"verbatim":case"uri":return e.toString();default:return jn(e.toString())}}function F0(e,t,r){let i=qn[r];return e.map(s=>{let a=Un(s,t);return a.includes(i)?`{${a}}`:a}).join(i)}function M0(e,t){if(!(e in ct.fieldTypes))return Un(t,"verbatim");let[r,i]=ct.fieldTypes[e];return r in qn?F0(t,i,r):Un(t,i)}});var $n=R(Ds=>{"use strict";Object.defineProperty(Ds,"__esModule",{value:!0});Ds.format=q0;Ds.formatBibtex=j0;var fp=Bn(),U0=hp();function mp({type:e,label:t,properties:r}){let i={};for(let s in r){let a=r[s];i[s]=(0,U0.format)(s,a)}return{type:e,label:t,properties:i}}function q0(e){return(0,fp.format)(e).map(mp)}function j0(e){return(0,fp.formatBibtex)(e).map(mp)}});var dp=R(zn=>{"use strict";Object.defineProperty(zn,"__esModule",{value:!0});zn.format=$0;function G0({type:e,label:t,properties:r},i){let s=Object.entries(r).map(([a,n])=>i.listItem.join(`${a} = {${n}},`));return i.entry.join(`@${e}{${t},${i.list.join(s.join(""))}}`)}function $0(e,t){let r=e.map(i=>G0(i,t)).join("");return t.bibliographyContainer.join(r)}});var Vn=R(Hn=>{"use strict";Object.defineProperty(Hn,"__esModule",{value:!0});Hn.format=H0;function z0({type:e,label:t,properties:r},i){let s=Object.entries(r).concat([["type",e]]).map(([a,n])=>i.listItem.join(`${a}: ${n}`));return i.entry.join(`[${t}]${i.list.join(s.join(""))}`)}function H0(e,t){let r=e.map(i=>z0(i,t)).join(`
`);return t.bibliographyContainer.join(r)}});var Wn=R(Ps=>{"use strict";Object.defineProperty(Ps,"__esModule",{value:!0});Ps.default=void 0;var gp=me(),Yn=$n(),bp=dp(),V0=Vn(),Jn=function(e,t){return function(r,i={}){let{type:s,format:a=s||"text"}=i;if(r=e(r),a==="object")return r;if(gp.plugins.dict.has(a))return t(r,gp.plugins.dict.get(a),i);throw new RangeError(`Output dictionary "${a}" not available`)}},Y0={bibtex:Jn(Yn.formatBibtex,bp.format),biblatex:Jn(Yn.format,bp.format),bibtxt:Jn(Yn.formatBibtex,V0.format)};Ps.default=Y0});var Rs=R(()=>{"use strict";var J0=me(),yp=Mn(),W0=vp(oi()),X0=vp(Wn());function vp(e){return e&&e.__esModule?e:{default:e}}J0.plugins.add(yp.ref,{input:yp.formats,output:X0.default,config:W0.default})});var _p=R((bT,K0)=>{K0.exports={"en-US":`<?xml version="1.0" encoding="utf-8"?><locale xmlns="http://purl.org/net/xbiblio/csl" version="1.0" xml:lang="en-US"><info><rights license="http://creativecommons.org/licenses/by-sa/3.0/">This work is licensed under a Creative Commons Attribution-ShareAlike 3.0 License</rights><updated>2015-10-10T23:31:02+00:00</updated></info><style-options punctuation-in-quote="true"/><date form="text"><date-part name="month" suffix=" "/><date-part name="day" suffix=", "/><date-part name="year"/></date><date form="numeric"><date-part name="month" form="numeric-leading-zeros" suffix="/"/><date-part name="day" form="numeric-leading-zeros" suffix="/"/><date-part name="year"/></date><terms><term name="accessed">accessed</term><term name="and">and</term><term name="and others">and others</term><term name="anonymous">anonymous</term><term name="anonymous" form="short">anon.</term><term name="at">at</term><term name="available at">available at</term><term name="by">by</term><term name="circa">circa</term><term name="circa" form="short">c.</term><term name="cited">cited</term><term name="edition"><single>edition</single><multiple>editions</multiple></term><term name="edition" form="short">ed.</term><term name="et-al">et al.</term><term name="forthcoming">forthcoming</term><term name="from">from</term><term name="ibid">ibid.</term><term name="in">in</term><term name="in press">in press</term><term name="internet">internet</term><term name="interview">interview</term><term name="letter">letter</term><term name="no date">no date</term><term name="no date" form="short">n.d.</term><term name="online">online</term><term name="presented at">presented at the</term><term name="reference"><single>reference</single><multiple>references</multiple></term><term name="reference" form="short"><single>ref.</single><multiple>refs.</multiple></term><term name="retrieved">retrieved</term><term name="scale">scale</term><term name="version">version</term><term name="ad">AD</term><term name="bc">BC</term><term name="open-quote">\u201C</term><term name="close-quote">\u201D</term><term name="open-inner-quote">\u2018</term><term name="close-inner-quote">\u2019</term><term name="page-range-delimiter">\u2013</term><term name="ordinal">th</term><term name="ordinal-01">st</term><term name="ordinal-02">nd</term><term name="ordinal-03">rd</term><term name="ordinal-11">th</term><term name="ordinal-12">th</term><term name="ordinal-13">th</term><term name="long-ordinal-01">first</term><term name="long-ordinal-02">second</term><term name="long-ordinal-03">third</term><term name="long-ordinal-04">fourth</term><term name="long-ordinal-05">fifth</term><term name="long-ordinal-06">sixth</term><term name="long-ordinal-07">seventh</term><term name="long-ordinal-08">eighth</term><term name="long-ordinal-09">ninth</term><term name="long-ordinal-10">tenth</term><term name="book"><single>book</single><multiple>books</multiple></term><term name="chapter"><single>chapter</single><multiple>chapters</multiple></term><term name="column"><single>column</single><multiple>columns</multiple></term><term name="figure"><single>figure</single><multiple>figures</multiple></term><term name="folio"><single>folio</single><multiple>folios</multiple></term><term name="issue"><single>number</single><multiple>numbers</multiple></term><term name="line"><single>line</single><multiple>lines</multiple></term><term name="note"><single>note</single><multiple>notes</multiple></term><term name="opus"><single>opus</single><multiple>opera</multiple></term><term name="page"><single>page</single><multiple>pages</multiple></term><term name="number-of-pages"><single>page</single><multiple>pages</multiple></term><term name="paragraph"><single>paragraph</single><multiple>paragraphs</multiple></term><term name="part"><single>part</single><multiple>parts</multiple></term><term name="section"><single>section</single><multiple>sections</multiple></term><term name="sub verbo"><single>sub verbo</single><multiple>sub verbis</multiple></term><term name="verse"><single>verse</single><multiple>verses</multiple>
</term><term name="volume"><single>volume</single><multiple>volumes</multiple></term><term name="book" form="short"><single>bk.</single><multiple>bks.</multiple></term><term name="chapter" form="short"><single>chap.</single><multiple>chaps.</multiple></term><term name="column" form="short"><single>col.</single><multiple>cols.</multiple></term><term name="figure" form="short"><single>fig.</single><multiple>figs.</multiple></term><term name="folio" form="short"><single>fol.</single><multiple>fols.</multiple></term><term name="issue" form="short"><single>no.</single><multiple>nos.</multiple></term><term name="line" form="short"><single>l.</single><multiple>ll.</multiple></term><term name="note" form="short"><single>n.</single><multiple>nn.</multiple></term><term name="opus" form="short"><single>op.</single><multiple>opp.</multiple></term><term name="page" form="short"><single>p.</single><multiple>pp.</multiple></term><term name="number-of-pages" form="short"><single>p.</single><multiple>pp.</multiple></term><term name="paragraph" form="short"><single>para.</single><multiple>paras.</multiple></term><term name="part" form="short"><single>pt.</single><multiple>pts.</multiple></term><term name="section" form="short"><single>sec.</single><multiple>secs.</multiple></term><term name="sub verbo" form="short"><single>s.v.</single><multiple>s.vv.</multiple></term><term name="verse" form="short"><single>v.</single><multiple>vv.</multiple></term><term name="volume" form="short"><single>vol.</single><multiple>vols.</multiple></term><term name="paragraph" form="symbol"><single>\xB6</single><multiple>\xB6\xB6</multiple></term><term name="section" form="symbol"><single>\xA7</single><multiple>\xA7\xA7</multiple></term><term name="director"><single>director</single><multiple>directors</multiple></term><term name="editor"><single>editor</single><multiple>editors</multiple></term><term name="editorial-director"><single>editor</single><multiple>editors</multiple></term><term name="illustrator"><single>illustrator</single><multiple>illustrators</multiple></term><term name="translator"><single>translator</single><multiple>translators</multiple></term><term name="editortranslator"><single>editor &amp; translator</single><multiple>editors &amp; translators</multiple></term><term name="director" form="short"><single>dir.</single><multiple>dirs.</multiple></term><term name="editor" form="short"><single>ed.</single><multiple>eds.</multiple></term><term name="editorial-director" form="short"><single>ed.</single><multiple>eds.</multiple></term><term name="illustrator" form="short"><single>ill.</single><multiple>ills.</multiple></term><term name="translator" form="short"><single>tran.</single><multiple>trans.</multiple></term><term name="editortranslator" form="short"><single>ed. &amp; tran.</single><multiple>eds. &amp; trans.</multiple></term><term name="container-author" form="verb">by</term><term name="director" form="verb">directed by</term><term name="editor" form="verb">edited by</term><term name="editorial-director" form="verb">edited by</term><term name="illustrator" form="verb">illustrated by</term><term name="interviewer" form="verb">interview by</term><term name="recipient" form="verb">to</term><term name="reviewed-author" form="verb">by</term><term name="translator" form="verb">translated by</term><term name="editortranslator" form="verb">edited &amp; translated by</term><term name="director" form="verb-short">dir. by</term><term name="editor" form="verb-short">ed. by</term><term name="editorial-director" form="verb-short">ed. by</term><term name="illustrator" form="verb-short">illus. by</term><term name="translator" form="verb-short">trans. by</term><term name="editortranslator" form="verb-short">ed. &amp; trans. by</term><term name="month-01">January</term><term name="month-02">February</term><term name="month-03">March</term><term name="month-04">April</term><term name="month-05">May</term><term name="month-06">June</term><term name="month-07">July</term><term name="month-08">August</term><term name="month-09">September</term>
<term name="month-10">October</term><term name="month-11">November</term><term name="month-12">December</term><term name="month-01" form="short">Jan.</term><term name="month-02" form="short">Feb.</term><term name="month-03" form="short">Mar.</term><term name="month-04" form="short">Apr.</term><term name="month-05" form="short">May</term><term name="month-06" form="short">Jun.</term><term name="month-07" form="short">Jul.</term><term name="month-08" form="short">Aug.</term><term name="month-09" form="short">Sep.</term><term name="month-10" form="short">Oct.</term><term name="month-11" form="short">Nov.</term><term name="month-12" form="short">Dec.</term><term name="season-01">Spring</term><term name="season-02">Summer</term><term name="season-03">Autumn</term><term name="season-04">Winter</term></terms></locale>`,"nl-NL":`<?xml version="1.0" encoding="utf-8"?><locale xmlns="http://purl.org/net/xbiblio/csl" version="1.0" xml:lang="nl-NL"><info><translator><name>Rintze Zelle</name><uri>http://twitter.com/rintzezelle</uri></translator><rights license="http://creativecommons.org/licenses/by-sa/3.0/">This work is licensed under a Creative Commons Attribution-ShareAlike 3.0 License</rights><updated>2012-07-04T23:31:02+00:00</updated></info><style-options punctuation-in-quote="false"/><date form="text"><date-part name="day" suffix=" "/><date-part name="month" suffix=" "/><date-part name="year"/></date><date form="numeric"><date-part name="day" suffix="-" range-delimiter="/"/><date-part name="month" form="numeric" suffix="-" range-delimiter="/"/><date-part name="year"/></date><terms><term name="accessed">geraadpleegd</term><term name="and">en</term><term name="and others">en anderen</term><term name="anonymous">anoniem</term><term name="anonymous" form="short">anon.</term><term name="at">bij</term><term name="available at">beschikbaar op</term><term name="by">door</term><term name="circa">circa</term><term name="circa" form="short">c.</term><term name="cited">geciteerd</term><term name="edition"><single>editie</single><multiple>edities</multiple></term><term name="edition" form="short">ed.</term><term name="et-al">e.a.</term><term name="forthcoming">in voorbereiding</term><term name="from">van</term><term name="ibid">ibid.</term><term name="in">in</term><term name="in press">in druk</term><term name="internet">internet</term><term name="interview">interview</term><term name="letter">brief</term><term name="no date">zonder datum</term><term name="no date" form="short">z.d.</term><term name="online">online</term><term name="presented at">gepresenteerd bij</term><term name="reference"><single>referentie</single><multiple>referenties</multiple></term><term name="reference" form="short"><single>ref.</single><multiple>refs.</multiple></term><term name="retrieved">geraadpleegd</term><term name="scale">schaal</term><term name="version">versie</term><term name="ad">AD</term><term name="bc">BC</term><term name="open-quote">\u201C</term><term name="close-quote">\u201D</term><term name="open-inner-quote">\u2018</term><term name="close-inner-quote">\u2019</term><term name="page-range-delimiter">\u2013</term><term name="ordinal">ste</term><term name="ordinal-00" match="whole-number">de</term><term name="ordinal-02" match="last-two-digits">de</term><term name="ordinal-03" match="last-two-digits">de</term><term name="ordinal-04" match="last-two-digits">de</term><term name="ordinal-05" match="last-two-digits">de</term><term name="ordinal-06" match="last-two-digits">de</term><term name="ordinal-07" match="last-two-digits">de</term><term name="ordinal-09" match="last-two-digits">de</term><term name="ordinal-10">de</term><term name="ordinal-11">de</term><term name="ordinal-12">de</term><term name="ordinal-13">de</term><term name="ordinal-14">de</term><term name="ordinal-15">de</term><term name="ordinal-16">de</term><term name="ordinal-17">de</term><term name="ordinal-18">de</term><term name="ordinal-19">de</term><term name="long-ordinal-01">eerste</term><term name="long-ordinal-02">tweede</term><term name="long-ordinal-03">derde</term><term name="long-ordinal-04">vierde</term><term name="long-ordinal-05">vijfde</term><term name="long-ordinal-06">zesde</term><term name="long-ordinal-07">zevende</term><term name="long-ordinal-08">achtste</term><term name="long-ordinal-09">negende</term><term name="long-ordinal-10">tiende</term><term name="book"><single>boek</single><multiple>boeken</multiple></term><term name="chapter"><single>hoofdstuk</single><multiple>hoofdstukken</multiple></term><term name="column"><single>column</single><multiple>columns</multiple></term><term name="figure"><single>figuur</single><multiple>figuren</multiple></term><term name="folio"><single>folio</single><multiple>folio's</multiple></term><term name="issue"><single>nummer</single><multiple>nummers</multiple></term><term name="line"><single>regel</single><multiple>regels</multiple>
</term><term name="note"><single>aantekening</single><multiple>aantekeningen</multiple></term><term name="opus"><single>opus</single><multiple>opera</multiple></term><term name="page"><single>pagina</single><multiple>pagina's</multiple></term><term name="number-of-pages"><single>pagina</single><multiple>pagina's</multiple></term><term name="paragraph"><single>paragraaf</single><multiple>paragrafen</multiple></term><term name="part"><single>deel</single><multiple>delen</multiple></term><term name="section"><single>sectie</single><multiple>secties</multiple></term><term name="sub verbo"><single>sub verbo</single><multiple>sub verbis</multiple></term><term name="verse"><single>vers</single><multiple>versen</multiple></term><term name="volume"><single>volume</single><multiple>volumes</multiple></term><term name="book" form="short">bk.</term><term name="chapter" form="short">hfdst.</term><term name="column" form="short">col.</term><term name="figure" form="short">fig.</term><term name="folio" form="short">f.</term><term name="issue" form="short">nr.</term><term name="line" form="short">l.</term><term name="note" form="short">n.</term><term name="opus" form="short">op.</term><term name="page" form="short"><single>p.</single><multiple>pp.</multiple></term><term name="number-of-pages" form="short"><single>p.</single><multiple>pp.</multiple></term><term name="paragraph" form="short">par.</term><term name="part" form="short">deel</term><term name="section" form="short">sec.</term><term name="sub verbo" form="short"><single>s.v.</single><multiple>s.vv.</multiple></term><term name="verse" form="short"><single>v.</single><multiple>vv.</multiple></term><term name="volume" form="short"><single>vol.</single><multiple>vols.</multiple></term><term name="paragraph" form="symbol"><single>\xB6</single><multiple>\xB6\xB6</multiple></term><term name="section" form="symbol"><single>\xA7</single><multiple>\xA7\xA7</multiple></term><term name="director"><single>regisseur</single><multiple>regisseurs</multiple></term><term name="editor"><single>redacteur</single><multiple>redacteuren</multiple></term><term name="editorial-director"><single>redacteur</single><multiple>redacteuren</multiple></term><term name="illustrator"><single>illustrator</single><multiple>illustrators</multiple></term><term name="translator"><single>vertaler</single><multiple>vertalers</multiple></term><term name="editortranslator"><single>redacteur &amp; vertaler</single><multiple>redacteuren &amp; vertalers</multiple></term><term name="director" form="short"><single>reg.</single><multiple>reg.</multiple></term><term name="editor" form="short"><single>red.</single><multiple>red.</multiple></term><term name="editorial-director" form="short"><single>red.</single><multiple>red.</multiple></term><term name="illustrator" form="short"><single>ill.</single><multiple>ill.</multiple></term><term name="translator" form="short"><single>vert.</single><multiple>vert.</multiple></term><term name="editortranslator" form="short"><single>red. &amp; vert.</single><multiple>red. &amp; vert.</multiple></term><term name="container-author" form="verb">door</term><term name="director" form="verb">geregisseerd door</term><term name="editor" form="verb">bewerkt door</term><term name="editorial-director" form="verb">bewerkt door</term><term name="illustrator" form="verb">ge\xEFllustreerd door</term><term name="interviewer" form="verb">ge\xEFnterviewd door</term><term name="recipient" form="verb">ontvangen door</term><term name="reviewed-author" form="verb">door</term><term name="translator" form="verb">vertaald door</term><term name="editortranslator" form="verb">bewerkt &amp; vertaald door</term><term name="director" form="verb-short">geregisseerd door</term><term name="editor" form="verb-short">bewerkt door</term><term name="editorial-director" form="verb-short">bewerkt door</term><term name="illustrator" form="verb-short">ge\xEFllustreerd door</term><term name="translator" form="verb-short">vertaald door</term><term name="editortranslator" form="verb-short">bewerkt &amp; vertaald door</term>
<term name="month-01">januari</term><term name="month-02">februari</term><term name="month-03">maart</term><term name="month-04">april</term><term name="month-05">mei</term><term name="month-06">juni</term><term name="month-07">juli</term><term name="month-08">augustus</term><term name="month-09">september</term><term name="month-10">oktober</term><term name="month-11">november</term><term name="month-12">december</term><term name="month-01" form="short">jan.</term><term name="month-02" form="short">feb.</term><term name="month-03" form="short">mrt.</term><term name="month-04" form="short">apr.</term><term name="month-05" form="short">mei</term><term name="month-06" form="short">jun.</term><term name="month-07" form="short">jul.</term><term name="month-08" form="short">aug.</term><term name="month-09" form="short">sep.</term><term name="month-10" form="short">okt.</term><term name="month-11" form="short">nov.</term><term name="month-12" form="short">dec.</term><term name="season-01">lente</term><term name="season-02">zomer</term><term name="season-03">herst</term><term name="season-04">winter</term></terms></locale>`,"fr-FR":`<?xml version="1.0" encoding="utf-8"?><locale xmlns="http://purl.org/net/xbiblio/csl" version="1.0" xml:lang="fr-FR"><info><translator><name>Gr\xE9goire Colly</name></translator><rights license="http://creativecommons.org/licenses/by-sa/3.0/">This work is licensed under a Creative Commons Attribution-ShareAlike 3.0 License</rights><updated>2012-07-04T23:31:02+00:00</updated></info><style-options punctuation-in-quote="false" limit-day-ordinals-to-day-1="true"/><date form="text"><date-part name="day" suffix=" "/><date-part name="month" suffix=" "/><date-part name="year"/></date><date form="numeric"><date-part name="day" form="numeric-leading-zeros" suffix="/"/><date-part name="month" form="numeric-leading-zeros" suffix="/"/><date-part name="year"/></date><terms><term name="accessed">consult\xE9 le</term><term name="and">et</term><term name="and others">et autres</term><term name="anonymous">anonyme</term><term name="anonymous" form="short">anon.</term><term name="at">sur</term><term name="available at">disponible sur</term><term name="by">par</term><term name="circa">vers</term><term name="circa" form="short">v.</term><term name="cited">cit\xE9</term><term name="edition" gender="feminine"><single>\xE9dition</single><multiple>\xE9ditions</multiple></term><term name="edition" form="short">\xE9d.</term><term name="et-al">et al.</term><term name="forthcoming">\xE0 para\xEEtre</term><term name="from">\xE0 l'adresse</term><term name="ibid">ibid.</term><term name="in">in</term><term name="in press">sous presse</term><term name="internet">Internet</term><term name="interview">entretien</term><term name="letter">lettre</term><term name="no date">sans date</term><term name="no date" form="short">s.&#160;d.</term><term name="online">en ligne</term><term name="presented at">pr\xE9sent\xE9 \xE0</term><term name="reference"><single>r\xE9f\xE9rence</single><multiple>r\xE9f\xE9rences</multiple></term><term name="reference" form="short"><single>r\xE9f.</single><multiple>r\xE9f.</multiple></term><term name="retrieved">consult\xE9</term><term name="scale">\xE9chelle</term><term name="version">version</term><term name="ad">apr. J.-C.</term><term name="bc">av. J.-C.</term><term name="open-quote">\xAB&#160;</term><term name="close-quote">&#160;\xBB</term><term name="open-inner-quote">\u201C</term><term name="close-inner-quote">\u201D</term><term name="page-range-delimiter">&#8209;</term><term name="ordinal">\u1D49</term><term name="ordinal-01" gender-form="feminine" match="whole-number">\u02B3\u1D49</term><term name="ordinal-01" gender-form="masculine" match="whole-number">\u1D49\u02B3</term><term name="long-ordinal-01">premier</term><term name="long-ordinal-02">deuxi\xE8me</term><term name="long-ordinal-03">troisi\xE8me</term><term name="long-ordinal-04">quatri\xE8me</term><term name="long-ordinal-05">cinqui\xE8me</term><term name="long-ordinal-06">sixi\xE8me</term><term name="long-ordinal-07">septi\xE8me</term><term name="long-ordinal-08">huiti\xE8me</term><term name="long-ordinal-09">neuvi\xE8me</term><term name="long-ordinal-10">dixi\xE8me</term><term name="book"><single>livre</single><multiple>livres</multiple></term><term name="chapter"><single>chapitre</single><multiple>chapitres</multiple></term><term name="column"><single>colonne</single><multiple>colonnes</multiple></term><term name="figure"><single>figure</single><multiple>figures</multiple></term><term name="folio"><single>folio</single><multiple>folios</multiple></term><term name="issue" gender="masculine"><single>num\xE9ro</single><multiple>num\xE9ros</multiple></term><term name="line"><single>ligne</single><multiple>lignes</multiple></term><term name="note"><single>note</single><multiple>notes</multiple></term><term name="opus"><single>opus</single><multiple>opus</multiple></term><term name="page"><single>page</single><multiple>pages</multiple></term><term name="number-of-pages"><single>page</single><multiple>pages</multiple></term><term name="paragraph"><single>paragraphe</single><multiple>paragraphes</multiple></term><term name="part"><single>partie</single><multiple>parties</multiple></term><term name="section"><single>section</single><multiple>sections</multiple>
</term><term name="sub verbo"><single>sub verbo</single><multiple>sub verbis</multiple></term><term name="verse"><single>verset</single><multiple>versets</multiple></term><term name="volume" gender="masculine"><single>volume</single><multiple>volumes</multiple></term><term name="book" form="short">liv.</term><term name="chapter" form="short">chap.</term><term name="column" form="short">col.</term><term name="figure" form="short">fig.</term><term name="folio" form="short"><single>f\u1D52</single><multiple>f\u1D52\u02E2</multiple></term><term name="issue" form="short"><single>n\u1D52</single><multiple>n\u1D52\u02E2</multiple></term><term name="line" form="short">l.</term><term name="note" form="short">n.</term><term name="opus" form="short">op.</term><term name="page" form="short"><single>p.</single><multiple>p.</multiple></term><term name="number-of-pages" form="short"><single>p.</single><multiple>p.</multiple></term><term name="paragraph" form="short">paragr.</term><term name="part" form="short">part.</term><term name="section" form="short">sect.</term><term name="sub verbo" form="short"><single>s.&#160;v.</single><multiple>s.&#160;vv.</multiple></term><term name="verse" form="short"><single>v.</single><multiple>v.</multiple></term><term name="volume" form="short"><single>vol.</single><multiple>vol.</multiple></term><term name="paragraph" form="symbol"><single>\xA7</single><multiple>\xA7</multiple></term><term name="section" form="symbol"><single>\xA7</single><multiple>\xA7</multiple></term><term name="director"><single>r\xE9alisateur</single><multiple>r\xE9alisateurs</multiple></term><term name="editor"><single>\xE9diteur</single><multiple>\xE9diteurs</multiple></term><term name="editorial-director"><single>directeur</single><multiple>directeurs</multiple></term><term name="illustrator"><single>illustrateur</single><multiple>illustrateurs</multiple></term><term name="translator"><single>traducteur</single><multiple>traducteurs</multiple></term><term name="editortranslator"><single>\xE9diteur et traducteur</single><multiple>\xE9diteurs et traducteurs</multiple></term><term name="director" form="short"><single>r\xE9al.</single><multiple>r\xE9al.</multiple></term><term name="editor" form="short"><single>\xE9d.</single><multiple>\xE9d.</multiple></term><term name="editorial-director" form="short"><single>dir.</single><multiple>dir.</multiple></term><term name="illustrator" form="short"><single>ill.</single><multiple>ill.</multiple></term><term name="translator" form="short"><single>trad.</single><multiple>trad.</multiple></term><term name="editortranslator" form="short"><single>\xE9d. et trad.</single><multiple>\xE9d. et trad.</multiple></term><term name="container-author" form="verb">par</term><term name="director" form="verb">r\xE9alis\xE9 par</term><term name="editor" form="verb">\xE9dit\xE9 par</term><term name="editorial-director" form="verb">sous la direction de</term><term name="illustrator" form="verb">illustr\xE9 par</term><term name="interviewer" form="verb">entretien r\xE9alis\xE9 par</term><term name="recipient" form="verb">\xE0</term><term name="reviewed-author" form="verb">par</term><term name="translator" form="verb">traduit par</term><term name="editortranslator" form="verb">\xE9dit\xE9 et traduit par</term><term name="director" form="verb-short">r\xE9al. par</term><term name="editor" form="verb-short">\xE9d. par</term><term name="editorial-director" form="verb-short">ss la dir. de</term><term name="illustrator" form="verb-short">ill. par</term><term name="translator" form="verb-short">trad. par</term><term name="editortranslator" form="verb-short">\xE9d. et trad. par</term><term name="month-01" gender="masculine">janvier</term><term name="month-02" gender="masculine">f\xE9vrier</term><term name="month-03" gender="masculine">mars</term><term name="month-04" gender="masculine">avril</term><term name="month-05" gender="masculine">mai</term><term name="month-06" gender="masculine">juin</term><term name="month-07" gender="masculine">juillet</term><term name="month-08" gender="masculine">ao\xFBt</term><term name="month-09" gender="masculine">septembre</term><term name="month-10" gender="masculine">
octobre</term><term name="month-11" gender="masculine">novembre</term><term name="month-12" gender="masculine">d\xE9cembre</term><term name="month-01" form="short">janv.</term><term name="month-02" form="short">f\xE9vr.</term><term name="month-03" form="short">mars</term><term name="month-04" form="short">avr.</term><term name="month-05" form="short">mai</term><term name="month-06" form="short">juin</term><term name="month-07" form="short">juill.</term><term name="month-08" form="short">ao\xFBt</term><term name="month-09" form="short">sept.</term><term name="month-10" form="short">oct.</term><term name="month-11" form="short">nov.</term><term name="month-12" form="short">d\xE9c.</term><term name="season-01">printemps</term><term name="season-02">\xE9t\xE9</term><term name="season-03">automne</term><term name="season-04">hiver</term></terms></locale>`,"de-DE":`<?xml version="1.0" encoding="utf-8"?><locale xmlns="http://purl.org/net/xbiblio/csl" version="1.0" xml:lang="de-DE"><info><rights license="http://creativecommons.org/licenses/by-sa/3.0/">This work is licensed under a Creative Commons Attribution-ShareAlike 3.0 License</rights><updated>2012-07-04T23:31:02+00:00</updated></info><style-options punctuation-in-quote="false"/><date form="text"><date-part name="day" form="ordinal" suffix=" "/><date-part name="month" suffix=" "/><date-part name="year"/></date><date form="numeric"><date-part name="day" form="numeric-leading-zeros" suffix="."/><date-part name="month" form="numeric-leading-zeros" suffix="."/><date-part name="year"/></date><terms><term name="accessed">zugegriffen</term><term name="and">und</term><term name="and others">und andere</term><term name="anonymous">ohne Autor</term><term name="anonymous" form="short">o.&#160;A.</term><term name="at">auf</term><term name="available at">verf\xFCgbar unter</term><term name="by">von</term><term name="circa">circa</term><term name="circa" form="short">ca.</term><term name="cited">zitiert</term><term name="edition"><single>Auflage</single><multiple>Auflagen</multiple></term><term name="edition" form="short">Aufl.</term><term name="et-al">u.&#160;a.</term><term name="forthcoming">i.&#160;E.</term><term name="from">von</term><term name="ibid">ebd.</term><term name="in">in</term><term name="in press">im Druck</term><term name="internet">Internet</term><term name="interview">Interview</term><term name="letter">Brief</term><term name="no date">ohne Datum</term><term name="no date" form="short">o.&#160;J.</term><term name="online">online</term><term name="presented at">gehalten auf der</term><term name="reference"><single>Referenz</single><multiple>Referenzen</multiple></term><term name="reference" form="short"><single>Ref.</single><multiple>Ref.</multiple></term><term name="retrieved">abgerufen</term><term name="scale">Ma\xDFstab</term><term name="version">Version</term><term name="ad">n.&#160;Chr.</term><term name="bc">v.&#160;Chr.</term><term name="open-quote">\u201E</term><term name="close-quote">\u201C</term><term name="open-inner-quote">\u201A</term><term name="close-inner-quote">\u2018</term><term name="page-range-delimiter">\u2013</term><term name="ordinal">.</term><term name="long-ordinal-01">erster</term><term name="long-ordinal-02">zweiter</term><term name="long-ordinal-03">dritter</term><term name="long-ordinal-04">vierter</term><term name="long-ordinal-05">f\xFCnfter</term><term name="long-ordinal-06">sechster</term><term name="long-ordinal-07">siebter</term><term name="long-ordinal-08">achter</term><term name="long-ordinal-09">neunter</term><term name="long-ordinal-10">zehnter</term><term name="book"><single>Buch</single><multiple>B\xFCcher</multiple></term><term name="chapter"><single>Kapitel</single><multiple>Kapitel</multiple></term><term name="column"><single>Spalte</single><multiple>Spalten</multiple></term><term name="figure"><single>Abbildung</single><multiple>Abbildungen</multiple></term><term name="folio"><single>Blatt</single><multiple>Bl\xE4tter</multiple></term><term name="issue"><single>Nummer</single><multiple>Nummern</multiple></term><term name="line"><single>Zeile</single><multiple>Zeilen</multiple></term><term name="note"><single>Note</single><multiple>Noten</multiple></term><term name="opus"><single>Opus</single><multiple>Opera</multiple></term><term name="page"><single>Seite</single><multiple>Seiten</multiple></term><term name="number-of-pages"><single>Seite</single><multiple>Seiten</multiple></term><term name="paragraph"><single>Absatz</single><multiple>Abs\xE4tze</multiple></term><term name="part"><single>Teil</single><multiple>Teile</multiple></term><term name="section"><single>Abschnitt</single><multiple>Abschnitte</multiple></term><term name="sub verbo"><single>sub verbo</single><multiple>sub verbis</multiple></term><term name="verse"><single>Vers</single><multiple>Verse</multiple></term><term name="volume"><single>Band</single><multiple>B\xE4nde</multiple></term><term name="book" form="short">B.</term>
<term name="chapter" form="short">Kap.</term><term name="column" form="short">Sp.</term><term name="figure" form="short">Abb.</term><term name="folio" form="short">Fol.</term><term name="issue" form="short">Nr.</term><term name="line" form="short">Z.</term><term name="note" form="short">N.</term><term name="opus" form="short">op.</term><term name="page" form="short"><single>S.</single><multiple>S.</multiple></term><term name="number-of-pages" form="short"><single>S.</single><multiple>S.</multiple></term><term name="paragraph" form="short">Abs.</term><term name="part" form="short">Teil</term><term name="section" form="short">Abschn.</term><term name="sub verbo" form="short"><single>s.&#160;v.</single><multiple>s.&#160;vv.</multiple></term><term name="verse" form="short"><single>V.</single><multiple>V.</multiple></term><term name="volume" form="short"><single>Bd.</single><multiple>Bde.</multiple></term><term name="paragraph" form="symbol"><single>\xB6</single><multiple>\xB6\xB6</multiple></term><term name="section" form="symbol"><single>\xA7</single><multiple>\xA7\xA7</multiple></term><term name="director"><single>Regisseur</single><multiple>Regisseure</multiple></term><term name="editor"><single>Herausgeber</single><multiple>Herausgeber</multiple></term><term name="collection-editor"><single>Reihenherausgeber</single><multiple>Reihenherausgeber</multiple></term><term name="editorial-director"><single>Herausgeber</single><multiple>Herausgeber</multiple></term><term name="illustrator"><single>Illustrator</single><multiple>Illustratoren</multiple></term><term name="translator"><single>\xDCbersetzer</single><multiple>\xDCbersetzer</multiple></term><term name="editortranslator"><single>Herausgeber&#160;&amp; \xDCbersetzer</single><multiple>Herausgeber&#160;&amp; \xDCbersetzer</multiple></term><term name="director" form="short"><single>Reg.</single><multiple>Reg.</multiple></term><term name="editor" form="short"><single>Hrsg.</single><multiple>Hrsg.</multiple></term><term name="collection-editor" form="short"><single>Hrsg.</single><multiple>Hrsg.</multiple></term><term name="editorial-director" form="short"><single>Hrsg.</single><multiple>Hrsg.</multiple></term><term name="illustrator" form="short"><single>Ill.</single><multiple>Ill.</multiple></term><term name="translator" form="short"><single>\xDCbers.</single><multiple>\xDCbers.</multiple></term><term name="editortranslator" form="short"><single>Hrsg.&#160;&amp; \xDCbers.</single><multiple>Hrsg.&#160;&amp; \xDCbers</multiple></term><term name="container-author" form="verb">von</term><term name="director" form="verb">Regie von</term><term name="editor" form="verb">herausgegeben von</term><term name="collection-editor" form="verb">herausgegeben von</term><term name="editorial-director" form="verb">herausgegeben von</term><term name="illustrator" form="verb">illustriert von</term><term name="interviewer" form="verb">interviewt von</term><term name="recipient" form="verb">an</term><term name="reviewed-author" form="verb">von</term><term name="translator" form="verb">\xFCbersetzt von</term><term name="editortranslator" form="verb">herausgegeben und \xFCbersetzt von</term><term name="director" form="verb-short">Reg.</term><term name="editor" form="verb-short">hg. von</term><term name="collection-editor" form="verb-short">hg. von</term><term name="editorial-director" form="verb-short">hg. von</term><term name="illustrator" form="verb-short">illus. von</term><term name="translator" form="verb-short">\xFCbers. von</term><term name="editortranslator" form="verb-short">hg.&#160;&amp; \xFCbers. von</term><term name="month-01">Januar</term><term name="month-02">Februar</term><term name="month-03">M\xE4rz</term><term name="month-04">April</term><term name="month-05">Mai</term><term name="month-06">Juni</term><term name="month-07">Juli</term><term name="month-08">August</term><term name="month-09">September</term><term name="month-10">Oktober</term><term name="month-11">November</term><term name="month-12">Dezember</term><term name="month-01" form="short">Jan.</term><term name="month-02" form="short">Feb.</term>
<term name="month-03" form="short">M\xE4rz</term><term name="month-04" form="short">Apr.</term><term name="month-05" form="short">Mai</term><term name="month-06" form="short">Juni</term><term name="month-07" form="short">Juli</term><term name="month-08" form="short">Aug.</term><term name="month-09" form="short">Sep.</term><term name="month-10" form="short">Okt.</term><term name="month-11" form="short">Nov.</term><term name="month-12" form="short">Dez.</term><term name="season-01">Fr\xFChjahr</term><term name="season-02">Sommer</term><term name="season-03">Herbst</term><term name="season-04">Winter</term></terms></locale>`,"es-ES":`<?xml version="1.0" encoding="utf-8"?><locale xmlns="http://purl.org/net/xbiblio/csl" version="1.0" xml:lang="es-ES"><info><rights license="http://creativecommons.org/licenses/by-sa/3.0/">This work is licensed under a Creative Commons Attribution-ShareAlike 3.0 License</rights><updated>2012-07-04T23:31:02+00:00</updated></info><style-options punctuation-in-quote="false"/><date form="text"><date-part name="day" suffix=" de "/><date-part name="month" suffix=" de "/><date-part name="year"/></date><date form="numeric"><date-part name="day" form="numeric-leading-zeros" suffix="/"/><date-part name="month" form="numeric-leading-zeros" suffix="/"/><date-part name="year"/></date><terms><term name="accessed">accedido</term><term name="and">y</term><term name="and others">y otros</term><term name="anonymous">an\xF3nimo</term><term name="anonymous" form="short">an\xF3n.</term><term name="at">en</term><term name="available at">disponible en</term><term name="by">de</term><term name="circa">circa</term><term name="circa" form="short">c.</term><term name="cited">citado</term><term name="edition"><single>edici\xF3n</single><multiple>ediciones</multiple></term><term name="edition" form="short">ed.</term><term name="et-al">et&#160;al.</term><term name="forthcoming">previsto</term><term name="from">a partir de</term><term name="ibid">ibid.</term><term name="in">en</term><term name="in press">en imprenta</term><term name="internet">internet</term><term name="interview">entrevista</term><term name="letter">carta</term><term name="no date">sin fecha</term><term name="no date" form="short">s.&#160;f.</term><term name="online">en l\xEDnea</term><term name="presented at">presentado en</term><term name="reference"><single>referencia</single><multiple>referencias</multiple></term><term name="reference" form="short"><single>ref.</single><multiple>refs.</multiple></term><term name="retrieved">recuperado</term><term name="scale">escala</term><term name="version">versi\xF3n</term><term name="ad">d.&#160;C.</term><term name="bc">a.&#160;C.</term><term name="open-quote">\xAB</term><term name="close-quote">\xBB</term><term name="open-inner-quote">\u201C</term><term name="close-inner-quote">\u201D</term><term name="page-range-delimiter">-</term><term name="ordinal">.\xAA</term><term name="long-ordinal-01">primera</term><term name="long-ordinal-02">segunda</term><term name="long-ordinal-03">tercera</term><term name="long-ordinal-04">cuarta</term><term name="long-ordinal-05">quinta</term><term name="long-ordinal-06">sexta</term><term name="long-ordinal-07">s\xE9ptima</term><term name="long-ordinal-08">octava</term><term name="long-ordinal-09">novena</term><term name="long-ordinal-10">d\xE9cima</term><term name="book"><single>libro</single><multiple>libros</multiple></term><term name="chapter"><single>cap\xEDtulo</single><multiple>cap\xEDtulos</multiple></term><term name="column"><single>columna</single><multiple>columnas</multiple></term><term name="figure"><single>figura</single><multiple>figuras</multiple></term><term name="folio"><single>folio</single><multiple>folios</multiple></term><term name="issue"><single>n\xFAmero</single><multiple>n\xFAmeros</multiple></term><term name="line"><single>l\xEDnea</single><multiple>l\xEDneas</multiple></term><term name="note"><single>nota</single><multiple>notas</multiple></term><term name="opus"><single>opus</single><multiple>opera</multiple></term><term name="page"><single>p\xE1gina</single><multiple>p\xE1ginas</multiple></term><term name="number-of-pages"><single>p\xE1gina</single><multiple>p\xE1ginas</multiple></term><term name="paragraph"><single>p\xE1rrafo</single><multiple>p\xE1rrafos</multiple></term><term name="part"><single>parte</single><multiple>partes</multiple></term><term name="section"><single>secci\xF3n</single><multiple>secciones</multiple></term><term name="sub verbo"><single>sub voce</single><multiple>sub vocibus</multiple></term><term name="verse"><single>verso</single><multiple>versos</multiple></term><term name="volume"><single>volumen</single><multiple>vol\xFAmenes</multiple></term><term name="book" form="short">lib.</term>
<term name="chapter" form="short">cap.</term><term name="column" form="short">col.</term><term name="figure" form="short">fig.</term><term name="folio" form="short">f.</term><term name="issue" form="short">n.\xBA</term><term name="line" form="short">l.</term><term name="note" form="short">n.</term><term name="opus" form="short">op.</term><term name="page" form="short"><single>p.</single><multiple>pp.</multiple></term><term name="number-of-pages" form="short"><single>p.</single><multiple>pp.</multiple></term><term name="paragraph" form="short">p\xE1rr.</term><term name="part" form="short">pt.</term><term name="section" form="short">sec.</term><term name="sub verbo" form="short"><single>s.&#160;v.</single><multiple>s.&#160;vv.</multiple></term><term name="verse" form="short"><single>v.</single><multiple>vv.</multiple></term><term name="volume" form="short"><single>vol.</single><multiple>vols.</multiple></term><term name="paragraph" form="symbol"><single>\xA7</single><multiple>\xA7</multiple></term><term name="section" form="symbol"><single>\xA7</single><multiple>\xA7</multiple></term><term name="director"><single>director</single><multiple>directores</multiple></term><term name="editor"><single>editor</single><multiple>editores</multiple></term><term name="editorial-director"><single>editor</single><multiple>editores</multiple></term><term name="illustrator"><single>ilustrador</single><multiple>ilustradores</multiple></term><term name="translator"><single>traductor</single><multiple>traductores</multiple></term><term name="editortranslator"><single>editor y traductor</single><multiple>editores y traductores</multiple></term><term name="director" form="short"><single>dir.</single><multiple>dirs.</multiple></term><term name="editor" form="short"><single>ed.</single><multiple>eds.</multiple></term><term name="editorial-director" form="short"><single>ed.</single><multiple>eds.</multiple></term><term name="illustrator" form="short"><single>ilust.</single><multiple>ilusts.</multiple></term><term name="translator" form="short"><single>trad.</single><multiple>trads.</multiple></term><term name="editortranslator" form="short"><single>ed. y trad.</single><multiple>eds. y trads.</multiple></term><term name="container-author" form="verb">de</term><term name="director" form="verb">dirigido por</term><term name="editor" form="verb">editado por</term><term name="editorial-director" form="verb">editado por</term><term name="illustrator" form="verb">ilustrado por</term><term name="interviewer" form="verb">entrevistado por</term><term name="recipient" form="verb">a</term><term name="reviewed-author" form="verb">por</term><term name="translator" form="verb">traducido por</term><term name="editortranslator" form="verb">editado y traducido por</term><term name="director" form="verb-short">dir.</term><term name="editor" form="verb-short">ed.</term><term name="editorial-director" form="verb-short">ed.</term><term name="illustrator" form="verb-short">ilust.</term><term name="translator" form="verb-short">trad.</term><term name="editortranslator" form="verb-short">ed. y trad.</term><term name="month-01">enero</term><term name="month-02">febrero</term><term name="month-03">marzo</term><term name="month-04">abril</term><term name="month-05">mayo</term><term name="month-06">junio</term><term name="month-07">julio</term><term name="month-08">agosto</term><term name="month-09">septiembre</term><term name="month-10">octubre</term><term name="month-11">noviembre</term><term name="month-12">diciembre</term><term name="month-01" form="short">ene.</term><term name="month-02" form="short">feb.</term><term name="month-03" form="short">mar.</term><term name="month-04" form="short">abr.</term><term name="month-05" form="short">may</term><term name="month-06" form="short">jun.</term><term name="month-07" form="short">jul.</term><term name="month-08" form="short">ago.</term><term name="month-09" form="short">sep.</term><term name="month-10" form="short">oct.</term><term name="month-11" form="short">nov.</term><term name="month-12" form="short">
dic.</term><term name="season-01">primavera</term><term name="season-02">verano</term><term name="season-03">oto\xF1o</term><term name="season-04">invierno</term></terms></locale>`}});var Xn=R(Qr=>{"use strict";Object.defineProperty(Qr,"__esModule",{value:!0});Qr.locales=Qr.default=void 0;var Z0=me(),e1=t1(_p());function t1(e){return e&&e.__esModule?e:{default:e}}var Ls=new Z0.util.Register(e1.default);Qr.locales=Ls;var r1=e=>Ls.has(e)?Ls.get(e):Ls.get("en-US"),i1=r1;Qr.default=i1});var Ep=R((vT,s1)=>{s1.exports={apa:'<?xml version="1.0" encoding="utf-8"?><style xmlns="http://purl.org/net/xbiblio/csl" class="in-text" version="1.0" demote-non-dropping-particle="never" page-range-format="expanded"><info><title>American Psychological Association 7th edition</title><title-short>APA</title-short><id>http://www.zotero.org/styles/apa</id><link href="http://www.zotero.org/styles/apa" rel="self"/><link href="http://www.zotero.org/styles/apa-6th-edition" rel="template"/><link href="https://apastyle.apa.org/style-grammar-guidelines/references/examples" rel="documentation"/><author><name>Brenton M. Wiernik</name><email>zotero@wiernik.org</email></author><category citation-format="author-date"/><category field="psychology"/><category field="generic-base"/><updated>2019-12-04T13:09:49+00:00</updated><rights license="http://creativecommons.org/licenses/by-sa/3.0/">This work is licensed under a Creative Commons Attribution-ShareAlike 3.0 License</rights></info><locale xml:lang="en"><terms><term name="editortranslator" form="short"><single>ed. &amp; trans.</single><multiple>eds. &amp; trans.</multiple></term><term name="translator" form="short">trans.</term><term name="interviewer" form="short"><single>interviewer</single><multiple>interviewers</multiple></term><term name="collection-editor" form="short"><single>ed.</single><multiple>eds.</multiple></term><term name="circa" form="short">ca.</term><term name="bc"> B.C.E.</term><term name="ad"> C.E.</term><term name="letter">personal communication</term><term name="letter" form="short">letter</term><term name="issue" form="long"><single>issue</single><multiple>issues</multiple></term></terms></locale><locale xml:lang="af"><terms><term name="letter">persoonlike kommunikasie</term><term name="letter" form="short">brief</term></terms></locale><locale xml:lang="ar"><terms><term name="letter">\u0627\u062A\u0635\u0627\u0644 \u0634\u062E\u0635\u064A</term><term name="letter" form="short">\u062E\u0637\u0627\u0628</term></terms></locale><locale xml:lang="da"><terms><term name="et-al">et al.</term><term name="letter">personlig kommunikation</term><term name="letter" form="short">brev</term></terms></locale><locale xml:lang="de"><terms><term name="et-al">et al.</term><term name="letter">pers\xF6nliche Kommunikation</term><term name="letter" form="short">Brief</term></terms></locale><locale xml:lang="es"><terms><term name="from">de</term><term name="letter">comunicaci\xF3n personal</term><term name="letter" form="short">carta</term></terms></locale><locale xml:lang="fr"><terms><term name="letter">communication personnelle</term><term name="letter" form="short">lettre</term><term name="editor" form="short"><single>\xE9d.</single><multiple>\xE9ds.</multiple></term></terms></locale><locale xml:lang="nb"><terms><term name="et-al">et al.</term><term name="letter">personlig kommunikasjon</term><term name="letter" form="short">brev</term></terms></locale><locale xml:lang="nl"><terms><term name="et-al">et al.</term><term name="letter">persoonlijke communicatie</term><term name="letter" form="short">brief</term></terms></locale><locale xml:lang="nn"><terms><term name="et-al">et al.</term><term name="letter">personlig kommunikasjon</term><term name="letter" form="short">brev</term></terms></locale><locale xml:lang="ru"><terms><term name="letter">\u043B\u0438\u0447\u043D\u0430\u044F \u043F\u0435\u0440\u0435\u043F\u0438\u0441\u043A\u0430</term><term name="letter" form="short">\u043F\u0438\u0441\u044C\u043C\u043E</term></terms></locale><locale xml:lang="tr"><terms><term name="letter">ki\u015Fisel ileti\u015Fim</term><term name="letter" form="short">mektup</term></terms></locale><macro name="author-bib"><names variable="composer" delimiter=", "><name name-as-sort-order="all" and="symbol" sort-separator=", " initialize-with=". " delimiter=", " delimiter-precedes-last="always"/><substitute><names variable="author"/><names variable="illustrator"/><names variable="director"><name name-as-sort-order="all" and="symbol" sort-separator=", " initialize-with=". " delimiter=", " delimiter-precedes-last="always"/><label form="long" prefix=" (" suffix=")" text-case="title"/></names><choose><if variable="container-title"><choose><if type="book entry entry-dictionary entry-encyclopedia" match="any"><choose><if variable="title"><group delimiter=" "><text macro="title"/><text macro="parenthetical"/></group></if><else><text macro="title-and-descriptions"/></else></choose></if></choose></if></choose><names variable="editor" delimiter=", "><name name-as-sort-order="all" and="symbol" sort-separator=", " initialize-with=". " delimiter=", " delimiter-precedes-last="always"/><label form="short" prefix=" (" suffix=")" text-case="title"/></names><names variable="editorial-director"><name name-as-sort-order="all" and="symbol" sort-separator=", " initialize-with=". " delimiter=", " delimiter-precedes-last="always"/><label form="short" prefix=" (" suffix=")" text-case="title"/></names><names variable="collection-editor"><name name-as-sort-order="all" and="symbol" sort-separator=", " initialize-with=". " delimiter=", " delimiter-precedes-last="always"/><label form="short" prefix=" (" suffix=")" text-case="title"/></names><choose><if variable="title"><group delimiter=" "><text macro="title"/><text macro="parenthetical"/></group></if><else><text macro="title-and-descriptions"/></else></choose></substitute></names></macro><macro name="author-intext"><choose><if type="bill legal_case legislation treaty" match="any"><text macro="title-intext"/></if><else-if type="interview personal_communication"><choose><if variable="archive container-title DOI publisher URL" match="none"><group delimiter=", "><names variable="author"><name and="symbol" delimiter=", " initialize-with=". "/><substitute><text macro="title-intext"/></substitute></names><text term="letter"/></group></if><else><names variable="author" delimiter=", "><name form="short" and="symbol" delimiter=", " initialize-with=". "/><substitute><text macro="title-intext"/></substitute></names></else></choose></else-if><else><names variable="composer" delimiter=", "><name form="short" and="symbol" delimiter=", " initialize-with=". "/><substitute><names variable="author"/><names variable="illustrator"/><names variable="director"/><choose><if variable="container-title"><choose><if type="book entry entry-dictionary entry-encyclopedia" match="any"><text macro="title-intext"/></if></choose></if></choose><names variable="editor"/><names variable="editorial-director"/><text macro="title-intext"/></substitute></names></else></choose></macro><macro name="date-bib"><group delimiter=" " prefix="(" suffix=")"><choose><if is-uncertain-date="issued"><text term="circa" form="short"/></if></choose><group><choose><if variable="issued"><date variable="issued"><date-part name="year"/></date><text variable="year-suffix"/><choose><if type="article-magazine article-newspaper broadcast interview motion_picture pamphlet personal_communication post post-weblog song speech webpage" match="any"><date variable="issued"><date-part prefix=", " name="month"/><date-part prefix=" " name="day"/></date></if><else-if type="paper-conference"><choose><if variable="collection-editor editor editorial-director issue page volume" match="none"><date variable="issued"><date-part prefix=", " name="month"/><date-part prefix=" " name="day"/></date></if></choose></else-if></choose></if><else-if variable="status"><group><text variable="status" text-case="lowercase"/><text variable="year-suffix" prefix="-"/></group></else-if><else><group><text term="no date" form="short"/><text variable="year-suffix" prefix="-"/></group></else></choose></group></group></macro><macro name="date-sort-group"><choose><if variable="issued"><text value="1"/></if><else-if variable="status"><text value="2"/></else-if><else><text value="0"/></else></choose></macro><macro name="date-sort-date"><choose><if type="article-magazine article-newspaper broadcast interview pamphlet personal_communication post post-weblog speech treaty webpage" match="any"><date variable="issued" form="numeric"/></if><else-if type="paper-conference"><choose><if variable="collection-editor editor editorial-director issue page volume" match="none"><date variable="issued" form="numeric"/></if></choose></else-if><else><date variable="issued" form="numeric"/></else></choose></macro><macro name="date-intext"><choose><if variable="issued"><group delimiter="/"><group delimiter=" "><choose><if is-uncertain-date="original-date"><text term="circa" form="short"/></if></choose><date variable="original-date"><date-part name="year"/></date></group><group delimiter=" "><choose><if is-uncertain-date="issued"><text term="circa" form="short"/></if></choose><group><choose><if type="interview personal_communication"><choose><if variable="archive container-title DOI publisher URL" match="none"><date variable="issued" form="text"/></if><else><date variable="issued"><date-part name="year"/></date></else></choose></if><else><date variable="issued"><date-part name="year"/></date></else></choose><text variable="year-suffix"/></group></group></group></if><else-if variable="status"><text variable="status" text-case="lowercase"/><text variable="year-suffix" prefix="-"/></else-if><else><text term="no date" form="short"/><text variable="year-suffix" prefix="-"/></else></choose></macro><macro name="title-and-descriptions"><choose><if variable="title"><group delimiter=" "><text macro="title"/><text macro="parenthetical"/><text macro="bracketed"/></group></if><else><group delimiter=" "><text macro="bracketed"/><text macro="parenthetical"/></group></else></choose></macro><macro name="title"><choose><if type="post webpage" match="any"><text variable="title" font-style="italic"/></if><else-if variable="container-title" match="any"><text variable="title"/></else-if><else><choose><if type="article-journal article-magazine article-newspaper post-weblog review review-book"><text variable="title" font-style="italic"/></if><else-if type="paper-conference"><choose><if variable="collection-editor editor editorial-director" match="any"><group delimiter=": " font-style="italic"><text variable="title"/><choose><if is-numeric="volume" match="none"><group delimiter=" "><label variable="volume" form="short" text-case="capitalize-first"/><text variable="volume"/></group></if></choose></group></if><else><text variable="title" font-style="italic"/></else></choose></else-if><else><group delimiter=": " font-style="italic"><text variable="title"/><choose><if is-numeric="volume" match="none"><group delimiter=" "><label variable="volume" form="short" text-case="capitalize-first"/><text variable="volume"/></group></if></choose></group></else></choose></else></choose></macro><macro name="title-intext"><choose><if variable="title" match="none"><text macro="bracketed-intext" prefix="[" suffix="]"/></if><else-if type="bill"><choose><if variable="number container-title" match="none"><text variable="title" form="short" font-style="italic" text-case="title"/></if><else-if variable="title"><text variable="title" form="short" text-case="title"/></else-if><else><group delimiter=" "><text variable="genre"/><group delimiter=" "><choose><if variable="chapter-number container-title" match="none"><text term="issue" form="short"/></if></choose><text variable="number"/></group></group></else></choose></else-if><else-if type="legal_case" match="any"><text variable="title" font-style="italic"/></else-if><else-if type="legislation treaty" match="any"><text variable="title" form="short" text-case="title"/></else-if><else-if type="post webpage" match="any"><text variable="title" form="short" font-style="italic" text-case="title"/></else-if><else-if variable="container-title" match="any"><text variable="title" form="short" quotes="true" text-case="title"/></else-if><else><text variable="title" form="short" font-style="italic" text-case="title"/></else></choose></macro><macro name="parenthetical"><group prefix="(" suffix=")"><choose><if type="patent"><group delimiter=" "><text variable="authority" form="short"/><choose><if variable="genre"><text variable="genre" text-case="capitalize-first"/></if><else><text value="patent" text-case="capitalize-first"/></else></choose><group delimiter=" "><text term="issue" form="short" text-case="capitalize-first"/><text variable="number"/></group></group></if><else-if type="post webpage"><group delimiter="; "><text macro="secondary-contributors"/><text macro="database-location"/><text macro="number"/><text macro="locators-booklike"/></group></else-if><else-if variable="container-title"><group delimiter="; "><text macro="secondary-contributors"/><choose><if type="broadcast graphic map motion_picture song" match="any"><text macro="number"/></if></choose></group></else-if><else><group delimiter="; "><text macro="secondary-contributors"/><text macro="database-location"/><text macro="number"/><text macro="locators-booklike"/></group></else></choose></group></macro><macro name="parenthetical-container"><choose><if variable="container-title" match="any"><group prefix="(" suffix=")"><group delimiter="; "><text macro="database-location"/><choose><if type="broadcast graphic map motion_picture song" match="none"><text macro="number"/></if></choose><text macro="locators-booklike"/></group></group></if></choose></macro><macro name="bracketed"><group prefix="[" suffix="]"><choose><if variable="reviewed-author reviewed-title" type="review review-book" match="any"><group delimiter="; "><group delimiter=", "><group delimiter=" "><choose><if variable="number" match="none"><choose><if variable="genre"><text variable="genre" text-case="capitalize-first"/></if><else-if variable="medium"><text variable="medium" text-case="capitalize-first"/></else-if><else><text value="Review of"/></else></choose></if><else><choose><if variable="medium"><text variable="medium" text-case="capitalize-first"/></if><else><text value="Review of"/></else></choose></else></choose><text macro="reviewed-title"/></group><names variable="reviewed-author"><label form="verb-short" suffix=" "/><name and="symbol" initialize-with=". " delimiter=", "/></names></group><choose><if variable="genre" match="any"><choose><if variable="number" match="none"><text variable="medium" text-case="capitalize-first"/></if></choose></if></choose></group></if><else-if type="thesis"><group delimiter="; "><choose><if variable="number" match="none"><group delimiter=", "><text variable="genre" text-case="capitalize-first"/><choose><if variable="archive DOI URL" match="any"><text variable="publisher"/></if></choose></group></if></choose><text variable="medium" text-case="capitalize-first"/></group></else-if><else-if variable="interviewer" type="interview" match="any"><choose><if variable="title"><text macro="format"/></if><else-if variable="genre"><group delimiter="; "><group delimiter=" "><text variable="genre" text-case="capitalize-first"/><group delimiter=" "><text term="author" form="verb"/><names variable="interviewer"><name and="symbol" initialize-with=". " delimiter=", "/></names></group></group></group></else-if><else-if variable="interviewer"><group delimiter="; "><names variable="interviewer"><label form="verb" suffix=" " text-case="capitalize-first"/><name and="symbol" initialize-with=". " delimiter=", "/></names><text variable="medium" text-case="capitalize-first"/></group></else-if><else><text macro="format"/></else></choose></else-if><else-if type="personal_communication"><choose><if variable="recipient"><group delimiter="; "><group delimiter=" "><choose><if variable="number" match="none"><choose><if variable="genre"><text variable="genre" text-case="capitalize-first"/></if><else-if variable="medium"><text variable="medium" text-case="capitalize-first"/></else-if><else><text term="letter" form="short" text-case="capitalize-first"/></else></choose></if><else><choose><if variable="medium"><text variable="medium" text-case="capitalize-first"/></if><else><text term="letter" form="short" text-case="capitalize-first"/></else></choose></else></choose><names variable="recipient" delimiter=", "><label form="verb" suffix=" "/><name and="symbol" delimiter=", "/></names></group><choose><if variable="genre" match="any"><choose><if variable="number" match="none"><text variable="medium" text-case="capitalize-first"/></if></choose></if></choose></group></if><else><text macro="format"/></else></choose></else-if><else-if variable="composer" type="song" match="all"><group delimiter="; "><choose><if variable="number" match="none"><group delimiter=" "><choose><if variable="genre"><text variable="genre" text-case="capitalize-first"/><names variable="author" prefix="recorded by "><name and="symbol" initialize-with=". " delimiter=", "/></names></if><else-if variable="medium"><text variable="medium" text-case="capitalize-first"/><names variable="author" prefix="recorded by "><name and="symbol" initialize-with=". " delimiter=", "/></names></else-if><else><names variable="author" prefix="Recorded by "><name and="symbol" initialize-with=". " delimiter=", "/></names></else></choose></group></if><else><group delimiter=" "><choose><if variable="medium"><text variable="medium" text-case="capitalize-first"/><names variable="author" prefix="recorded by "><name and="symbol" initialize-with=". " delimiter=", "/></names></if><else><names variable="author" prefix="Recorded by "><name and="symbol" initialize-with=". " delimiter=", "/></names></else></choose></group></else></choose><choose><if variable="genre" match="any"><choose><if variable="number" match="none"><text variable="medium" text-case="capitalize-first"/></if></choose></if></choose></group></else-if><else-if variable="container-title" match="none"><text macro="format"/></else-if><else><choose><if type="paper-conference speech" match="any"><choose><if variable="collection-editor editor editorial-director issue page volume" match="any"><text macro="format"/></if></choose></if><else-if type="book"><choose><if variable="version" match="none"><text macro="format"/></if></choose></else-if><else-if type="report" match="none"><text macro="format"/></else-if></choose></else></choose></group></macro><macro name="bracketed-intext"><group prefix="[" suffix="]"><choose><if variable="reviewed-author reviewed-title" type="review review-book" match="any"><text macro="reviewed-title-intext" prefix="Review of "/></if><else-if variable="interviewer" type="interview" match="any"><names variable="interviewer"><label form="verb" suffix=" " text-case="capitalize-first"/><name and="symbol" initialize-with=". " delimiter=", "/><substitute><text macro="format-intext"/></substitute></names></else-if><else-if type="personal_communication"><choose><if variable="recipient"><group delimiter=" "><choose><if variable="number" match="none"><text variable="genre" text-case="capitalize-first"/></if><else><text term="letter" form="short" text-case="capitalize-first"/></else></choose><names variable="recipient" delimiter=", "><label form="verb" suffix=" "/><name and="symbol" delimiter=", "/></names></group></if><else><text macro="format-intext"/></else></choose></else-if><else><text macro="format-intext"/></else></choose></group></macro><macro name="bracketed-container"><group prefix="[" suffix="]"><choose><if type="paper-conference speech" match="any"><choose><if variable="collection-editor editor editorial-director issue page volume" match="none"><text macro="format"/></if></choose></if><else-if type="book" variable="version" match="all"><text macro="format"/></else-if><else-if type="report"><text macro="format"/></else-if></choose></group></macro><macro name="secondary-contributors"><choose><if type="article-journal article-magazine article-newspaper post-weblog review review-book" match="any"><text macro="secondary-contributors-periodical"/></if><else-if type="paper-conference"><choose><if variable="collection-editor editor editorial-director" match="any"><text macro="secondary-contributors-booklike"/></if><else><text macro="secondary-contributors-periodical"/></else></choose></else-if><else><text macro="secondary-contributors-booklike"/></else></choose></macro><macro name="secondary-contributors-periodical"><group delimiter="; "><choose><if variable="title"><names variable="interviewer" delimiter="; "><name and="symbol" initialize-with=". " delimiter=", "/><label form="short" prefix=", " text-case="title"/></names></if></choose><names variable="translator" delimiter="; "><name and="symbol" initialize-with=". " delimiter=", "/><label form="short" prefix=", " text-case="title"/></names></group></macro><macro name="secondary-contributors-booklike"><group delimiter="; "><choose><if variable="title"><names variable="interviewer"><name and="symbol" initialize-with=". " delimiter=", "/><label form="short" prefix=", " text-case="title"/></names></if></choose><choose><if type="post webpage" match="none"><choose><if variable="container-title" match="none"><group delimiter="; "><names variable="container-author"><label form="verb-short" suffix=" " text-case="title"/><name and="symbol" initialize-with=". " delimiter=", "/></names><names variable="editor translator" delimiter="; "><name and="symbol" initialize-with=". " delimiter=", "/><label form="short" prefix=", " text-case="title"/></names></group></if></choose></if><else><group delimiter="; "><names variable="container-author"><label form="verb-short" suffix=" " text-case="title"/><name and="symbol" initialize-with=". " delimiter=", "/></names><names variable="editor translator" delimiter="; "><name and="symbol" initialize-with=". " delimiter=", "/><label form="short" prefix=", " text-case="title"/></names></group></else></choose></group></macro><macro name="database-location"><choose><if variable="archive-place" match="none"><text variable="archive_location"/></if></choose></macro><macro name="number"><choose><if variable="number"><group delimiter=", "><group delimiter=" "><text variable="genre" text-case="title"/><choose><if is-numeric="number"><text term="issue" form="short" text-case="capitalize-first"/><text variable="number"/></if><else><text variable="number"/></else></choose></group><choose><if type="thesis"><choose><if variable="archive DOI URL" match="any"><text variable="publisher"/></if></choose></if></choose></group></if></choose></macro><macro name="locators-booklike"><choose><if type="article-journal article-magazine article-newspaper broadcast interview patent post post-weblog review review-book speech webpage" match="any"/><else-if type="paper-conference"><choose><if variable="collection-editor editor editorial-director" match="any"><group delimiter=", "><text macro="version"/><text macro="edition"/><text macro="volume-booklike"/></group></if></choose></else-if><else><group delimiter=", "><text macro="version"/><text macro="edition"/><text macro="volume-booklike"/></group></else></choose></macro><macro name="version"><choose><if is-numeric="version"><group delimiter=" "><text term="version" text-case="capitalize-first"/><text variable="version"/></group></if><else><text variable="version"/></else></choose></macro><macro name="edition"><choose><if is-numeric="edition"><group delimiter=" "><number variable="edition" form="ordinal"/><label variable="edition" form="short"/></group></if><else><text variable="edition"/></else></choose></macro><macro name="volume-booklike"><group delimiter=", "><choose><if type="report"><group delimiter=" "><text variable="collection-title" text-case="title"/><text variable="collection-number"/></group></if></choose><choose><if variable="volume" match="any"><choose><if is-numeric="volume" match="none"/><else><group delimiter=" "><label variable="volume" form="short" text-case="capitalize-first"/><number variable="volume" form="numeric"/></group></else></choose></if><else><group><text term="volume" form="short" text-case="capitalize-first" suffix=" "/><text term="page-range-delimiter" prefix="1"/><number variable="number-of-volumes" form="numeric"/></group></else></choose><group delimiter=" "><label variable="issue" text-case="capitalize-first"/><text variable="issue"/></group><group delimiter=" "><label variable="page" form="short" suffix=" "/><text variable="page"/></group></group></macro><macro name="reviewed-title"><choose><if variable="reviewed-title"><text variable="reviewed-title" font-style="italic"/></if><else><text variable="title" font-style="italic"/></else></choose></macro><macro name="reviewed-title-intext"><choose><if variable="reviewed-title"><text variable="reviewed-title" form="short" font-style="italic" text-case="title"/></if><else><text variable="title" form="short" font-style="italic" text-case="title"/></else></choose></macro><macro name="format"><choose><if variable="genre medium" match="any"><group delimiter="; "><choose><if variable="number" match="none"><text variable="genre" text-case="capitalize-first"/></if></choose><text variable="medium" text-case="capitalize-first"/></group></if><else-if type="dataset"><text value="Data set"/></else-if><else-if type="book" variable="version" match="all"><text value="Computer software"/></else-if><else-if type="interview personal_communication" match="any"><choose><if variable="archive container-title DOI publisher URL" match="none"><text term="letter" text-case="capitalize-first"/></if><else-if type="interview"><text term="interview" text-case="capitalize-first"/></else-if></choose></else-if><else-if type="map"><text value="Map"/></else-if></choose></macro><macro name="format-intext"><choose><if variable="genre" match="any"><text variable="genre" text-case="capitalize-first"/></if><else-if variable="medium"><text variable="medium" text-case="capitalize-first"/></else-if><else-if type="dataset"><text value="Data set"/></else-if><else-if type="book" variable="version" match="all"><text value="Computer software"/></else-if><else-if type="interview personal_communication" match="any"><choose><if variable="archive container-title DOI publisher URL" match="none"><text term="letter" text-case="capitalize-first"/></if><else-if type="interview"><text term="interview" text-case="capitalize-first"/></else-if></choose></else-if><else-if type="map"><text value="Map"/></else-if></choose></macro><macro name="container"><choose><if type="article-journal article-magazine article-newspaper post-weblog review review-book" match="any"><text macro="container-periodical"/></if><else-if type="paper-conference"><choose><if variable="editor editorial-director collection-editor container-author" match="any"><text macro="container-booklike"/></if><else><text macro="container-periodical"/></else></choose></else-if><else-if type="post webpage" match="none"><text macro="container-booklike"/></else-if></choose></macro><macro name="container-periodical"><group delimiter=". "><group delimiter=", "><text variable="container-title" font-style="italic" text-case="title"/><choose><if variable="volume"><group><text variable="volume" font-style="italic"/><text variable="issue" prefix="(" suffix=")"/></group></if><else><text variable="issue" font-style="italic"/></else></choose><choose><if variable="page"><text variable="page"/></if><else><text variable="number" prefix="Article "/></else></choose></group><choose><if variable="issued"><choose><if variable="issue page volume" match="none"><text variable="status" text-case="capitalize-first"/></if></choose></if></choose></group></macro><macro name="container-booklike"><choose><if variable="container-title" match="any"><group delimiter=" "><text term="in" text-case="capitalize-first"/><group delimiter=", "><names variable="editor translator" delimiter=", &amp; "><name and="symbol" initialize-with=". " delimiter=", "/><label form="short" text-case="title" prefix=" (" suffix=")"/><substitute><names variable="editorial-director"/><names variable="collection-editor"/><names variable="container-author"/></substitute></names><group delimiter=": " font-style="italic"><text variable="container-title"/><choose><if is-numeric="volume" match="none"><group delimiter=" "><label variable="volume" form="short" text-case="capitalize-first"/><text variable="volume"/></group></if></choose></group></group><text macro="parenthetical-container"/><text macro="bracketed-container"/></group></if></choose></macro><macro name="publisher"><group delimiter="; "><choose><if type="thesis"><choose><if variable="archive DOI URL" match="none"><text variable="publisher"/></if></choose></if><else-if type="post webpage"><group delimiter="; "><text variable="container-title" text-case="title"/><text variable="publisher"/></group></else-if><else-if type="paper-conference"><choose><if variable="collection-editor editor editorial-director" match="any"><text variable="publisher"/></if></choose></else-if><else-if type="article-journal article-magazine article-newspaper post-weblog" match="none"><text variable="publisher"/></else-if></choose><group delimiter=", "><choose><if variable="archive-place"><text variable="archive_location"/></if></choose><text variable="archive"/><text variable="archive-place"/></group></group></macro><macro name="access"><choose><if variable="DOI" match="any"><text variable="DOI" prefix="https://doi.org/"/></if><else-if variable="URL"><group delimiter=" "><choose><if variable="issued status" match="none"><group delimiter=" "><text term="retrieved" text-case="capitalize-first"/><date variable="accessed" form="text" suffix=","/><text term="from"/></group></if></choose><text variable="URL"/></group></else-if></choose></macro><macro name="event"><choose><if variable="event"><choose><if variable="collection-editor editor editorial-director issue page volume" match="none"><group delimiter=", "><text variable="event"/><text variable="event-place"/></group></if></choose></if></choose></macro><macro name="publication-history"><choose><if type="patent" match="none"><group prefix="(" suffix=")"><choose><if variable="references"><text variable="references"/></if><else><group delimiter=" "><text value="Original work published"/><choose><if is-uncertain-date="original-date"><text term="circa" form="short"/></if></choose><date variable="original-date"><date-part name="year"/></date></group></else></choose></group></if><else><text variable="references" prefix="(" suffix=")"/></else></choose></macro><macro name="legal-cites"><choose><if type="legal_case"><group delimiter=". "><group delimiter=", "><text variable="title"/><group delimiter=" "><text macro="container-legal"/><text macro="date-legal"/></group><text variable="references"/></group><text macro="access"/></group></if><else-if type="bill"><group delimiter=". "><group delimiter=", "><choose><if variable="number container-title" match="none"><text variable="title" font-style="italic"/></if><else><text variable="title"/></else></choose><group delimiter=" "><text macro="container-legal"/><text macro="date-legal"/><choose><if variable="number container-title" match="none"><names variable="author" prefix="(testimony of " suffix=")"><name and="symbol" delimiter=", "/></names></if><else><text variable="status" prefix="(" suffix=")"/></else></choose></group><text variable="references"/></group><text macro="access"/></group></else-if><else-if type="legislation"><group delimiter=". "><group delimiter=", "><text variable="title"/><group delimiter=" "><text macro="container-legal"/><text macro="date-legal"/><text variable="status" prefix="(" suffix=")"/></group><text variable="references"/></group><text macro="access"/></group></else-if><else-if type="treaty"><group delimiter=", "><text variable="title" text-case="title"/><names variable="author"><name initialize-with="." form="short" delimiter="-"/></names><text macro="date-legal"/><text macro="container-legal"/><text macro="access"/></group></else-if></choose></macro><macro name="date-legal"><choose><if type="legal_case"><group prefix="(" suffix=")" delimiter=" "><text variable="authority"/><choose><if variable="container-title" match="any"><date variable="issued" form="numeric" date-parts="year"/></if><else><date variable="issued" form="text"/></else></choose></group></if><else-if type="bill legislation" match="any"><group prefix="(" suffix=")" delimiter=" "><group delimiter=" "><date variable="original-date"><date-part name="year"/></date><text term="and" form="symbol"/></group><date variable="issued"><date-part name="year"/></date></group></else-if><else-if type="treaty"><date variable="issued" form="text"/></else-if></choose></macro><macro name="container-legal"><choose><if type="legal_case"><group delimiter=" "><choose><if variable="container-title"><group delimiter=" "><text variable="volume"/><text variable="container-title"/><group delimiter=" "><text term="section" form="symbol"/><text variable="section"/></group><choose><if variable="page page-first" match="any"><text variable="page-first"/></if><else><text value="___"/></else></choose></group></if><else><group delimiter=" "><choose><if is-numeric="number"><text term="issue" form="short" text-case="capitalize-first"/></if></choose><text variable="number"/></group></else></choose></group></if><else-if type="bill"><group delimiter=", "><group delimiter=" "><text variable="genre"/><group delimiter=" "><choose><if variable="chapter-number container-title" match="none"><text term="issue" form="short"/></if></choose><text variable="number"/></group></group><text variable="authority"/><text variable="chapter-number"/><group delimiter=" "><text variable="volume"/><text variable="container-title"/><text variable="page-first"/></group></group></else-if><else-if type="legislation"><choose><if variable="number"><group delimiter=", "><text variable="number" prefix="Pub. L. No. "/><group delimiter=" "><text variable="volume"/><text variable="container-title"/><text variable="page-first"/></group></group></if><else><group delimiter=" "><text variable="volume"/><text variable="container-title"/><choose><if variable="section"><group delimiter=" "><text term="section" form="symbol"/><text variable="section"/></group></if><else><text variable="page-first"/></else></choose></group></else></choose></else-if><else-if type="treaty"><group delimiter=" "><number variable="volume"/><text variable="container-title"/><choose><if variable="page page-first" match="any"><text variable="page-first"/></if><else><group delimiter=" "><text term="issue" form="short" text-case="capitalize-first"/><text variable="number"/></group></else></choose></group></else-if></choose></macro><macro name="citation-locator"><group delimiter=" "><choose><if locator="chapter"><label variable="locator" text-case="capitalize-first"/></if><else><label variable="locator" form="short"/></else></choose><text variable="locator"/></group></macro><citation et-al-min="3" et-al-use-first="1" disambiguate-add-year-suffix="true" disambiguate-add-names="true" disambiguate-add-givenname="true" collapse="year" givenname-disambiguation-rule="primary-name"><sort><key macro="author-bib" names-min="3" names-use-first="1"/><key macro="date-sort-group"/><key macro="date-sort-date" sort="ascending"/><key variable="status"/></sort><layout prefix="(" suffix=")" delimiter="; "><group delimiter=", "><text macro="author-intext"/><text macro="date-intext"/><text macro="citation-locator"/></group></layout></citation><bibliography hanging-indent="true" et-al-min="21" et-al-use-first="19" et-al-use-last="true" entry-spacing="0" line-spacing="2"><sort><key macro="author-bib"/><key macro="date-sort-group"/><key macro="date-sort-date" sort="ascending"/><key variable="status"/><key macro="title"/></sort><layout><choose><if type="bill legal_case legislation treaty" match="any"><choose><if variable="DOI URL" match="any"><text macro="legal-cites"/></if><else><text macro="legal-cites" suffix="."/></else></choose></if><else><group delimiter=" "><group delimiter=". " suffix="."><text macro="author-bib"/><text macro="date-bib"/><text macro="title-and-descriptions"/><text macro="container"/><text macro="event"/><text macro="publisher"/></group><text macro="access"/><text macro="publication-history"/></group></else></choose></layout></bibliography></style>',vancouver:`<?xml version="1.0" encoding="utf-8"?><style xmlns="http://purl.org/net/xbiblio/csl" class="in-text" version="1.0" demote-non-dropping-particle="sort-only" page-range-format="minimal"><info><title>Vancouver</title><id>http://www.zotero.org/styles/vancouver</id><link href="http://www.zotero.org/styles/vancouver" rel="self"/><link href="http://www.nlm.nih.gov/bsd/uniform_requirements.html" rel="documentation"/><author><name>Michael Berkowitz</name><email>mberkowi@gmu.edu</email></author><contributor><name>Sean Takats</name><email>stakats@gmu.edu</email></contributor><contributor><name>Sebastian Karcher</name></contributor><category citation-format="numeric"/><category field="medicine"/><summary>Vancouver style as outlined by International Committee of Medical Journal Editors Uniform Requirements for Manuscripts Submitted to Biomedical Journals: Sample References</summary><updated>2014-09-06T16:03:01+00:00</updated><rights license="http://creativecommons.org/licenses/by-sa/3.0/">This work is licensed under a Creative Commons Attribution-ShareAlike 3.0 License</rights></info><locale xml:lang="en"><date form="text" delimiter=" "><date-part name="year"/><date-part name="month" form="short" strip-periods="true"/><date-part name="day"/></date><terms><term name="collection-editor" form="long"><single>editor</single><multiple>editors</multiple></term><term name="presented at">presented at</term><term name="available at">available from</term><term name="section" form="short">sect.</term></terms></locale><locale xml:lang="fr"><date form="text" delimiter=" "><date-part name="day"/><date-part name="month" form="short" strip-periods="true"/><date-part name="year"/></date></locale><macro name="author"><names variable="author"><name sort-separator=" " initialize-with="" name-as-sort-order="all" delimiter=", " delimiter-precedes-last="always"/><label form="long" prefix=", "/><substitute><names variable="editor"/></substitute></names></macro><macro name="editor"><names variable="editor" suffix="."><name sort-separator=" " initialize-with="" name-as-sort-order="all" delimiter=", " delimiter-precedes-last="always"/><label form="long" prefix=", "/></names></macro><macro name="chapter-marker"><choose><if type="chapter paper-conference entry-dictionary entry-encyclopedia" match="any"><text term="in" text-case="capitalize-first"/></if></choose></macro><macro name="publisher"><choose><if type="article-journal article-magazine article-newspaper" match="none"><group delimiter=": " suffix=";"><choose><if type="thesis"><text variable="publisher-place" prefix="[" suffix="]"/></if><else-if type="speech"/><else><text variable="publisher-place"/></else></choose><text variable="publisher"/></group></if></choose></macro><macro name="access"><choose><if variable="URL"><group delimiter=": "><text term="available at" text-case="capitalize-first"/><text variable="URL"/></group></if></choose></macro><macro name="accessed-date"><choose><if variable="URL"><group prefix="[" suffix="]" delimiter=" "><text term="cited" text-case="lowercase"/><date variable="accessed" form="text"/></group></if></choose></macro><macro name="container-title"><choose><if type="article-journal article-magazine chapter paper-conference article-newspaper review review-book entry-dictionary entry-encyclopedia" match="any"><group suffix="." delimiter=" "><choose><if type="article-journal review review-book" match="any"><text variable="container-title" form="short" strip-periods="true"/></if><else><text variable="container-title" strip-periods="true"/></else></choose><choose><if variable="URL"><text term="internet" prefix="[" suffix="]" text-case="capitalize-first"/></if></choose></group><text macro="edition" prefix=" "/></if><else-if type="bill legislation" match="any"><group delimiter=", "><group delimiter=". "><text variable="container-title"/><group delimiter=" "><text term="section" form="short" text-case="capitalize-first"/><text variable="section"/></group></group><text variable="number"/></group></else-if><else-if type="speech">
<group delimiter=": " suffix=";"><group delimiter=" "><text variable="genre" text-case="capitalize-first"/><text term="presented at"/></group><text variable="event"/></group></else-if><else><group delimiter=", " suffix="."><choose><if variable="collection-title" match="none"><group delimiter=" "><label variable="volume" form="short" text-case="capitalize-first"/><text variable="volume"/></group></if></choose><text variable="container-title"/></group></else></choose></macro><macro name="title"><text variable="title"/><choose><if type="article-journal article-magazine chapter paper-conference article-newspaper review review-book entry-dictionary entry-encyclopedia" match="none"><choose><if variable="URL"><text term="internet" prefix=" [" suffix="]" text-case="capitalize-first"/></if></choose><text macro="edition" prefix=". "/></if></choose><choose><if type="thesis"><text variable="genre" prefix=" [" suffix="]"/></if></choose></macro><macro name="edition"><choose><if is-numeric="edition"><group delimiter=" "><number variable="edition" form="ordinal"/><text term="edition" form="short"/></group></if><else><text variable="edition" suffix="."/></else></choose></macro><macro name="date"><choose><if type="article-journal article-magazine article-newspaper review review-book" match="any"><group suffix=";" delimiter=" "><date variable="issued" form="text"/><text macro="accessed-date"/></group></if><else-if type="bill legislation" match="any"><group delimiter=", "><date variable="issued" delimiter=" "><date-part name="month" form="short" strip-periods="true"/><date-part name="day"/></date><date variable="issued"><date-part name="year"/></date></group></else-if><else-if type="report"><date variable="issued" delimiter=" "><date-part name="year"/><date-part name="month" form="short" strip-periods="true"/></date><text macro="accessed-date" prefix=" "/></else-if><else-if type="patent"><group suffix="."><group delimiter=", "><text variable="number"/><date variable="issued"><date-part name="year"/></date></group><text macro="accessed-date" prefix=" "/></group></else-if><else-if type="speech"><group delimiter="; "><group delimiter=" "><date variable="issued" delimiter=" "><date-part name="year"/><date-part name="month" form="short" strip-periods="true"/><date-part name="day"/></date><text macro="accessed-date"/></group><text variable="event-place"/></group></else-if><else><group suffix="."><date variable="issued"><date-part name="year"/></date><text macro="accessed-date" prefix=" "/></group></else></choose></macro><macro name="pages"><choose><if type="article-journal article-magazine article-newspaper review review-book" match="any"><text variable="page" prefix=":"/></if><else-if type="book" match="any"><text variable="number-of-pages" prefix=" "/><choose><if is-numeric="number-of-pages"><label variable="number-of-pages" form="short" prefix=" " plural="never"/></if></choose></else-if><else><group prefix=" " delimiter=" "><label variable="page" form="short" plural="never"/><text variable="page"/></group></else></choose></macro><macro name="journal-location"><choose><if type="article-journal article-magazine review review-book" match="any"><text variable="volume"/><text variable="issue" prefix="(" suffix=")"/></if></choose></macro><macro name="collection-details"><choose><if type="article-journal article-magazine article-newspaper review review-book" match="none"><choose><if variable="collection-title"><group delimiter=" " prefix="(" suffix=")"><names variable="collection-editor" suffix="."><name sort-separator=" " initialize-with="" name-as-sort-order="all" delimiter=", " delimiter-precedes-last="always"/><label form="long" prefix=", "/></names><group delimiter="; "><text variable="collection-title"/><group delimiter=" "><label variable="volume" form="short"/><text variable="volume"/></group></group></group></if></choose></if></choose></macro><macro name="report-details"><choose><if type="report"><text variable="number" prefix="Report No.: "/></if></choose></macro><citation collapse="citation-number">
<sort><key variable="citation-number"/></sort><layout prefix="(" suffix=")" delimiter=","><text variable="citation-number"/></layout></citation><bibliography et-al-min="7" et-al-use-first="6" second-field-align="flush"><layout><text variable="citation-number" suffix=". "/><group delimiter=". " suffix=". "><text macro="author"/><text macro="title"/></group><group delimiter=" " suffix=". "><group delimiter=": "><text macro="chapter-marker"/><group delimiter=" "><text macro="editor"/><text macro="container-title"/></group></group><text macro="publisher"/><group><text macro="date"/><text macro="journal-location"/><text macro="pages"/></group></group><text macro="collection-details" suffix=". "/><text macro="report-details" suffix=". "/><text macro="access"/></layout></bibliography></style>`,harvard1:`<?xml version="1.0" encoding="utf-8"?><style xmlns="http://purl.org/net/xbiblio/csl" class="in-text" version="1.0" demote-non-dropping-particle="sort-only"><info><title>Harvard Reference format 1 (author-date)</title><id>http://www.zotero.org/styles/harvard1</id><link href="http://www.zotero.org/styles/harvard1" rel="self"/><link href="http://libweb.anglia.ac.uk/referencing/harvard.htm" rel="documentation"/><author><name>Julian Onions</name><email>julian.onions@gmail.com</email></author><category citation-format="author-date"/><category field="generic-base"/><summary>The Harvard author-date style</summary><updated>2012-09-27T22:06:38+00:00</updated><rights license="http://creativecommons.org/licenses/by-sa/3.0/">This work is licensed under a Creative Commons Attribution-ShareAlike 3.0 License</rights></info><macro name="editor"><names variable="editor" delimiter=", "><name and="symbol" initialize-with=". " delimiter=", "/><label form="short" prefix=", " text-case="lowercase"/></names></macro><macro name="anon"><text term="anonymous" form="short" text-case="capitalize-first" strip-periods="true"/></macro><macro name="author"><names variable="author"><name name-as-sort-order="all" and="symbol" sort-separator=", " initialize-with="." delimiter-precedes-last="never" delimiter=", "/><label form="short" prefix=" " text-case="lowercase"/><substitute><names variable="editor"/><text macro="anon"/></substitute></names></macro><macro name="author-short"><names variable="author"><name form="short" and="symbol" delimiter=", " delimiter-precedes-last="never" initialize-with=". "/><substitute><names variable="editor"/><names variable="translator"/><text macro="anon"/></substitute></names></macro><macro name="access"><choose><if variable="URL"><text value="Available at:" suffix=" "/><text variable="URL"/><group prefix=" [" suffix="]"><text term="accessed" text-case="capitalize-first" suffix=" "/><date variable="accessed"><date-part name="month" suffix=" "/><date-part name="day" suffix=", "/><date-part name="year"/></date></group></if></choose></macro><macro name="title"><choose><if type="bill book graphic legal_case legislation motion_picture report song thesis" match="any"><text variable="title" font-style="italic"/></if><else><text variable="title"/></else></choose></macro><macro name="publisher"><group delimiter=": "><text variable="publisher-place"/><text variable="publisher"/></group></macro><macro name="year-date"><choose><if variable="issued"><date variable="issued"><date-part name="year"/></date></if><else><text term="no date" form="short"/></else></choose></macro><macro name="edition"><choose><if is-numeric="edition"><group delimiter=" "><number variable="edition" form="ordinal"/><text term="edition" form="short"/></group></if><else><text variable="edition" suffix="."/></else></choose></macro><macro name="pages"><group><label variable="page" form="short" suffix=" "/><text variable="page"/></group></macro><citation et-al-min="3" et-al-use-first="1" disambiguate-add-year-suffix="true" disambiguate-add-names="true" disambiguate-add-givenname="true"><layout prefix="(" suffix=")" delimiter="; "><group delimiter=", "><group delimiter=" "><text macro="author-short"/><text macro="year-date"/></group><group><label variable="locator" form="short"/><text variable="locator"/></group></group></layout></citation><bibliography hanging-indent="true" et-al-min="4" et-al-use-first="1"><sort><key macro="author"/><key variable="title"/></sort><layout><text macro="author" suffix=","/><date variable="issued" prefix=" " suffix="."><date-part name="year"/></date><choose><if type="bill book graphic legal_case legislation motion_picture report song" match="any"><group prefix=" " delimiter=" " suffix=","><text macro="title"/><text macro="edition"/><text macro="editor"/></group><text prefix=" " suffix="." macro="publisher"/></if><else-if type="chapter paper-conference" match="any"><text macro="title" prefix=" " suffix="."/><group prefix=" " delimiter=" "><text term="in" text-case="capitalize-first"/>
<text macro="editor"/><text variable="container-title" font-style="italic" suffix="."/><text variable="collection-title" suffix="."/><text variable="event" suffix="."/><group suffix="." delimiter=", "><text macro="publisher" prefix=" "/><text macro="pages"/></group></group></else-if><else-if type="thesis"><group prefix=" " suffix="." delimiter=". "><text macro="title"/><text variable="genre"/><text macro="publisher"/></group></else-if><else><group suffix="."><text macro="title" prefix=" "/><text macro="editor" prefix=" "/></group><group prefix=" " suffix="."><text variable="container-title" font-style="italic"/><group prefix=", "><text variable="volume"/><text variable="issue" prefix="(" suffix=")"/></group><group prefix=", "><label variable="page" form="short"/><text variable="page"/></group></group></else></choose><text prefix=" " macro="access" suffix="."/></layout></bibliography></style>`}});var Kn=R(Nr=>{"use strict";Object.defineProperty(Nr,"__esModule",{value:!0});Nr.templates=Nr.default=void 0;var a1=me(),n1=o1(Ep());function o1(e){return e&&e.__esModule?e:{default:e}}var Bs=new a1.util.Register(n1.default);Nr.templates=Bs;var l1=e=>Bs.has(e)?Bs.get(e):Bs.get("apa"),u1=l1;Nr.default=u1});var Zn=R((ET,wp)=>{"use strict";var l={PROCESSOR_VERSION:"1.4.61",error:function(e){throw typeof Error=="undefined"?new Error("citeproc-js error: "+e):"citeproc-js error: "+e},debug:function(e){typeof console=="undefined"?dump("CSL: "+e+`
`):console.log("citeproc-js warning: "+e)},toLocaleUpperCase(e){var t=this.tmp.lang_array;try{e=e.toLocaleUpperCase(t)}catch(r){e=e.toUpperCase()}return e},toLocaleLowerCase(e){var t=this.tmp.lang_array;try{e=e.toLocaleLowerCase(t)}catch(r){e=e.toLowerCase()}return e},LOCATOR_LABELS_REGEXP:new RegExp("^((vrs|sv|subpara|op|subch|add|amend|annot|app|art|bibliog|bk|ch|cl|col|cmt|dec|dept|div|ex|fig|fld|fol|n|hypo|illus|intro|l|no|p|pp|para|pt|pmbl|princ|pub|r|rn|sched|sec|ser|subdiv|subsec|supp|tbl|tit|vol)\\.)\\s+(.*)"),STATUTE_SUBDIV_PLAIN_REGEX:/(?:(?:^| )(?:vrs|sv|subpara|op|subch|add|amend|annot|app|art|bibliog|bk|ch|cl|col|cmt|dec|dept|div|ex|fig|fld|fol|n|hypo|illus|intro|l|no|p|pp|para|pt|pmbl|princ|pub|r|rn|sched|sec|ser|subdiv|subsec|supp|tbl|tit|vol)\. *)/,STATUTE_SUBDIV_PLAIN_REGEX_FRONT:/(?:^\s*[.,;]*\s*(?:vrs|sv|subpara|op|subch|add|amend|annot|app|art|bibliog|bk|ch|cl|col|cmt|dec|dept|div|ex|fig|fld|fol|n|hypo|illus|intro|l|no|p|pp|para|pt|pmbl|princ|pub|r|rn|sched|sec|ser|subdiv|subsec|supp|tbl|tit|vol)\. *)/,STATUTE_SUBDIV_STRINGS:{"vrs.":"verse","sv.":"sub-verbo","subpara.":"subparagraph","op.":"opus","subch.":"subchapter","add.":"addendum","amend.":"amendment","annot.":"annotation","app.":"appendix","art.":"article","bibliog.":"bibliography","bk.":"book","ch.":"chapter","cl.":"clause","col.":"column","cmt.":"comment","dec.":"decision","dept.":"department","ex.":"example","fig.":"figure","fld.":"field","fol.":"folio","n.":"note","hypo.":"hypothetical","illus.":"illustration","intro.":"introduction","l.":"line","no.":"issue","p.":"page","pp.":"page","para.":"paragraph","pt.":"part","pmbl.":"preamble","princ.":"principle","pub.":"publication","r.":"rule","rn.":"randnummer","sched.":"schedule","sec.":"section","ser.":"series,","subdiv.":"subdivision","subsec.":"subsection","supp.":"supplement","tbl.":"table","tit.":"title","vol.":"volume"},STATUTE_SUBDIV_STRINGS_REVERSE:{verse:"vrs.","sub-verbo":"sv.","sub verbo":"sv.",subparagraph:"subpara.",opus:"op.",subchapter:"subch.",addendum:"add.",amendment:"amend.",annotation:"annot.",appendix:"app.",article:"art.",bibliography:"bibliog.",book:"bk.",chapter:"ch.",clause:"cl.",column:"col.",comment:"cmt.",decision:"dec.",department:"dept.",example:"ex.",figure:"fig.",field:"fld.",folio:"fol.",note:"n.",hypothetical:"hypo.",illustration:"illus.",introduction:"intro.",line:"l.",issue:"no.",page:"p.",paragraph:"para.",part:"pt.",preamble:"pmbl.",principle:"princ.",publication:"pub.",rule:"r.",randnummer:"rn.",schedule:"sched.",section:"sec.","series,":"ser.",subdivision:"subdiv.",subsection:"subsec.",supplement:"supp.",table:"tbl.",title:"tit.",volume:"vol."},LOCATOR_LABELS_MAP:{vrs:"verse",sv:"sub-verbo",subpara:"subparagraph",op:"opus",subch:"subchapter",add:"addendum",amend:"amendment",annot:"annotation",app:"appendix",art:"article",bibliog:"bibliography",bk:"book",ch:"chapter",cl:"clause",col:"column",cmt:"comment",dec:"decision",dept:"department",ex:"example",fig:"figure",fld:"field",fol:"folio",n:"note",hypo:"hypothetical",illus:"illustration",intro:"introduction",l:"line",no:"issue",p:"page",pp:"page",para:"paragraph",pt:"part",pmbl:"preamble",princ:"principle",pub:"publication",r:"rule",rn:"randnummer",sched:"schedule",sec:"section",ser:"series,",subdiv:"subdivision",subsec:"subsection",supp:"supplement",tbl:"table",tit:"title",vol:"volume"},MODULE_MACROS:{"juris-pretitle":!0,"juris-title":!0,"juris-pretitle-short":!0,"juris-title-short":!0,"juris-main":!0,"juris-main-short":!0,"juris-tail":!0,"juris-tail-short":!0,"juris-locator":!0},MODULE_TYPES:{legal_case:!0,legislation:!0,bill:!0,hearing:!0,gazette:!0,report:!0,regulation:!0,standard:!0,patent:!0,locator:!0},checkNestedBrace:function(e){e.opt.xclass==="note"?(this.depth=0,this.update=function(r){for(var r=r||"",i=r.split(/([\(\)])/),s=1,a=i.length;s<a;s+=2)i[s]==="("?(this.depth%2===1&&(i[s]="["),this.depth+=1):i[s]===")"&&(this.depth%2===0&&(i[s]="]"),this.depth-=1);var n=i.join("");return n}):this.update=function(t){return t}},MULTI_FIELDS:["event","publisher","publisher-place","event-place","title","container-title","collection-title","authority","genre","title-short","medium","country","jurisdiction","archive","archive-place"],LangPrefsMap:{title:"titles","title-short":"titles",event:"titles",genre:"titles",medium:"titles","container-title":"journals","collection-title":"titles",archive:"journals",publisher:"publishers",authority:"publishers","publisher-place":"places","event-place":"places","archive-place":"places",jurisdiction:"places",number:"places",edition:"places",issue:"places",volume:"places"},AbbreviationSegments:function(){this["container-title"]={},this["collection-title"]={},this["institution-entire"]={},this["institution-part"]={},this.nickname={},this.number={},this.title={},this.place={},this.hereinafter={},this.classic={},this["container-phrase"]={},this["title-phrase"]={}},getAbbrevsDomain:function(e,t,r){var i=null;if(e.opt.availableAbbrevDomains&&t&&t!=="default"){var s=e.locale[e.opt.lang].opts["jurisdiction-preference"],a=null;if(e.locale[r]&&(a=e.locale[r].opts["jurisdiction-preference"]),a){for(var n=a.length-1;n>-1;n--)if(e.opt.availableAbbrevDomains[t].indexOf(a[n])>-1){i=a[n];break}}if(!i&&s){for(var n=s.length-1;n>-1;n--)if(e.opt.availableAbbrevDomains[t].indexOf(s[n])>-1){i=s[n];break}}}return i},FIELD_CATEGORY_REMAP:{title:"title","container-title":"container-title","collection-title":"collection-title",country:"place",number:"number",place:"place",archive:"container-title","title-short":"title",genre:"title",event:"title",medium:"title","archive-place":"place","publisher-place":"place","event-place":"place",jurisdiction:"place","language-name":"place","language-name-original":"place","call-number":"number","chapter-number":"number","collection-number":"number",edition:"number",page:"number",issue:"number",locator:"number","locator-extra":"number","number-of-pages":"number","number-of-volumes":"number",volume:"number","citation-number":"number",publisher:"institution-part"},parseLocator:function(e){if(this.opt.development_extensions.locator_date_and_revision&&e.locator){e.locator=""+e.locator;var t=e.locator.indexOf("|");if(t>-1){var r=e.locator;e.locator=r.slice(0,t),r=r.slice(t+1);var i=r.match(/^([0-9]{4}-[0-9]{2}-[0-9]{2}).*/);i&&(e["locator-date"]=this.fun.dateparser.parseDateToObject(i[1]),r=r.slice(i[1].length)),e["locator-extra"]=r.replace(/^\s+/,"").replace(/\s+$/,"")}}return e.locator&&(e.locator=(""+e.locator).replace(/\s+$/,"")),e},normalizeLocaleStr:function(e){if(e){var t=e.split("-");return t[0]=t[0].toLowerCase(),t[1]&&(t[1]=t[1].toUpperCase()),t.join("-")}},parseNoteFieldHacks:function(e,t,r){if(typeof e.note=="string"){for(var i=[],s=e.note.split(`
`),a=0,n=s.length;a<n;a++){var o=s[a],i=[],u=o.match(l.NOTE_FIELDS_REGEXP);if(u){for(var c=o.split(l.NOTE_FIELDS_REGEXP),p=0,f=c.length-1;p<f;p++)i.push(c[p]),i.push(u[p]);i.push(c[c.length-1]);for(var p=1,f=i.length;p<f&&!(i[p-1].trim()&&(a>0||p>1)&&!i[p-1].match(l.NOTE_FIELD_REGEXP));p+=2)i[p]=`
`+i[p].slice(2,-1).trim()+`
`;s[a]=i.join("")}}s=s.join(`
`).split(`
`);for(var h=0,m={},a=0,n=s.length;a<n;a++){var o=s[a],g=o.match(l.NOTE_FIELD_REGEXP);if(o.trim()){if(!g){if(a===0)continue;h=a;break}}else continue;var d=g[1],v=g[2].replace(/^\s+/,"").replace(/\s+$/,"");if(d==="type")e.type=v,s[a]="";else if(l.DATE_VARIABLES.indexOf(d.replace(/^alt-/,""))>-1)(!e[d]||r)&&(e[d]=l.DateParser.parseDateToArray(v),(!t||t[d]&&this.isDateString(v))&&(s[a]=""));else if(!e[d]){if(l.NAME_VARIABLES.indexOf(d.replace(/^alt-/,""))>-1){m[d]||(m[d]=[]);var b=v.split(/\s*\|\|\s*/);if(b.length===1)m[d].push({literal:b[0]});else if(b.length===2){var E={family:b[0],given:b[1]};l.parseParticles(E),m[d].push(E)}}else e[d]=v;(!t||t[d])&&(s[a]="")}}for(var d in m)e[d]=m[d];if(t){s[h].trim()&&(s[h]=`
`+s[h]);for(var a=h-1;a>-1;a--)s[a].trim()||(s=s.slice(0,a).concat(s.slice(a+1)))}e.note=s.join(`
`).trim()}},checkPrefixSpaceAppend:function(e,a){a||(a="");var r="",i=a.replace(/<[^>]+>/g,"").replace(/["'\u201d\u2019\u00bb\u202f\u00a0 ]+$/g,""),s=i.slice(-1);(i.match(l.ENDSWITH_ROMANESQUE_REGEXP)||l.TERMINAL_PUNCTUATION.slice(0,-1).indexOf(s)>-1||s.match(/[\)\],0-9]/))&&(r=" ");var a=(a+r).replace(/\s+/g," ");return a},checkIgnorePredecessor:function(e,t){var r=!1,i=t.replace(/<[^>]+>/g,"").replace(/["'\u201d\u2019\u00bb\u202f\u00a0 ]+$/g,""),s=i.slice(-1);return l.TERMINAL_PUNCTUATION.slice(0,-1).indexOf(s)>-1&&t.trim().indexOf(" ")>-1?(e.tmp.term_predecessor=!1,!0):!1},checkSuffixSpacePrepend:function(e,t){return t?((t.match(l.STARTSWITH_ROMANESQUE_REGEXP)||["[","("].indexOf(t.slice(0,1))>-1)&&(t=" "+t),t):""},GENDERS:["masculine","feminine"],ERROR_NO_RENDERED_FORM:1,PREVIEW:"Just for laughs.",ASSUME_ALL_ITEMS_REGISTERED:2,START:0,END:1,SINGLETON:2,SEEN:6,SUCCESSOR:3,SUCCESSOR_OF_SUCCESSOR:4,SUPPRESS:5,SINGULAR:0,PLURAL:1,LITERAL:!0,BEFORE:1,AFTER:2,DESCENDING:1,ASCENDING:2,PRIMARY:1,SECONDARY:2,POSITION_FIRST:0,POSITION_SUBSEQUENT:1,POSITION_IBID:2,POSITION_IBID_WITH_LOCATOR:3,POSITION_CONTAINER_SUBSEQUENT:4,POSITION_MAP:{0:0,4:1,1:2,2:3,3:4},POSITION_TEST_VARS:["position","first-reference-note-number","near-note"],AREAS:["citation","citation_sort","bibliography","bibliography_sort","intext"],CITE_FIELDS:["first-reference-note-number","first-container-reference-note-number","locator","locator-extra"],SWAPPING_PUNCTUATION:[".","!","?",":",","],TERMINAL_PUNCTUATION:[":",".",";","!","?"," "],NONE:0,NUMERIC:1,POSITION:2,TRIGRAPH:3,DATE_PARTS:["year","month","day"],DATE_PARTS_ALL:["year","month","day","season"],DATE_PARTS_INTERNAL:["year","month","day","year_end","month_end","day_end"],NAME_PARTS:["non-dropping-particle","family","given","dropping-particle","suffix","literal"],DISAMBIGUATE_OPTIONS:["disambiguate-add-names","disambiguate-add-givenname","disambiguate-add-year-suffix"],GIVENNAME_DISAMBIGUATION_RULES:["all-names","all-names-with-initials","primary-name","primary-name-with-initials","by-cite"],NAME_ATTRIBUTES:["and","delimiter-precedes-last","delimiter-precedes-et-al","initialize-with","initialize","name-as-sort-order","sort-separator","et-al-min","et-al-use-first","et-al-subsequent-min","et-al-subsequent-use-first","form","prefix","suffix","delimiter"],LOOSE:0,STRICT:1,TOLERANT:2,PREFIX_PUNCTUATION:/[.;:]\s*$/,SUFFIX_PUNCTUATION:/^\s*[.;:,\(\)]/,NUMBER_REGEXP:/(?:^\d+|\d+$)/,NAME_INITIAL_REGEXP:/^([A-Z\u0e01-\u0e5b\u00c0-\u017f\u0400-\u042f\u0590-\u05d4\u05d6-\u05ff\u0600-\u06ff\u0370\u0372\u0376\u0386\u0388-\u03ab\u03e2\u03e4\u03e6\u03e8\u03ea\u03ec\u03ee\u03f4\u03f7\u03fd-\u03ff])([a-zA-Z\u0e01-\u0e5b\u00c0-\u017f\u0400-\u052f\u0600-\u06ff\u0370-\u03ff\u1f00-\u1fff]*|)(\.)*/,ROMANESQUE_REGEXP:/[-0-9a-zA-Z\u0e01-\u0e5b\u00c0-\u017f\u0370-\u03ff\u0400-\u052f\u0590-\u05d4\u05d6-\u05ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]/,ROMANESQUE_NOT_REGEXP:/[^a-zA-Z\u0e01-\u0e5b\u00c0-\u017f\u0370-\u03ff\u0400-\u052f\u0590-\u05d4\u05d6-\u05ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]/g,STARTSWITH_ROMANESQUE_REGEXP:/^[&a-zA-Z\u0e01-\u0e5b\u00c0-\u017f\u0370-\u03ff\u0400-\u052f\u0590-\u05d4\u05d6-\u05ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]/,ENDSWITH_ROMANESQUE_REGEXP:/[.;:&a-zA-Z\u0e01-\u0e5b\u00c0-\u017f\u0370-\u03ff\u0400-\u052f\u0590-\u05d4\u05d6-\u05ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]$/,ALL_ROMANESQUE_REGEXP:/^[a-zA-Z\u0e01-\u0e5b\u00c0-\u017f\u0370-\u03ff\u0400-\u052f\u0590-\u05d4\u05d6-\u05ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]+$/,VIETNAMESE_SPECIALS:/[\u00c0-\u00c3\u00c8-\u00ca\u00cc\u00cd\u00d2-\u00d5\u00d9\u00da\u00dd\u00e0-\u00e3\u00e8-\u00ea\u00ec\u00ed\u00f2-\u00f5\u00f9\u00fa\u00fd\u0101\u0103\u0110\u0111\u0128\u0129\u0168\u0169\u01a0\u01a1\u01af\u01b0\u1ea0-\u1ef9]/,VIETNAMESE_NAMES:/^(?:(?:[.AaBbCcDdEeGgHhIiKkLlMmNnOoPpQqRrSsTtUuVvXxYy \u00c0-\u00c3\u00c8-\u00ca\u00cc\u00cd\u00d2-\u00d5\u00d9\u00da\u00dd\u00e0-\u00e3\u00e8-\u00ea\u00ec\u00ed\u00f2-\u00f5\u00f9\u00fa\u00fd\u0101\u0103\u0110\u0111\u0128\u0129\u0168\u0169\u01a0\u01a1\u01af\u01b0\u1ea0-\u1ef9]{2,6})(\s+|$))+$/,NOTE_FIELDS_REGEXP:/\{:(?:[\-_a-z]+|[A-Z]+):[^\}]+\}/g,NOTE_FIELD_REGEXP:/^([\-_a-z]+|[A-Z]+):\s*([^\}]+)$/,PARTICLE_GIVEN_REGEXP:/^([^ ]+(?:\u02bb |\u2019 | |\' ) *)(.+)$/,PARTICLE_FAMILY_REGEXP:/^([^ ]+(?:\-|\u02bb|\u2019| |\') *)(.+)$/,DISPLAY_CLASSES:["block","left-margin","right-inline","indent"],NAME_VARIABLES:["author","chair","collection-editor","compiler","composer","container-author","contributor","curator","director","editor","editor-translator","editorial-director","executive-producer","guest","host","illustrator","interviewer","narrator","organizer","original-author","performer","producer","recipient","reviewed-author","script-writer","series-creator","translator","commenter"],CREATORS:["author","chair","collection-editor","compiler","composer","container-author","contributor","curator","director","editor","editor-translator","editorial-director","executive-producer","guest","host","illustrator","interviewer","narrator","organizer","original-author","performer","producer","recipient","reviewed-author","script-writer","series-creator","translator","commenter"],NUMERIC_VARIABLES:["call-number","chapter-number","collection-number","division","edition","page","issue","locator","locator-extra","number","number-of-pages","number-of-volumes","part-number","printing-number","section","supplement-number","version","volume","supplement","citation-number"],DATE_VARIABLES:["locator-date","issued","event-date","accessed","original-date","publication-date","available-date","submitted","alt-issued","alt-event"],VARIABLES_WITH_SHORT_FORM:["title","container-title"],TITLE_FIELD_SPLITS:function(e){for(var t=["title","short","main","sub","subjoin"],r={},i=0,s=t.length;i<s;i++)r[t[i]]=e+"title"+(t[i]==="title"?"":"-"+t[i]);return r},demoteNoiseWords:function(e,t,r){var i=e.locale[e.opt.lang].opts["leading-noise-words"];if(t&&r){t=t.split(/\s+/),t.reverse();for(var s=[],a=t.length-1;a>-1&&i.indexOf(t[a].toLowerCase())>-1;a+=-1)s.push(t.pop());t.reverse();var n=t.join(" "),o=s.join(" ");r==="drop"||!o?t=n:r==="demote"&&(t=[n,o].join(", "))}return t},extractTitleAndSubtitle:function(e,t){var r=t?"\u202F":"",i=[""];this.opt.development_extensions.split_container_title&&i.push("container-");for(var s=0,a=i.length;s<a;s++){var n=i[s],o=l.TITLE_FIELD_SPLITS(n),u=[!1];if(e.multi)for(var c in e.multi._keys[o.short])u.push(c);for(var p=0,f=u.length;p<f;p++){var c=u[p],h={};c?(e.multi._keys[o.title]&&(h[o.title]=e.multi._keys[o.title][c]),e.multi._keys[o.short]&&(h[o.short]=e.multi._keys[o.short][c])):(h[o.title]=e[o.title],h[o.short]=e[o.short]),h[o.main]=h[o.title],h[o.sub]=!1;var m=h[o.short];if(h[o.title]){if(m&&m.toLowerCase()===h[o.title].toLowerCase())h[o.main]=h[o.title],h[o.subjoin]="",h[o.sub]="";else if(m){var g=h[o.title].slice(m.replace(/[\?\!]+$/,"").length),d=h[o.title].replace(g.replace(/^[\?\!]+/,""),"").trim(),v=l.TITLE_SPLIT_REGEXP.matchfirst.exec(g);if(v&&d.toLowerCase()===m.toLowerCase())h[o.main]=d,h[o.subjoin]=v[1].replace(/[\?\!]+(\s*)$/,"$1"),h[o.sub]=g.replace(l.TITLE_SPLIT_REGEXP.matchfirst,""),this.opt.development_extensions.force_short_title_casing_alignment&&(h[o.short]=h[o.main]);else{var b=l.TITLE_SPLIT(h[o.title]);b.length==3?(h[o.main]=b[0],h[o.subjoin]=b[1],h[o.sub]=b[2]):(h[o.main]=h[o.title],h[o.subjoin]="",h[o.sub]="")}}else{var b=l.TITLE_SPLIT(h[o.title]);if(b.length==3){if(h[o.main]=b[0],h[o.subjoin]=b[1],h[o.sub]=b[2],this.opt.development_extensions.implicit_short_title&&e.type!=="legal_case"&&!e[o.short]&&!h[o.main].match(/^[\-\.[0-9]+$/)){var E=h[o.subjoin].trim();["?","!"].indexOf(E)===-1&&(E=""),h[o.short]=h[o.main]+E}}else h[o.main]=h[o.title],h[o.subjoin]="",h[o.sub]=""}if(h[o.subjoin]&&h[o.subjoin].match(/([\?\!])/)){var v=h[o.subjoin].match(/(\s*)$/);h[o.main]=h[o.main]+r+h[o.subjoin].trim(),h[o.subjoin]=v[1]}}if(h[o.subjoin]&&(h[o.subjoin].indexOf(":")>-1&&(h[o.subjoin]=r+": "),(h[o.subjoin].indexOf("-")>-1||h[o.subjoin].indexOf("\u2014")>-1)&&(h[o.subjoin]="\u2014")),c)for(var x in h)e.multi._keys[x]||(e.multi._keys[x]={}),e.multi._keys[x][c]=h[x];else for(var x in h)e[x]=h[x]}}},titlecaseSentenceOrNormal:function(e,t,r,i,s){var a=l.TITLE_FIELD_SPLITS(r),n={};if(i&&t.multi?(t.multi._keys[a.title]&&(n[a.title]=t.multi._keys[a.title][i]),t.multi._keys[a.main]&&(n[a.main]=t.multi._keys[a.main][i]),t.multi._keys[a.sub]&&(n[a.sub]=t.multi._keys[a.sub][i]),t.multi._keys[a.subjoin]&&(n[a.subjoin]=t.multi._keys[a.subjoin][i])):(n[a.title]=t[a.title],n[a.main]=t[a.main],n[a.sub]=t[a.sub],n[a.subjoin]=t[a.subjoin]),n[a.main]&&n[a.sub]){var o=n[a.main],u=n[a.subjoin],c=n[a.sub];return s?(o=l.Output.Formatters.sentence(e,o),c=l.Output.Formatters.sentence(e,c)):e.opt.development_extensions.uppercase_subtitles&&(c=l.Output.Formatters["capitalize-first"](e,c)),[o,u,c].join("")}else if(n[a.title]){if(s)return l.Output.Formatters.sentence(e,n[a.title]);if(e.opt.development_extensions.uppercase_subtitles){for(var p=l.TITLE_SPLIT(n[a.title]),f=0,h=p.length;f<h;f+=2)p[f]=l.Output.Formatters["capitalize-first"](e,p[f]);for(var f=1,h=p.length-1;f<h;f+=2){var m=p[f].match(/([:\?\!] )/);if(m){var g=e.opt["default-locale"][0].slice(0,2).toLowerCase()==="fr"?"\u202F":"";p[f]=g+m[1]}(p[f].indexOf("-")>-1||p[f].indexOf("\u2014")>-1)&&(p[f]="\u2014")}return n[a.title]=p.join(""),n[a.title]}else return n[a.title]}else return""},getSafeEscape:function(e){if(["bibliography","citation"].indexOf(e.tmp.area)>-1){var t=[];return e.opt.development_extensions.thin_non_breaking_space_html_hack&&e.opt.mode==="html"&&t.push(function(r){return r.replace(/\u202f/g,'<span style="white-space:nowrap">&thinsp;</span>')}),t.length?function(r){for(var i=0,s=t.length;i<s;i+=1)r=t[i](r);return l.Output.Formats[e.opt.mode].text_escape(r)}:l.Output.Formats[e.opt.mode].text_escape}else return function(r){return r}},SKIP_WORDS:["about","above","across","afore","after","against","al","along","alongside","amid","amidst","among","amongst","anenst","apropos","apud","around","as","aside","astride","at","athwart","atop","barring","before","behind","below","beneath","beside","besides","between","beyond","but","by","circa","despite","down","during","et","except","for","forenenst","from","given","in","inside","into","lest","like","modulo","near","next","notwithstanding","of","off","on","onto","out","over","per","plus","pro","qua","sans","since","than","through"," thru","throughout","thruout","till","to","toward","towards","under","underneath","until","unto","up","upon","versus","vs.","v.","vs","v","via","vis-\xE0-vis","with","within","without","according to","ahead of","apart from","as for","as of","as per","as regards","aside from","back to","because of","close to","due to","except for","far from","inside of","instead of","near to","next to","on to","out from","out of","outside of","prior to","pursuant to","rather than","regardless of","such as","that of","up to","where as","or","yet","so","for","and","nor","a","an","the","de","d'","von","van","c","ca"],FORMAT_KEY_SEQUENCE:["@strip-periods","@font-style","@font-variant","@font-weight","@text-decoration","@vertical-align","@quotes"],INSTITUTION_KEYS:["font-style","font-variant","font-weight","text-decoration","text-case"],SUFFIX_CHARS:"a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z",ROMAN_NUMERALS:[["","i","ii","iii","iv","v","vi","vii","viii","ix"],["","x","xx","xxx","xl","l","lx","lxx","lxxx","xc"],["","c","cc","ccc","cd","d","dc","dcc","dccc","cm"],["","m","mm","mmm","mmmm","mmmmm"]],LANGS:{"af-ZA":"Afrikaans",ar:"Arabic","bg-BG":"Bulgarian","ca-AD":"Catalan","cs-CZ":"Czech","da-DK":"Danish","de-AT":"Austrian","de-CH":"German (CH)","de-DE":"German (DE)","el-GR":"Greek","en-GB":"English (GB)","en-US":"English (US)","es-ES":"Spanish","et-EE":"Estonian",eu:"European","fa-IR":"Persian","fi-FI":"Finnish","fr-CA":"French (CA)","fr-FR":"French (FR)","he-IL":"Hebrew","hr-HR":"Croatian","hu-HU":"Hungarian","is-IS":"Icelandic","it-IT":"Italian","ja-JP":"Japanese","km-KH":"Khmer","ko-KR":"Korean","lt-LT":"Lithuanian","lv-LV":"Latvian","mn-MN":"Mongolian","nb-NO":"Norwegian (Bokm\xE5l)","nl-NL":"Dutch","nn-NO":"Norwegian (Nynorsk)","pl-PL":"Polish","pt-BR":"Portuguese (BR)","pt-PT":"Portuguese (PT)","ro-RO":"Romanian","ru-RU":"Russian","sk-SK":"Slovak","sl-SI":"Slovenian","sr-RS":"Serbian","sv-SE":"Swedish","th-TH":"Thai","tr-TR":"Turkish","uk-UA":"Ukrainian","vi-VN":"Vietnamese","zh-CN":"Chinese (CN)","zh-TW":"Chinese (TW)"},LANG_BASES:{af:"af_ZA",ar:"ar",bg:"bg_BG",ca:"ca_AD",cs:"cs_CZ",da:"da_DK",de:"de_DE",el:"el_GR",en:"en_US",es:"es_ES",et:"et_EE",eu:"eu",fa:"fa_IR",fi:"fi_FI",fr:"fr_FR",he:"he_IL",hr:"hr-HR",hu:"hu_HU",is:"is_IS",it:"it_IT",ja:"ja_JP",km:"km_KH",ko:"ko_KR",lt:"lt_LT",lv:"lv-LV",mn:"mn_MN",nb:"nb_NO",nl:"nl_NL",nn:"nn-NO",pl:"pl_PL",pt:"pt_PT",ro:"ro_RO",ru:"ru_RU",sk:"sk_SK",sl:"sl_SI",sr:"sr_RS",sv:"sv_SE",th:"th_TH",tr:"tr_TR",uk:"uk_UA",vi:"vi_VN",zh:"zh_CN"},SUPERSCRIPTS:{\u00AA:"a","\xB2":"2","\xB3":"3","\xB9":"1",\u00BA:"o",\u02B0:"h",\u02B1:"\u0266",\u02B2:"j",\u02B3:"r",\u02B4:"\u0279",\u02B5:"\u027B",\u02B6:"\u0281",\u02B7:"w",\u02B8:"y",\u02E0:"\u0263",\u02E1:"l",\u02E2:"s",\u02E3:"x",\u02E4:"\u0295","\u1D2C":"A","\u1D2D":"\xC6","\u1D2E":"B","\u1D30":"D","\u1D31":"E","\u1D32":"\u018E","\u1D33":"G","\u1D34":"H","\u1D35":"I","\u1D36":"J","\u1D37":"K","\u1D38":"L","\u1D39":"M","\u1D3A":"N","\u1D3C":"O","\u1D3D":"\u0222","\u1D3E":"P","\u1D3F":"R","\u1D40":"T","\u1D41":"U","\u1D42":"W","\u1D43":"a","\u1D44":"\u0250","\u1D45":"\u0251","\u1D46":"\u1D02","\u1D47":"b","\u1D48":"d","\u1D49":"e","\u1D4A":"\u0259","\u1D4B":"\u025B","\u1D4C":"\u025C","\u1D4D":"g","\u1D4F":"k","\u1D50":"m","\u1D51":"\u014B","\u1D52":"o","\u1D53":"\u0254","\u1D54":"\u1D16","\u1D55":"\u1D17","\u1D56":"p","\u1D57":"t","\u1D58":"u","\u1D59":"\u1D1D","\u1D5A":"\u026F","\u1D5B":"v","\u1D5C":"\u1D25","\u1D5D":"\u03B2","\u1D5E":"\u03B3","\u1D5F":"\u03B4","\u1D60":"\u03C6","\u1D61":"\u03C7","\u2070":"0","\u2071":"i","\u2074":"4","\u2075":"5","\u2076":"6","\u2077":"7","\u2078":"8","\u2079":"9","\u207A":"+","\u207B":"\u2212","\u207C":"=","\u207D":"(","\u207E":")",\u207F:"n","\u2120":"SM","\u2122":"TM","\u3192":"\u4E00","\u3193":"\u4E8C","\u3194":"\u4E09","\u3195":"\u56DB","\u3196":"\u4E0A","\u3197":"\u4E2D","\u3198":"\u4E0B","\u3199":"\u7532","\u319A":"\u4E59","\u319B":"\u4E19","\u319C":"\u4E01","\u319D":"\u5929","\u319E":"\u5730","\u319F":"\u4EBA",\u02C0:"\u0294",\u02C1:"\u0295",\u06E5:"\u0648",\u06E6:"\u064A"},SUPERSCRIPTS_REGEXP:new RegExp("[\xAA\xB2\xB3\xB9\xBA\u02B0\u02B1\u02B2\u02B3\u02B4\u02B5\u02B6\u02B7\u02B8\u02E0\u02E1\u02E2\u02E3\u02E4\u1D2C\u1D2D\u1D2E\u1D30\u1D31\u1D32\u1D33\u1D34\u1D35\u1D36\u1D37\u1D38\u1D39\u1D3A\u1D3C\u1D3D\u1D3E\u1D3F\u1D40\u1D41\u1D42\u1D43\u1D44\u1D45\u1D46\u1D47\u1D48\u1D49\u1D4A\u1D4B\u1D4C\u1D4D\u1D4F\u1D50\u1D51\u1D52\u1D53\u1D54\u1D55\u1D56\u1D57\u1D58\u1D59\u1D5A\u1D5B\u1D5C\u1D5D\u1D5E\u1D5F\u1D60\u1D61\u2070\u2071\u2074\u2075\u2076\u2077\u2078\u2079\u207A\u207B\u207C\u207D\u207E\u207F\u2120\u2122\u3192\u3193\u3194\u3195\u3196\u3197\u3198\u3199\u319A\u319B\u319C\u319D\u319E\u319F\u02C0\u02C1\u06E5\u06E6]","g"),UPDATE_GROUP_CONTEXT_CONDITION:function(e,t,r,i,s){if(e.opt.use_context_condition){var a=e.tmp.group_context.tip;a.condition?(a.condition.termtxt||(a.condition.termtxt=t,a.condition.valueTerm=r),!a.value_seen&&a.condition.test==="comma-safe-numbers-only"&&s&&(a.value_seen=!0,s.match(/^[0-9]/)||(e.tmp.just_did_number=!1))):i&&i.decorations.filter(n=>n[0]==="@vertical-align").length>0||i&&i.strings.suffix?e.tmp.just_did_number=!1:t&&(t.match(/[0-9]$/)?e.tmp.just_did_number=!0:e.tmp.just_did_number=!1)}},EVALUATE_GROUP_CONDITION:function(e,t){if(e.opt.use_context_condition){var r,i=t.condition.test==="comma-safe-numbers-only";if(t.condition.test==="empty-label")r=!t.condition.termtxt;else if(t.condition.test==="empty-label-no-decor")r=!t.condition.termtxt||t.condition.termtxt.indexOf("%s")>-1;else if(["comma-safe","comma-safe-numbers-only"].indexOf(t.condition.test)>-1){var s=t.condition.termtxt,a=!1;t.condition.termtxt&&(a=t.condition.termtxt.slice(0,1).match(l.ALL_ROMANESQUE_REGEXP));var n=e.tmp.just_did_number;n?t.condition.valueTerm?r=!i:s?a?r=!i:["always","after-number"].indexOf(e.opt.require_comma_on_symbol)>-1?r=!0:r=!1:r=!0:t.condition.valueTerm?r=!1:s?a?r=!i:e.opt.require_comma_on_symbol==="always"?r=!0:r=!1:r=!1}if(r)var o=!1;else var o=!0;return t.condition.not&&(o=!o),o}},SYS_OPTIONS:["prioritize_disambiguate_condition","csl_reverse_lookup_support","main_title_from_short_title","uppercase_subtitles","force_short_title_casing_alignment","implicit_short_title","split_container_title"],TITLE_SPLIT_REGEXP:function(){var e=["\\.\\s+","\\!\\s+","\\?\\s+","\\s*::*\\s+","\\s*\u2014\\s*","\\s+\\-\\s+","\\s*\\-\\-\\-*\\s*"];return{match:new RegExp("("+e.join("|")+")","g"),matchfirst:new RegExp("^("+e.join("|")+")"),split:new RegExp("(?:"+e.join("|")+")")}}(),TITLE_SPLIT:function(e){if(!e)return e;for(var t=e.match(l.TITLE_SPLIT_REGEXP.match),r=e.split(l.TITLE_SPLIT_REGEXP.split),i=r.length-2;i>-1;i--)r[i]=r[i].trim(),r[i]&&r[i].slice(-1).toLowerCase()!==r[i].slice(-1)?(r[i]=r[i]+t[i]+r[i+1],r=r.slice(0,i+1).concat(r.slice(i+2))):r=r.slice(0,i+1).concat([t[i]]).concat(r.slice(i+1));return r},GET_COURT_CLASS:function(e,t,r){var i="",s=null,a=t.jurisdiction?t.jurisdiction.split(":")[0]:null,n="court_condition_classes";return r&&(n="court_key_classes"),a&&t.authority&&(typeof t.authority=="string"?s=t.authority:t.authority[0]&&t.authority[0].literal&&(s=t.authority[0].literal)),s&&(this.lang&&e.locale[this.lang].opts[n]&&e.locale[this.lang].opts[n][a]&&e.locale[this.lang].opts[n][a][s]?i=e.locale[this.lang].opts[n][a][s]:e.locale[e.opt["default-locale"][0]].opts[n]&&e.locale[e.opt["default-locale"][0]].opts[n][a]&&e.locale[e.opt["default-locale"][0]].opts[n][a][s]&&(i=e.locale[e.opt["default-locale"][0]].opts[n][a][s])),i},SET_COURT_CLASSES:function(e,t,r,i){for(var s=r.getNodesByName(i,"court-class"),a=0,n=r.numberofnodes(s);a<n;a+=1){var o=s[a],u=r.attributes(o),c=u["@name"],p=u["@country"],f=u["@courts"],h="court_key_classes";if(e.registry&&(h="court_condition_classes"),c&&p&&f){f=f.trim().split(/\s+/),e.locale[t].opts[h]||(e.locale[t].opts[h]={}),e.locale[t].opts[h][p]||(e.locale[t].opts[h][p]={});for(var m=0,g=f.length;m<g;m++)e.locale[t].opts[h][p][f[m]]=c}}},INIT_JURISDICTION_MACROS:function(e,t,r,i){if(t["best-jurisdiction"])return!0;if(!e.sys.retrieveStyleModule||!l.MODULE_MACROS[i]||!t.jurisdiction)return!1;var o=e.getJurisdictionList(t.jurisdiction);if(!e.opt.jurisdictions_seen[o[0]]){var s=e.retrieveAllStyleModules(o);for(var a in s){var n=e.loadStyleModule(a,s[a]);n&&(s[n]||(Object.assign(s,e.retrieveAllStyleModules([n])),e.loadStyleModule(n,s[n],!0)))}}var o=e.getJurisdictionList(t.jurisdiction);e.opt.parallel.enable&&(e.parallel||(e.parallel=new l.Parallel(e)));for(var u=0,c=o.length;u<c;u++){var a=o[u];if(r&&e.juris[a]&&!r["best-jurisdiction"]&&e.juris[a].types.locator&&(t["best-jurisdiction"]=a),e.juris[a]&&e.juris[a].types[t.type])return t["best-jurisdiction"]=a,!0}return!1}};l.XmlJSON=function(e){this.dataObj=e,this.institution={name:"institution",attrs:{"institution-parts":"long",delimiter:", "},children:[{name:"institution-part",attrs:{name:"long"},children:[]}]}};l.XmlJSON.prototype.clean=function(e){return e};l.XmlJSON.prototype.getStyleId=function(e,t){var r="id";t&&(r="title");for(var i="",s=e.children,a=0,n=s.length;a<n;a++)if(s[a].name==="info")for(var o=s[a].children,u=0,c=o.length;u<c;u++)o[u].name===r&&(i=o[u].children[0]);return i};l.XmlJSON.prototype.children=function(e){return e&&e.children.length?e.children.slice():!1};l.XmlJSON.prototype.nodename=function(e){return e?e.name:null};l.XmlJSON.prototype.attributes=function(e){var t={};for(var r in e.attrs)t["@"+r]=e.attrs[r];return t};l.XmlJSON.prototype.content=function(e){var t="";if(!e||!e.children)return t;for(var r=0,i=e.children.length;r<i;r+=1)typeof e.children[r]=="string"&&(t+=e.children[r]);return t};l.XmlJSON.prototype.namespace={};l.XmlJSON.prototype.numberofnodes=function(e){return e&&typeof e.length=="number"?e.length:0};l.XmlJSON.prototype.getAttributeValue=function(e,t,r){var i="";return r&&(t=r+":"+t),e&&e.attrs&&(e.attrs[t]?i=e.attrs[t]:i=""),i};l.XmlJSON.prototype.getNodeValue=function(e,t){var r="";if(t)for(var i=0,s=e.children.length;i<s;i+=1)e.children[i].name===t&&(e.children[i].children.length?r=e.children[i]:r="");else e&&(r=e);return r&&r.children&&r.children.length==1&&typeof r.children[0]=="string"&&(r=r.children[0]),r};l.XmlJSON.prototype.setAttributeOnNodeIdentifiedByNameAttribute=function(e,t,r,i,s){var a,n,o,u,c;i.slice(0,1)==="@"&&(i=i.slice(1));for(var p=0,f=e.children.length;p<f;p+=1)e.children[p].name===t&&e.children[p].attrs.name===r&&(e.children[p].attrs[i]=s)};l.XmlJSON.prototype.deleteNodeByNameAttribute=function(e,t){var r,i;for(r=0,i=e.children.length;r<i;r+=1)!e.children[r]||typeof e.children[r]=="string"||e.children[r].attrs.name==t&&(e.children=e.children.slice(0,r).concat(e.children.slice(r+1)))};l.XmlJSON.prototype.deleteAttribute=function(e,t){var r,i;typeof e.attrs[t]!="undefined"&&e.attrs.pop(t)};l.XmlJSON.prototype.setAttribute=function(e,t,r){return e.attrs[t]=r,!1};l.XmlJSON.prototype.nodeCopy=function(e,t){if(!t)var t={};if(typeof t=="object"&&typeof t.length=="undefined")for(var r in e)typeof e[r]=="string"?t[r]=e[r]:typeof e[r]=="object"&&(typeof e[r].length=="undefined"?t[r]=this.nodeCopy(e[r],{}):t[r]=this.nodeCopy(e[r],[]));else for(var i=0,s=e.length;i<s;i+=1)typeof e[i]=="string"?t[i]=e[i]:t[i]=this.nodeCopy(e[i],{});return t};l.XmlJSON.prototype.getNodesByName=function(e,t,r,i){var s,a,n,o;if(!i)var i=[];if(!e||!e.children)return i;t===e.name&&(r?r===e.attrs.name&&i.push(e):i.push(e));for(var u=0,c=e.children.length;u<c;u+=1)typeof e.children[u]=="object"&&this.getNodesByName(e.children[u],t,r,i);return i};l.XmlJSON.prototype.nodeNameIs=function(e,t){return typeof e=="undefined"?!1:t==e.name};l.XmlJSON.prototype.makeXml=function(e){return typeof e=="string"&&(e.slice(0,1)==="<"?e=this.jsonStringWalker.walkToObject(e):e=JSON.parse(e)),e};l.XmlJSON.prototype.insertChildNodeAfter=function(e,t,r,i){for(var s=0,a=e.children.length;s<a;s+=1)if(t===e.children[s]){e.children=e.children.slice(0,s).concat([i]).concat(e.children.slice(s+1));break}return e};l.XmlJSON.prototype.insertPublisherAndPlace=function(e){if(e.name==="group"){for(var t=!0,r=["publisher","publisher-place"],i=0,s=e.children.length;i<s;i+=1){var a=r.indexOf(e.children[i].attrs.variable),n=e.children[i].name==="text";if(n&&a>-1&&!e.children[i].attrs.prefix&&!e.children[i].attrs.suffix)r=r.slice(0,a).concat(r.slice(a+1));else{t=!1;break}}t&&!r.length&&(e.attrs["has-publisher-and-publisher-place"]=!0)}for(var i=0,s=e.children.length;i<s;i+=1)typeof e.children[i]=="object"&&this.insertPublisherAndPlace(e.children[i])};l.XmlJSON.prototype.isChildOfSubstitute=function(e){if(e.length>0){var t=e.slice(),r=t.pop();return r==="substitute"?!0:this.isChildOfSubstitute(t)}return!1};l.XmlJSON.prototype.addMissingNameNodes=function(e,t){if(t||(t=[]),e.name==="names"&&!this.isChildOfSubstitute(t)){for(var r=!0,i=0,s=e.children.length;i<s;i++)if(e.children[i].name==="name"){r=!1;break}r&&(e.children=[{name:"name",attrs:{},children:[]}].concat(e.children))}t.push(e.name);for(var i=0,s=e.children.length;i<s;i+=1)typeof e.children[i]=="object"&&this.addMissingNameNodes(e.children[i],t);t.pop()};l.XmlJSON.prototype.addInstitutionNodes=function(e){var t,r,i,s,a,n,o,u,c;if(e.name==="names"){for(var p={},f=-1,h=0,m=e.children.length;h<m;h+=1){if(e.children[h].name=="name"){for(var g in e.children[h].attrs)p[g]=e.children[h].attrs[g];p.delimiter=e.children[h].attrs.delimiter,p.and=e.children[h].attrs.and,f=h;for(var d=0,v=e.children[h].children.length;d<v;d+=1)if(e.children[h].children[d].attrs.name==="family")for(var g in e.children[h].children[d].attrs)p[g]=e.children[h].children[d].attrs[g]}if(e.children[h].name=="institution"){f=-1;break}}if(f>-1){for(var i=this.nodeCopy(this.institution),h=0,m=l.INSTITUTION_KEYS.length;h<m;h+=1){var b=l.INSTITUTION_KEYS[h];typeof p[b]!="undefined"&&(i.children[0].attrs[b]=p[b]),p.delimiter&&(i.attrs.delimiter=p.delimiter),p.and&&(i.attrs.and=p.and)}e.children=e.children.slice(0,f+1).concat([i]).concat(e.children.slice(f+1))}}for(var h=0,m=e.children.length;h<m;h+=1)typeof e.children[h]!="string"&&this.addInstitutionNodes(e.children[h])};l.XmlJSON.prototype.flagDateMacros=function(e){for(var t=0,r=e.children.length;t<r;t+=1)e.children[t].name==="macro"&&this.inspectDateMacros(e.children[t])&&(e.children[t].attrs["macro-has-date"]="true")};l.XmlJSON.prototype.inspectDateMacros=function(e){if(!e||!e.children)return!1;if(e.name==="date")return!0;for(var t=0,r=e.children.length;t<r;t+=1)if(this.inspectDateMacros(e.children[t]))return!0;return!1};l.stripXmlProcessingInstruction=function(e){return e&&(e=e.replace(/^<\?[^?]+\?>/,""),e=e.replace(/<!--[^>]+-->/g,""),e=e.replace(/^\s+/g,""),e=e.replace(/\s+$/g,""),e)};l.parseXml=function(e){var t=0,r={children:[]},i=[r.children];function s(E){E=E.split(/(?:\r\n|\n|\r)/).join(" ").replace(/>[	 ]+</g,"><").replace(/<\!--.*?-->/g,"");for(var x=E.split("><"),w=null,S=0,T=x.length;S<T;S++)S>0&&(x[S]="<"+x[S]),S<x.length-1&&(x[S]=x[S]+">"),typeof w!="number"&&(x[S].slice(0,7)==="<style "||x[S].slice(0,8)=="<locale ")&&(w=S);x=x.slice(w);for(var S=x.length-2;S>-1;S--)if(x[S].slice(1).indexOf("<")===-1){var I=x[S].slice(0,5);x[S].slice(-2)!=="/>"&&(I==="<term"?x[S+1].slice(0,6)==="</term"&&(x[S]=x[S]+x[S+1],x=x.slice(0,S+1).concat(x.slice(S+2))):["<sing","<mult"].indexOf(I)>-1&&x[S].slice(-2)!=="/>"&&x[S+1].slice(0,1)==="<"&&(x[S]=x[S]+x[S+1],x=x.slice(0,S+1).concat(x.slice(S+2))))}return x}function a(E){return E.split("&amp;").join("&").split("&quot;").join('"').split("&gt;").join(">").split("&lt;").join("<").replace(/&#([0-9]{1,6});/gi,function(x,w){var S=parseInt(w,10);return String.fromCharCode(S)}).replace(/&#x([a-f0-9]{1,6});/gi,function(x,w){var S=parseInt(w,16);return String.fromCharCode(S)})}function n(E){var x=E.match(/([^\'\"=	 ]+)=(?:\"[^\"]*\"|\'[^\']*\')/g);if(x)for(var w=0,S=x.length;w<S;w++)x[w]=x[w].replace(/=.*/,"");return x}function o(E,x){var w=RegExp("^.*[	 ]+"+x+`=("(?:[^"]*)"|'(?:[^']*)').*$`),S=E.match(w);return S?S[1].slice(1,-1):null}function u(E){var x=RegExp("^<([^	 />]+)"),w=E.match(x);return w?w[1]:null}function c(E){var x={};x.name=u(E),x.attrs={};var w=n(E);if(w)for(var S=0,T=w.length;S<T;S++){var I={name:w[S],value:o(E,w[S])};x.attrs[I.name]=a(I.value)}return x.children=[],x}function p(E){var x=E.match(/^.*>([^<]*)<.*$/);return a(x[1])}function f(E){i.slice(-1)[0].push(E)}function h(E){i.push(E.children)}function m(E){var x;if(E.slice(1).indexOf("<")>-1){var w=E.slice(0,E.indexOf(">")+1);x=c(w),x.children=[p(E)],f(x)}else E.slice(-2)==="/>"?(x=c(E),u(E)==="term"&&x.children.push(""),f(x)):E.slice(0,2)==="</"?i.pop():(x=c(E),f(x),h(x))}for(var g=s(e),d=0,v=g.length;d<v;d++){var b=g[d];m(b)}return r.children[0]};l.XmlDOM=function(e){this.dataObj=e,typeof DOMParser=="undefined"?(DOMParser=function(){},DOMParser.prototype.parseFromString=function(a,n){if(typeof ActiveXObject!="undefined"){var o=new ActiveXObject("MSXML.DomDocument");return o.async=!1,o.loadXML(a),o}else if(typeof XMLHttpRequest!="undefined"){var o=new XMLHttpRequest;return n||(n="text/xml"),o.open("GET","data:"+n+";charset=utf-8,"+encodeURIComponent(a),!1),o.overrideMimeType&&o.overrideMimeType(n),o.send(null),o.responseXML}else if(typeof marknote!="undefined"){var u=new marknote.Parser;return u.parse(a)}},this.hasAttributes=function(a){var n;return a.attributes&&a.attributes.length?n=!0:n=!1,n}):this.hasAttributes=function(a){var n;return a.attributes&&a.attributes.length?n=!0:n=!1,n},this.importNode=function(a,n){var o;return typeof a.importNode=="undefined"?o=this._importNode(a,n,!0):o=a.importNode(n,!0),o},this._importNode=function(a,n,o){switch(n.nodeType){case 1:var u=a.createElement(n.nodeName);if(n.attributes&&n.attributes.length>0)for(var c=0,p=n.attributes.length;c<p;)u.setAttribute(n.attributes[c].nodeName,n.getAttribute(n.attributes[c++].nodeName));if(o&&n.childNodes&&n.childNodes.length>0)for(var c=0,p=n.childNodes.length;c<p;)u.appendChild(this._importNode(a,n.childNodes[c++],o));return u;case 3:case 4:case 8:}},this.parser=new DOMParser;var t='<docco><institution institution-parts="long" delimiter=", " substitute-use-first="1" use-last="1"><institution-part name="long"/></institution></docco>',r=this.parser.parseFromString(t,"text/xml"),i=r.getElementsByTagName("institution");this.institution=i.item(0);var s=r.getElementsByTagName("institution-part");this.institutionpart=s.item(0),this.ns="http://purl.org/net/xbiblio/csl"};l.XmlDOM.prototype.clean=function(e){return e=e.replace(/<\?[^?]+\?>/g,""),e=e.replace(/<![^>]+>/g,""),e=e.replace(/^\s+/,""),e=e.replace(/\s+$/,""),e=e.replace(/^\n*/,""),e};l.XmlDOM.prototype.getStyleId=function(e,t){var r="",i="id";t&&(i="title");var s=e.getElementsByTagName(i);return s&&s.length&&(s=s.item(0)),s&&(r=s.textContent),r||(r=s.innerText),r||(r=s.innerHTML),r};l.XmlDOM.prototype.children=function(e){var t,r,i,s;if(e){for(s=[],t=e.childNodes,r=0,i=t.length;r<i;r+=1)t[r].nodeName!="#text"&&s.push(t[r]);return s}else return[]};l.XmlDOM.prototype.nodename=function(e){var t=e.nodeName;return t};l.XmlDOM.prototype.attributes=function(e){var t,r,i,s,a,n,o;if(t=new Object,e&&this.hasAttributes(e))for(r=e.attributes,n=0,o=r.length;n<o;n+=1)i=r[n],t["@"+i.name]=i.value;return t};l.XmlDOM.prototype.content=function(e){var t;return typeof e.textContent!="undefined"?t=e.textContent:typeof e.innerText!="undefined"?t=e.innerText:t=e.txt,t};l.XmlDOM.prototype.namespace={xml:"http://www.w3.org/XML/1998/namespace"};l.XmlDOM.prototype.numberofnodes=function(e){return e?e.length:0};l.XmlDOM.prototype.getAttributeName=function(e){var t=e.name;return t};l.XmlDOM.prototype.getAttributeValue=function(e,t,r){var i="";return r&&(t=r+":"+t),e&&this.hasAttributes(e)&&e.getAttribute(t)&&(i=e.getAttribute(t)),i};l.XmlDOM.prototype.getNodeValue=function(e,t){var r=null;if(t){var i=e.getElementsByTagName(t);i.length>0&&(typeof i[0].textContent!="undefined"?r=i[0].textContent:typeof i[0].innerText!="undefined"?r=i[0].innerText:r=i[0].text)}return r===null&&e&&e.childNodes&&(e.childNodes.length==0||e.childNodes.length==1&&e.firstChild.nodeName=="#text")&&(typeof e.textContent!="undefined"?r=e.textContent:typeof e.innerText!="undefined"?r=e.innerText:r=e.text),r===null&&(r=e),r};l.XmlDOM.prototype.setAttributeOnNodeIdentifiedByNameAttribute=function(e,t,r,i,s){var a,n,o,u,c;for(i.slice(0,1)==="@"&&(i=i.slice(1)),u=e.getElementsByTagName(t),a=0,n=u.length;a<n;a+=1)c=u[a],c.getAttribute("name")==r&&c.setAttribute(i,s)};l.XmlDOM.prototype.deleteNodeByNameAttribute=function(e,t){var r,i,s,a;for(a=e.childNodes,r=0,i=a.length;r<i;r+=1)s=a[r],!(!s||s.nodeType==s.TEXT_NODE)&&this.hasAttributes(s)&&s.getAttribute("name")==t&&e.removeChild(a[r])};l.XmlDOM.prototype.deleteAttribute=function(e,t){e.removeAttribute(t)};l.XmlDOM.prototype.setAttribute=function(e,t,r){return e.ownerDocument||(e=e.firstChild),["function","unknown"].indexOf(typeof e.setAttribute)>-1&&e.setAttribute(t,r),!1};l.XmlDOM.prototype.nodeCopy=function(e){var t=e.cloneNode(!0);return t};l.XmlDOM.prototype.getNodesByName=function(e,t,r){var i,s,a,n,o;for(i=[],s=e.getElementsByTagName(t),n=0,o=s.length;n<o;n+=1)a=s.item(n),!(r&&!(this.hasAttributes(a)&&a.getAttribute("name")==r))&&i.push(a);return i};l.XmlDOM.prototype.nodeNameIs=function(e,t){return t==e.nodeName};l.XmlDOM.prototype.makeXml=function(e){var t,r;e||(e="<docco><bogus/></docco>"),e=e.replace(/\s*<\?[^>]*\?>\s*\n*/g,"");var i=this.parser.parseFromString(e,"application/xml");return i.firstChild};l.XmlDOM.prototype.insertChildNodeAfter=function(e,t,r,i){var s,a;return s=this.importNode(t.ownerDocument,i),e.replaceChild(s,t),e};l.XmlDOM.prototype.insertPublisherAndPlace=function(e){for(var t=e.getElementsByTagName("group"),r=0,i=t.length;r<i;r+=1){for(var s=t.item(r),a=[],n=0,o=s.childNodes.length;n<o;n+=1)s.childNodes.item(n).nodeType!==1&&a.push(n);if(s.childNodes.length-a.length===2){for(var u=[],n=0,o=2;n<o;n+=1)if(!(a.indexOf(n)>-1)){for(var c=s.childNodes.item(n),p=[],f=0,h=c.childNodes.length;f<h;f+=1)c.childNodes.item(f).nodeType!==1&&p.push(f);if(c.childNodes.length-p.length===0&&(u.push(c.getAttribute("variable")),c.getAttribute("suffix")||c.getAttribute("prefix"))){u=[];break}}u.indexOf("publisher")>-1&&u.indexOf("publisher-place")>-1&&s.setAttribute("has-publisher-and-publisher-place",!0)}}};l.XmlDOM.prototype.isChildOfSubstitute=function(e){return e.parentNode?e.parentNode.tagName.toLowerCase()==="substitute"?!0:this.isChildOfSubstitute(e.parentNode):!1};l.XmlDOM.prototype.addMissingNameNodes=function(e){for(var t=e.getElementsByTagName("names"),r=0,i=t.length;r<i;r+=1){var s=t.item(r),a=s.getElementsByTagName("name");if((!a||a.length===0)&&!this.isChildOfSubstitute(s)){var n=s.ownerDocument,o=n.createElement("name");s.appendChild(o)}}};l.XmlDOM.prototype.addInstitutionNodes=function(e){var t,r,i,s,a,n,o,u,c,p;for(t=e.getElementsByTagName("names"),c=0,p=t.length;c<p;c+=1)if(r=t.item(c),n=r.getElementsByTagName("name"),n.length!=0&&(i=r.getElementsByTagName("institution"),i.length==0)){s=this.importNode(e.ownerDocument,this.institution),a=s.getElementsByTagName("institution-part").item(0),o=n.item(0),r.insertBefore(s,o.nextSibling);for(var f=0,h=l.INSTITUTION_KEYS.length;f<h;f+=1){var m=l.INSTITUTION_KEYS[f],g=o.getAttribute(m);g&&a.setAttribute(m,g)}for(var d=o.getElementsByTagName("name-part"),f=0,h=d.length;f<h;f+=1)if(d[f].getAttribute("name")==="family")for(var v=0,b=l.INSTITUTION_KEYS.length;v<b;v+=1){var m=l.INSTITUTION_KEYS[v],g=d[f].getAttribute(m);g&&a.setAttribute(m,g)}}};l.XmlDOM.prototype.flagDateMacros=function(e){var t,r,i,s,a=e.getElementsByTagName("macro");for(t=0,r=a.length;t<r;t+=1)i=a.item(t),s=i.getElementsByTagName("date"),s.length&&i.setAttribute("macro-has-date","true")};l.setupXml=function(e){var t={},r=null;return typeof e!="undefined"?typeof e=="string"?(e=e.replace("^\uFEFF","").replace(/^\s+/,""),e.slice(0,1)==="<"?t=l.parseXml(e):t=JSON.parse(e),r=new l.XmlJSON(t)):typeof e.getAttribute!="undefined"?r=new l.XmlDOM(e):typeof e.toXMLString!="undefined"?r=new l.XmlE4X(e):r=new l.XmlJSON(e):l.error("unable to parse XML input"),r||l.error("citeproc-js error: unable to parse CSL style or locale object"),r};l.getSortCompare=function(e){if(l.stringCompare)return l.stringCompare;var t=this,r,i={sensitivity:"base",ignorePunctuation:!0,numeric:!0};e||(e="en-US"),r=function(u,c){return l.toLocaleLowerCase.call(t,u).localeCompare(l.toLocaleLowerCase.call(t,c),e,i)};var s=function(u){return u.replace(/^[\[\]\'\"]*/g,"")},a=function(){return r("[x","x")?function(u,c){return r(s(u),s(c))}:!1},n=a(),o=function(u,c){return n?n(u,c):r(u,c)};return o};l.ambigConfigDiff=function(e,t){var r,i,s,a;if(e.names.length!==t.names.length)return 1;for(r=0,i=e.names.length;r<i;r+=1){if(e.names[r]!==t.names[r])return 1;for(s=0,a=e.givens[r];s<a;s+=1)if(e.givens[r][s]!==t.givens[r][s])return 1}return e.disambiguate!=t.disambiguate||e.year_suffix!==t.year_suffix?1:0};l.cloneAmbigConfig=function(e,t){var r,i,s,a,n,o={};for(o.names=[],o.givens=[],o.year_suffix=!1,o.disambiguate=!1,r=0,i=e.names.length;r<i;r+=1)n=e.names[r],o.names[r]=n;for(r=0,i=e.givens.length;r<i;r+=1){for(n=[],s=0,a=e.givens[r].length;s<a;s+=1)n.push(e.givens[r][s]);o.givens.push(n)}return t?(o.year_suffix=t.year_suffix,o.disambiguate=t.disambiguate):(o.year_suffix=e.year_suffix,o.disambiguate=e.disambiguate),o};l.getAmbigConfig=function(){var e,t;e=this.tmp.disambig_request,e||(e=this.tmp.disambig_settings);var t=l.cloneAmbigConfig(e);return t};l.getMaxVals=function(){return this.tmp.names_max.mystack.slice()};l.getMinVal=function(){return this.tmp["et-al-min"]};l.tokenExec=function(e,t,r){var i,s,a,n;n=!1,i=e.next,s=!1;var o=function(p){return p?(this.tmp.jump.replace("succeed"),e.succeed):(this.tmp.jump.replace("fail"),e.fail)};e.test&&(i=o.call(this,e.test(t,r)));for(var u=0,c=e.execs.length;u<c;u++)a=e.execs[u],s=a.call(e,this,t,r),s&&(i=s);return n&&l.debug(e.name+" ("+e.tokentype+") ---> done"),i};l.expandMacro=function(e,t){var r,i,s,a;r=e.postponed_macro;var n=e.strings.sort_direction;e=new l.Token("group",l.START);var o=!1,u=!1;i=this.cslXml.getNodesByName(this.cslXml.dataObj,"macro",r),i.length&&(u=this.cslXml.getAttributeValue(i[0],"cslid"),o=this.cslXml.getAttributeValue(i[0],"macro-has-date")),o&&(r=r+"@"+this.build.current_default_locale,a=function(f){f.tmp.extension&&(f.tmp["doing-macro-with-date"]=!0)},e.execs.push(a)),this.build.macro_stack.indexOf(r)>-1?l.error('CSL processor error: call to macro "'+r+'" would cause an infinite loop'):this.build.macro_stack.push(r),e.cslid=u,l.MODULE_MACROS[r]&&(e.juris=r,this.opt.update_mode=l.POSITION),l.Node.group.build.call(e,this,t,!0),this.cslXml.getNodeValue(i)||l.error('CSL style error: undefined macro "'+r+'"');var c=l.getMacroTarget.call(this,r);if(c&&(l.buildMacro.call(this,c,i),l.configureMacro.call(this,c)),!this.build.extension){var a=function(h){return function(m,g,d){for(var v=0;v<m.macros[h].length;)v=l.tokenExec.call(m,m.macros[h][v],g,d)}}(r),p=new l.Token("text",l.SINGLETON);p.execs.push(a),t.push(p)}s=new l.Token("group",l.END),s.strings.sort_direction=n,o&&(a=function(f){f.tmp.extension&&(f.tmp["doing-macro-with-date"]=!1)},s.execs.push(a)),e.juris&&(s.juris=r),l.Node.group.build.call(s,this,t,!0),this.build.macro_stack.pop()};l.getMacroTarget=function(e){var t=!1;return this.build.extension?t=this[this.build.root+this.build.extension].tokens:this.macros[e]||(t=[],this.macros[e]=t),t};l.buildMacro=function(e,t){var r=l.makeBuilder(this,e),i;typeof t.length=="undefined"?i=t:i=t[0],r(i)};l.configureMacro=function(e){this.build.extension||this.configureTokenList(e)};l.XmlToToken=function(e,t,r,i){var s,a,n,o,u,c,p,f;if(s=e.cslXml.nodename(this),!(e.build.skip&&e.build.skip!==s)){if(!s){a=e.cslXml.content(this),a&&(e.build.text=a);return}if(l.Node[e.cslXml.nodename(this)]||l.error('Undefined node name "'+s+'".'),n=[],o=e.cslXml.attributes(this),u=l.setDecorations.call(this,e,o),c=new l.Token(s,t),t!==l.END||s==="if"||s==="else-if"||s==="layout"){for(var p in o)if(o.hasOwnProperty(p)){if(t===l.END&&p!=="@language"&&p!=="@locale")continue;if(o.hasOwnProperty(p))if(l.Attributes[p])try{l.Attributes[p].call(c,e,""+o[p])}catch(m){l.error(p+" attribute: "+m)}else l.debug('warning: undefined attribute "'+p+'" in style')}c.decorations=u,l.DATE_VARIABLES.indexOf(o["@variable"])>-1&&i.push(c.variables)}else t===l.END&&o["@variable"]&&(c.hasVariable=!0,l.DATE_VARIABLES.indexOf(o["@variable"])>-1&&(c.variables=i.pop()));r?f=r:f=e[e.build.area].tokens,l.Node[s].build.call(c,e,f,!0)}};l.DateParser=function(){for(var e=[["\u660E\u6CBB",1867],["\u5927\u6B63",1911],["\u662D\u548C",1925],["\u5E73\u6210",1988]],t={},r=0,i=e.length;r<i;r++){var s=e[r][0],a=e[r][1];t[s]=a}for(var n=[],o={},r=0,i=e.length;r<i;r++){var u=e[r],a=u[0];n.push(a),o[u[0]]=u[1]}var c=n.join("|"),p=new RegExp("(?:"+c+")(?:[0-9]+)"),f=new RegExp("(?:"+c+")(?:[0-9]+)","g"),h=/(\u6708|\u5E74)/g,m=/\u65E5/g,g=/\u301c/g,d="(?:[?0-9]{1,2}%%NUMD%%){0,2}[?0-9]{4}(?![0-9])",v="[?0-9]{4}(?:%%NUMD%%[?0-9]{1,2}){0,2}(?![0-9])",b="[?0-9]{1,3}",E="[%%DATED%%]",x="[?~]",w="[^-/~?0-9]+",S="("+v+"|"+d+"|"+b+"|"+E+"|"+x+"|"+w+")",T=new RegExp(S.replace(/%%NUMD%%/g,"-").replace(/%%DATED%%/g,"-")),I=new RegExp(S.replace(/%%NUMD%%/g,"-").replace(/%%DATED%%/g,"/")),C=new RegExp(S.replace(/%%NUMD%%/g,"/").replace(/%%DATED%%/g,"-")),A="january february march april may june july august september october november december spring summer fall winter spring summer";this.monthStrings=A.split(" "),this.setOrderDayMonth=function(){this.monthGuess=1,this.dayGuess=0},this.setOrderMonthDay=function(){this.monthGuess=0,this.dayGuess=1},this.resetDateParserMonths=function(){this.monthSets=[];for(var y=0,_=this.monthStrings.length;y<_;y++)this.monthSets.push([this.monthStrings[y]]);this.monthAbbrevs=[];for(var y=0,_=this.monthSets.length;y<_;y++){this.monthAbbrevs.push([]);for(var k=0,Q=this.monthSets[y].length;k<Q;k++)this.monthAbbrevs[y].push(this.monthSets[y][0].slice(0,3))}this.monthRexes=[];for(var y=0,_=this.monthAbbrevs.length;y<_;y++)this.monthRexes.push(new RegExp("(?:"+this.monthAbbrevs[y].join("|")+")"))},this.addDateParserMonths=function(y){if(typeof y=="string"&&(y=y.split(/\s+/)),y.length!==12&&y.length!==16){l.debug("month [+season] list of "+y.length+", expected 12 or 16. Ignoring.");return}for(var _=0,k=y.length;_<k;_++){for(var Q=null,O=!1,N=3,B={},q=0,P=this.monthAbbrevs.length;q<P;q++){if(B[q]={},q===_){for(var F=0,j=this.monthAbbrevs[_].length;F<j;F++)if(this.monthAbbrevs[_][F]===y[_].slice(0,this.monthAbbrevs[_][F].length)){O=!0;break}}else for(var F=0,j=this.monthAbbrevs[q].length;F<j;F++)if(Q=this.monthAbbrevs[q][F].length,this.monthAbbrevs[q][F]===y[_].slice(0,Q)){for(;this.monthSets[q][F].slice(0,Q)===y[_].slice(0,Q);)if(Q>y[_].length||Q>this.monthSets[q][F].length){l.debug("unable to disambiguate month string in date parser: "+y[_]);break}else Q+=1;N=Q,B[q][F]=Q}for(var D in B)for(var L in B[D])Q=B[D][L],D=parseInt(D,10),L=parseInt(L,10),this.monthAbbrevs[D][L]=this.monthSets[D][L].slice(0,Q)}O||(this.monthSets[_].push(y[_]),this.monthAbbrevs[_].push(y[_].slice(0,N)))}this.monthRexes=[],this.monthRexStrs=[];for(var _=0,k=this.monthAbbrevs.length;_<k;_++)this.monthRexes.push(new RegExp("^(?:"+this.monthAbbrevs[_].join("|")+")")),this.monthRexStrs.push("^(?:"+this.monthAbbrevs[_].join("|")+")");if(this.monthAbbrevs.length===18)for(var _=12,k=14;_<k;_++)this.monthRexes[_+4]=new RegExp("^(?:"+this.monthAbbrevs[_].join("|")+")"),this.monthRexStrs[_+4]="^(?:"+this.monthAbbrevs[_].join("|")+")"},this.convertDateObjectToArray=function(y){y["date-parts"]=[],y["date-parts"].push([]);for(var _=0,k,Q=0,O=3;Q<O&&(k=["year","month","day"][Q],!!y[k]);Q++)_+=1,y["date-parts"][0].push(y[k]),delete y[k];y["date-parts"].push([]);for(var Q=0,O=_;Q<O&&(k=["year_end","month_end","day_end"][Q],!!y[k]);Q++)y["date-parts"][1].push(y[k]),delete y[k];return y["date-parts"][0].length!==y["date-parts"][1].length&&y["date-parts"].pop(),y},this.convertDateObjectToString=function(y){for(var _=[],k=0,Q=3;k<Q&&y[l.DATE_PARTS_ALL[k]];k+=1)_.push(y[l.DATE_PARTS_ALL[k]]);return _.join("-")},this._parseNumericDate=function(y,_,k,Q){k||(k="");for(var O=Q.split(_),N=0,B=O.length;N<B;N++)if(O[N].length===4){y["year"+k]=O[N].replace(/^0*/,""),N?O=O.slice(0,N):O=O.slice(1);break}for(var N=0,B=O.length;N<B;N++)O[N]=parseInt(O[N],10);if(O.length===1||O.length===2&&!O[1]){var q=O[0];q&&(y["month"+k]=""+O[0])}else if(O.length===2)if(O[this.monthGuess]>12){var q=O[this.dayGuess],P=O[this.monthGuess];q&&(y["month"+k]=""+q,P&&(y["day"+k]=""+P))}else{var q=O[this.monthGuess],P=O[this.dayGuess];q&&(y["month"+k]=""+q,P&&(y["day"+k]=""+P))}},this.parseDateToObject=function(y){var _=y,k=-1,Q=-1,O=!1,N;if(y){if(y=y.replace(/^(.*[0-9])T[0-9].*/,"$1"),y.slice(0,1)==="-"&&(O=!0,y=y.slice(1)),y.match(/^[0-9]{1,3}$/))for(;y.length<4;)y="0"+y;y=""+y,y=y.replace(/\s*[0-9]{2}:[0-9]{2}(?::[0-9]+)/,"");var B=y.match(h);if(B){y=y.replace(/\s+/g,""),y=y.replace(m,""),y=y.replace(h,"-"),y=y.replace(g,"/"),y=y.replace(/\-\//g,"/"),y=y.replace(/-$/g,"");var q=y.split(p);N=[];var P=y.match(f);if(P){for(var F=[],j=0,D=P.length;j<D;j++)F=F.concat(P[j].match(/([^0-9]+)([0-9]+)/).slice(1));for(var j=0,D=q.length;j<D;j++)if(N.push(q[j]),j!==D-1){var L=j*2;N.push(F[L]),N.push(F[L+1])}}else N=q;for(var j=1,D=N.length;j<D;j+=3)N[j+1]=o[N[j]]+parseInt(N[j+1],10),N[j]="";y=N.join(""),y=y.replace(/\s*-\s*$/,"").replace(/\s*-\s*\//,"/"),y=y.replace(/\.\s*$/,""),y=y.replace(/\.(?! )/,""),k=y.indexOf("/"),Q=y.indexOf("-")}}y=y.replace(/([A-Za-z])\./g,"$1");var U="",H="",G={},$,z;if(y.slice(0,1)==='"'&&y.slice(-1)==='"')return G.literal=y.slice(1,-1),G;if(k>-1&&Q>-1){var Y=y.split("/");Y.length>3?($="-",y=y.replace(/\_/g,"-"),z="/",N=y.split(C)):($="/",y=y.replace(/\_/g,"/"),z="-",N=y.split(I))}else y=y.replace(/\//g,"-"),y=y.replace(/\_/g,"-"),$="-",z="-",N=y.split(T);for(var J=[],j=0,D=N.length;j<D;j++){var B=N[j].match(/^\s*([\-\/]|[^\-\/\~\?0-9]+|[\-~?0-9]+)\s*$/);B&&J.push(B[1])}var ee=J.indexOf($),le=[],X=!1;ee>-1?(le.push([0,ee]),le.push([ee+1,J.length]),X=!0):le.push([0,J.length]);for(var W="",j=0,D=le.length;j<D;j++){var fe=le[j],te=J.slice(fe[0],fe[1]);e:for(var ve=0,Re=te.length;ve<Re;ve++){var ae=te[ve];if(ae.indexOf(z)>-1){this._parseNumericDate(G,z,W,ae);continue}if(ae.match(/[0-9]{4}/)){G["year"+W]=ae.replace(/^0*/,"");continue}(ae==="~"||ae==="?"||ae==="c"||ae.match(/^cir/))&&(G.circa=!0);for(var _e=0,$r=this.monthRexes.length;_e<$r;_e++)if(ae.toLocaleLowerCase().match(this.monthRexes[_e])){G["month"+W]=""+(parseInt(_e,10)+1);continue e}if(ae.match(/^[0-9]+$/)&&(U=ae),ae.toLocaleLowerCase().match(/^bc/)&&U){G["year"+W]=""+U*-1,U="";continue}if(ae.toLocaleLowerCase().match(/^ad/)&&U){G["year"+W]=""+U,U="";continue}if(ae.toLocaleLowerCase().match(/(?:mic|tri|hil|eas)/)&&!G["season"+W]){H=ae;continue}}U&&(G["day"+W]=U,U=""),H&&!G["season"+W]&&(G["season"+W]=H.trim(),H=""),W="_end"}if(X)for(var ve=0,Re=l.DATE_PARTS_ALL.length;ve<Re;ve++){var ce=l.DATE_PARTS_ALL[ve];G[ce]&&!G[ce+"_end"]?G[ce+"_end"]=G[ce]:!G[ce]&&G[ce+"_end"]&&(G[ce]=G[ce+"_end"])}(!G.year||G.year&&G.day&&!G.month)&&(G={literal:_});for(var dt=["year","month","day","year_end","month_end","day_end"],j=0,D=dt.length;j<D;j++){var It=dt[j];typeof G[It]=="string"&&G[It].match(/^[0-9]+$/)&&(G[It]=parseInt(G[It],10))}return O&&Object.keys(G).indexOf("year")>-1&&(G.year=G.year*-1),G},this.parseDateToArray=function(y){return this.convertDateObjectToArray(this.parseDateToObject(y))},this.parseDateToString=function(y){return this.convertDateObjectToString(this.parseDateToObject(y))},this.parse=function(y){return this.parseDateToObject(y)},this.setOrderMonthDay(),this.resetDateParserMonths()};l.DateParser=new l.DateParser;l.Engine=function(e,t,r,i){var s,a;this.processor_version=l.PROCESSOR_VERSION,this.csl_version="1.0",this.sys=e,typeof Object.assign!="function"&&Object.defineProperty(Object,"assign",{value:function(f){"use strict";if(f==null)throw new TypeError("Cannot convert undefined or null to object");for(var h=Object(f),m=1;m<arguments.length;m++){var g=arguments[m];if(g!=null)for(var d in g)Object.prototype.hasOwnProperty.call(g,d)&&(h[d]=g[d])}return h},writable:!0,configurable:!0}),e.variableWrapper&&(l.VARIABLE_WRAPPER_PREPUNCT_REX=new RegExp("^(["+[" "].concat(l.SWAPPING_PUNCTUATION).join("")+"]*)(.*)")),l.retrieveStyleModule&&(this.sys.retrieveStyleModule=l.retrieveStyleModule),l.getAbbreviation&&(this.sys.getAbbreviation=l.getAbbreviation),this.sys.stringCompare&&(l.stringCompare=this.sys.stringCompare),this.sys.AbbreviationSegments=l.AbbreviationSegments,this.transform=new l.Transform(this),this.setParseNames=function(p){this.opt["parse-names"]=p},this.opt=new l.Engine.Opt,this.tmp=new l.Engine.Tmp,this.build=new l.Engine.Build,this.fun=new l.Engine.Fun(this),this.configure=new l.Engine.Configure,this.citation_sort=new l.Engine.CitationSort,this.bibliography_sort=new l.Engine.BibliographySort,this.citation=new l.Engine.Citation(this),this.bibliography=new l.Engine.Bibliography,this.intext=new l.Engine.InText,this.output=new l.Output.Queue(this),this.dateput=new l.Output.Queue(this),this.cslXml=l.setupXml(t);for(var n in l.SYS_OPTIONS){var o=l.SYS_OPTIONS[n];typeof this.sys[o]=="boolean"&&(this.opt.development_extensions[o]=this.sys[o])}(this.opt.development_extensions.uppercase_subtitles||this.opt.development_extensions.implicit_short_title)&&(this.opt.development_extensions.main_title_from_short_title=!0),this.opt.development_extensions.csl_reverse_lookup_support&&(this.build.cslNodeId=0,this.setCslNodeIds=function(p,f){var h=this.cslXml.children(p);this.cslXml.setAttribute(p,"cslid",this.build.cslNodeId),this.opt.nodenames.push(f),this.build.cslNodeId+=1;for(var m=0,g=this.cslXml.numberofnodes(h);m<g;m+=1)f=this.cslXml.nodename(h[m]),f&&this.setCslNodeIds(h[m],f)},this.setCslNodeIds(this.cslXml.dataObj,"style")),this.cslXml.addMissingNameNodes(this.cslXml.dataObj),this.cslXml.addInstitutionNodes(this.cslXml.dataObj),this.cslXml.insertPublisherAndPlace(this.cslXml.dataObj),this.cslXml.flagDateMacros(this.cslXml.dataObj),s=this.cslXml.attributes(this.cslXml.dataObj),typeof s["@sort-separator"]=="undefined"&&this.cslXml.setAttribute(this.cslXml.dataObj,"sort-separator",", "),this.opt["initialize-with-hyphen"]=!0,this.setStyleAttributes(),this.opt.xclass=this.cslXml.getAttributeValue(this.cslXml.dataObj,"class"),this.opt.class=this.opt.xclass,this.opt.styleID=this.cslXml.getStyleId(this.cslXml.dataObj),this.opt.styleName=this.cslXml.getStyleId(this.cslXml.dataObj,!0),this.opt.version.slice(0,4)==="1.1m"&&(this.opt.development_extensions.consolidate_legal_items=!0,this.opt.development_extensions.consolidate_container_items=!0,this.opt.development_extensions.main_title_from_short_title=!0,this.opt.development_extensions.expect_and_symbol_form=!0,this.opt.development_extensions.require_explicit_legal_case_title_short=!0,this.opt.development_extensions.force_jurisdiction=!0,this.opt.development_extensions.force_title_abbrev_fallback=!0),r&&(r=r.replace("_","-"),r=l.normalizeLocaleStr(r)),this.opt["default-locale"][0]&&(this.opt["default-locale"][0]=this.opt["default-locale"][0].replace("_","-"),this.opt["default-locale"][0]=l.normalizeLocaleStr(this.opt["default-locale"][0])),r&&i&&(this.opt["default-locale"]=[r]),r&&!i&&this.opt["default-locale"][0]&&(r=this.opt["default-locale"][0]),this.opt["default-locale"].length===0&&(r||(r="en-US"),this.opt["default-locale"].push("en-US")),r||(r=this.opt["default-locale"][0]),a=l.localeResolve(r),this.opt.lang=a.best,this.opt["default-locale"][0]=a.best,this.locale={},this.opt["default-locale-sort"]||(this.opt["default-locale-sort"]=this.opt["default-locale"][0]),"dale|".localeCompare("daleb",this.opt["default-locale-sort"])>-1?this.opt.sort_sep="@":this.opt.sort_sep="|",this.localeConfigure(a);function u(f){var f=f.slice(),h=new RegExp("(?:(?:[?!:]*\\s+|-|^)(?:"+f.join("|")+")(?=[!?:]*\\s+|-|$))","g");return h}this.locale[this.opt.lang].opts["skip-words-regexp"]=u(this.locale[this.opt.lang].opts["skip-words"]),this.output.adjust=new l.Output.Queue.adjust(this.getOpt("punctuation-in-quote")),this.registry=new l.Registry(this),this.macros={},this.build.area="citation";var c=this.cslXml.getNodesByName(this.cslXml.dataObj,this.build.area);this.buildTokenLists(c,this[this.build.area].tokens),this.build.area="bibliography";var c=this.cslXml.getNodesByName(this.cslXml.dataObj,this.build.area);this.buildTokenLists(c,this[this.build.area].tokens),this.build.area="intext";var c=this.cslXml.getNodesByName(this.cslXml.dataObj,this.build.area);this.buildTokenLists(c,this[this.build.area].tokens),this.opt.parallel.enable&&(this.parallel=new l.Parallel(this)),this.juris={},this.configureTokenLists(),this.disambiguate=new l.Disambiguation(this),this.splice_delimiter=!1,this.fun.dateparser=l.DateParser,this.fun.flipflopper=new l.Util.FlipFlopper(this),this.setCloseQuotesArray(),this.fun.ordinalizer.init(this),this.fun.long_ordinalizer.init(this),this.fun.page_mangler=l.Util.PageRangeMangler.getFunction(this,"page"),this.fun.year_mangler=l.Util.PageRangeMangler.getFunction(this,"year"),this.setOutputFormat("html")};l.Engine.prototype.setCloseQuotesArray=function(){var e;e=[],e.push(this.getTerm("close-quote")),e.push(this.getTerm("close-inner-quote")),e.push('"'),e.push("'"),this.opt.close_quotes_array=e};l.makeBuilder=function(e,t){var r=[],i=[];function s(u){i.push(u),l.XmlToToken.call(u,e,l.START,t,r)}function a(){var u=i.pop();l.XmlToToken.call(u,e,l.END,t,r)}function n(u){l.XmlToToken.call(u,e,l.SINGLETON,t,r)}function o(u,c,p){p||(p=[]),u||(u=[]),typeof u.length=="undefined"&&(u=[u]);for(var f=0;f<u.length;f++){var h=u[f];e.cslXml.nodename(h)!==null&&(c&&e.cslXml.nodename(h)==="date"&&(l.Util.fixDateNode.call(e,c,f,h),h=e.cslXml.children(c)[f]),e.cslXml.numberofnodes(e.cslXml.children(h))?(s(h),o(e.cslXml.children(h),h,p),a()):n(h))}}return o};l.Engine.prototype.buildTokenLists=function(e,t){if(this.cslXml.getNodeValue(e)){var r=l.makeBuilder(this,t),i;typeof e.length=="undefined"?i=e:i=e[0],r(i)}};l.Engine.prototype.setStyleAttributes=function(){var r,e,t,r={};r.name=this.cslXml.nodename(this.cslXml.dataObj),e=this.cslXml.attributes(this.cslXml.dataObj);for(t in e)e.hasOwnProperty(t)&&l.Attributes[t].call(r,this,e[t])};l.Engine.prototype.getTerm=function(e,t,r,i,s,a){e&&e.match(/[A-Z]/)&&e===e.toUpperCase()&&(l.debug("Warning: term key is in uppercase form: "+e),e=e.toLowerCase());var n;a?n=this.opt["default-locale"][0]:n=this.opt.lang;var o=l.Engine.getField(l.LOOSE,this.locale[n].terms,e,t,r,i);return!o&&e==="range-delimiter"&&(o="\u2013"),typeof o=="undefined"&&(s===l.STRICT?l.error('Error in getTerm: term "'+e+'" does not exist.'):s===l.TOLERANT&&(o="")),o&&(this.tmp.cite_renders_content=!0),o};l.Engine.prototype.getDate=function(e,t){var r;return t?r=this.opt["default-locale"]:r=this.opt.lang,this.locale[r].dates[e]?this.locale[r].dates[e]:!1};l.Engine.prototype.getOpt=function(e){return typeof this.locale[this.opt.lang].opts[e]!="undefined"?this.locale[this.opt.lang].opts[e]:!1};l.Engine.prototype.getVariable=function(e,t,r,i){return l.Engine.getField(l.LOOSE,e,t,r,i)};l.Engine.prototype.getDateNum=function(e,t){return typeof e=="undefined"?0:e[t]};l.Engine.getField=function(e,t,r,i,s,a){var n,o,u,c,p,f;if(n="",typeof t[r]=="undefined")if(e===l.STRICT)l.error('Error in getField: term "'+r+'" does not exist.');else return;for(a&&t[r][a]?f=t[r][a]:f=t[r],o=[],i==="symbol"?o=["symbol","short"]:i==="verb-short"?o=["verb-short","verb"]:i!=="long"&&(o=[i]),o=o.concat(["long"]),p=o.length,c=0;c<p;c+=1)if(u=o[c],typeof f=="string"||typeof f=="number")n=f;else if(typeof f[u]!="undefined"){typeof f[u]=="string"||typeof f[u]=="number"?n=f[u]:typeof s=="number"?n=f[u][s]:n=f[u][0];break}return n};l.Engine.prototype.configureTokenLists=function(){var e,t,r;for(r=l.AREAS.length,t=0;t<r;t+=1){e=l.AREAS[t];var i=this[e].tokens;this.configureTokenList(i)}return this.version=l.version,this.state};l.Engine.prototype.configureTokenList=function(e){var t,r,i,s,a,n,o,u;for(t=["year","month","day"],o=e.length-1,a=o;a>-1;a+=-1){if(r=e[a],r.name==="date"&&l.END===r.tokentype&&(i=[]),r.name==="date-part"&&r.strings.name)for(u=t.length,n=0;n<u;n+=1)s=t[n],s===r.strings.name&&i.push(r.strings.name);r.name==="date"&&l.START===r.tokentype&&(i.reverse(),r.dateparts=i),r.next=a+1,r.name&&l.Node[r.name].configure&&l.Node[r.name].configure.call(r,this,a)}};l.Engine.prototype.refetchItems=function(e){for(var t=[],r=0,i=e.length;r<i;r+=1)t.push(this.refetchItem(""+e[r]));return t};l.ITERATION=0;l.Engine.prototype.retrieveItem=function(e){var t,r,i;if(!this.tmp.loadedItemIDs[e])this.tmp.loadedItemIDs[e]=!0;else return this.registry.refhash[e];if(this.opt.development_extensions.normalize_lang_keys_to_lowercase&&typeof this.opt.development_extensions.normalize_lang_keys_to_lowercase=="boolean"){for(var i=0,s=this.opt["default-locale"].length;i<s;i+=1)this.opt["default-locale"][i]=this.opt["default-locale"][i].toLowerCase();for(var i=0,s=this.opt["locale-translit"].length;i<s;i+=1)this.opt["locale-translit"][i]=this.opt["locale-translit"][i].toLowerCase();for(var i=0,s=this.opt["locale-translat"].length;i<s;i+=1)this.opt["locale-translat"][i]=this.opt["locale-translat"][i].toLowerCase();this.opt.development_extensions.normalize_lang_keys_to_lowercase=100}if(l.ITERATION+=1,t=JSON.parse(JSON.stringify(this.sys.retrieveItem(""+e))),this.opt.development_extensions.normalize_lang_keys_to_lowercase){if(t.multi){if(t.multi._keys)for(var a in t.multi._keys)for(var n in t.multi._keys[a])n!==n.toLowerCase()&&(t.multi._keys[a][n.toLowerCase()]=t.multi._keys[a][n],delete t.multi._keys[a][n]);if(t.multi.main)for(var a in t.multi.main)t.multi.main[a]=t.multi.main[a].toLowerCase()}for(var i=0,s=l.NAME_VARIABLES.length;i>s;i+=1){var o=l.NAME_VARIABLES[i];if(t[o]&&t[o].multi)for(var u=0,c=t[o].length;u<c;u+=1){var p=t[o][u];if(p.multi){if(p.multi._key)for(var n in p.multi._key)n!==n.toLowerCase()&&(p.multi._key[n.toLowerCase()]=p.multi._key[n],delete p.multi._key[n]);p.multi.main&&(p.multi.main=p.multi.main.toLowerCase())}}}}if(t.language&&t.language.match(/[><]/)){var r=t.language.match(/(.*?)([<>])(.*)/);r[2]==="<"?(t["language-name"]=r[1],t["language-name-original"]=r[3]):(t["language-name"]=r[3],t["language-name-original"]=r[1]),this.opt.multi_layout?t["language-name-original"]&&(t.language=t["language-name-original"]):t["language-name"]&&(t.language=t["language-name"])}if(t.page){t["page-first"]=t.page;var f=""+t.page,r=f.split(/\s*(?:&|, |-|\u2013)\s*/);r[0].slice(-1)!=="\\"&&(t["page-first"]=r[0])}this.opt.development_extensions.field_hack&&t.note&&l.parseNoteFieldHacks(t,!1,this.opt.development_extensions.allow_field_hack_date_override);for(var n in t)if(l.DATE_VARIABLES.indexOf(n.replace(/^alt-/,""))>-1){var h=t[n];h&&(this.opt.development_extensions.raw_date_parsing&&h.raw&&(!h["date-parts"]||h["date-parts"].length===0)&&(h=this.fun.dateparser.parseDateToObject(h.raw)),t[n]=this.dateParseArray(h))}if(this.opt.development_extensions.consolidate_legal_items&&t.type&&["bill","gazette","legislation","regulation","treaty"].indexOf(t.type)>-1){for(var m,g=["type","title","jurisdiction","genre","volume","container-title"],d=[],i=0,s=g.length;i<s;i+=1)m=g[i],t[m]&&d.push(t[m]);g=["original-date","issued"];for(var i=0,s=g.length;i<s;i+=1)if(m=g[i],t[m]&&t[m].year){var v=t[m].year;d.push(v);break}t.legislation_id=d.join("::")}if(this.bibliography.opt.track_container_items&&this.bibliography.opt.track_container_items.indexOf(t.type)>-1){for(var m,g=["type","container-title","publisher","edition"],b=[],i=0,s=g.length;i<s;i+=1)m=g[i],t[m]&&b.push(t[m]);t.container_id=b.join("::")}if(this.opt.development_extensions.force_jurisdiction&&typeof t.authority=="string"&&(t.authority=[{literal:t.authority,multi:{_key:{}}}],t.multi&&t.multi._keys&&t.multi._keys.authority)){t.authority[0].multi._key={};for(var n in t.multi._keys.authority)t.authority[0].multi._key[n]={literal:t.multi._keys.authority[n]}}if(t["title-short"]||(t["title-short"]=t.shortTitle),this.opt.development_extensions.main_title_from_short_title){var E=this.opt["default-locale"][0].slice(0,2).toLowerCase()==="fr";l.extractTitleAndSubtitle.call(this,t,E)}var x=["bill","legal_case","legislation","gazette","regulation"].indexOf(t.type)>-1;this.opt.development_extensions.force_jurisdiction&&x&&(t.jurisdiction||(t.jurisdiction="us"));var w;if(!x&&t.title&&this.sys.getAbbreviation){var S=!1;t.jurisdiction||(S=!0),this.sys.normalizeAbbrevsKey?w=this.sys.normalizeAbbrevsKey("title",t.title):w=t.title;var T=this.transform.loadAbbreviation(t.jurisdiction,"title",w,t.language);this.transform.abbrevs[T].title&&this.transform.abbrevs[T].title[w]&&(t["title-short"]=this.transform.abbrevs[T].title[w])}if(t["container-title-short"]||(t["container-title-short"]=t.journalAbbreviation),t["container-title"]&&this.sys.getAbbreviation){this.sys.normalizeAbbrevsKey?w=this.sys.normalizeAbbrevsKey(t["container-title"]):w=t["container-title"];var T=this.transform.loadAbbreviation(t.jurisdiction,"container-title",w,t.language);this.transform.abbrevs[T]["container-title"]&&this.transform.abbrevs[T]["container-title"][w]&&(t["container-title-short"]=this.transform.abbrevs[T]["container-title"][w])}if(t.jurisdiction&&(t.country=t.jurisdiction.split(":")[0]),this.registry.refhash[e]){if(JSON.stringify(this.registry.refhash[e])!=JSON.stringify(t)){for(var n in this.registry.refhash[e])delete this.registry.refhash[e][n];this.tmp.taintedItemIDs[t.id]=!0,Object.assign(this.registry.refhash[e],t)}}else this.registry.refhash[e]=t;return this.registry.refhash[e]};l.Engine.prototype.refetchItem=function(e){return this.registry.refhash[e]};l.Engine.prototype.setOpt=function(e,t,r){e.name==="style"||e.name==="cslstyle"?(this.opt.inheritedAttributes[t]=r,this.citation.opt.inheritedAttributes[t]=r,this.bibliography.opt.inheritedAttributes[t]=r):["citation","bibliography"].indexOf(e.name)>-1?this[e.name].opt.inheritedAttributes[t]=r:e.strings[t]=r};l.Engine.prototype.inheritOpt=function(e,t,r,i){if(typeof e.strings[t]!="undefined")return e.strings[t];var s=this[this.tmp.root].opt.inheritedAttributes[r||t];return typeof s!="undefined"?s:i};l.Engine.prototype.remapSectionVariable=function(e){for(var t=0,r=e.length;t<r;t+=1){var i=e[t][0],s=e[t][1];if(["bill","gazette","legislation","regulation","treaty"].indexOf(i.type)>-1){if(s.locator){s.locator=s.locator.trim();var a=s.locator.match(l.STATUTE_SUBDIV_PLAIN_REGEX_FRONT);a||(s.label?s.locator=l.STATUTE_SUBDIV_STRINGS_REVERSE[s.label]+" "+s.locator:s.locator="p. "+s.locator)}var n=null;if(i.section){i.section=i.section.trim();var a=i.section.match(l.STATUTE_SUBDIV_PLAIN_REGEX_FRONT);a?n=a[0].trim():(i.section="sec. "+i.section,n="sec.")}if(i.section)if(!s.locator)s.locator=i.section;else{var a=s.locator.match(/^([^ ]*)\s*(.*)/),o=" ";a?(a[1]==="p."&&n!=="p."&&(s.locator=a[2]),["[","(",".",",",";",":","?"].indexOf(s.locator.slice(0,1))>-1&&(o="")):o="",s.locator=i.section+o+s.locator}s.label=""}}};l.Engine.prototype.setNumberLabels=function(e){if(e.number&&["bill","gazette","legislation","regulation","treaty"].indexOf(e.type)>-1&&this.opt.development_extensions.consolidate_legal_items&&!this.tmp.shadow_numbers.number){this.tmp.shadow_numbers.number={},this.tmp.shadow_numbers.number.values=[],this.tmp.shadow_numbers.number.plural=0,this.tmp.shadow_numbers.number.numeric=!1,this.tmp.shadow_numbers.number.label=!1;var t=""+e.number;t=t.split("\\").join("");var r=t.split(/\s+/)[0],i=l.STATUTE_SUBDIV_STRINGS[r];if(i){var s=t.split(l.STATUTE_SUBDIV_PLAIN_REGEX);if(s.length>1){for(var a=[],n=1,o=s.length;n<o;n+=1)a.push(s[n].replace(/\s*$/,"").replace(/^\s*/,""));t=a.join(" ")}else t=s[0];this.tmp.shadow_numbers.number.label=i,this.tmp.shadow_numbers.number.values.push(["Blob",t,!1]),this.tmp.shadow_numbers.number.numeric=!1}else this.tmp.shadow_numbers.number.values.push(["Blob",t,!1]),this.tmp.shadow_numbers.number.numeric=!0}};l.substituteOne=function(e){return function(t,r){return r?e.replace("%%STRING%%",r):""}};l.substituteTwo=function(e){return function(t){var r=e.replace("%%PARAM%%",t);return function(i,s){return s?r.replace("%%STRING%%",s):""}}};l.Mode=function(e){var t,r,i,s,a,n;t={},r=l.Output.Formats[e];for(i in r){if(i.slice(0,1)!=="@"){t[i]=r[i];continue}s=!1,a=r[i],n=i.split("/"),typeof a=="string"&&a.indexOf("%%STRING%%")>-1?a.indexOf("%%PARAM%%")>-1?s=l.substituteTwo(a):s=l.substituteOne(a):typeof a=="boolean"&&!a?s=l.Output.Formatters.passthrough:typeof a=="function"?s=a:l.error("Bad "+e+" config entry for "+i+": "+a),n.length===1?t[n[0]]=s:n.length===2&&(t[n[0]]||(t[n[0]]={}),t[n[0]][n[1]]=s)}return t};l.setDecorations=function(e,t){var r,i,s;r=[];for(s in l.FORMAT_KEY_SEQUENCE){var i=l.FORMAT_KEY_SEQUENCE[s];t[i]&&(r.push([i,t[i]]),delete t[i])}return r};l.Doppeler=function(e,t){var r=new RegExp("("+e+")","g"),i=new RegExp(e,"g");this.split=function(s){t&&(s=t(s));var a=s.match(r);if(!a)return{tags:[],strings:[s]};for(var n=s.split(i),o=a.length-1;o>-1;o--){typeof a[o]=="number"&&(a[o]="");var u=a[o];u==="'"&&n[o+1].length>0&&(n[o+1]=a[o]+n[o+1],a[o]="")}return{tags:a,strings:n,origStrings:n.slice()}},this.join=function(s){for(var a=s.strings.slice(-1),n=s.tags.length-1;n>-1;n--)a.push(s.tags[n]),a.push(s.strings[n]);return a.reverse(),a.join("")}};l.Engine.prototype.normalDecorIsOrphan=function(e,t){if(t[1]==="normal"){var r=!1,i;this.tmp.area==="citation"?i=[this.citation.opt.layout_decorations].concat(e.alldecor):i=e.alldecor;for(var s=i.length-1;s>-1;s+=-1)for(var a=i[s].length-1;a>-1;a+=-1)i[s][a][0]===t[0]&&i[s][a][1]!=="normal"&&(r=!0);if(!r)return!0}return!1};l.Engine.prototype.getCitationLabel=function(e){var t="",r=this.getTrigraphParams(),i=r[0],s=this.getTerm("reference","short",0);typeof s=="undefined"&&(s="reference"),s=s.replace(".",""),s=s.slice(0,1).toUpperCase()+s.slice(1);for(var a=0,n=l.NAME_VARIABLES.length;a<n;a+=1){var o=l.NAME_VARIABLES[a];if(e[o]){var u=e[o];u.length>r.length?i=r[r.length-1]:i=r[u.length-1];for(var c=0,p=u.length;c<p&&c!==i.authors.length;c+=1){var f=this.nameOutput.getName(u[c],"locale-translit",!0),h=f.name;h&&h.family?(s=h.family,s=s.replace(/^([ \'\u2019a-z]+\s+)/,"")):h&&h.literal&&(s=h.literal);var m=s.toLowerCase().match(/^(a\s+|the\s+|an\s+)/);if(m&&(s=s.slice(m[1].length)),s=s.replace(l.ROMANESQUE_NOT_REGEXP,""),!s)break;s=s.slice(0,i.authors[c]),s.length>1?s=s.slice(0,1).toUpperCase()+s.slice(1).toLowerCase():s.length===1&&(s=s.toUpperCase()),t+=s}break}}if(!t&&e.title){for(var g=this.locale[this.opt.lang].opts["skip-words"],d=e.title.split(/\s+/),a=d.length-1;a>-1;a--)g.indexOf(d[a])>-1&&(d=d.slice(0,a).concat(d.slice(a+1)));var v=d.join("");v=v.slice(0,r[0].authors[0]),v.length>1?v=v.slice(0,1).toUpperCase()+v.slice(1).toLowerCase():v.length===1&&(v=v.toUpperCase()),t=v}var b="0000";return e.issued&&e.issued.year&&(b=""+e.issued.year),b=b.slice(i.year*-1),t=t+b,t};l.Engine.prototype.getTrigraphParams=function(){var e=[],t=this.opt.trigraph.split(":");(!this.opt.trigraph||this.opt.trigraph.slice(0,1)!=="A")&&l.error("Bad trigraph definition: "+this.opt.trigraph);for(var r=0,i=t.length;r<i;r+=1){for(var s=t[r],a={authors:[],year:0},n=0,o=s.length;n<o;n+=1)switch(s.slice(n,n+1)){case"A":a.authors.push(1);break;case"a":a.authors[a.authors.length-1]+=1;break;case"0":a.year+=1;break;default:l.error("Invalid character in trigraph definition: "+this.opt.trigraph)}e.push(a)}return e};l.Engine.prototype.setOutputFormat=function(e){this.opt.mode=e,this.fun.decorate=l.Mode(e),this.output[e]||(this.output[e]={},this.output[e].tmp={})};l.Engine.prototype.getSortFunc=function(){return function(e,t){return e=e.split("-"),t=t.split("-"),e.length<t.length?1:e.length>t.length?-1:(e=e.slice(-1)[0],t=t.slice(-1)[0],e.length<t.length?1:e.length>t.length?-1:0)}};l.Engine.prototype.setLangTagsForCslSort=function(e){var t,r;if(e)for(this.opt["locale-sort"]=[],t=0,r=e.length;t<r;t+=1)this.opt["locale-sort"].push(e[t]);this.opt["locale-sort"].sort(this.getSortFunc())};l.Engine.prototype.setLangTagsForCslTransliteration=function(e){var t,r;if(this.opt["locale-translit"]=[],e)for(t=0,r=e.length;t<r;t+=1)this.opt["locale-translit"].push(e[t]);this.opt["locale-translit"].sort(this.getSortFunc())};l.Engine.prototype.setLangTagsForCslTranslation=function(e){var t,r;if(this.opt["locale-translat"]=[],e)for(t=0,r=e.length;t<r;t+=1)this.opt["locale-translat"].push(e[t]);this.opt["locale-translat"].sort(this.getSortFunc())};l.Engine.prototype.setLangPrefsForCites=function(e,t){var r=this.opt["cite-lang-prefs"];t||(t=function(m){return m.toLowerCase()});for(var i=["Persons","Institutions","Titles","Journals","Publishers","Places"],s=0,a=i.length;s<a;s+=1){var n=t(i[s]),o=i[s].toLowerCase();if(e[n]){for(var u=[];e[n].length>1;)u.push(e[n].pop());var c={orig:1,translit:2,translat:3};for(u.length===2&&c[u[0]]<c[u[1]]&&u.reverse();u.length;)e[n].push(u.pop());for(var p=r[o];p.length;)p.pop();for(var f=0,h=e[n].length;f<h;f+=1)p.push(e[n][f])}}};l.Engine.prototype.setLangPrefsForCiteAffixes=function(e){if(e&&e.length===48){for(var t=this.opt.citeAffixes,r=0,i=["persons","institutions","titles","journals","publishers","places"],s=["translit","orig","translit","translat"],a,n=0,o=i.length;n<o;n+=1)for(var u=0,c=s.length;u<c;u+=1)a="",r%8===4?!t[i[n]]["locale-"+s[u]].prefix&&!t[i[n]]["locale-"+s[u]].suffix&&(a=e[r]?e[r]:"",t[i[n]]["locale-"+s[u]].prefix=a,a=e[r]?e[r+1]:"",t[i[n]]["locale-"+s[u]].suffix=a):(a=e[r]?e[r]:"",t[i[n]]["locale-"+s[u]].prefix=a,a=e[r]?e[r+1]:"",t[i[n]]["locale-"+s[u]].suffix=a),r+=2;this.opt.citeAffixes=t}};l.Engine.prototype.setAutoVietnameseNamesOption=function(e){e?this.opt["auto-vietnamese-names"]=!0:this.opt["auto-vietnamese-names"]=!1};l.Engine.prototype.setAbbreviations=function(e){this.sys.setAbbreviations&&this.sys.setAbbreviations(e)};l.Engine.prototype.setSuppressTrailingPunctuation=function(e){this.citation.opt.suppressTrailingPunctuation=!!e};l.Output={};l.Output.Queue=function(e){this.levelname=["top"],this.state=e,this.queue=[],this.empty=new l.Token("empty");var t={};t.empty=this.empty,this.formats=new l.Stack(t),this.current=new l.Stack(this.queue)};l.Output.Queue.prototype.pop=function(){var e=this.current.value();return e.length?e.pop():e.blobs.pop()};l.Output.Queue.prototype.getToken=function(e){var t=this.formats.value()[e];return t};l.Output.Queue.prototype.mergeTokenStrings=function(e,t){var r,i,s,a;if(r=this.formats.value()[e],i=this.formats.value()[t],s=r,i){r||(r=new l.Token(e,l.SINGLETON),r.decorations=[]),s=new l.Token(e,l.SINGLETON);var a="";for(var a in r.strings)r.strings.hasOwnProperty(a)&&(s.strings[a]=r.strings[a]);for(var a in i.strings)i.strings.hasOwnProperty(a)&&(s.strings[a]=i.strings[a]);s.decorations=r.decorations.concat(i.decorations)}return s};l.Output.Queue.prototype.addToken=function(e,t,r){var i,s;if(i=new l.Token("output"),typeof r=="string"&&(r=this.formats.value()[r]),r&&r.strings){for(s in r.strings)r.strings.hasOwnProperty(s)&&(i.strings[s]=r.strings[s]);i.decorations=r.decorations}typeof t=="string"&&(i.strings.delimiter=t),this.formats.value()[e]=i};l.Output.Queue.prototype.pushFormats=function(e){e||(e={}),e.empty=this.empty,this.formats.push(e)};l.Output.Queue.prototype.popFormats=function(){this.formats.pop()};l.Output.Queue.prototype.startTag=function(e,t){var r={};this.state.tmp["doing-macro-with-date"]&&this.state.tmp.extension&&(t=this.empty,e="empty"),r[e]=t,this.pushFormats(r),this.openLevel(e)};l.Output.Queue.prototype.endTag=function(e){this.closeLevel(e),this.popFormats()};l.Output.Queue.prototype.openLevel=function(e){var t,r;typeof e=="object"?t=new l.Blob(void 0,e):typeof e=="undefined"?t=new l.Blob(void 0,this.formats.value().empty,"empty"):((!this.formats.value()||!this.formats.value()[e])&&l.error('CSL processor error: call to nonexistent format token "'+e+'"'),t=new l.Blob(void 0,this.formats.value()[e],e)),r=this.current.value(),!this.state.tmp.just_looking&&this.checkNestedBrace&&(t.strings.prefix=this.checkNestedBrace.update(t.strings.prefix)),r.push(t),this.current.push(t)};l.Output.Queue.prototype.closeLevel=function(e){e&&e!==this.current.value().levelname&&l.error("Level mismatch error:  wanted "+e+" but found "+this.current.value().levelname);var t=this.current.pop();!this.state.tmp.just_looking&&this.checkNestedBrace&&(t.strings.suffix=this.checkNestedBrace.update(t.strings.suffix))};l.Output.Queue.prototype.append=function(e,t,r,i,s){var a,n,o,u=!0;if(r&&(i=!0),this.state.tmp["doing-macro-with-date"]&&!r){if(t!=="macro-with-date")return!1;t==="macro-with-date"&&(t="empty")}if(typeof e=="undefined"||(typeof e=="number"&&(e=""+e),!r&&this.state.tmp.element_trace&&this.state.tmp.element_trace.value()==="suppress-me"))return!1;if(n=!1,t?t==="literal"?(a=!0,u=!1):typeof t=="string"?a=this.formats.value()[t]:a=t:a=this.formats.value().empty,a||l.error("CSL processor error: unknown format token name: "+t),a.strings&&typeof a.strings.delimiter=="undefined"&&(a.strings.delimiter=""),typeof e=="string"&&e.length&&(e=e.replace(/ ([:;?!\u00bb])/g,"\u202F$1").replace(/\u00ab /g,"\xAB\u202F"),this.last_char_rendered=e.slice(-1),e=e.replace(/\s+'/g," '"),r||(e=e.replace(/^'/g," '")),i?r&&(this.state.tmp.term_predecessor_name=!0):(this.state.tmp.term_predecessor=!0,this.state.tmp.in_cite_predecessor=!0)),n=new l.Blob(e,a),o=this.current.value(),typeof o=="undefined"&&this.current.mystack.length===0&&(this.current.mystack.push([]),o=this.current.value()),typeof n.blobs=="string"&&(i?r&&(this.state.tmp.term_predecessor_name=!0):(this.state.tmp.term_predecessor=!0,this.state.tmp.in_cite_predecessor=!0)),typeof e=="string"){if(typeof n.blobs=="string"&&n.blobs.slice(0,1)!==" "){for(var c="",p=n.blobs;l.TERMINAL_PUNCTUATION.indexOf(p.slice(0,1))>-1;)c=c+p.slice(0,1),p=p.slice(1);p&&c&&(n.strings.prefix=n.strings.prefix+c,n.blobs=p)}n.strings["text-case"]&&(n.blobs=l.Output.Formatters[n.strings["text-case"]](this.state,e)),this.state.tmp.strip_periods&&!s&&(n.blobs=n.blobs.replace(/\.([^a-z]|$)/g,"$1"));for(var f=n.decorations.length-1;f>-1;f+=-1)n.decorations[f][0]==="@quotes"&&n.decorations[f][1]!=="false"&&(n.punctuation_in_quote=this.state.getOpt("punctuation-in-quote")),n.blobs.match(l.ROMANESQUE_REGEXP)||n.decorations[f][0]==="@font-style"&&(n.decorations=n.decorations.slice(0,f).concat(n.decorations.slice(f+1)));o.push(n),this.state.fun.flipflopper.processTags(n)}else u?o.push(n):o.push(e);return!0};l.Output.Queue.prototype.string=function(e,t,r){var i,s,a,n,o,u=l.getSafeEscape(this.state),c=t.slice(),p=[];if(c.length===0)return p;var f="";r?f=r.strings.delimiter:(e.tmp.count_offset_characters=!1,e.tmp.offset_characters=0),r&&r.new_locale&&(r.old_locale=e.opt.lang,e.opt.lang=r.new_locale);for(var h,m,g,d,i=0,s=c.length;i<s;i+=1){if(h=c[i],h.strings.first_blob&&(e.tmp.count_offset_characters=h.strings.first_blob),typeof h.blobs=="string"){if(typeof h.num=="number")p.push(h);else if(h.blobs){h.particle&&(h.blobs=h.particle+h.blobs,h.particle=""),o=u(h.blobs);var v=o.length;if(!e.tmp.suppress_decorations)for(a=0,n=h.decorations.length;a<n;a+=1)d=h.decorations[a],d[0]!=="@showid"&&(e.normalDecorIsOrphan(h,d)||(o=e.fun.decorate[d[0]][d[1]].call(h,e,o,d[2])));if(o&&o.length){if(o=u(h.strings.prefix)+o+u(h.strings.suffix),e.opt.development_extensions.csl_reverse_lookup_support&&!e.tmp.suppress_decorations)for(a=0,n=h.decorations.length;a<n;a+=1)d=h.decorations[a],d[0]==="@showid"&&(o=e.fun.decorate[d[0]][d[1]].call(h,e,o,d[2]));p.push(o),e.tmp.count_offset_characters&&(e.tmp.offset_characters+=v+h.strings.suffix.length+h.strings.prefix.length)}}}else if(h.blobs.length){var b=e.output.string(e,h.blobs,h);if(r&&b!=="string"&&b.length>1&&h.strings.delimiter)for(var E=!1,a=0,n=b.length;a<n;a++)typeof b[a]!="string"?E=!0:E&&(b[a]=h.strings.delimiter+b[a]);p=p.concat(b)}h.strings.first_blob&&e.registry.registry[h.strings.first_blob]&&(e.registry.registry[h.strings.first_blob].offset=e.tmp.offset_characters,e.tmp.count_offset_characters=!1)}for(i=0,s=p.length-1;i<s;i+=1)typeof p[i].num=="number"&&typeof p[i+1].num=="number"&&!p[i+1].UGLY_DELIMITER_SUPPRESS_HACK&&(p[i].strings.suffix=p[i].strings.suffix+(f||""),p[i+1].successor_prefix="",p[i+1].UGLY_DELIMITER_SUPPRESS_HACK=!0);for(var x=0,i=0,s=p.length;i<s;i+=1)typeof p[i]=="string"&&(x=parseInt(i,10)+1,i<p.length-1&&typeof p[i+1]=="object"&&(f&&!p[i+1].UGLY_DELIMITER_SUPPRESS_HACK&&(p[i]+=u(f)),p[i+1].UGLY_DELIMITER_SUPPRESS_HACK=!0));if(r&&(r.decorations.length||r.strings.suffix))x=p.length;else if(r&&r.strings.prefix){for(var i=0,s=p.length;i<s;i++)if(typeof p[i].num!="undefined"){x=i,i===0&&(p[i].strings.prefix=r.strings.prefix+p[i].strings.prefix);break}}var w=e.output.renderBlobs(p.slice(0,x),f,!1,r);if(w&&r&&(r.decorations.length||r.strings.suffix||r.strings.prefix)){if(!e.tmp.suppress_decorations)for(var i=0,s=r.decorations.length;i<s;i+=1)d=r.decorations[i],!(["@cite","@bibliography","@display","@showid"].indexOf(d[0])>-1)&&(e.normalDecorIsOrphan(h,d)||d[0]&&typeof w=="string"&&(w=e.fun.decorate[d[0]][d[1]].call(r,e,w,d[2])));if(o=w,m=r.strings.suffix,o&&o.length&&(g=r.strings.prefix,o=u(g)+o+u(m),e.tmp.count_offset_characters&&(e.tmp.offset_characters+=g.length+m.length)),w=o,!e.tmp.suppress_decorations)for(var i=0,s=r.decorations.length;i<s;i+=1)d=r.decorations[i],["@cite","@bibliography","@display","@showid"].indexOf(d[0])!==-1&&typeof w=="string"&&(w=e.fun.decorate[d[0]][d[1]].call(r,e,w,d[2]))}var S=p.slice(x,p.length);return!S.length&&w?p=[w]:S.length&&!w?p=S:w&&S.length&&(p=[w].concat(S)),typeof r=="undefined"?(this.queue=[],this.current.mystack=[],this.current.mystack.push(this.queue),e.tmp.suppress_decorations&&(p=e.output.renderBlobs(p,void 0,!1))):typeof r=="boolean"&&(p=e.output.renderBlobs(p,void 0,!0)),r&&r.new_locale&&(e.opt.lang=r.old_locale),p};l.Output.Queue.prototype.clearlevel=function(){var e,t,r;for(e=this.current.value(),r=e.blobs.length,t=0;t<r;t+=1)e.blobs.pop()};l.Output.Queue.prototype.renderBlobs=function(e,t,r,i){var s,a,n,o,u,c,p,f,h,m,g,d;if(d=l.getSafeEscape(this.state),t||(t=""),s=this.state,a="",n=[],o="",p=e.length,this.state.tmp.area==="citation"&&!this.state.tmp.just_looking&&p===1&&typeof e[0]=="object"&&i)return e[0].strings.prefix=i.strings.prefix+e[0].strings.prefix,e[0].strings.suffix=e[0].strings.suffix+i.strings.suffix,e[0].decorations=e[0].decorations.concat(i.decorations),e[0].params=i.params,e[0];var v=!0;for(c=0;c<p;c+=1)e[c].checkNext?(e[c].checkNext(e[c+1],v),v=!1):e[c+1]&&e[c+1].splice_prefix?v=!1:v=!0;var b=!0;for(c=e.length-1;c>0;c+=-1)e[c].checkLast?b&&e[c].checkLast(e[c-1])&&(b=!1):b=!0;for(p=e.length,c=0;c<p;c+=1)if(u=e[c],a&&(o=t),typeof u=="string")a+=d(o),a+=u,s.tmp.count_offset_characters&&(s.tmp.offset_characters+=o.length);else if(r)a?a=[a,u]:a=[u];else if(u.status!==l.SUPPRESS){u.particle?m=u.particle+u.num:m=u.formatter.format(u.num,u.gender);var E=m.replace(/<[^>]*>/g,"").length;this.append(m,"empty",!0);var x=this.pop(),w=s.tmp.count_offset_characters;if(m=this.string(s,[x],!1),s.tmp.count_offset_characters=w,u.strings["text-case"]&&(m=l.Output.Formatters[u.strings["text-case"]](this.state,m)),m&&this.state.tmp.strip_periods&&(m=m.replace(/\.([^a-z]|$)/g,"$1")),!s.tmp.suppress_decorations)for(h=u.decorations.length,f=0;f<h;f+=1)g=u.decorations[f],!s.normalDecorIsOrphan(u,g)&&(m=s.fun.decorate[g[0]][g[1]].call(u,s,m,g[2]));m=d(u.strings.prefix)+m+d(u.strings.suffix);var S="";u.status===l.END?S=d(u.range_prefix):u.status===l.SUCCESSOR?S=d(u.successor_prefix):u.status===l.START?c>0&&!u.suppress_splice_prefix?S=d(u.splice_prefix):S="":u.status===l.SEEN&&(S=d(u.splice_prefix)),a+=S,a+=m,s.tmp.count_offset_characters&&(s.tmp.offset_characters+=S.length+u.strings.prefix.length+E+u.strings.suffix.length)}return a};l.Output.Queue.purgeEmptyBlobs=function(e){if(!(typeof e!="object"||typeof e.blobs!="object"||!e.blobs.length))for(var t=e.blobs.length-1;t>-1;t--){l.Output.Queue.purgeEmptyBlobs(e.blobs[t]);var r=e.blobs[t];if(!r||!r.blobs||!r.blobs.length){for(var i=[];e.blobs.length-1>t;)i.push(e.blobs.pop());for(e.blobs.pop();i.length;)e.blobs.push(i.pop())}}};l.Output.Queue.adjust=function(e){var t={";":!0,":":!0},r={".":!0,"!":!0,"?":!0},i={"!":{".":"!","?":"!?",":":"!",",":"!,",";":"!;"},"?":{"!":"?!",".":"?",":":"?",",":"?,",";":"?;"},".":{"!":".!","?":".?",":":".:",",":".,",";":".;"},":":{"!":"!","?":"?",".":":",",":":,",";":":;"},",":{"!":",!","?":",?",":":",:",".":",.",";":",;"},";":{"!":"!","?":"?",":":";",",":";,",".":";"}},s={},a={},n={},o={};for(var u in i)n[u]=!0,o[u]=!0,t[u]||(s[u]=!0),r[u]||(a[u]=!0);o[" "]=!0,o["\xA0"]=!0;var c={};for(var u in i)for(var p in i[u])c[p]||(c[p]={}),c[p][u]=i[u][p];function f(C){return typeof C.num=="number"||C.blobs&&C.blobs.length===1&&typeof C.blobs[0].num=="number"}function h(C){if(typeof C.num=="number")return!0;if(!C.blobs||typeof C.blobs!="object")return!1;if(h(C.blobs[C.blobs.length-1]))return!0}function m(C,A){var y=!1,_=["@font-style","@font-variant","@font-weight","@text-decoration","@vertical-align"];if(A&&_.push("@quotes"),C.decorations){for(var k=0,Q=C.decorations.length;k<Q;k++)if(_.indexOf(C.decorations[k][0])>-1){y=!0;break}}return y}function g(C){if(C.decorations){for(var A=0,y=C.decorations.length;A<y;A++)if(C.decorations[A][0]==="@quotes"&&C.decorations[A][1]!=="false")return!0}return typeof C.blobs!="object"?!1:g(C.blobs[C.blobs.length-1])}function d(C,A){var y=A.strings.suffix.slice(-1);!y&&typeof A.blobs=="string"&&(y=A.blobs.slice(-1));var _=c[C][y];return _&&_.length===1?!0:typeof A.blobs!="object"?!1:!!d(C,A.blobs[A.blobs.length-1])}function v(C,A){if(!n[A])return!1;if(typeof C.blobs=="string")return C.blobs.slice(-1)===A;var y=C.blobs[C.blobs.length-1];if(y){var _=y.strings.suffix.slice(-1);return _?y.strings.suffix.slice(-1)==A:v(y,A)}else return!1}function b(C,A,y,_,k){var Q=A==="blobs"?C:C.strings,O=_==="blobs"?y:y.strings,N=Q[A].slice(-1),B=O[_].slice(0,1);function q(){O[_]=O[_].slice(1)}function P(){Q[A]=Q[A].slice(0,-1)}function F(J){O[_]=J+O[_]}function j(J){Q[A]+=J}var D=k?P:q;function L(){return c[B]}function U(){return i[N]}var H=k?U:L;function G(){var J=i[N][B];typeof J=="string"?(P(),q(),F(J)):(F(N),P())}function $(){var J=c[B][N];typeof J=="string"?(P(),q(),j(J)):(j(B),q())}var z=k?G:$,Y=N===B;Y?D():H()&&z()}function E(C){if(C.blobs&&typeof C.blobs=="string"){n[C.strings.suffix.slice(0,1)]&&C.strings.suffix.slice(0,1)===C.blobs.slice(-1)&&(C.strings.suffix=C.strings.suffix.slice(1));return}else if(typeof C!="object"||typeof C.blobs!="object"||!C.blobs.length)return;for(var A=m(C,!0),y=C.blobs.length-1;y>-1;y--){this.upward(C.blobs[y]);var _=C.strings,k=C.blobs[y].strings;if(y===0){_.prefix.slice(-1)===" "&&k.prefix.slice(0,1)===" "&&(k.prefix=k.prefix.slice(1));var Q=k.prefix.slice(0,1);!A&&o[Q]&&!_.prefix&&(_.prefix+=Q,k.prefix=k.prefix.slice(1))}if(y===C.blobs.length-1){var Q=k.suffix.slice(-1);!A&&[" "].indexOf(Q)>-1&&(_.suffix.slice(0,1)!==Q&&(_.suffix=Q+_.suffix),k.suffix=k.suffix.slice(0,-1))}_.delimiter&&y>0&&o[_.delimiter.slice(-1)]&&_.delimiter.slice(-1)===k.prefix.slice(0,1)&&(k.prefix=k.prefix.slice(1))}}function x(C){if(!(typeof C!="object"||typeof C.blobs!="object"||!C.blobs.length)){for(var A=C.blobs.length-1;A>-1;A--)if(this.leftward(C.blobs[A]),A<C.blobs.length-1&&!C.strings.delimiter){var y=C.blobs[A],_=y.strings.suffix.slice(-1),k=C.blobs[A+1],Q=k.strings.prefix.slice(0,1),O=m(y)||m(k),N=typeof _=="number"||typeof Q=="number";if(!O&&!N&&n[Q]&&!N){var B=Q===y.strings.suffix.slice(-1),q=!y.strings.suffix&&typeof y.blobs=="string"&&y.blobs.slice(-1)===Q;!B&&!q?b(y,"suffix",k,"prefix"):k.strings.prefix=k.strings.prefix.slice(1)}}}}function w(C){if(C.blobs&&typeof C.blobs=="string"){n[C.strings.suffix.slice(0,1)]&&C.strings.suffix.slice(0,1)===C.blobs.slice(-1)&&(C.strings.suffix=C.strings.suffix.slice(1));return}else if(typeof C!="object"||typeof C.blobs!="object"||!C.blobs.length)return;for(var A=C.strings,y=!1,_=0,k=C.blobs.length;_<k;_++)if(f(C.blobs[_])){y=!0;break}if(A.delimiter&&n[A.delimiter.slice(0,1)]){for(var Q=A.delimiter.slice(0,1),_=C.blobs.length-2;_>-1;_--){var O=C.blobs[_].strings;O.suffix.slice(-1)!==Q&&(O.suffix+=Q)}A.delimiter=A.delimiter.slice(1)}for(var _=C.blobs.length-1;_>-1;_--){var N=C.blobs[_],O=C.blobs[_].strings,B=m(N,!0),q=f(N);if(_===C.blobs.length-1){var P=A.suffix.slice(0,1),F=!1;n[P]&&(F=d(P,N),!F&&e&&(F=g(N))),F&&n[P]&&(h(N)||(typeof N.blobs=="string"?b(N,"blobs",C,"suffix"):b(N,"suffix",C,"suffix"),A.suffix.slice(0,1)==="."&&(O.suffix+=A.suffix.slice(0,1),A.suffix=A.suffix.slice(1)))),O.suffix.slice(-1)==="\xA0"&&A.suffix.slice(0,1)===" "&&(A.suffix=A.suffix.slice(1)),o[O.suffix.slice(0,1)]&&(typeof N.blobs=="string"&&N.blobs.slice(-1)===O.suffix.slice(0,1)&&(O.suffix=O.suffix.slice(1)),O.suffix.slice(-1)===A.suffix.slice(0,1)&&(A.suffix=A.suffix.slice(0,-1))),v(C,C.strings.suffix.slice(0,1))&&(C.strings.suffix=C.strings.suffix.slice(1))}else if(A.delimiter)o[A.delimiter.slice(0,1)]&&A.delimiter.slice(0,1)===O.suffix.slice(-1)&&(C.blobs[_].strings.suffix=C.blobs[_].strings.suffix.slice(0,-1));else{var j=C.blobs[_+1].strings;!f(N)&&!B&&o[O.suffix.slice(-1)]&&O.suffix.slice(-1)===j.prefix.slice(0,1)&&(j.prefix=j.prefix.slice(1))}!q&&!B&&n[O.suffix.slice(0,1)]&&typeof N.blobs=="string"&&b(N,"blobs",N,"suffix"),this.downward(C.blobs[_])}}function S(C){var A=C.strings.suffix.slice(0,1);if(typeof C.blobs=="string")for(;s[A];)b(C,"blobs",C,"suffix"),A=C.strings.suffix.slice(0,1);else for(;s[A];)b(C.blobs[C.blobs.length-1],"suffix",C,"suffix"),A=C.strings.suffix.slice(0,1)}function T(C){if(typeof C.blobs=="string")for(var A=C.blobs.slice(-1);a[A];)b(C,"blobs",C,"suffix",!0),A=C.blobs.slice(-1);else for(var A=C.blobs[C.blobs.length-1].strings.suffix.slice(-1);a[A];)b(C.blobs[C.blobs.length-1],"suffix",C,"suffix",!0),A=C.blobs[C.blobs.length-1].strings.suffix.slice(-1)}function I(C){if(!(typeof C!="object"||typeof C.blobs!="object"||!C.blobs.length)){for(var A,y=0,_=C.blobs.length;y<_;y++){for(var k=C.blobs[y],Q=!1,O=0,N=k.decorations.length;O<N;O++){var B=k.decorations[O];B[0]==="@quotes"&&B[1]!=="false"&&(Q=!0)}Q&&(e?S(k):T(k)),A=this.fix(C.blobs[y]),k.blobs&&typeof k.blobs=="string"&&(A=k.blobs.slice(-1))}return A}}this.upward=E,this.leftward=x,this.downward=w,this.fix=I};l.Engine.Opt=function(){this.parallel={enable:!1},this.has_disambiguate=!1,this.mode="html",this.dates={},this.jurisdictions_seen={},this.suppressedJurisdictions={},this.inheritedAttributes={},this["locale-sort"]=[],this["locale-translit"]=[],this["locale-translat"]=[],this.citeAffixes={persons:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},institutions:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},titles:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},journals:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},publishers:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},places:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}}},this["default-locale"]=[],this.update_mode=l.NONE,this.bib_mode=l.NONE,this.sort_citations=!1,this["et-al-min"]=0,this["et-al-use-first"]=1,this["et-al-use-last"]=!1,this["et-al-subsequent-min"]=!1,this["et-al-subsequent-use-first"]=!1,this["demote-non-dropping-particle"]="display-and-sort",this["parse-names"]=!0,this.citation_number_slug=!1,this.trigraph="Aaaa00:AaAa00:AaAA00:AAAA00",this.nodenames=[],this.gender={},this["cite-lang-prefs"]={persons:["orig"],institutions:["orig"],titles:["orig"],journals:["orig"],publishers:["orig"],places:["orig"],number:["orig"]},this.has_layout_locale=!1,this.disable_duplicate_year_suppression=[],this.use_context_condition=!1,this.jurisdiction_fallbacks={},this.development_extensions={},this.development_extensions.field_hack=!0,this.development_extensions.allow_field_hack_date_override=!0,this.development_extensions.locator_date_and_revision=!0,this.development_extensions.locator_label_parse=!0,this.development_extensions.raw_date_parsing=!0,this.development_extensions.clean_up_csl_flaws=!0,this.development_extensions.consolidate_legal_items=!1,this.development_extensions.csl_reverse_lookup_support=!1,this.development_extensions.wrap_url_and_doi=!1,this.development_extensions.thin_non_breaking_space_html_hack=!1,this.development_extensions.apply_citation_wrapper=!1,this.development_extensions.main_title_from_short_title=!1,this.development_extensions.uppercase_subtitles=!1,this.development_extensions.normalize_lang_keys_to_lowercase=!1,this.development_extensions.strict_text_case_locales=!1,this.development_extensions.expect_and_symbol_form=!1,this.development_extensions.require_explicit_legal_case_title_short=!1,this.development_extensions.spoof_institutional_affiliations=!1,this.development_extensions.force_jurisdiction=!1,this.development_extensions.parse_names=!0,this.development_extensions.hanging_indent_legacy_number=!1,this.development_extensions.throw_on_empty=!1,this.development_extensions.strict_inputs=!0,this.development_extensions.prioritize_disambiguate_condition=!1,this.development_extensions.force_short_title_casing_alignment=!0,this.development_extensions.implicit_short_title=!1,this.development_extensions.force_title_abbrev_fallback=!1,this.development_extensions.split_container_title=!1,this.development_extensions.legacy_institution_name_ordering=!1,this.development_extensions.etal_min_etal_usefirst_hack=!1};l.Engine.Tmp=function(){this.names_max=new l.Stack,this.names_base=new l.Stack,this.givens_base=new l.Stack,this.value=[],this.namepart_decorations={},this.namepart_type=!1,this.area="citation",this.root="citation",this.extension="",this.can_substitute=new l.Stack(0,l.LITERAL),this.element_rendered_ok=!1,this.element_trace=new l.Stack("style"),this.nameset_counter=0,this.group_context=new l.Stack({term_intended:!1,variable_attempt:!1,variable_success:!1,output_tip:void 0,label_form:void 0,parallel_first:void 0,parallel_last:void 0,parallel_delimiter_override:void 0,condition:!1,force_suppress:!1,done_vars:[]}),this.term_predecessor=!1,this.in_cite_predecessor=!1,this.jump=new l.Stack(0,l.LITERAL),this.decorations=new l.Stack,this.tokenstore_stack=new l.Stack,this.last_suffix_used="",this.last_names_used=[],this.last_years_used=[],this.years_used=[],this.names_used=[],this.taintedItemIDs={},this.taintedCitationIDs={},this.initialize_with=new l.Stack,this.disambig_request=!1,this["name-as-sort-order"]=!1,this.suppress_decorations=!1,this.disambig_settings=new l.AmbigConfig,this.bib_sort_keys=[],this.prefix=new l.Stack("",l.LITERAL),this.suffix=new l.Stack("",l.LITERAL),this.delimiter=new l.Stack("",l.LITERAL),this.cite_locales=[],this.cite_affixes={citation:!1,bibliography:!1,citation_sort:!1,bibliography_sort:!1},this.strip_periods=0,this.shadow_numbers={},this.authority_stop_last=0,this.loadedItemIDs={},this.condition_counter=0,this.condition_lang_val_arr=[],this.condition_lang_counter_arr=[]};l.Engine.Fun=function(e){this.match=new l.Util.Match,this.suffixator=new l.Util.Suffixator(l.SUFFIX_CHARS),this.romanizer=new l.Util.Romanizer,this.ordinalizer=new l.Util.Ordinalizer(e),this.long_ordinalizer=new l.Util.LongOrdinalizer};l.Engine.Build=function(){this["alternate-term"]=!1,this.in_bibliography=!1,this.in_style=!1,this.skip=!1,this.postponed_macro=!1,this.layout_flag=!1,this.name=!1,this.names_variables=[[]],this.name_label=[{}],this.form=!1,this.term=!1,this.macro={},this.macro_stack=[],this.text=!1,this.lang=!1,this.area="citation",this.root="citation",this.extension="",this.substitute_level=new l.Stack(0,l.LITERAL),this.names_level=0,this.render_nesting_level=0,this.render_seen=!1,this.bibliography_key_pos=0};l.Engine.Configure=function(){this.tests=[],this.fail=[],this.succeed=[]};l.Engine.Citation=function(e){this.opt={inheritedAttributes:{}},this.tokens=[],this.srt=new l.Registry.Comparifier(e,"citation_sort"),this.opt.collapse=[],this.opt["disambiguate-add-names"]=!1,this.opt["disambiguate-add-givenname"]=!1,this.opt["disambiguate-add-year-suffix"]=!1,this.opt["givenname-disambiguation-rule"]="by-cite",this.opt["near-note-distance"]=5,this.opt.topdecor=[],this.opt.layout_decorations=[],this.opt.layout_prefix="",this.opt.layout_suffix="",this.opt.layout_delimiter="",this.opt.sort_locales=[],this.opt.max_number_of_names=0,this.root="citation"};l.Engine.Bibliography=function(){this.opt={inheritedAttributes:{}},this.tokens=[],this.opt.collapse=[],this.opt.topdecor=[],this.opt.layout_decorations=[],this.opt.layout_prefix="",this.opt.layout_suffix="",this.opt.layout_delimiter="",this.opt["line-spacing"]=1,this.opt["entry-spacing"]=1,this.opt.sort_locales=[],this.opt.max_number_of_names=0,this.root="bibliography"};l.Engine.BibliographySort=function(){this.tokens=[],this.opt={},this.opt.sort_directions=[],this.opt.topdecor=[],this.opt.citation_number_sort_direction=l.ASCENDING,this.opt.citation_number_secondary=!1,this.tmp={},this.keys=[],this.root="bibliography"};l.Engine.CitationSort=function(){this.tokens=[],this.opt={},this.opt.sort_directions=[],this.keys=[],this.opt.topdecor=[],this.root="citation"};l.Engine.InText=function(){this.opt={inheritedAttributes:{}},this.tokens=[],this.opt.collapse=[],this.opt["disambiguate-add-names"]=!1,this.opt["disambiguate-add-givenname"]=!1,this.opt["disambiguate-add-year-suffix"]=!1,this.opt["givenname-disambiguation-rule"]="by-cite",this.opt["near-note-distance"]=5,this.opt.topdecor=[],this.opt.layout_decorations=[],this.opt.layout_prefix="",this.opt.layout_suffix="",this.opt.layout_delimiter="",this.opt.sort_locales=[],this.opt.max_number_of_names=0,this.root="intext"};l.Engine.prototype.previewCitationCluster=function(e,t,r,i){var s=this.opt.mode;this.setOutputFormat(i),e.citationID&&delete e.citationID;var a=this.processCitationCluster(e,t,r,l.PREVIEW);return this.setOutputFormat(s),a[1]};l.Engine.prototype.appendCitationCluster=function(e){for(var t=[],r=this.registry.citationreg.citationByIndex.length,i=0;i<r;i+=1){var s=this.registry.citationreg.citationByIndex[i];t.push([""+s.citationID,s.properties.noteIndex])}return this.processCitationCluster(e,t,[])[1]};l.Engine.prototype.processCitationCluster=function(e,t,r,i){var s,a,n,o,u,c,p,f,h,m,g,d,v,b,E,x,w,S;this.debug=!1,this.tmp.loadedItemIDs={},this.tmp.citation_errors=[],this.registry.return_data={bibchange:!1},this.setCitationId(e);var T,I,C;if(i===l.PREVIEW){this.debug&&l.debug("****** start state save *********"),T=this.registry.citationreg.citationByIndex.slice(),I=this.registry.reflist.slice();for(var A=t.concat(r),y={},_=[],o=0,u=A.length;o<u;o+=1)for(s=this.registry.citationreg.citationById[A[o][0]],c=0,p=s.citationItems.length;c<p;c+=1)y[s.citationItems[c].id]=!0,_.push(""+s.citationItems[c].id);for(c=0,p=e.citationItems.length;c<p;c+=1)y[e.citationItems[c].id]=!0,_.push(""+e.citationItems[c].id);C={};for(var o=0,u=I.length;o<u;o+=1)if(!y[I[o].id]){var k=this.registry.registry[I[o].id].ambig,Q=this.registry.ambigcites[k];if(Q)for(c=0,p=Q.length;c<p;c+=1)C[Q[c]]=l.cloneAmbigConfig(this.registry.registry[Q[c]].disambig)}this.debug&&l.debug("****** end state save *********")}this.tmp.taintedCitationIDs={};for(var O=[],N={},o=0,u=e.citationItems.length;o<u;o+=1){b={};for(var d in e.citationItems[o])b[d]=e.citationItems[o][d];if(v=this.retrieveItem(""+b.id),v.id&&this.transform.loadAbbreviation("default","hereinafter",v.id,v.language),b=l.parseLocator.call(this,b),this.opt.development_extensions.consolidate_legal_items&&this.remapSectionVariable([[v,b]]),this.opt.development_extensions.locator_label_parse&&b.locator&&["bill","gazette","legislation","regulation","treaty"].indexOf(v.type)===-1&&(!b.label||b.label==="page")){var w=l.LOCATOR_LABELS_REGEXP.exec(b.locator);if(w){var B=l.LOCATOR_LABELS_MAP[w[2]];this.getTerm(B)&&(b.label=B,b.locator=w[3])}}var q=[v,b];O.push(q),e.citationItems[o].item=v}e.sortedItems=O;var P=[],F={},j;for(o=0,u=t.length;o<u;o+=1)a=t[o],this.opt.development_extensions.strict_inputs&&(F[a[0]]&&l.error("Previously referenced citationID "+a[0]+" encountered in citationsPre"),a[1]&&(j>a[1]&&l.debug("Note index sequence is not sane at citationsPre["+o+"]"),j=a[1])),this.registry.citationreg.citationById[a[0]].properties.noteIndex=a[1],P.push(this.registry.citationreg.citationById[a[0]]),F[a[0]]=this.registry.citationreg.citationById[a[0]];for(e.properties||(e.properties={noteIndex:0}),this.opt.development_extensions.strict_inputs&&(F[e.citationID]&&l.error("Citation with previously referenced citationID "+e.citationID),e.properties.noteIndex&&(j>e.properties.noteIndex&&l.debug("Note index sequence is not sane for citation "+e.citationID),j=e.properties.noteIndex)),P.push(e),F[e.citationID]=e,o=0,u=r.length;o<u;o+=1)n=r[o],this.opt.development_extensions.strict_inputs&&(F[n[0]]&&l.error("Previously referenced citationID "+n[0]+" encountered in citationsPost"),n[1]&&(j>n[1]&&l.debug("Note index sequence is not sane at postCitation["+o+"]"),j=n[1])),this.registry.citationreg.citationById[n[0]].properties.noteIndex=n[1],P.push(this.registry.citationreg.citationById[n[0]]),F[n[0]]=this.registry.citationreg.citationById[n[0]];this.registry.citationreg.citationByIndex=P,this.registry.citationreg.citationById=F,this.registry.citationreg.citationsByItemId={},this.opt.update_mode===l.POSITION&&(x=[],E=[],S={});for(var D=[],o=0,u=P.length;o<u;o+=1){for(P[o].properties.index=o,c=0,p=P[o].sortedItems.length;c<p;c+=1)b=P[o].sortedItems[c],this.registry.citationreg.citationsByItemId[b[1].id]||(this.registry.citationreg.citationsByItemId[b[1].id]=[],D.push(""+b[1].id)),this.registry.citationreg.citationsByItemId[b[1].id].indexOf(P[o])===-1&&this.registry.citationreg.citationsByItemId[b[1].id].push(P[o]);this.opt.update_mode===l.POSITION&&(P[o].properties.noteIndex?E.push(P[o]):(P[o].properties.noteIndex=0,x.push(P[o])))}if(i!==l.ASSUME_ALL_ITEMS_REGISTERED&&(this.debug&&l.debug("****** start update items *********"),this.updateItems(D,null,null,!0),this.debug&&l.debug("****** endo update items *********")),!this.opt.citation_number_sort&&O&&O.length>1&&this.citation_sort.tokens.length>0){for(var o=0,u=O.length;o<u;o+=1)O[o][1].sortkeys=l.getSortKeys.call(this,O[o][0],"citation_sort");if(this.opt.grouped_sort&&!e.properties.unsorted){for(var o=0,u=O.length;o<u;o+=1){var L=O[o][1].sortkeys;this.tmp.authorstring_request=!0;var U=this.registry.registry[O[o][0].id].disambig;this.tmp.authorstring_request=!0,l.getAmbiguousCite.call(this,O[o][0],U);var H=this.registry.authorstrings[O[o][0].id];this.tmp.authorstring_request=!1,O[o][1].sortkeys=[H].concat(L)}O.sort(this.citation.srt.compareCompositeKeys);for(var G=!1,$=!1,z=!1,o=0,u=O.length;o<u;o+=1)O[o][1].sortkeys[0]!==G&&(z=O[o][1].sortkeys[0],$=O[o][1].sortkeys[1]),O[o][1].sortkeys[0]=""+$+o,G=z}e.properties.unsorted||O.sort(this.citation.srt.compareCompositeKeys)}this.opt.parallel.enable&&this.parallel.StartCitation(e.sortedItems);var Y;if(this.opt.update_mode===l.POSITION)for(var o=0;o<2;o+=1){var J={},ee={},le={};for(Y=[x,E][o],c=0,p=Y.length;c<p;c+=1){var X=Y[c];for(Y[c].properties.noteIndex||(Y[c].properties.noteIndex=0),Y[c].properties.noteIndex=parseInt(Y[c].properties.noteIndex,10),c>0&&X.properties.noteIndex&&Y[c-1].properties.noteIndex>X.properties.noteIndex&&(S={},J={},ee={},le={}),f=0,h=X.sortedItems.length;f<h;f+=1)X.sortedItems[f][1].parallel&&X.sortedItems[f][1].parallel!=="first"||(S[X.properties.noteIndex]?S[X.properties.noteIndex]+=1:S[X.properties.noteIndex]=1);for(f=0,h=Y[c].sortedItems.length;f<h;f+=1){b=Y[c].sortedItems[f];var W=b[0].id,fe=b[0].legislation_id?b[0].legislation_id:b[0].id,te=b[0].legislation_id?b[0].legislation_id:b[0].container_id?b[0].container_id:b[0].id,ve=b[1]["locator-extra"],Re=b[1].locator,ae=b[1].label,_e,$r;if(f>0)if(X.sortedItems[f-1][0].legislation_id)_e=X.sortedItems[f-1][0].legislation_id;else{_e=X.sortedItems[f-1][1].id,$r=X.sortedItems[f-1][1]["locator-extra"];for(var ce=f-2;ce>-1;ce--)X.sortedItems[ce][1].parallel==="first"&&(_e=X.sortedItems[ce][1].id,$r=X.sortedItems[ce][1]["locator-extra"])}if(i===l.PREVIEW&&X.citationID!=e.citationID){typeof J[b[1].id]=="undefined"&&(J[fe]=X.properties.noteIndex),ee[te]=X.properties.noteIndex;continue}var dt={};if(dt.position=b[1].position,dt["first-reference-note-number"]=b[1]["first-reference-note-number"],dt["first-container-reference-note-number"]=b[1]["first-container-reference-note-number"],dt["near-note"]=b[1]["near-note"],b[1]["first-reference-note-number"]=0,b[1]["first-container-reference-note-number"]=0,b[1]["near-note"]=!1,this.registry.citationreg.citationsByItemId[W]&&this.opt.xclass==="note"&&this.opt.has_disambiguate){var It=this.registry.registry[b[0].id]["citation-count"],ym=this.registry.citationreg.citationsByItemId[W].length;if(this.registry.registry[b[0].id]["citation-count"]=this.registry.citationreg.citationsByItemId[W].length,typeof It=="number"){var vm=It<2,_m=ym<2;if(vm!==_m)for(var ce=0,Ea=this.registry.citationreg.citationsByItemId[W].length;ce<Ea;ce++)N[this.registry.registry[b[0].id].ambig]=!0,this.tmp.taintedCitationIDs[this.registry.citationreg.citationsByItemId[W][ce].citationID]=!0}else for(var ce=0,Ea=this.registry.citationreg.citationsByItemId[W].length;ce<Ea;ce++)N[this.registry.registry[b[0].id].ambig]=!0,this.tmp.taintedCitationIDs[this.registry.citationreg.citationsByItemId[W][ce].citationID]=!0}var wa,Jo;if(typeof ee[te]=="undefined"&&X.properties.mode!=="author-only")J[fe]=X.properties.noteIndex,ee[te]=X.properties.noteIndex,le[te]=X.properties.noteIndex,b[1].position=l.POSITION_FIRST;else{var ot=!1,rr=!1,Qe=null;if(c>0)var Qe=Y[c-1];var Ai=Y[c];if(c>0){var xa=1;Qe.properties.mode==="author-only"&&c>1&&(xa=2);var Wo=c-xa;Y[Wo].sortedItems.length&&(wa=Y[Wo].sortedItems.slice(-1)[0][1].id,Jo=Y[c-xa].sortedItems.slice(-1)[0][1]["locator-extra"]),Qe.sortedItems.length&&Qe.sortedItems[0].slice(-1)[0].legislation_id&&(wa=Qe.sortedItems[0].slice(-1)[0].legislation_id)}if(c>0&&f===0&&Qe.properties.noteIndex!==Ai.properties.noteIndex){var Xo=!1,Ko=Qe.sortedItems[0][0].id;if(Qe.sortedItems[0][0].legislation_id&&(Ko=Qe.sortedItems[0][0].legislation_id),Ko==fe&&Qe.properties.noteIndex>=Ai.properties.noteIndex-1){var Em=Qe.sortedItems[0][1]["locator-extra"],wm=Ai.sortedItems[0][1]["locator-extra"];(S[Qe.properties.noteIndex]===1||Qe.properties.noteIndex===0)&&Em===wm&&(Xo=!0)}Xo?ot=!0:rr=!0}else f>0&&_e==fe&&$r==ve||f===0&&c>0&&Qe.properties.noteIndex==Ai.properties.noteIndex&&Qe.sortedItems.length&&wa==fe&&Jo==ve?ot=!0:rr=!0;var Dt,lt,Ta,gt,Aa;ot&&(f>0?Dt=X.sortedItems[f-1][1]:Dt=Y[c-1].sortedItems[0][1],Dt.locator?(Dt.label?Ta=Dt.label:Ta="",lt=""+Dt.locator+Ta):lt=Dt.locator,Re?(ae?Aa=ae:Aa="",gt=""+Re+Aa):gt=Re),ot&&lt&&!gt&&(ot=!1,rr=!0),ot&&(!lt&&gt?b[1].position=l.POSITION_IBID_WITH_LOCATOR:!lt&&!gt||lt&&gt===lt?b[1].position=l.POSITION_IBID:lt&&gt&&gt!==lt?b[1].position=l.POSITION_IBID_WITH_LOCATOR:(ot=!1,rr=!0)),rr&&(b[1].position=l.POSITION_CONTAINER_SUBSEQUENT,typeof J[fe]=="undefined"?J[fe]=X.properties.noteIndex:b[1].position=l.POSITION_SUBSEQUENT),(rr||ot)&&(X.properties.mode==="author-only"&&(b[1].position=l.POSITION_FIRST),le[te]!=X.properties.noteIndex&&(b[1]["first-container-reference-note-number"]=le[te],this.registry.registry[b[0].id]&&(this.registry.registry[b[0].id]["first-container-reference-note-number"]=le[te])),J[fe]!=X.properties.noteIndex&&(b[1]["first-reference-note-number"]=J[fe],this.registry.registry[b[0].id]&&(this.registry.registry[b[0].id]["first-reference-note-number"]=J[fe])))}if(X.properties.noteIndex){var xm=parseInt(X.properties.noteIndex,10)-parseInt(ee[te],10);b[1].position!==l.POSITION_FIRST&&xm<=this.citation.opt["near-note-distance"]&&(b[1]["near-note"]=!0),ee[te]=X.properties.noteIndex}else b[1].position!==l.POSITION_FIRST&&(b[1]["near-note"]=!0);if(X.citationID!=e.citationID)for(m=0,g=l.POSITION_TEST_VARS.length;m<g;m+=1){var Sa=l.POSITION_TEST_VARS[m];b[1][Sa]!==dt[Sa]&&(this.registry.registry[b[0].id]&&Sa==="first-reference-note-number"&&(N[this.registry.registry[b[0].id].ambig]=!0,this.tmp.taintedItemIDs[b[0].id]=!0),this.tmp.taintedCitationIDs[X.citationID]=!0)}this.sys.variableWrapper&&(b[1].index=X.properties.index,b[1].noteIndex=X.properties.noteIndex)}}}if(this.opt.citation_number_sort&&O&&O.length>1&&this.citation_sort.tokens.length>0&&!e.properties.unsorted){for(var o=0,u=O.length;o<u;o+=1)O[o][1].sortkeys=l.getSortKeys.call(this,O[o][0],"citation_sort");O.sort(this.citation.srt.compareCompositeKeys)}for(var d in this.tmp.taintedItemIDs)if(this.tmp.taintedItemIDs.hasOwnProperty(d)&&(Y=this.registry.citationreg.citationsByItemId[d],Y))for(var o=0,u=Y.length;o<u;o+=1)this.tmp.taintedCitationIDs[Y[o].citationID]=!0;var zr=[];if(i===l.PREVIEW){this.debug&&l.debug("****** start run processor *********");try{zr=this.process_CitationCluster.call(this,e.sortedItems,e)}catch(Si){l.error("Error running CSL processor for preview: "+Si)}this.debug&&(l.debug("****** end run processor *********"),l.debug("****** start state restore *********")),this.registry.citationreg.citationByIndex=T,this.registry.citationreg.citationById={};for(var o=0,u=T.length;o<u;o+=1)this.registry.citationreg.citationById[T[o].citationID]=T[o];this.debug&&l.debug("****** start final update *********");for(var Zo=[],o=0,u=I.length;o<u;o+=1)Zo.push(""+I[o].id);this.updateItems(Zo,null,null,!0),this.debug&&l.debug("****** end final update *********");for(var d in C)C.hasOwnProperty(d)&&(this.registry.registry[d].disambig=C[d]);this.debug&&l.debug("****** end state restore *********")}else{for(var Tm in N)this.disambiguate.run(Tm,e);var Xe;for(var d in this.tmp.taintedCitationIDs)if(d!=e.citationID){var Me=this.registry.citationreg.citationById[d];if(!Me.properties.unsorted){for(var o=0,u=Me.sortedItems.length;o<u;o+=1)Me.sortedItems[o][1].sortkeys=l.getSortKeys.call(this,Me.sortedItems[o][0],"citation_sort");Me.sortedItems.sort(this.citation.srt.compareCompositeKeys)}this.tmp.citation_pos=Me.properties.index,this.tmp.citation_note_index=Me.properties.noteIndex,this.tmp.citation_id=""+Me.citationID,Xe=[],Xe.push(Me.properties.index),Xe.push(this.process_CitationCluster.call(this,Me.sortedItems,Me)),Xe.push(Me.citationID),zr.push(Xe)}this.tmp.taintedItemIDs={},this.tmp.taintedCitationIDs={},this.tmp.citation_pos=e.properties.index,this.tmp.citation_note_index=e.properties.noteIndex,this.tmp.citation_id=""+e.citationID,Xe=[],Xe.push(t.length),Xe.push(this.process_CitationCluster.call(this,O,e)),Xe.push(e.citationID),zr.push(Xe),zr.sort(function(Si,el){return Si[0]>el[0]?1:Si[0]<el[0]?-1:0})}return this.registry.return_data.citation_errors=this.tmp.citation_errors.slice(),[this.registry.return_data,zr]};l.Engine.prototype.process_CitationCluster=function(e,t){var r="";if(t&&t.properties&&t.properties.mode==="composite"){t.properties.mode="author-only";var i=l.getCitationCluster.call(this,e,t);t.properties.mode="suppress-author";var s="";t.properties.infix&&(this.output.append(t.properties.infix),s=this.output.string(this,this.output.queue),typeof s=="object"&&(s=s.join("")));var a=l.getCitationCluster.call(this,e,t);t.properties.mode="composite",i&&s&&l.SWAPPING_PUNCTUATION.concat(["\u2019","'"]).indexOf(s[0])>-1&&(i+=s,s=!1),r=[i,s,a].filter(function(n){return n}).join(" ")}else r=l.getCitationCluster.call(this,e,t);return r};l.Engine.prototype.makeCitationCluster=function(e){var t,r,p,i,s,a,n;for(t=[],s=e.length,i=0;i<s;i+=1){a={};for(var o in e[i])a[o]=e[i][o];if(n=this.retrieveItem(""+a.id),this.opt.development_extensions.locator_label_parse&&a.locator&&["bill","gazette","legislation","regulation","treaty"].indexOf(n.type)===-1&&(!a.label||a.label==="page")){var u=l.LOCATOR_LABELS_REGEXP.exec(a.locator);if(u){var c=l.LOCATOR_LABELS_MAP[u[2]];this.getTerm(c)&&(a.label=c,a.locator=u[3])}}a.locator&&(a.locator=(""+a.locator).replace(/\s+$/,"")),r=[n,a],t.push(r)}if(this.opt.development_extensions.consolidate_legal_items&&this.remapSectionVariable(t),t&&t.length>1&&this.citation_sort.tokens.length>0){for(s=t.length,i=0;i<s;i+=1)t[i][1].sortkeys=l.getSortKeys.call(this,t[i][0],"citation_sort");t.sort(this.citation.srt.compareCompositeKeys)}this.tmp.citation_errors=[];var p=l.getCitationCluster.call(this,t);return p};l.getAmbiguousCite=function(e,t,r,i){var h,s=this.tmp.group_context.tip,a={term_intended:s.term_intended,variable_attempt:s.variable_attempt,variable_success:s.variable_success,output_tip:s.output_tip,label_form:s.label_form,non_parallel:s.non_parallel,parallel_last:s.parallel_last,parallel_first:s.parallel_first,parallel_last_override:s.parallel_last_override,parallel_delimiter_override:s.parallel_delimiter_override,parallel_delimiter_override_on_suppress:s.parallel_delimiter_override_on_suppress,condition:s.condition,force_suppress:s.force_suppress,done_vars:s.done_vars.slice()};t?this.tmp.disambig_request=t:this.tmp.disambig_request=!1;var n={position:l.POSITION_SUBSEQUENT,"near-note":!0};i&&(n.locator=i.locator,n.label=i.label),this.registry.registry[e.id]&&this.registry.citationreg.citationsByItemId&&this.registry.citationreg.citationsByItemId[e.id]&&this.registry.citationreg.citationsByItemId[e.id].length&&r&&this.citation.opt["givenname-disambiguation-rule"]==="by-cite"&&(n["first-reference-note-number"]=this.registry.registry[e.id]["first-reference-note-number"]),this.tmp.area="citation",this.tmp.root="citation";var o=this.tmp.suppress_decorations;this.tmp.suppress_decorations=!0,this.tmp.just_looking=!0,l.getCite.call(this,e,n,null,!1);for(var u=0,c=this.output.queue.length;u<c;u+=1)l.Output.Queue.purgeEmptyBlobs(this.output.queue[u]);if(this.opt.development_extensions.clean_up_csl_flaws)for(var p=0,f=this.output.queue.length;p<f;p+=1)this.output.adjust.upward(this.output.queue[p]),this.output.adjust.leftward(this.output.queue[p]),this.output.adjust.downward(this.output.queue[p]),this.output.adjust.fix(this.output.queue[p]);var h=this.output.string(this,this.output.queue);return this.tmp.just_looking=!1,this.tmp.suppress_decorations=o,this.tmp.group_context.replace(a),h};l.getSpliceDelimiter=function(e,t,r){if(this.citation.opt["after-collapse-delimiter"]!==void 0)e?this.tmp.splice_delimiter=this.citation.opt["after-collapse-delimiter"]:t&&!this.tmp.have_collapsed?this.tmp.splice_delimiter=this.citation.opt["after-collapse-delimiter"]:!t&&!this.tmp.have_collapsed&&this.citation.opt.collapse!=="year-suffix"?this.tmp.splice_delimiter=this.citation.opt["after-collapse-delimiter"]:this.tmp.splice_delimiter=this.citation.opt.layout_delimiter;else if(this.tmp.use_cite_group_delimiter)this.tmp.splice_delimiter=this.citation.opt.cite_group_delimiter;else if(this.tmp.have_collapsed&&this.opt.xclass==="in-text"&&this.opt.update_mode!==l.NUMERIC)this.tmp.splice_delimiter=", ";else if(this.tmp.cite_locales[r-1]){var i=this.tmp.cite_affixes[this.tmp.area][this.tmp.cite_locales[r-1]];i&&i.delimiter&&(this.tmp.splice_delimiter=i.delimiter)}else this.tmp.splice_delimiter||(this.tmp.splice_delimiter="");return this.tmp.splice_delimiter};l.getCitationCluster=function(e,t){var r,i,s,a,n,o,u,c,p,f,h,m,g,d,v,b,E,x,w,S,T,I,C="";this.output.checkNestedBrace=new l.checkNestedBrace(this),t&&(S=t.citationID,T=t.properties.mode==="author-only"?!!t.properties.mode:!1,this.opt.xclass!=="note"&&(I=t.properties.mode==="suppress-author"?!!t.properties.mode:!1),t.properties.prefix&&(C=l.checkPrefixSpaceAppend(this,t.properties.prefix))),e=e||[],this.tmp.last_primary_names_string=!1,x=l.getSafeEscape(this),this.tmp.area="citation",this.tmp.root="citation",r="",i=[],this.tmp.last_suffix_used="",this.tmp.last_names_used=[],this.tmp.last_years_used=[],this.tmp.backref_index=[],this.tmp.cite_locales=[],this.tmp.just_looking||(this.tmp.abbrev_trimmer={QUASHES:{}});var A=this.output.checkNestedBrace.update(this.citation.opt.layout_prefix+C),y=!1;if(this.citation.opt.suppressTrailingPunctuation&&(y=!0),S&&this.registry.citationreg.citationById[S].properties["suppress-trailing-punctuation"]&&(y=!0),this.opt.xclass==="note"){for(var _=[],k=!1,Q=!1,O=!1,N=[],B=0,q=e.length;B<q;B+=1){var P=e[B][0].type,F=e[B][0].title,j=e[B][1].position,D=e[B][0].id;F&&P==="legal_case"&&D!==O&&j&&((F!==k||_.length===0)&&(N=[],_.push(N)),N.push(e[B][1])),k=F,Q=j,O=D}for(B=0,q=_.length;B<q;B+=1)if(N=_[B],!(N.length<2)){var L=N.slice(-1)[0].locator;if(L)for(var U=0,H=N.length-1;U<H;U+=1)N[U].locator&&(L=!1);L&&(N[0].locator=L,delete N.slice(-1)[0].locator,N[0].label=N.slice(-1)[0].label,N.slice(-1)[0].label&&delete N.slice(-1)[0].label)}}for(s=[],a=e.length,e[0]&&e[0][1]&&(T?(delete e[0][1]["suppress-author"],e[0][1]["author-only"]=!0):I&&(delete e[0][1]["author-only"],e[0][1]["suppress-author"]=!0)),this.opt.parallel.enable&&this.parallel.StartCitation(e),n=0;n<a;n+=1){this.tmp.cite_index=n,g=e[n][0],o=e[n][1],o=l.parseLocator.call(this,o),u=this.tmp.have_collapsed;var G=!1;if(n>0&&e[n-1][1]&&(G=!!e[n-1][1].locator),c={},this.tmp.shadow_numbers={},!this.tmp.just_looking&&this.opt.hasPlaceholderTerm){var $=this.output;this.output=new l.Output.Queue(this),this.output.adjust=new l.Output.Queue.adjust,l.getAmbiguousCite.call(this,g,null,!1,o),this.output=$}if(this.tmp.in_cite_predecessor=!1,n>0?l.getCite.call(this,g,o,""+e[n-1][0].id,!0):(this.tmp.term_predecessor=!1,l.getCite.call(this,g,o,null,!0)),this.tmp.cite_renders_content||(w={citationID:""+this.tmp.citation_id,index:this.tmp.citation_pos,noteIndex:this.tmp.citation_note_index,itemID:""+g.id,citationItems_pos:n,error_code:l.ERROR_NO_RENDERED_FORM},this.tmp.citation_errors.push(w)),c.splice_delimiter=l.getSpliceDelimiter.call(this,G,u,n),o&&o["author-only"]&&(this.tmp.suppress_decorations=!0),n>0){E=e[n-1][1];var z=E.suffix&&[";",".",","].indexOf(E.suffix.slice(-1))>-1,Y=!E.suffix&&o.prefix&&[";",".",","].indexOf(o.prefix.slice(0,1))>-1;if(z||Y){var J=c.splice_delimiter.indexOf(" ");J>-1&&!Y?c.splice_delimiter=c.splice_delimiter.slice(J):c.splice_delimiter=""}}if(c.suppress_decorations=this.tmp.suppress_decorations,c.have_collapsed=this.tmp.have_collapsed,s.push(c),o["author-only"])break}p=0,m=this.output.queue.slice();var ee="";t&&(ee=l.checkSuffixSpacePrepend(this,t.properties.suffix));var le=this.citation.opt.layout_suffix,X=this.tmp.cite_locales[this.tmp.cite_locales.length-1];X&&this.tmp.cite_affixes[this.tmp.area][X]&&this.tmp.cite_affixes[this.tmp.area][X].suffix&&(le=this.tmp.cite_affixes[this.tmp.area][X].suffix),l.TERMINAL_PUNCTUATION.slice(0,-1).indexOf(le.slice(0,1))>-1&&(le=le.slice(0,1)),le=this.output.checkNestedBrace.update(ee+le);for(var B=0,q=this.output.queue.length;B<q;B+=1)l.Output.Queue.purgeEmptyBlobs(this.output.queue[B]);if(!this.tmp.suppress_decorations&&this.output.queue.length&&(this.opt.development_extensions.apply_citation_wrapper&&this.sys.wrapCitationEntry&&!this.tmp.just_looking&&this.tmp.area==="citation"||(y||(this.output.queue[this.output.queue.length-1].strings.suffix=le),this.output.queue[0].strings.prefix=A)),this.opt.development_extensions.clean_up_csl_flaws)for(var U=0,H=this.output.queue.length;U<H;U+=1)this.output.adjust.upward(this.output.queue[U]),this.output.adjust.leftward(this.output.queue[U]),this.output.adjust.downward(this.output.queue[U]),this.tmp.last_chr=this.output.adjust.fix(this.output.queue[U]);for(n=0,a=m.length;n<a;n+=1){var W=[];if(this.output.queue=[m[n]],this.tmp.suppress_decorations=s[n].suppress_decorations,this.tmp.splice_delimiter=s[n].splice_delimiter,m[n].parallel_delimiter&&(this.tmp.splice_delimiter=m[n].parallel_delimiter),this.tmp.have_collapsed=s[n].have_collapsed,f=this.output.string(this,this.output.queue),this.tmp.suppress_decorations=!1,typeof f=="string")return this.tmp.suppress_decorations=!1,f||(this.opt.development_extensions.throw_on_empty?l.error("Citation would render no content"):f="[NO_PRINTED_FORM]"),f;if(typeof f=="object"&&f.length===0&&!o["suppress-author"]){if(n===0){var fe="[CSL STYLE ERROR: reference with no printed form.]",te=n===0?x(this.citation.opt.layout_prefix):"",ve=n===m.length-1?x(this.citation.opt.layout_suffix):"";f.push(te+fe+ve)}else if(n===m.length-1){var Re=i[i.length-1];typeof Re=="string"?i[i.length-1]+=x(this.citation.opt.layout_suffix):typeof Re=="object"&&(Re.strings.suffix+=x(this.citation.opt.layout_suffix))}}if(W.length&&typeof f[0]=="string"){f.reverse();var ae=f.pop();ae&&ae.slice(0,1)===","?W.push(ae):typeof W.slice(-1)[0]=="string"&&W.slice(-1)[0].slice(-1)===","?W.push(" "+ae):ae&&W.push(x(this.tmp.splice_delimiter)+ae)}else f.reverse(),h=f.pop(),typeof h!="undefined"&&(W.length&&typeof W[W.length-1]=="string"&&(W[W.length-1]+=h.successor_prefix),W.push(h));for(d=f.length,v=0;v<d;v+=1){if(b=f[v],typeof b=="string"){W.push(x(this.tmp.splice_delimiter)+b);continue}h=f.pop(),typeof h!="undefined"&&W.push(h)}W.length===0&&!e[n][1]["suppress-author"]&&(p+=1),W.length>1&&typeof W[0]!="string"&&(W=[this.output.renderBlobs(W)]),W.length&&(typeof W[0]=="string"?n>0&&(W[0]=x(this.tmp.splice_delimiter)+W[0]):n>0?W[0].splice_prefix=this.tmp.splice_delimiter:W[0].splice_prefix=""),i=i.concat(W)}if(r+=this.output.renderBlobs(i),r&&!this.tmp.suppress_decorations)for(a=this.citation.opt.layout_decorations.length,n=0;n<a;n+=1)c=this.citation.opt.layout_decorations[n],c[1]!=="normal"&&(!o||!o["author-only"])&&(r=this.fun.decorate[c[0]][c[1]](this,r));return this.tmp.suppress_decorations=!1,r||(this.opt.development_extensions.throw_on_empty?l.error("Citation would render no content"):r="[NO_PRINTED_FORM]"),r};l.getCite=function(e,t,r,i){var s,a,n=this.tmp.area;for(t&&t["author-only"]&&this.intext&&this.intext.tokens.length>0&&(this.tmp.area="intext"),this.tmp.cite_renders_content=!1,this.tmp.probably_rendered_something=!1,this.tmp.prevItemID=r,l.citeStart.call(this,e,t,i),s=0,this.tmp.name_node={},this.nameOutput=new l.NameOutput(this,e,t);s<this[this.tmp.area].tokens.length;)s=l.tokenExec.call(this,this[this.tmp.area].tokens[s],e,t);return l.citeEnd.call(this,e,t),!this.tmp.cite_renders_content&&!this.tmp.just_looking&&this.tmp.area==="bibliography"&&(a={index:this.tmp.bibliography_pos,itemID:""+e.id,error_code:l.ERROR_NO_RENDERED_FORM},this.tmp.bibliography_errors.push(a)),this.tmp.area=n,""+e.id};l.citeStart=function(e,t,r){if(this.tmp.lang_array=[],e.language){var i=e.language.match(/^([a-zA-Z]+).*/);i&&this.tmp.lang_array.push(i[1].toLowerCase())}if(this.tmp.lang_array.push(this.opt.lang),r||(this.tmp.shadow_numbers={}),this.tmp.disambiguate_count=0,this.tmp.disambiguate_maxMax=0,this.tmp.same_author_as_previous_cite=!1,this.tmp.suppress_decorations?this.tmp.subsequent_author_substitute_ok=!1:this.tmp.subsequent_author_substitute_ok=!0,this.tmp.lastchr="",this.tmp.area==="citation"&&this.citation.opt.collapse&&this.citation.opt.collapse.length?this.tmp.have_collapsed=!0:this.tmp.have_collapsed=!1,this.tmp.render_seen=!1,this.tmp.disambig_request&&!this.tmp.disambig_override?this.tmp.disambig_settings=this.tmp.disambig_request:this.registry.registry[e.id]&&!this.tmp.disambig_override?(this.tmp.disambig_request=this.registry.registry[e.id].disambig,this.tmp.disambig_settings=this.registry.registry[e.id].disambig):this.tmp.disambig_settings=new l.AmbigConfig,this.tmp.area!=="citation"){if(!this.registry.registry[e.id])this.tmp.disambig_restore=new l.AmbigConfig;else if(this.tmp.disambig_restore=l.cloneAmbigConfig(this.registry.registry[e.id].disambig),this.tmp.area==="bibliography"&&this.tmp.disambig_settings&&this.tmp.disambig_override&&(this.opt["disambiguate-add-names"]&&(this.tmp.disambig_settings.names=this.registry.registry[e.id].disambig.names.slice(),this.tmp.disambig_request&&(this.tmp.disambig_request.names=this.registry.registry[e.id].disambig.names.slice())),this.opt["disambiguate-add-givenname"])){this.tmp.disambig_request=this.tmp.disambig_settings,this.tmp.disambig_settings.givens=this.registry.registry[e.id].disambig.givens.slice(),this.tmp.disambig_request.givens=this.registry.registry[e.id].disambig.givens.slice();for(var s=0,a=this.tmp.disambig_settings.givens.length;s<a;s+=1)this.tmp.disambig_settings.givens[s]=this.registry.registry[e.id].disambig.givens[s].slice();for(var s=0,a=this.tmp.disambig_request.givens.length;s<a;s+=1)this.tmp.disambig_request.givens[s]=this.registry.registry[e.id].disambig.givens[s].slice()}}this.tmp.names_used=[],this.tmp.nameset_counter=0,this.tmp.years_used=[],this.tmp.names_max.clear(),this.tmp.just_looking||(!t||t.parallel==="first"||!t.parallel)&&(this.tmp.abbrev_trimmer={QUASHES:{}}),this.tmp.splice_delimiter=this[this.tmp.area].opt.layout_delimiter,this.bibliography_sort.keys=[],this.citation_sort.keys=[],this.tmp.has_done_year_suffix=!1,this.tmp.last_cite_locale=!1,!this.tmp.just_looking&&t&&!t.position&&this.registry.registry[e.id]&&(this.tmp.disambig_restore=l.cloneAmbigConfig(this.registry.registry[e.id].disambig)),this.tmp.first_name_string=!1,this.tmp.authority_stop_last=0};l.citeEnd=function(e,t){if(this.tmp.disambig_restore&&this.registry.registry[e.id]){this.registry.registry[e.id].disambig.names=this.tmp.disambig_restore.names.slice(),this.registry.registry[e.id].disambig.givens=this.tmp.disambig_restore.givens.slice();for(var r=0,i=this.registry.registry[e.id].disambig.givens.length;r<i;r+=1)this.registry.registry[e.id].disambig.givens[r]=this.tmp.disambig_restore.givens[r].slice()}if(this.tmp.disambig_restore=!1,t&&t.suffix?this.tmp.last_suffix_used=t.suffix:this.tmp.last_suffix_used="",this.tmp.last_years_used=this.tmp.years_used.slice(),this.tmp.last_names_used=this.tmp.names_used.slice(),this.tmp.cut_var=!1,this.tmp.disambig_request=!1,this.tmp.cite_locales.push(this.tmp.last_cite_locale),this.tmp.issued_date&&this.tmp.renders_collection_number){for(var s=[],r=this.tmp.issued_date.list.length-1;r>this.tmp.issued_date.pos;r+=-1)s.push(this.tmp.issued_date.list.pop());for(this.tmp.issued_date.list.pop(),r=s.length-1;r>-1;r+=-1)this.tmp.issued_date.list.push(s.pop())}this.tmp.issued_date=!1,this.tmp.renders_collection_number=!1};l.Engine.prototype.makeBibliography=function(e){var t,r,i,s,a,n,o,u,c,p,f,h;if(t=!1,!e&&(this.bibliography.opt.exclude_types||this.bibliography.opt.exclude_with_fields)){if(e={exclude:[]},this.bibliography.opt.exclude_types)for(var m in this.bibliography.opt.exclude_types){var g=this.bibliography.opt.exclude_types[m];e.exclude.push({field:"type",value:g})}if(this.bibliography.opt.exclude_with_fields)for(var m in this.bibliography.opt.exclude_with_fields){var d=this.bibliography.opt.exclude_with_fields[m];e.exclude.push({field:d,value:!0})}}if(!this.bibliography.tokens.length)return!1;if(typeof e=="string"&&(this.opt.citation_number_slug=e,e=!1),t){for(n=this.bibliography.tokens.length,o=0;o<n;o+=1)u=this.bibliography.tokens[o],l.debug("bibtok: "+u.name);for(l.debug("---"),n=this.citation.tokens.length,o=0;o<n;o+=1)c=this.citation.tokens[o],l.debug("cittok: "+u.name);for(l.debug("---"),n=this.bibliography_sort.tokens.length,o=0;o<n;o+=1)p=this.bibliography_sort.tokens[o],l.debug("bibsorttok: "+u.name)}r=l.getBibliographyEntries.call(this,e),f=r[0],h=r[1];var v=r[2];for(i={maxoffset:0,entryspacing:this.bibliography.opt["entry-spacing"],linespacing:this.bibliography.opt["line-spacing"],"second-field-align":!1,entry_ids:f,bibliography_errors:this.tmp.bibliography_errors.slice(),done:v},this.bibliography.opt["second-field-align"]&&(i["second-field-align"]=this.bibliography.opt["second-field-align"]),s=0,n=this.registry.reflist.length,o=0;o<n;o+=1)a=this.registry.reflist[o],a.offset>i.maxoffset&&(i.maxoffset=a.offset);return this.bibliography.opt.hangingindent&&(i.hangingindent=this.bibliography.opt.hangingindent),i.bibstart=this.fun.decorate.bibstart,i.bibend=this.fun.decorate.bibend,this.opt.citation_number_slug=!1,[i,h]};l.getBibliographyEntries=function(e){var t,r,i,s,a,n,o,u,c,p,f,h,m,g,d,v,b,E,x,w,S,T,I;t=[],S=[],this.tmp.area="bibliography",this.tmp.root="bibliography",this.tmp.last_rendered_name=!1,this.tmp.bibliography_errors=[],this.tmp.bibliography_pos=0,e&&e.page_start&&e.page_length?r=this.registry.getSortedIds():r=this.refetchItems(this.registry.getSortedIds()),this.tmp.disambig_override=!0;function C(P,F){return P===F}function A(P,F){for(p=F.length,f=0;f<p;f+=1)if(C(P,F[f]))return!0;return!1}function y(P,F){return typeof P=="boolean"||!P?P?!!F:!F:typeof F=="string"?C(P,F):F?A(P,F):!1}E={};var _;if(e&&e.page_start&&e.page_length&&(_=0,e.page_start!==!0))for(d=0,v=r.length;d<v&&(E[r[d]]=!0,e.page_start!=r[d]);d+=1);var k=[],Q={};for(this.tmp.container_item_count={},r=r.filter(P=>{var F=P;return P.legislation_id?Q[P.legislation_id]?F=!1:Q[P.legislation_id]=!0:P.container_id&&(this.tmp.container_item_count[P.container_id]||(this.tmp.container_item_count[P.container_id]=0),this.tmp.container_item_count[P.container_id]++,this.bibliography.opt.consolidate_containers.indexOf(P.type)>-1&&(Q[P.container_id]?F=!1:Q[P.container_id]=!0)),F}),this.tmp.container_item_pos={},d=0,v=r.length;d<v;d+=1){if(e&&e.page_start&&e.page_length){if(E[r[d]])continue;if(u=this.refetchItem(r[d]),_===e.page_length)break}else if(u=r[d],E[u.id])continue;if(e){if(i=!0,e.include){for(i=!1,T=0,I=e.include.length;T<I;T+=1)if(c=e.include[T],y(c.value,u[c.field])){i=!0;break}}else if(e.exclude){for(s=!1,T=0,I=e.exclude.length;T<I;T+=1)if(c=e.exclude[T],y(c.value,u[c.field])){s=!0;break}s&&(i=!1)}else if(e.select){for(i=!1,a=!0,T=0,I=e.select.length;T<I;T+=1)c=e.select[T],y(c.value,u[c.field])||(a=!1);a&&(i=!0)}if(e.quash){for(a=!0,T=0,I=e.quash.length;T<I;T+=1)c=e.quash[T],y(c.value,u[c.field])||(a=!1);a&&(i=!1)}if(!i)continue}if(g&&l.debug("BIB: "+u.id),u.container_id&&(this.tmp.container_item_pos[u.container_id]||(this.tmp.container_item_pos[u.container_id]=0),this.tmp.container_item_pos[u.container_id]++),n=new l.Token("group",l.START),n.decorations=[["@bibliography","entry"]].concat(this.bibliography.opt.layout_decorations),this.output.startTag("bib_entry",n),u.system_id&&this.sys.embedBibliographyEntry?this.output.current.value().item_id=u.system_id:this.output.current.value().system_id=u.id,m=[],this.registry.registry[u.id].master&&!(e&&e.page_start&&e.page_length)){x=[[u,{id:u.id}]],b=this.registry.registry[u.id].siblings;for(var T=0,I=b.length;T<I;T++)x.push([this.refetchItem(b[T]),{id:b[T]}]);for(this.parallel.StartCitation(x),this.registry.registry[u.id].parallel_delimiter_override?this.output.queue[0].strings.delimiter=this.registry.registry[u.id].parallel_delimiter_override:this.output.queue[0].strings.delimiter=", ",this.tmp.term_predecessor=!1,this.tmp.cite_index=0,T=0,I=x.length;T<I;T+=1)T<x.length-1?this.tmp.parallel_and_not_last=!0:delete this.tmp.parallel_and_not_last,m.push(""+l.getCite.call(this,x[T][0],x[T][1])),this.tmp.cite_index++,E[x[T][0].id]=!0}else this.registry.registry[u.id].siblings||(this.tmp.term_predecessor=!1,this.tmp.cite_index=0,m.push(""+l.getCite.call(this,u)),e&&e.page_start&&e.page_length&&(_+=1));for(S.push(""),this.tmp.bibliography_pos+=1,k.push(m),this.output.endTag("bib_entry"),this.output.queue[0].blobs.length&&this.output.queue[0].blobs[0].blobs.length&&(this.output.queue[0].blobs[0].blobs[0].strings?h=this.output.queue[0].blobs[0].blobs:h=this.output.queue[0].blobs,h[0].strings.prefix=this.bibliography.opt.layout_prefix+h[0].strings.prefix),T=0,I=this.output.queue.length;T<I;T+=1)l.Output.Queue.purgeEmptyBlobs(this.output.queue[T]);for(T=0,I=this.output.queue.length;T<I;T+=1)this.output.adjust.upward(this.output.queue[T]),this.output.adjust.leftward(this.output.queue[T]),this.output.adjust.downward(this.output.queue[T],!0),this.output.adjust.fix(this.output.queue[T]);if(o=this.output.string(this,this.output.queue)[0],!o&&this.opt.update_mode===l.NUMERIC){var O=t.length+1+". [CSL STYLE ERROR: reference with no printed form.]";o=l.Output.Formats[this.opt.mode]["@bibliography/entry"](this,O)}o&&t.push(o)}var N=!1;if(e&&e.page_start&&e.page_length){var B=r.slice(-1)[0],q=k.slice(-1)[0];(!B||!q||B==q)&&(N=!0)}return this.tmp.disambig_override=!1,[k,t,N]};l.Engine.prototype.setCitationId=function(e,t){var r,i,s;if(r=!1,!e.citationID||t){for(i=Math.floor(Math.random()*1e14);;){if(s=0,this.registry.citationreg.citationById[i])!s&&i<5e13?s=1:s=-1;else{e.citationID="a"+i.toString(32);break}s===1?i+=1:i+=-1}r=""+i}return this.registry.citationreg.citationById[e.citationID]=e,r};l.Engine.prototype.rebuildProcessorState=function(e,t,r){e||(e=[]),t||(t="html");for(var i={},s=[],a=0,n=e.length;a<n;a+=1)for(var o=0,u=e[a].citationItems.length;o<u;o+=1){var c=""+e[a].citationItems[o].id;i[c]||s.push(c),i[c]=!0}this.updateItems(s);var p=[],f=[],h=[],m=this.opt.mode;this.setOutputFormat(t);for(var a=0,n=e.length;a<n;a+=1){var g=this.processCitationCluster(e[a],p,f,l.ASSUME_ALL_ITEMS_REGISTERED);p.push([e[a].citationID,e[a].properties.noteIndex]);for(var o=0,u=g[1].length;o<u;o+=1){var d=g[1][o][0];h[d]=[p[d][0],p[d][1],g[1][o][1]]}}return this.updateUncitedItems(r),this.setOutputFormat(m),h};l.Engine.prototype.restoreProcessorState=function(e){var t,r,i,s,a,n,o,u,c,p;u=[],c=[],e||(e=[]);var f=[],h={};for(t=0,r=e.length;t<r;t+=1)h[e[t].citationID]&&this.setCitationId(e[t],!0),h[e[t].citationID]=!0,f.push(e[t].properties.index);var m=e.slice();for(m.sort(function(d,v){return d.properties.index<v.properties.index?-1:d.properties.index>v.properties.index?1:0}),t=0,r=m.length;t<r;t+=1)m[t].properties.index=t;for(t=0,r=m.length;t<r;t+=1){for(p=[],i=0,s=m[t].citationItems.length;i<s;i+=1)a=m[t].citationItems[i],typeof a.sortkeys=="undefined"&&(a.sortkeys=[]),n=this.retrieveItem(""+a.id),o=[n,a],p.push(o),m[t].citationItems[i].item=n,c.push(""+a.id);m[t].properties.unsorted||p.sort(this.citation.srt.compareCompositeKeys),m[t].sortedItems=p,this.registry.citationreg.citationById[m[t].citationID]=m[t]}for(this.updateItems(c),t=0,r=e.length;t<r;t+=1)u.push([""+e[t].citationID,e[t].properties.noteIndex]);var g=[];return e&&e.length?g=this.processCitationCluster(e[0],[],u.slice(1)):(this.registry=new l.Registry(this),this.tmp=new l.Engine.Tmp,this.disambiguate=new l.Disambiguation(this)),g};l.Engine.prototype.updateItems=function(e,t,r,i){var s=!1,a=this.tmp.area,n=this.tmp.root,o=this.tmp.extension;if(this.bibliography_sort.tokens.length===0&&(t=!0),this.tmp.area="citation",this.tmp.root="citation",this.tmp.extension="",i||(this.tmp.loadedItemIDs={}),s&&l.debug("--> init <--"),this.registry.init(e),r)for(var u in this.registry.ambigcites)this.registry.ambigsTouched[u]=!0;return this.registry.dodeletes(this.registry.myhash),this.registry.doinserts(this.registry.mylist),this.registry.dorefreshes(),this.registry.rebuildlist(t),this.registry.setsortkeys(),this.registry.setdisambigs(),this.registry.sorttokens(t),this.registry.renumber(),this.tmp.extension=o,this.tmp.area=a,this.tmp.root=n,this.registry.getSortedIds()};l.Engine.prototype.updateUncitedItems=function(e,t){var r,i=this.tmp.area,s=this.tmp.root,a=this.tmp.extension;if(this.bibliography_sort.tokens.length===0&&(t=!0),this.tmp.area="citation",this.tmp.root="citation",this.tmp.extension="",this.tmp.loadedItemIDs={},e||(e=[]),typeof e=="object"){if(typeof e.length=="undefined"){r=e,e=[];for(var n in r)e.push(n)}else if(typeof e.length=="number"){r={};for(var o=0,u=e.length;o<u;o+=1)r[e[o]]=!0}}return this.registry.init(e,!0),this.registry.dopurge(r),this.registry.doinserts(this.registry.mylist),this.registry.dorefreshes(),this.registry.rebuildlist(t),this.registry.setsortkeys(),this.registry.setdisambigs(),this.registry.sorttokens(t),this.registry.renumber(),this.tmp.extension=a,this.tmp.area=i,this.tmp.root=s,this.registry.getSortedIds()};l.localeResolve=function(e,t){var r,i;return t||(t="en-US"),e||(e=t),r={},i=e.split(/[\-_]/),r.base=l.LANG_BASES[i[0]],typeof r.base=="undefined"?{base:t,best:e,bare:i[0]}:(i.length===1&&(r.generic=!0),i.length===1||i[1]==="x"?r.best=r.base.replace("_","-"):r.best=i.slice(0,2).join("-"),r.base=r.base.replace("_","-"),r.bare=i[0],r)};l.Engine.prototype.localeConfigure=function(e,t){var r;if(!(t&&this.locale[e.best])&&(e.best==="en-US"?(r=l.setupXml(this.sys.retrieveLocale("en-US")),this.localeSet(r,"en-US",e.best)):e.best!=="en-US"&&(e.base!==e.best&&(r=l.setupXml(this.sys.retrieveLocale(e.base)),this.localeSet(r,e.base,e.best)),r=l.setupXml(this.sys.retrieveLocale(e.best)),this.localeSet(r,e.best,e.best)),this.localeSet(this.cslXml,"",e.best),this.localeSet(this.cslXml,e.bare,e.best),e.base!==e.best&&this.localeSet(this.cslXml,e.base,e.best),this.localeSet(this.cslXml,e.best,e.best),typeof this.locale[e.best].terms["page-range-delimiter"]=="undefined"&&(["fr","pt"].indexOf(e.best.slice(0,2).toLowerCase())>-1?this.locale[e.best].terms["page-range-delimiter"]="-":this.locale[e.best].terms["page-range-delimiter"]="\u2013"),typeof this.locale[e.best].terms["year-range-delimiter"]=="undefined"&&(this.locale[e.best].terms["year-range-delimiter"]="\u2013"),typeof this.locale[e.best].terms["citation-range-delimiter"]=="undefined"&&(this.locale[e.best].terms["citation-range-delimiter"]="\u2013"),this.opt.development_extensions.normalize_lang_keys_to_lowercase)){for(var i=["default-locale","locale-sort","locale-translit","locale-translat"],s=0,a=i.length;s<a;s+=1)for(var n=0,o=this.opt[i[s]].length;n<o;n+=1)this.opt[i[s]][n]=this.opt[i[s]][n].toLowerCase();this.opt.lang=this.opt.lang.toLowerCase()}};l.Engine.prototype.localeSet=function(e,t,r){var i,s,a,n,o,u,c,p,f,h,m,g,d,v,b,E;if(t=t.replace("_","-"),r=r.replace("_","-"),this.opt.development_extensions.normalize_lang_keys_to_lowercase&&(t=t.toLowerCase(),r=r.toLowerCase()),this.locale[r]||(this.locale[r]={},this.locale[r].terms={},this.locale[r].opts={},this.locale[r].opts["skip-words"]=l.SKIP_WORDS,this.locale[r].opts["leading-noise-words"]||(this.locale[r].opts["leading-noise-words"]=[]),this.locale[r].dates={},this.locale[r].ord={"1.0.1":!1,keys:{}},this.locale[r]["noun-genders"]={}),s=e.makeXml(),e.nodeNameIs(e.dataObj,"locale"))s=e.dataObj;else{a=e.getNodesByName(e.dataObj,"locale");var x=!1;for(o=0,g=e.numberofnodes(a);o<g;o+=1)if(i=a[o],!x&&e.getAttributeValue(i,"lang","xml")===t)s=i,x=!0;else{var w=e.getAttributeValue(i,"lang","xml"),S=e.getNodesByName(i,"style-options");if(w&&S&&S.length){var T=e.getAttributeValue(S[0],"jurisdiction-preference");T&&(this.locale[w]||(this.locale[w]={opts:{}}),this.locale[w].opts["jurisdiction-preference"]=T.split(/\s+/))}}}for(a=e.getNodesByName(s,"type"),b=0,E=e.numberofnodes(a);b<E;b+=1){var I=a[b],C=e.getAttributeValue(I,"name"),A=e.getAttributeValue(I,"gender");this.opt.gender[C]=A}var y=e.getNodesByName(s,"term","ordinal").length;if(y){for(var _ in this.locale[r].ord.keys)delete this.locale[r].terms[_];this.locale[r].ord={"1.0.1":!1,keys:{}}}a=e.getNodesByName(s,"term");var k={"last-digit":{},"last-two-digits":{},"whole-number":{}},Q=!1,O={};for(o=0,g=e.numberofnodes(a);o<g;o+=1){if(u=a[o],p=e.getAttributeValue(u,"name"),p==="sub verbo"&&(p="sub-verbo"),p.slice(0,7)==="ordinal"){if(p==="ordinal")Q=!0;else{var N=e.getAttributeValue(u,"match"),B=p.slice(8),d=e.getAttributeValue(u,"gender-form");d||(d="neuter"),N||(N="last-two-digits",B.slice(0,1)==="0"&&(N="last-digit")),B.slice(0,1)==="0"&&(B=B.slice(1)),k[N][B]||(k[N][B]={}),k[N][B][d]=p}this.locale[r].ord.keys[p]=!0}typeof this.locale[r].terms[p]=="undefined"&&(this.locale[r].terms[p]={}),c="long",d=!1,e.getAttributeValue(u,"form")&&(c=e.getAttributeValue(u,"form")),e.getAttributeValue(u,"gender-form")&&(d=e.getAttributeValue(u,"gender-form")),e.getAttributeValue(u,"gender")&&(this.locale[r]["noun-genders"][p]=e.getAttributeValue(u,"gender")),d?(this.locale[r].terms[p][d]={},this.locale[r].terms[p][d][c]=[],v=this.locale[r].terms[p][d],O[p]=!0):(this.locale[r].terms[p][c]=[],v=this.locale[r].terms[p]),e.numberofnodes(e.getNodesByName(u,"multiple"))?(v[c][0]=e.getNodeValue(u,"single"),v[c][0].indexOf("%s")>-1&&(this.opt.hasPlaceholderTerm=!0),v[c][1]=e.getNodeValue(u,"multiple"),v[c][1].indexOf("%s")>-1&&(this.opt.hasPlaceholderTerm=!0)):(v[c]=e.getNodeValue(u),v[c].indexOf("%s")>-1&&(this.opt.hasPlaceholderTerm=!0))}if(this.locale[r].terms.supplement||(this.locale[r].terms.supplement={}),this.locale[r].terms.supplement.long||(this.locale[r].terms.supplement.long=["supplement","supplements"]),Q){for(var q in O){var P={},F=0;for(var j in this.locale[r].terms[q])["masculine","feminine"].indexOf(j)>-1?P[j]=this.locale[r].terms[q][j]:F+=1;if(!F){if(P.feminine)for(var j in P.feminine)this.locale[r].terms[q][j]=P.feminine[j];else if(P.masculine)for(var j in P.masculine)this.locale[r].terms[q][j]=P.masculine[j]}}this.locale[r].ord["1.0.1"]=k}for(p in this.locale[r].terms)for(b=0,E=2;b<E;b+=1)if(d=l.GENDERS[b],this.locale[r].terms[p][d])for(c in this.locale[r].terms[p])this.locale[r].terms[p][d][c]||(this.locale[r].terms[p][d][c]=this.locale[r].terms[p][c]);for(a=e.getNodesByName(s,"style-options"),o=0,g=e.numberofnodes(a);o<g;o+=1){f=a[o],n=e.attributes(f);for(m in n)if(n.hasOwnProperty(m)){if(m==="@punctuation-in-quote"||m==="@limit-day-ordinals-to-day-1")n[m]==="true"?this.locale[r].opts[m.slice(1)]=!0:this.locale[r].opts[m.slice(1)]=!1;else if(m==="@jurisdiction-preference"){var D=n[m].split(/\s+/);this.locale[r].opts[m.slice(1)]=D}else if(m==="@skip-words"){var L=n[m].split(/\s*,\s*/);this.locale[r].opts[m.slice(1)]=L}else if(m==="@leading-noise-words"){var U=n[m].split(/\s*,\s*/);this.locale[r].opts["leading-noise-words"]=U}else if(m==="@name-as-sort-order"){this.locale[r].opts["name-as-sort-order"]={};for(var H=n[m].split(/\s+/),b=0,E=H.length;b<E;b+=1)this.locale[r].opts["name-as-sort-order"][H[b]]=!0}else if(m==="@name-as-reverse-order"){this.locale[r].opts["name-as-reverse-order"]={};for(var H=n[m].split(/\s+/),b=0,E=H.length;b<E;b+=1)this.locale[r].opts["name-as-reverse-order"][H[b]]=!0}else if(m==="@name-never-short"){this.locale[r].opts["name-never-short"]={};for(var H=n[m].split(/\s+/),b=0,E=H.length;b<E;b+=1)this.locale[r].opts["name-never-short"][H[b]]=!0}}}for(a=e.getNodesByName(s,"date"),o=0,g=e.numberofnodes(a);o<g;o+=1){var h=a[o];this.locale[r].dates[e.getAttributeValue(h,"form")]=h}l.SET_COURT_CLASSES(this,r,e,s)};l.getLocaleNames=function(e,t){var r=l.setupXml(e);function i(f,h){var m=["base","best"];if(h)for(var g=l.localeResolve(h),d=0,v=m.length;d<v;d++)g[m[d]]&&f.indexOf(g[m[d]])===-1&&f.push(g[m[d]])}var s=["en-US"];function a(f){for(var h=r.getNodesByName(r.dataObj,f),m=0,g=h.length;m<g;m++){var d=r.getAttributeValue(h[m],"locale");if(d){d=d.split(/ +/);for(var v=0,b=d.length;v<b;v++)this.extendLocaleList(s,d[v])}}}i(s,t);var n=r.getNodesByName(r.dataObj,"style")[0],o=r.getAttributeValue(n,"default-locale");i(s,o);for(var u=["layout","if","else-if","condition"],c=0,p=u.length;c<p;c++)a(r,s,u[c]);return s};l.Node={};l.Node.bibliography={build:function(e,t){if(this.tokentype===l.START){e.build.area="bibliography",e.build.root="bibliography",e.build.extension="";var r=function(i){i.tmp.area="bibliography",i.tmp.root="bibliography",i.tmp.extension=""};this.execs.push(r)}t.push(this)}};l.Node.choose={build:function(e,t){var r;this.tokentype===l.START&&(r=function(i){i.tmp.jump.push(void 0,l.LITERAL)}),this.tokentype===l.END&&(r=function(i){i.tmp.jump.pop()}),this.execs.push(r),t.push(this)},configure:function(e,t){this.tokentype===l.END?(e.configure.fail.push(t),e.configure.succeed.push(t)):(e.configure.fail.pop(),e.configure.succeed.pop())}};l.Node.citation={build:function(e,t){if(this.tokentype===l.START){e.build.area="citation",e.build.root="citation",e.build.extension="";var r=function(s){s.tmp.area="citation",s.tmp.root="citation",s.tmp.extension=""};this.execs.push(r)}if(this.tokentype===l.END){if(e.opt.grouped_sort=e.opt.xclass==="in-text"&&e.citation.opt.collapse&&e.citation.opt.collapse.length||e.citation.opt.cite_group_delimiter&&e.citation.opt.cite_group_delimiter.length&&e.opt.update_mode!==l.POSITION&&e.opt.update_mode!==l.NUMERIC,e.opt.grouped_sort&&e.citation_sort.opt.sort_directions.length){var i=e.citation_sort.opt.sort_directions[0].slice();e.citation_sort.opt.sort_directions=[i].concat(e.citation_sort.opt.sort_directions)}e.citation.srt=new l.Registry.Comparifier(e,"citation_sort")}t.push(this)}};l.Node["#comment"]={build:function(){}};l.Node.date={build:function(e,t){var r,i,s,a,n,o,u,c,p,f;(this.tokentype===l.START||this.tokentype===l.SINGLETON)&&(e.dateput.string(e,e.dateput.queue),e.tmp.date_token=l.Util.cloneToken(this),e.tmp.date_token.strings.prefix="",e.tmp.date_token.strings.suffix="",e.dateput.openLevel(this),e.build.date_parts=[],e.build.date_variables=this.variables,e.build.extension||l.Util.substituteStart.call(this,e,t),e.build.extension?r=l.dateMacroAsSortKey:r=function(h,m,g){var d;if(h.tmp.element_rendered_ok=!1,h.tmp.donesies=[],h.tmp.dateparts=[],d=[],this.variables.length&&!(h.tmp.just_looking&&this.variables[0]==="accessed")){for(i=m[this.variables[0]],typeof i=="undefined"&&(i={"date-parts":[[0]]},h.opt.development_extensions.locator_date_and_revision&&g&&this.variables[0]==="locator-date"&&g["locator-date"]&&(i=g["locator-date"])),h.tmp.date_object=i,s=this.dateparts.length,a=0;a<s;a+=1)n=this.dateparts[a],(typeof h.tmp.date_object[n+"_end"]!="undefined"||n==="month"&&typeof h.tmp.date_object.season_end!="undefined")&&d.push(n);for(o=[],u=["year","month","day"],s=u.length,a=0;a<s;a+=1)d.indexOf(u[a])>-1&&o.push(u[a]);for(d=o.slice(),c=2,s=d.length,a=0;a<s;a+=1)if(n=d[a],p=h.tmp.date_object[n],f=h.tmp.date_object[n+"_end"],p!==f){c=a;break}h.tmp.date_collapse_at=d.slice(c)}else h.tmp.date_object=!1},this.execs.push(r),r=function(h,m){if(m[this.variables[0]]&&(h.output.startTag("date",this),this.variables[0]==="issued"&&(m.type==="legal_case"||m.type==="legislation")&&h.opt.disable_duplicate_year_suppression.indexOf(m.country)===-1&&!h.tmp.extension&&""+m["collection-number"]==""+h.tmp.date_object.year&&this.dateparts.length===1&&this.dateparts[0]==="year")){for(var g in h.tmp.date_object)if(h.tmp.date_object.hasOwnProperty(g)&&g.slice(0,4)==="year"){h.tmp.issued_date={};var d=h.output.current.mystack.slice(-2)[0].blobs;h.tmp.issued_date.list=d,h.tmp.issued_date.pos=d.length-1}}},this.execs.push(r)),!e.build.extension&&(this.tokentype===l.END||this.tokentype===l.SINGLETON)&&(r=function(h,m){m[this.variables[0]]&&h.output.endTag()},this.execs.push(r)),t.push(this),(this.tokentype===l.END||this.tokentype===l.SINGLETON)&&(e.build.extension||l.Util.substituteEnd.call(this,e,t))}};l.Node["date-part"]={build:function(e,t){var r,i,s,a,n,o,u,c,p,f,h,m,g,d,v,b,E,x,w,S,T,I,C;this.strings.form||(this.strings.form="long"),e.build.date_parts.push(this.strings.name);var A=e.build.date_variables[0];function y(_,k,Q){if(!Q)return Q;if(Q=""+l.Util.Dates[this.strings.name][_](e,Q,k,this.default_locale),this.strings.name==="month"){if(e.tmp.strip_periods)Q=Q.replace(/\./g,"");else for(var O=0,N=this.decorations.length;O<N;O+=1)if(this.decorations[O][0]==="@strip-periods"&&this.decorations[O][1]==="true"){Q=Q.replace(/\./g,"");break}}return Q}r=function(_,k){if(_.tmp.date_object)_.tmp.probably_rendered_something=!0;else return;var Q="";if(a=!0,n="",o="",_.tmp.donesies.push(this.strings.name),_.tmp.date_object.literal&&this.strings.name==="year"&&(Q=_.tmp.date_object.literal,_.output.append(_.tmp.date_object.literal,this)),_.tmp.date_object&&(n=_.tmp.date_object[this.strings.name],o=_.tmp.date_object[this.strings.name+"_end"]),this.strings.name==="year"&&n===0&&!_.tmp.suppress_decorations&&(n=!1),u=!_.tmp.suppress_decorations,c=_.tmp.have_collapsed,p=_[_.tmp.area].opt.collapse==="year-suffix"||_[_.tmp.area].opt.collapse==="year-suffix-ranged",f=_.opt["disambiguate-add-year-suffix"],u&&f&&p&&(_.tmp.years_used.push(n),h=_.tmp.last_years_used.length>=_.tmp.years_used.length,h&&c&&_.tmp.last_years_used[_.tmp.years_used.length-1]===n&&(n=!1)),typeof n!="undefined"){m=!1,g=!1,d=!1,v=!1,this.strings.name==="year"&&(parseInt(n,10)<500&&parseInt(n,10)>0&&(g=_.getTerm("ad")),parseInt(n,10)<0&&(m=_.getTerm("bc"),n=parseInt(n,10)*-1),o&&(parseInt(o,10)<500&&parseInt(o,10)>0&&(v=_.getTerm("ad")),parseInt(o,10)<0&&(d=_.getTerm("bc"),o=parseInt(o,10)*-1)));for(var O=""+_.tmp.date_object.month;O.length<2;)O="0"+O;O="month-"+O;var N=_.locale[_.opt.lang]["noun-genders"][O];if(this.strings.form){var B=this.strings.form,q=this.strings.form;this.strings.name==="day"&&B==="ordinal"&&_.locale[_.opt.lang].opts["limit-day-ordinals-to-day-1"]&&(n!=1&&(B="numeric"),o!=1&&(q="numeric")),n=y.call(this,B,N,n),o=y.call(this,q,N,o)}if(_.output.openLevel("empty"),_.tmp.date_collapse_at.length){for(b=!0,s=_.tmp.date_collapse_at.length,i=0;i<s;i+=1)if(I=_.tmp.date_collapse_at[i],_.tmp.donesies.indexOf(I)===-1){b=!1;break}if(b){if(""+o!="0"){if(_.dateput.queue.length===0&&(a=!0),_.opt["year-range-format"]&&_.opt["year-range-format"]!=="expanded"&&!_.tmp.date_object.day&&!_.tmp.date_object.month&&!_.tmp.date_object.season&&this.strings.name==="year"&&n&&o){o=_.fun.year_mangler(n+"-"+o,!0);var P=_.getTerm("year-range-delimiter");o=o.slice(o.indexOf(P)+1)}Q=o,_.dateput.append(o,this),a&&(C=_.dateput.current.value().blobs[0],C&&(C.strings.prefix=""))}Q=n,_.output.append(n,this),E=_.output.current.value(),C=E.blobs[E.blobs.length-1],C&&(C.strings.suffix=""),this.strings["range-delimiter"]?_.output.append(this.strings["range-delimiter"]):_.output.append(_.getTerm("year-range-delimiter"),"empty"),_.dateput.closeLevel(),x=_.dateput.current.value(),E.blobs=E.blobs.concat(x),_.dateput.string(_,_.dateput.queue),_.dateput.openLevel(_.tmp.date_token),_.tmp.date_collapse_at=[]}else Q=n,_.output.append(n,this),_.tmp.date_collapse_at.indexOf(this.strings.name)>-1&&""+o!="0"&&(_.dateput.queue.length===0&&(a=!0),_.dateput.openLevel("empty"),Q=o,_.dateput.append(o,this),a&&(C=_.dateput.current.value().blobs[0],C&&(C.strings.prefix="")),m&&(Q=m,_.dateput.append(m)),g&&(Q=g,_.dateput.append(g)),_.dateput.closeLevel())}else Q=n,_.output.append(n,this);m&&(Q=m,_.output.append(m)),g&&(Q=g,_.output.append(g)),_.output.closeLevel()}else this.strings.name==="month"&&_.tmp.date_object.season&&(n=""+_.tmp.date_object.season,n&&n.match(/^[1-4]$/)?(_.tmp.group_context.tip.variable_success=!0,Q="winter",_.output.append(_.getTerm("season-0"+n),this)):n&&(Q=n,_.output.append(n,this)));_.tmp.value=[],k[A]&&(n||_.tmp.have_collapsed)&&!_.opt.has_year_suffix&&this.strings.name==="year"&&!_.tmp.just_looking&&_.registry.registry[k.id]&&_.registry.registry[k.id].disambig.year_suffix!==!1&&!_.tmp.has_done_year_suffix&&(_.tmp.has_done_year_suffix=!0,Q="x",S=parseInt(_.registry.registry[k.id].disambig.year_suffix,10),w=new l.NumericBlob(_,!1,S,this,k.id),this.successor_prefix=_[_.build.area].opt.layout_delimiter,this.splice_prefix=_[_.build.area].opt.layout_delimiter,T=new l.Util.Suffixator(l.SUFFIX_CHARS),w.setFormatter(T),_[_.tmp.area].opt.collapse==="year-suffix-ranged"&&(w.range_prefix=_.getTerm("citation-range-delimiter")),_[_.tmp.area].opt.cite_group_delimiter?w.successor_prefix=_[_.tmp.area].opt.cite_group_delimiter:_[_.tmp.area].opt["year-suffix-delimiter"]?w.successor_prefix=_[_.tmp.area].opt["year-suffix-delimiter"]:w.successor_prefix=_[_.tmp.area].opt.layout_delimiter,w.UGLY_DELIMITER_SUPPRESS_HACK=!0,_.output.append(w,"literal")),Q&&!_.tmp.group_context.tip.condition&&(_.tmp.just_did_number=Q.match(/[0-9]$/),_.output.current.tip.strings.suffix&&(_.tmp.just_did_number=!1))},this.execs.push(r),t.push(this)}};l.Node["else-if"]={build:function(e,t){l.Conditions.TopNode.call(this,e,t),t.push(this)},configure:function(e,t){l.Conditions.Configure.call(this,e,t)}};l.Node.else={build:function(e,t){t.push(this)},configure:function(e,t){this.tokentype===l.START&&(e.configure.fail[e.configure.fail.length-1]=t)}};l.Node["et-al"]={build:function(e,t){if(e.build.area==="citation"||e.build.area==="bibliography"){var r=function(i){i.tmp.etal_node=this,typeof this.strings.term=="string"&&(i.tmp.etal_term=this.strings.term)};this.execs.push(r)}t.push(this)}};l.Node.group={build:function(e,t,r){var i,s;if(this.realGroup=r,this.tokentype===l.START&&(l.Util.substituteStart.call(this,e,t),e.build.substitute_level.value()&&e.build.substitute_level.replace(e.build.substitute_level.value()+1),this.juris||t.push(this),i=function(h){if(h.output.startTag("group",this),this.strings.label_form_override&&(h.tmp.group_context.tip.label_form||(h.tmp.group_context.tip.label_form=this.strings.label_form_override)),this.strings.label_capitalize_if_first_override&&(h.tmp.group_context.tip.label_capitalize_if_first||(h.tmp.group_context.tip.label_capitalize_if_first=this.strings.label_capitalize_if_first_override)),this.realGroup){h.tmp.group_context.tip.condition&&l.UPDATE_GROUP_CONTEXT_CONDITION(h,this.strings.prefix,null,this);var m=!1,g=!1;h.tmp.group_context.mystack.length&&(h.output.current.value().parent=h.tmp.group_context.tip.output_tip);var d=h.tmp.group_context.tip.label_form;d||(d=this.strings.label_form_override);var v=h.tmp.group_context.tip.label_capitalize_if_first;v||(v=this.strings.label_capitalize_if_first),h.tmp.group_context.tip.condition?(m=h.tmp.group_context.tip.condition,g=h.tmp.group_context.tip.force_suppress):this.strings.reject?m={test:this.strings.reject,not:!0}:this.strings.require&&(m={test:this.strings.require,not:!1});var b={old_term_predecessor:h.tmp.term_predecessor,term_intended:!1,variable_attempt:!1,variable_success:!1,variable_success_parent:h.tmp.group_context.tip.variable_success,output_tip:h.output.current.tip,label_form:d,label_static:h.tmp.group_context.tip.label_static,label_capitalize_if_first:v,parallel_delimiter_override:this.strings.set_parallel_delimiter_override,parallel_delimiter_override_on_suppress:this.strings.set_parallel_delimiter_override_on_suppress,condition:m,force_suppress:g,done_vars:h.tmp.group_context.tip.done_vars.slice()};if(this.non_parallel){var E=h.tmp.group_context.tip.non_parallel;E||(E={}),Object.assign(E,this.non_parallel),b.non_parallel=E}if(this.parallel_first){var x=h.tmp.group_context.tip.parallel_first;x||(x={}),Object.assign(x,this.parallel_first),b.parallel_first=x}if(this.parallel_last){var w=h.tmp.group_context.tip.parallel_last;w||(w={}),Object.assign(w,this.parallel_last),b.parallel_last=w}if(h.tmp.abbrev_trimmer&&h.tmp.abbrev_trimmer.LAST_TO_FIRST&&b.parallel_last){b.parallel_first||(b.parallel_first={});for(var S in h.tmp.abbrev_trimmer.LAST_TO_FIRST)b.parallel_last[S]&&(b.parallel_first[S]=!0,delete b.parallel_last[S])}if(h.tmp.group_context.push(b),h.tmp.abbrev_trimmer&&this.parallel_last_to_first){h.tmp.abbrev_trimmer.LAST_TO_FIRST||(h.tmp.abbrev_trimmer.LAST_TO_FIRST={});for(var S in this.parallel_last_to_first)h.tmp.abbrev_trimmer.LAST_TO_FIRST[S]=!0}}},s=[],s.push(i),this.execs=s.concat(this.execs),this.strings["has-publisher-and-publisher-place"]&&(e.build["publisher-special"]=!0,this.strings["subgroup-delimiter"]&&(i=function(h,m){if(m.publisher&&m["publisher-place"]){var g=m.publisher.split(/;\s*/),d=m["publisher-place"].split(/;\s*/);g.length>1&&g.length===d.length&&(h.publisherOutput=new l.PublisherOutput(h,this),h.publisherOutput["publisher-list"]=g,h.publisherOutput["publisher-place-list"]=d)}},this.execs.push(i))),this.juris)){var a=new l.Token("choose",l.START);l.Node.choose.build.call(a,e,t);var n=new l.Token("if",l.START);i=function(h){return function(m,g){return l.INIT_JURISDICTION_MACROS(e,m,g,h)}}(this.juris),n.tests||(n.tests=[]),n.tests.push(i),n.test=e.fun.match.any(n,e,n.tests),t.push(n);var o=new l.Token("text",l.SINGLETON);i=function(h,m,g){var d=m;g&&g["best-jurisdiction"]&&this.juris==="juris-locator"&&(d=g);var v=0;if(h.juris[d["best-jurisdiction"]][this.juris])for(;v<h.juris[d["best-jurisdiction"]][this.juris].length;)v=l.tokenExec.call(h,h.juris[d["best-jurisdiction"]][this.juris][v],m,g)},o.juris=this.juris,o.execs.push(i),t.push(o);var u=new l.Token("if",l.END);l.Node.if.build.call(u,e,t);var c=new l.Token("else",l.START);l.Node.else.build.call(c,e,t)}if(this.tokentype===l.END&&(e.build["publisher-special"]&&(e.build["publisher-special"]=!1,i=function(h){h.publisherOutput&&(h.publisherOutput.render(),h.publisherOutput=!1)},this.execs.push(i)),i=function(h,m,g){if(h.tmp.group_context.tip.condition||h.output.current.tip.strings.suffix&&(h.tmp.just_did_number=!1),h.output.endTag(),this.realGroup){var d=h.tmp.group_context.pop();if(d.parallel_delimiter_override&&(h.tmp.group_context.tip.parallel_delimiter_override=d.parallel_delimiter_override,!h.tmp.just_looking&&h.registry.registry[m.id].master&&(h.registry.registry[m.id].parallel_delimiter_override=d.parallel_delimiter_override)),d.parallel_delimiter_override_on_suppress&&(h.tmp.group_context.tip.parallel_delimiter_override_on_suppress=d.parallel_delimiter_override_on_suppress),h.tmp.area==="bibliography_sort"){var v=d.done_vars.indexOf("citation-number");this.strings.sort_direction&&v>-1&&h.tmp.group_context.length()==1&&(this.strings.sort_direction===l.DESCENDING?h.bibliography_sort.opt.citation_number_sort_direction=l.DESCENDING:h.bibliography_sort.opt.citation_number_sort_direction=l.ASCENDING,d.done_vars=d.done_vars.slice(0,v).concat(d.done_vars.slice(v+1)))}if(d.condition&&(d.force_suppress=l.EVALUATE_GROUP_CONDITION(h,d)),h.tmp.group_context.tip.condition&&(h.tmp.group_context.tip.force_suppress=d.force_suppress),!d.force_suppress&&(d.variable_success||d.term_intended&&!d.variable_attempt)){this.isJurisLocatorLabel||(h.tmp.group_context.tip.variable_success=!0);var b=h.output.current.value().blobs,E=h.output.current.value().blobs.length-1;if(!h.tmp.just_looking&&(d.non_parallel||d.parallel_last||d.parallel_first||d.parallel_delimiter_override||d.parallel_delimiter_override_on_suppress)){var x=h.parallel.checkRepeats(d);if(x&&b&&b.pop(),h.tmp.cite_index>0&&(x||!d.parallel_first&&!d.parallel_last&&!d.non_parallel)){var w=h.tmp.suppress_repeats[h.tmp.cite_index-1];x&&d.parallel_delimiter_override_on_suppress&&(w.SIBLING||w.ORPHAN)?h.output.queue.slice(-1)[0].parallel_delimiter=d.parallel_delimiter_override_on_suppress:d.parallel_delimiter_override&&w.SIBLING&&(h.output.queue.slice(-1)[0].parallel_delimiter=d.parallel_delimiter_override)}}}else{if(h.tmp.term_predecessor=d.old_term_predecessor,h.tmp.group_context.tip.variable_attempt=d.variable_attempt,d.force_suppress&&!h.tmp.group_context.tip.condition&&(h.tmp.group_context.tip.variable_attempt=!0,h.tmp.group_context.tip.variable_success=d.variable_success_parent),d.force_suppress)for(var S=0,T=d.done_vars.length;S<T;S++)for(var I=d.done_vars[S],C=0,A=h.tmp.done_vars.length;C<A;C++)h.tmp.done_vars[C]===I&&(h.tmp.done_vars=h.tmp.done_vars.slice(0,C).concat(h.tmp.done_vars.slice(C+1)));h.output.current.value().blobs&&h.output.current.value().blobs.pop()}}},this.execs.push(i),this.juris)){var p=new l.Token("else",l.END);l.Node.else.build.call(p,e,t);var f=new l.Token("choose",l.END);l.Node.choose.build.call(f,e,t)}this.tokentype===l.END&&(this.juris||t.push(this),e.build.substitute_level.value()&&e.build.substitute_level.replace(e.build.substitute_level.value()-1),l.Util.substituteEnd.call(this,e,t))}};l.Node.if={build:function(e,t){l.Conditions.TopNode.call(this,e,t),t.push(this)},configure:function(e,t){l.Conditions.Configure.call(this,e,t)}};l.Node.conditions={build:function(e){this.tokentype===l.START&&e.tmp.conditions.addMatch(this.match),this.tokentype===l.END&&e.tmp.conditions.matchCombine()}};l.Node.condition={build:function(e){if(this.tokentype===l.SINGLETON){var t=e.fun.match[this.match](this,e,this.tests);e.tmp.conditions.addTest(t)}}};l.Conditions={};l.Conditions.TopNode=function(e){var t;(this.tokentype===l.START||this.tokentype===l.SINGLETON)&&(this.locale&&(e.opt.lang=this.locale),!this.tests||!this.tests.length?e.tmp.conditions=new l.Conditions.Engine(e,this):this.test=e.fun.match[this.match](this,e,this.tests),e.build.substitute_level.value()===0&&(t=function(r){r.tmp.condition_counter++},this.execs.push(t))),(this.tokentype===l.END||this.tokentype===l.SINGLETON)&&(e.build.substitute_level.value()===0&&(t=function(r){if(r.tmp.condition_counter--,r.tmp.condition_lang_counter_arr.length>0){var i=r.tmp.condition_lang_counter_arr.slice(-1)[0];i===r.tmp.condition_counter&&(r.opt.lang=r.tmp.condition_lang_val_arr.pop(),r.tmp.condition_lang_counter_arr.pop())}this.locale_default&&(r.output.current.value().old_locale=this.locale_default,r.output.closeLevel("empty"),r.opt.lang=this.locale_default)},this.execs.push(t)),t=function(r){var i=this[r.tmp.jump.value()];return i},this.execs.push(t),this.locale_default&&(e.opt.lang=this.locale_default))};l.Conditions.Configure=function(e,t){this.tokentype===l.START?(this.fail=e.configure.fail.slice(-1)[0],this.succeed=this.next,e.configure.fail[e.configure.fail.length-1]=t):this.tokentype===l.SINGLETON?(this.fail=this.next,this.succeed=e.configure.succeed.slice(-1)[0],e.configure.fail[e.configure.fail.length-1]=t):(this.succeed=e.configure.succeed.slice(-1)[0],this.fail=this.next)};l.Conditions.Engine=function(e,t){this.token=t,this.state=e};l.Conditions.Engine.prototype.addTest=function(e){this.token.tests||(this.token.tests=[]),this.token.tests.push(e)};l.Conditions.Engine.prototype.addMatch=function(e){this.token.match=e};l.Conditions.Engine.prototype.matchCombine=function(){this.token.test=this.state.fun.match[this.token.match](this.token,this.state,this.token.tests)};l.Node.info={build:function(e){this.tokentype===l.START?e.build.skip="info":e.build.skip=!1}};l.Node.institution={build:function(e,t){if([l.SINGLETON,l.START].indexOf(this.tokentype)>-1){var r=function(i){typeof this.strings.delimiter=="string"?i.tmp.institution_delimiter=this.strings.delimiter:i.tmp.institution_delimiter=i.tmp.name_delimiter,i.inheritOpt(this,"and")==="text"?this.and_term=i.getTerm("and","long",0):i.inheritOpt(this,"and")==="symbol"?i.opt.development_extensions.expect_and_symbol_form?this.and_term=i.getTerm("and","symbol",0):this.and_term="&":i.inheritOpt(this,"and")==="none"&&(this.and_term=i.tmp.institution_delimiter),typeof this.and_term=="undefined"&&i.tmp.and_term&&(this.and_term=i.tmp.and_term),l.STARTSWITH_ROMANESQUE_REGEXP.test(this.and_term)?(this.and_prefix_single=" ",this.and_prefix_multiple=", ",typeof i.tmp.institution_delimiter=="string"&&(this.and_prefix_multiple=i.tmp.institution_delimiter),this.and_suffix=" "):(this.and_prefix_single="",this.and_prefix_multiple="",this.and_suffix=""),i.inheritOpt(this,"delimiter-precedes-last")==="always"?this.and_prefix_single=i.tmp.institution_delimiter:i.inheritOpt(this,"delimiter-precedes-last")==="never"&&this.and_prefix_multiple&&(this.and_prefix_multiple=" "),this.and={},typeof this.and_term!="undefined"?(i.output.append(this.and_term,"empty",!0),this.and.single=i.output.pop(),this.and.single.strings.prefix=this.and_prefix_single,this.and.single.strings.suffix=this.and_suffix,i.output.append(this.and_term,"empty",!0),this.and.multiple=i.output.pop(),this.and.multiple.strings.prefix=this.and_prefix_multiple,this.and.multiple.strings.suffix=this.and_suffix):this.strings.delimiter!=="undefined"&&(this.and.single=new l.Blob(i.tmp.institution_delimiter),this.and.single.strings.prefix="",this.and.single.strings.suffix="",this.and.multiple=new l.Blob(i.tmp.institution_delimiter),this.and.multiple.strings.prefix="",this.and.multiple.strings.suffix=""),i.nameOutput.institution=this};this.execs.push(r)}t.push(this)},configure:function(e){[l.SINGLETON,l.START].indexOf(this.tokentype)>-1&&(e.build.has_institution=!0)}};l.Node["institution-part"]={build:function(e,t){var r;this.strings.name==="long"?this.strings["if-short"]?r=function(i){i.nameOutput.institutionpart["long-with-short"]=this}:r=function(i){i.nameOutput.institutionpart.long=this}:this.strings.name==="short"&&(r=function(i){i.nameOutput.institutionpart.short=this}),this.execs.push(r),t.push(this)}};l.Node.key={build:function(e,t){t=e[e.build.root+"_sort"].tokens;var r,i=!1,s=new l.Token("key",l.START);e.tmp.root=e.build.root,s.strings["et-al-min"]=e.inheritOpt(this,"et-al-min"),s.strings["et-al-use-first"]=e.inheritOpt(this,"et-al-use-first"),s.strings["et-al-use-last"]=e.inheritOpt(this,"et-al-use-last"),r=function(E){E.tmp.done_vars=[]},s.execs.push(r),r=function(E){E.output.openLevel("empty")},s.execs.push(r);var a=[];if(this.strings.sort_direction===l.DESCENDING?(a.push(1),a.push(-1)):(a.push(-1),a.push(1)),e[e.build.area].opt.sort_directions.push(a),l.DATE_VARIABLES.indexOf(this.variables[0])>-1&&(e.build.date_key=!0),r=function(E){E.tmp.sort_key_flag=!0,E.inheritOpt(this,"et-al-min")&&(E.tmp["et-al-min"]=E.inheritOpt(this,"et-al-min")),E.inheritOpt(this,"et-al-use-first")&&(E.tmp["et-al-use-first"]=E.inheritOpt(this,"et-al-use-first")),typeof E.inheritOpt(this,"et-al-use-last")=="boolean"&&(E.tmp["et-al-use-last"]=E.inheritOpt(this,"et-al-use-last"))},s.execs.push(r),t.push(s),this.variables.length){var n=this.variables[0];if(l.NAME_VARIABLES.indexOf(n)>-1){var o=new l.Token("names",l.START);o.tokentype=l.START,o.variables=this.variables,l.Node.names.build.call(o,e,t);var u=new l.Token("name",l.SINGLETON);u.tokentype=l.SINGLETON,u.strings["name-as-sort-order"]="all",u.strings["sort-separator"]=" ",u.strings["et-al-use-last"]=e.inheritOpt(this,"et-al-use-last"),u.strings["et-al-min"]=e.inheritOpt(this,"et-al-min"),u.strings["et-al-use-first"]=e.inheritOpt(this,"et-al-use-first"),l.Node.name.build.call(u,e,t);var c=new l.Token("institution",l.SINGLETON);c.tokentype=l.SINGLETON,l.Node.institution.build.call(c,e,t);var p=new l.Token("names",l.END);p.tokentype=l.END,l.Node.names.build.call(p,e,t)}else{var f=new l.Token("text",l.SINGLETON);if(f.strings.sort_direction=this.strings.sort_direction,f.dateparts=this.dateparts,l.NUMERIC_VARIABLES.indexOf(n)>-1)n==="citation-number"?r=function(E,x){if(E.tmp.area==="bibliography_sort"&&(this.strings.sort_direction===l.DESCENDING?E.bibliography_sort.opt.citation_number_sort_direction=l.DESCENDING:E.bibliography_sort.opt.citation_number_sort_direction=l.ASCENDING),E.tmp.area==="citation_sort"&&E.bibliography_sort.tmp.citation_number_map)var w=E.bibliography_sort.tmp.citation_number_map[E.registry.registry[x.id].seq];else var w=E.registry.registry[x.id].seq;w&&(w=l.Util.padding(""+w)),E.output.append(w,this)}:r=function(E,x){var w=!1;w=x[n],w&&(w=l.Util.padding(w)),E.output.append(w,this)};else if(n==="citation-label")r=function(E,x){var w=E.getCitationLabel(x);E.output.append(w,this)};else if(l.DATE_VARIABLES.indexOf(n)>-1)r=l.dateAsSortKey,f.variables=this.variables;else if(n==="title"){var h="title",m=!1,g=!1,d=!0;r=e.transform.getOutputFunction(this.variables,h,m,g,d)}else n==="court-class"?r=function(E,x,w){l.INIT_JURISDICTION_MACROS(E,x,w,"juris-main");var S=l.GET_COURT_CLASS(E,x,!0);E.output.append(S,"empty")}:r=function(E,x){var w=x[n];E.output.append(w,"empty")};f.execs.push(r),t.push(f)}}else{var v=new l.Token("text",l.SINGLETON);v.strings.sort_direction=this.strings.sort_direction,v.postponed_macro=this.postponed_macro,l.expandMacro.call(e,v,t)}var b=new l.Token("key",l.END);r=function(E){var x=E.output.string(E,E.output.queue);E.sys.normalizeUnicode&&(x=E.sys.normalizeUnicode(x)),x=x?x.split(" ").join(E.opt.sort_sep)+E.opt.sort_sep:"",i&&l.debug("keystring: "+x+" "+typeof x),x===""&&(x=void 0),typeof x!="string"&&(x=void 0),E[E[E.tmp.area].root+"_sort"].keys.push(x),E.tmp.value=[]},b.execs.push(r),e.build.date_key&&(e.build.area==="citation"&&e.build.extension==="_sort"&&(e[e.build.area].opt.sort_directions.push([-1,1]),r=function(E,x){var w=E.registry.registry[x.id].disambig.year_suffix;w||(w=0);var S=l.Util.padding(""+w);E[E.tmp.area].keys.push(S)},b.execs.push(r)),e.build.date_key=!1),r=function(E){E.tmp["et-al-min"]=void 0,E.tmp["et-al-use-first"]=void 0,E.tmp["et-al-use-last"]=void 0,E.tmp.sort_key_flag=!1},b.execs.push(r),t.push(b)}};l.Node.label={build:function(e,t){if(this.strings.term){var r=function(o,u,c){var p=l.evaluateLabel(this,o,u,c);c&&this.strings.term==="locator"&&(c.section_form_override=this.strings.form),p&&(o.tmp.group_context.tip.term_intended=!0),l.UPDATE_GROUP_CONTEXT_CONDITION(o,p,null,this),p.indexOf("%s")===-1&&(this.strings.capitalize_if_first&&!o.tmp.term_predecessor&&!(o.opt.class==="in-text"&&o.tmp.area==="citation")&&(p=l.Output.Formatters["capitalize-first"](o,p)),o.output.append(p,this))};this.execs.push(r)}else{this.strings.form||(this.strings.form="long");for(var i=e.build.names_variables[e.build.names_variables.length-1],s=e.build.name_label[e.build.name_label.length-1],a=0,n=i.length;a<n;a+=1)s[i[a]]||(s[i[a]]={});if(e.build.name_flag)for(var a=0,n=i.length;a<n;a+=1)s[i[a]].after=this;else for(var a=0,n=i.length;a<n;a+=1)s[i[a]].before=this}t.push(this)}};l.Node.layout={build:function(e,t){var r,i,s,a;function n(){e.build.area==="bibliography"&&(s=new l.Token("text",l.SINGLETON),r=function(c){if(!c.tmp.parallel_and_not_last){var p;c.tmp.cite_affixes[c.tmp.area][c.tmp.last_cite_locale]?p=c.tmp.cite_affixes[c.tmp.area][c.tmp.last_cite_locale].suffix:p=c.bibliography.opt.layout_suffix;var f=c.output.current.value();c.opt.using_display?f.blobs[f.blobs.length-1].strings.suffix=p:f.strings.suffix=p}c.bibliography.opt["second-field-align"]&&c.output.endTag("bib_other")},s.execs.push(r),t.push(s))}this.tokentype===l.START&&(this.locale_raw?e.build.current_default_locale=this.locale_raw:e.build.current_default_locale=e.opt["default-locale"],r=function(c,p,f){if(c.opt.development_extensions.apply_citation_wrapper&&c.sys.wrapCitationEntry&&!c.tmp.just_looking&&p.system_id&&c.tmp.area==="citation"){var h=new l.Token("group",l.START);h.decorations=[["@cite","entry"]],c.output.startTag("cite_entry",h),c.output.current.value().item_id=p.system_id,f&&(c.output.current.value().locator_txt=f.locator_txt,c.output.current.value().suffix_txt=f.suffix_txt)}},this.execs.push(r)),this.tokentype===l.START&&!e.tmp.cite_affixes[e.build.area]&&(r=function(c,p,f){if(c.tmp.done_vars=[],f&&f["author-only"]&&c.tmp.done_vars.push("locator"),c.opt.suppressedJurisdictions[p.country]&&p.country&&["treaty","patent"].indexOf(p.type)===-1&&c.tmp.done_vars.push("country"),!c.tmp.just_looking&&c.registry.registry[p.id]&&c.registry.registry[p.id].parallel&&c.tmp.done_vars.push("first-reference-note-number"),!c.tmp.just_looking&&c.tmp.abbrev_trimmer&&p.jurisdiction)for(var h in c.tmp.abbrev_trimmer.QUASHES[p.jurisdiction])c.tmp.done_vars.push(h);c.tmp.rendered_name=!1},this.execs.push(r),r=function(c){c.tmp.sort_key_flag=!1},this.execs.push(r),r=function(c){c.tmp.nameset_counter=0},this.execs.push(r),r=function(c,p){var f=new l.Token;c.output.openLevel(f)},this.execs.push(r),t.push(this),e.build.area==="citation"&&(i=new l.Token("text",l.SINGLETON),r=function(c,p,f){if(f&&f.prefix){var h=l.checkPrefixSpaceAppend(c,f.prefix);c.tmp.just_looking||(h=c.output.checkNestedBrace.update(h));var m=l.checkIgnorePredecessor(c,h);c.output.append(h,this,!1,m)}},i.execs.push(r),t.push(i)));var o;if(this.locale_raw&&(o=new l.Token("dummy",l.START),o.locale=this.locale_raw,o.strings.delimiter=this.strings.delimiter,o.strings.suffix=this.strings.suffix,e.tmp.cite_affixes[e.build.area]||(e.tmp.cite_affixes[e.build.area]={})),this.tokentype===l.START&&(e.build.layout_flag=!0,this.locale_raw||(e[e.tmp.area].opt.topdecor=[this.decorations],e[e.tmp.area+"_sort"].opt.topdecor=[this.decorations],e[e.build.area].opt.layout_prefix=this.strings.prefix,e[e.build.area].opt.layout_suffix=this.strings.suffix,e[e.build.area].opt.layout_delimiter=this.strings.delimiter,e[e.build.area].opt.layout_decorations=this.decorations,e.tmp.cite_affixes[e.build.area]&&(a=new l.Token("else",l.START),l.Node.else.build.call(a,e,t))),this.locale_raw)){if(e.build.layout_locale_flag)o.name="else-if",l.Attributes["@locale-internal"].call(o,e,this.locale_raw),l.Node["else-if"].build.call(o,e,t);else{var u=new l.Token("choose",l.START);l.Node.choose.build.call(u,e,t),o.name="if",l.Attributes["@locale-internal"].call(o,e,this.locale_raw),l.Node.if.build.call(o,e,t)}e.tmp.cite_affixes[e.build.area][o.locale]={},e.tmp.cite_affixes[e.build.area][o.locale].delimiter=this.strings.delimiter,e.tmp.cite_affixes[e.build.area][o.locale].suffix=this.strings.suffix}this.tokentype===l.END&&(this.locale_raw&&(n(),e.build.layout_locale_flag?(o.name="else-if",o.tokentype=l.END,l.Attributes["@locale-internal"].call(o,e,this.locale_raw),l.Node["else-if"].build.call(o,e,t)):(o.name="if",o.tokentype=l.END,l.Attributes["@locale-internal"].call(o,e,this.locale_raw),l.Node.if.build.call(o,e,t),e.build.layout_locale_flag=!0)),this.locale_raw||(n(),e.tmp.cite_affixes[e.build.area]&&e.build.layout_locale_flag&&(a=new l.Token("else",l.END),l.Node.else.build.call(a,e,t),a=new l.Token("choose",l.END),l.Node.choose.build.call(a,e,t)),e.build_layout_locale_flag=!0,e.build.area==="citation"&&(s=new l.Token("text",l.SINGLETON),r=function(c,p,f){var h;if(f&&f.suffix){var m=l.checkSuffixSpacePrepend(c,f.suffix);c.tmp.just_looking||(m=c.output.checkNestedBrace.update(m)),c.output.append(m,this)}},s.execs.push(r),t.push(s)),r=function(c){c.output.closeLevel()},this.execs.push(r),r=function(c,p){c.opt.development_extensions.apply_citation_wrapper&&c.sys.wrapCitationEntry&&!c.tmp.just_looking&&p.system_id&&c.tmp.area==="citation"&&c.output.endTag()},this.execs.push(r),t.push(this),e.build.layout_flag=!1,e.build.layout_locale_flag=!1))}};l.Node.macro={build:function(){}};l.Node.alternative={build:function(e,t){if(this.tokentype===l.START){var r=new l.Token("choose",l.START);l.Node.choose.build.call(r,e,t);var i=new l.Token("if",l.START);l.Attributes["@alternative-node-internal"].call(i,e),l.Node.if.build.call(i,e,t);var s=function(a,n){if(a.tmp.oldItem=n,a.tmp.oldLang=a.opt.lang,a.tmp.abort_alternative=!0,n["language-name"]&&n["language-name-original"]){var o=JSON.parse(JSON.stringify(n));o.language=o["language-name"];var u=l.localeResolve(o.language,a.opt["default-locale"][0]);if(a.opt.multi_layout)for(var c in a.opt.multi_layout){var p=a.opt.multi_layout[c],f=!1;for(var h in p){var m=p[h];if(u.best===m.best||u.base===m.base||u.bare===m.bare){f=p[0].best;break}}f||(f=a.opt["default-locale"][0]),a.opt.lang=f}for(var g in o)if(["id","type","language","multi"].indexOf(g)===-1&&g.slice(0,4)!=="alt-")if(o.multi&&o.multi._keys[g]){var d=!0;for(var v in o.multi._keys[g])if(u.bare===v.replace(/^([a-zA-Z]+).*/,"$1")){d=!1;break}d&&delete o[g]}else delete o[g];for(var g in o)g.slice(0,4)==="alt-"?(o[g.slice(4)]=o[g],a.tmp.abort_alternative=!1):o.multi&&o.multi._keys&&!o["alt-"+g]&&o.multi._keys[g]&&(o.multi._keys[g][u.best]?(o[g]=o.multi._keys[g][u.best],a.tmp.abort_alternative=!1):o.multi._keys[g][u.base]?(o[g]=o.multi._keys[g][u.base],a.tmp.abort_alternative=!1):o.multi._keys[g][u.bare]&&(o[g]=o.multi._keys[g][u.bare],a.tmp.abort_alternative=!1))}a.output.openLevel(this),a.registry.refhash[n.id]=o,a.nameOutput=new l.NameOutput(a,o)};this.execs.push(s),t.push(this);var r=new l.Token("choose",l.START);l.Node.choose.build.call(r,e,t);var i=new l.Token("if",l.START);l.Attributes["@alternative-node-internal"].call(i,e);var s=function(a){a.tmp.abort_alternative=!0};i.execs.push(s),l.Node.if.build.call(i,e,t)}else if(this.tokentype===l.END){var i=new l.Token("if",l.END);l.Node.if.build.call(i,e,t);var r=new l.Token("choose",l.END);l.Node.choose.build.call(r,e,t);var s=function(u,c){u.output.closeLevel(),u.registry.refhash[c.id]=u.tmp.oldItem,u.opt.lang=u.tmp.oldLang,u.nameOutput=new l.NameOutput(u,u.tmp.oldItem),u.tmp.abort_alternative=!1};this.execs.push(s),t.push(this);var i=new l.Token("if",l.END);l.Node.if.build.call(i,e,t);var r=new l.Token("choose",l.END);l.Node.choose.build.call(r,e,t)}}};l.Node["alternative-text"]={build:function(e,t){if(this.tokentype===l.SINGLETON){var r=function(i,a){var a=i.refetchItem(a.id);l.getCite.call(i,a)};this.execs.push(r)}t.push(this)}};l.NameOutput=function(e,t,r){this.debug=!1,this.state=e,this.debug&&this.state.sys.print("(1)"),this.Item=t,this.item=r,this.nameset_base=0,this.etal_spec={},this._first_creator_variable=!1,this._please_chop=!1};l.NameOutput.prototype.init=function(e){this.requireMatch=e.requireMatch,this.state.tmp.term_predecessor&&(this.state.tmp.subsequent_author_substitute_ok=!1),this.nameset_offset&&(this.nameset_base=this.nameset_base+this.nameset_offset),this.nameset_offset=0,this.names=e,this.variables=e.variables,this.state.tmp.value=[],this.state.tmp.rendered_name=[],this.state.tmp.label_blob=!1,this.state.tmp.etal_node=!1,this.state.tmp.etal_term=!1;for(var t=0,r=this.variables.length;t<r;t+=1)this.Item[this.variables[t]]&&this.Item[this.variables[t]].length&&(this.state.tmp.value=this.state.tmp.value.concat(this.Item[this.variables[t]]));if(this["et-al"]=void 0,this.with=void 0,this.name=void 0,this.institutionpart={},this.state.tmp.group_context.tip.variable_attempt=!0,this.labelVariable=this.variables[0],!!this.state.tmp.value.length){var i=this.checkCommonAuthor(this.requireMatch);if(i){this.state.tmp.can_substitute.pop(),this.state.tmp.can_substitute.push(!0);for(var t in this.variables){var s=this.state.tmp.done_vars.indexOf(this.variables[t]);s>-1&&(this.state.tmp.done_vars=this.state.tmp.done_vars.slice(0,s).concat(this.state.tmp.done_vars.slice(t+1)))}this.state.tmp.common_term_match_fail=!0,this.variables=[]}}};l.NameOutput.prototype.reinit=function(e,t){if(this.requireMatch=e.requireMatch,this.labelVariable=t,this.state.tmp.can_substitute.value()){this.nameset_offset=0,this.variables=e.variables;var r=this.state.tmp.value.slice();this.state.tmp.value=[];for(var i=0,s=this.variables.length;i<s;i+=1)this.Item[this.variables[i]]&&this.Item[this.variables[i]].length&&(this.state.tmp.value=this.state.tmp.value.concat(this.Item[this.variables[i]]));this.state.tmp.value.length&&this.state.tmp.can_substitute.replace(!1,l.LITERAL),this.state.tmp.value=r}var a=this.checkCommonAuthor(this.requireMatch);if(a){this.state.tmp.can_substitute.pop(),this.state.tmp.can_substitute.push(!0);for(var i in this.variables){var n=this.state.tmp.done_vars.indexOf(this.variables[i]);n>-1&&(this.state.tmp.done_vars=this.state.tmp.done_vars.slice(0,n).concat(this.state.tmp.done_vars.slice(i+1)))}this.variables=[]}};l.NameOutput.prototype.outputNames=function(){var e,t,r=this.variables;if(this.institution.and&&((!this.institution.and.single.blobs||!this.institution.and.single.blobs.length)&&(this.institution.and.single.blobs=this.name.and.single.blobs),(!this.institution.and.multiple.blobs||!this.institution.and.multiple.blobs.length)&&(this.institution.and.multiple.blobs=this.name.and.multiple.blobs)),this.variable_offset={},this.family)for(this.family_decor=l.Util.cloneToken(this.family),this.family_decor.strings.prefix="",this.family_decor.strings.suffix="",e=0,t=this.family.execs.length;e<t;e+=1)this.family.execs[e].call(this.family_decor,this.state,this.Item);else this.family_decor=!1;if(this.given)for(this.given_decor=l.Util.cloneToken(this.given),this.given_decor.strings.prefix="",this.given_decor.strings.suffix="",e=0,t=this.given.execs.length;e<t;e+=1)this.given.execs[e].call(this.given_decor,this.state,this.Item);else this.given_decor=!1;if(this.debug&&this.state.sys.print("(2)"),this.getEtAlConfig(),this.debug&&this.state.sys.print("(3)"),this.divideAndTransliterateNames(),this.debug&&this.state.sys.print("(4)"),this.truncatePersonalNameLists(),this.debug&&this.state.sys.print("(5)"),this.debug&&this.state.sys.print("(6)"),this.disambigNames(),this.constrainNames(),this.debug&&this.state.sys.print("(7)"),this.name.strings.form==="count"){(this.state.tmp.extension||this.names_count!=0)&&(this.state.output.append(this.names_count,"empty"),this.state.tmp.group_context.tip.variable_success=!0);return}this.debug&&this.state.sys.print("(8)"),this.setEtAlParameters(),this.debug&&this.state.sys.print("(9)"),this.setCommonTerm(this.requireMatch),this.debug&&this.state.sys.print("(10)"),this.renderAllNames(),this.debug&&this.state.sys.print("(11)");var i=[];for(e=0,t=r.length;e<t;e+=1){var s=r[e],a=[],n=!1,o=null;if(!this.state.opt.development_extensions.spoof_institutional_affiliations)o=this._join([this.freeters[s]],"");else{this.debug&&this.state.sys.print("(11a)");for(var u=0,c=this.institutions[s].length;u<c;u+=1)a.push(this.joinPersonsAndInstitutions([this.persons[s][u],this.institutions[s][u]]));if(this.debug&&this.state.sys.print("(11b)"),this.institutions[s].length){var p=this.nameset_base+this.variable_offset[s];this.freeters[s].length&&(p+=1),n=this.joinInstitutionSets(a,p)}this.debug&&this.state.sys.print("(11c)");var o=this.joinFreetersAndInstitutionSets([this.freeters[s],n]);this.debug&&this.state.sys.print("(11d)")}if(o&&(this.state.tmp.extension||(o=this._applyLabels(o,s)),i.push(o)),this.debug&&this.state.sys.print("(11e)"),this.common_term)break}for(this.debug&&this.state.sys.print("(12)"),this.state.output.openLevel("empty"),this.state.output.current.value().strings.delimiter=this.state.inheritOpt(this.names,"delimiter","names-delimiter"),this.debug&&this.state.sys.print("(13)"),e=0,t=i.length;e<t;e+=1)this.state.output.append(i[e],"literal",!0);!this.state.tmp.just_looking&&i.length>0&&(this.state.tmp.probably_rendered_something=!0),this.debug&&this.state.sys.print("(14)"),this.state.output.closeLevel("empty"),this.debug&&this.state.sys.print("(15)");var f=this.state.output.pop();this.state.tmp.name_node.top=f,this.debug&&this.state.sys.print("(16)");var h=l.Util.cloneToken(this.names);if(this.state.tmp.group_context.tip.condition&&l.UPDATE_GROUP_CONTEXT_CONDITION(this.state,this.names.strings.prefix,null,this.names),this.state.output.append(f,h),this.state.tmp.term_predecessor_name&&(this.state.tmp.term_predecessor=!0),this.debug&&this.state.sys.print("(17)"),this.debug&&this.state.sys.print("(18)"),r[0]!=="authority"){var m=[],g=this.Item[r[0]];if(g)for(var e=0,t=g.length;e<t;e+=1){var d=l.Util.Names.getRawName(g[e]);d&&m.push(d)}m=m.join(", "),m&&(this.state.tmp.name_node.string=m)}if(this.state.tmp.name_node.string&&!this.state.tmp.first_name_string&&(this.state.tmp.first_name_string=this.state.tmp.name_node.string),this.Item.type==="classic"&&this.state.tmp.first_name_string){var v=[];v.push(this.state.tmp.first_name_string),this.Item.title&&v.push(this.Item.title),v=v.join(", "),v&&this.state.sys.getAbbreviation&&(this.state.sys.normalizeAbbrevsKey&&(v=this.state.sys.normalizeAbbrevsKey("classic",v)),this.state.transform.loadAbbreviation("default","classic",v,this.Item.language),this.state.transform.abbrevs.default.classic[v]&&(this.state.tmp.done_vars.push("title"),this.state.output.append(this.state.transform.abbrevs.default.classic[v],"empty",!0),f=this.state.output.pop(),this.state.tmp.name_node.top.blobs.pop(),this.state.tmp.name_node.top.blobs.push(f)))}this._collapseAuthor(),this.variables=[],this.state.tmp.authority_stop_last=0,this.debug&&this.state.sys.print("(19)")};l.NameOutput.prototype._applyLabels=function(e,t){var r;if(!this.label||!this.label[this.labelVariable])return e;var i=0,s=this.freeters_count[t]+this.institutions_count[t];if(s>1)i=1;else{for(var a=0,n=this.persons[t].length;a<n;a+=1)s+=this.persons_count[t][a];s>1&&(i=1)}return this.label[this.labelVariable].before?(typeof this.label[this.labelVariable].before.strings.plural=="number"&&(i=this.label[this.labelVariable].before.strings.plural),r=this._buildLabel(t,i,"before",this.labelVariable),this.state.output.openLevel("empty"),this.state.output.append(r,this.label[this.labelVariable].before,!0),this.state.output.append(e,"literal",!0),this.state.output.closeLevel("empty"),e=this.state.output.pop()):this.label[this.labelVariable].after&&(typeof this.label[this.labelVariable].after.strings.plural=="number"&&(i=this.label[this.labelVariable].after.strings.plural),r=this._buildLabel(t,i,"after",this.labelVariable),this.state.output.openLevel("empty"),this.state.output.append(e,"literal",!0),this.state.output.append(r,this.label[this.labelVariable].after,!0),this.state.tmp.label_blob=this.state.output.pop(),this.state.output.append(this.state.tmp.label_blob,"literal",!0),this.state.output.closeLevel("empty"),e=this.state.output.pop()),e};l.NameOutput.prototype._buildLabel=function(e,t,r,i){this.common_term&&(e=this.common_term);var s=!1,a=this.label[i][r];return a&&(s=l.castLabel(this.state,a,e,t,l.TOLERANT)),s};l.NameOutput.prototype._collapseAuthor=function(){var e,t,r;this.state.tmp.name_node.top.blobs.length!==0&&(this.nameset_base===0&&this.Item[this.variables[0]]&&!this._first_creator_variable&&(this._first_creator_variable=this.variables[0]),(this.state[this.state.tmp.area].opt.collapse&&this.state[this.state.tmp.area].opt.collapse.length||this.state[this.state.tmp.area].opt.cite_group_delimiter&&this.state[this.state.tmp.area].opt.cite_group_delimiter.length)&&(this.state.tmp.authorstring_request?(t="",e=this.state.tmp.name_node.top.blobs.slice(-1)[0].blobs,r=this.state.tmp.offset_characters,e&&(t=this.state.output.string(this.state,e,!1)),this.state.tmp.offset_characters=r,this.state.registry.authorstrings[this.Item.id]=t):!this.state.tmp.just_looking&&!this.state.tmp.suppress_decorations&&(this.state[this.state.tmp.area].opt.collapse&&this.state[this.state.tmp.area].opt.collapse.length||this.state[this.state.tmp.area].opt.cite_group_delimiter&&this.state[this.state.tmp.area].opt.cite_group_delimiter)&&(t="",e=this.state.tmp.name_node.top.blobs.slice(-1)[0].blobs,r=this.state.tmp.offset_characters,e&&(t=this.state.output.string(this.state,e,!1)),t===this.state.tmp.last_primary_names_string?((this.item["suppress-author"]||this.state[this.state.tmp.area].opt.collapse&&this.state[this.state.tmp.area].opt.collapse.length)&&(this.state.tmp.name_node.top.blobs.pop(),this.state.tmp.name_node.children=[],this.state.tmp.offset_characters=r),this.state[this.state.tmp.area].opt.cite_group_delimiter&&this.state[this.state.tmp.area].opt.cite_group_delimiter&&(this.state.tmp.use_cite_group_delimiter=!0)):(this.state.tmp.last_primary_names_string=t,this.variables.indexOf(this._first_creator_variable)>-1&&this.item&&this.item["suppress-author"]&&this.Item.type!=="legal_case"&&(this.state.tmp.name_node.top.blobs.pop(),this.state.tmp.name_node.children=[],this.state.tmp.offset_characters=r,this.state.tmp.term_predecessor=!1),this.state.tmp.have_collapsed=!1,this.state[this.state.tmp.area].opt.cite_group_delimiter&&this.state[this.state.tmp.area].opt.cite_group_delimiter&&(this.state.tmp.use_cite_group_delimiter=!1)))))};l.NameOutput.prototype.isPerson=function(e){return!(e.literal||!e.given&&e.family&&e.isInstitution)};l.NameOutput.prototype.truncatePersonalNameLists=function(){var e,t,r,i,s,a,n;this.freeters_count={},this.persons_count={},this.institutions_count={};for(e in this.freeters)this.freeters.hasOwnProperty(e)&&(this.freeters_count[e]=this.freeters[e].length,this.freeters[e]=this._truncateNameList(this.freeters,e));for(e in this.persons)if(this.persons.hasOwnProperty(e))for(this.institutions_count[e]=this.institutions[e].length,this._truncateNameList(this.institutions,e),this.persons[e]=this.persons[e].slice(0,this.institutions[e].length),this.persons_count[e]=[],i=0,s=this.persons[e].length;i<s;i+=1)this.persons_count[e][i]=this.persons[e][i].length,this.persons[e][i]=this._truncateNameList(this.persons,e,i);if(this.state.opt.development_extensions.etal_min_etal_usefirst_hack&&this.etal_min===1&&this.etal_use_first===1&&!(this.state.tmp.extension||this.state.tmp.just_looking)?a=e:a=!1,a||this._please_chop)for(t=0,r=this.variables.length;t<r;t+=1){e=this.variables[t],this.freeters[e].length&&(this._please_chop===e?(this.freeters[e]=this.freeters[e].slice(1),this.freeters_count[e]+=-1,this._please_chop=!1):a&&!this._please_chop&&(this.freeters[e]=this.freeters[e].slice(0,1),this.freeters_count[e]=1,this.institutions[e]=[],this.persons[e]=[],this._please_chop=a));for(var i=0,s=this.persons[e].length;i<s;i++)if(this.persons[e][i].length){if(this._please_chop===e){this.persons[e][i]=this.persons[e][i].slice(1),this.persons_count[e][i]+=-1,this._please_chop=!1;break}else if(a&&!this._please_chop){this.freeters[e]=this.persons[e][i].slice(0,1),this.freeters_count[e]=1,this.institutions[e]=[],this.persons[e]=[],n=[],this._please_chop=a;break}}this.institutions[e].length&&(this._please_chop===e?(this.institutions[e]=this.institutions[e].slice(1),this.institutions_count[e]+=-1,this._please_chop=!1):a&&!this._please_chop&&(this.institutions[e]=this.institutions[e].slice(0,1),this.institutions_count[e]=1,n=[],this._please_chop=a))}for(t=0,r=this.variables.length;t<r;t+=1){this.institutions[e].length&&(this.nameset_offset+=1);for(var i=0,s=this.persons[e].length;i<s;i++)this.persons[e][i].length&&(this.nameset_offset+=1)}};l.NameOutput.prototype._truncateNameList=function(e,t,r){var i;if(typeof r=="undefined"?i=e[t]:i=e[t][r],this.state[this.state[this.state.tmp.area].root].opt.max_number_of_names&&i.length>50&&i.length>this.state[this.state[this.state.tmp.area].root].opt.max_number_of_names+2){var s=this.state[this.state[this.state.tmp.area].root].opt.max_number_of_names;i=i.slice(0,s+1).concat(i.slice(-1))}return i};l.NameOutput.prototype.divideAndTransliterateNames=function(){var e,t,r,i,s=this.Item,a=this.variables;for(this.varnames=a.slice(),this.freeters={},this.persons={},this.institutions={},e=0,t=a.length;e<t;e+=1){var n=a[e];this.variable_offset[n]=this.nameset_offset;var o=this._normalizeVariableValue(s,n);if(this.name.strings["suppress-min"]&&o.length>=this.name.strings["suppress-min"]&&(o=[]),this.name.strings["suppress-max"]&&o.length<=this.name.strings["suppress-max"]&&(o=[]),this._getFreeters(n,o),this._getPersonsAndInstitutions(n,o),this.state.opt.development_extensions.spoof_institutional_affiliations){if(this.name.strings["suppress-min"]===0)for(this.freeters[n]=[],r=0,i=this.persons[n].length;r<i;r+=1)this.persons[n][r]=[];else if(this.institution.strings["suppress-min"]===0){for(this.institutions[n]=[],this.freeters[n]=this.freeters[n].concat(this.persons[n]),r=0,i=this.persons[n].length;r<i;r+=1)for(var u=0,c=this.persons[n][r].length;u<c;u+=1)this.freeters[n].push(this.persons[n][r][u]);this.persons[n]=[]}}}};l.NameOutput.prototype._normalizeVariableValue=function(e,t){var r;return typeof e[t]=="string"||typeof e[t]=="number"?(l.debug('name variable "'+t+'" is string or number, not array. Attempting to fix.'),r=[{literal:e[t]+""}]):e[t]?(typeof e[t].length!="number"&&(l.debug('name variable "'+t+'" is object, not array. Attempting to fix.'),e[t]=[e[t]]),r=e[t].slice()):r=[],r};l.NameOutput.prototype._getFreeters=function(e,t){if(this.freeters[e]=[],this.state.opt.development_extensions.spoof_institutional_affiliations)for(var r=t.length-1;r>-1&&this.isPerson(t[r]);r--){var i=this._checkNickname(t.pop());i&&this.freeters[e].push(i)}else for(var r=t.length-1;r>-1;r--){var i=t.pop();if(this.isPerson(i))var i=this._checkNickname(i);this.freeters[e].push(i)}this.freeters[e].reverse(),this.freeters[e].length&&(this.nameset_offset+=1)};l.NameOutput.prototype._getPersonsAndInstitutions=function(e,t){if(this.persons[e]=[],this.institutions[e]=[],!!this.state.opt.development_extensions.spoof_institutional_affiliations){for(var r=[],i=!1,s=!0,a=t.length-1;a>-1;a+=-1)if(this.isPerson(t[a])){var n=this._checkNickname(t[a]);n&&r.push(n)}else i=!0,this.institutions[e].push(t[a]),s||(r.reverse(),this.persons[e].push(r),r=[]),s=!1;i&&(r.reverse(),this.persons[e].push(r),this.persons[e].reverse(),this.institutions[e].reverse())}};l.NameOutput.prototype._clearValues=function(e){for(var t=e.length-1;t>-1;t+=-1)e.pop()};l.NameOutput.prototype._checkNickname=function(e){if(["interview","personal_communication"].indexOf(this.Item.type)>-1){var t="";if(t=l.Util.Names.getRawName(e),t&&this.state.sys.getAbbreviation&&!(this.item&&this.item["suppress-author"])){var r=t;this.state.sys.normalizeAbbrevsKey&&(r=this.state.sys.normalizeAbbrevsKey("author",t)),this.state.transform.loadAbbreviation("default","nickname",r,this.Item.language);var i=this.state.transform.abbrevs.default.nickname[r];i&&(i==="!here>>>"?e=!1:e={family:i,given:""})}}return e};l.NameOutput.prototype._purgeEmptyBlobs=function(e){for(var t=e.length-1;t>-1;t+=-1)(!e[t]||e[t].length===0||!e[t].blobs.length)&&(e=e.slice(0,t).concat(e.slice(t+1)));return e};l.NameOutput.prototype.joinPersons=function(e,t,r,i){var s;return e=this._purgeEmptyBlobs(e),i||(i="name"),typeof r=="undefined"?this.etal_spec[t].freeters===1?s=this._joinEtAl(e):this.etal_spec[t].freeters===2?s=this._joinEllipsis(e):this.state.tmp.sort_key_flag?s=this._join(e,this.state.inheritOpt(this.name,"delimiter","name-delimiter",", ")):s=this._joinAnd(e):this.etal_spec[t].persons[r]===1?s=this._joinEtAl(e):this.etal_spec[t].persons[r]===2?s=this._joinEllipsis(e):this.state.tmp.sort_key_flag?s=this._join(e,this.state.inheritOpt(this.name,"delimiter","name-delimiter",", ")):s=this._joinAnd(e),s};l.NameOutput.prototype.joinInstitutionSets=function(e,t){var r;return e=this._purgeEmptyBlobs(e),this.etal_spec[t].institutions===1?r=this._joinEtAl(e,"institution"):this.etal_spec[t].institutions===2?r=this._joinEllipsis(e,"institution"):r=this._joinAnd(e),r};l.NameOutput.prototype.joinPersonsAndInstitutions=function(e){e=this._purgeEmptyBlobs(e);var t=this._join(e,this.state.tmp.name_delimiter);return t.isInstitution=!0,t};l.NameOutput.prototype.joinFreetersAndInstitutionSets=function(e){e=this._purgeEmptyBlobs(e);var t=this._join(e,"[never here]",this.with.single,this.with.multiple);return t};l.NameOutput.prototype._getAfterInvertedName=function(e,t,r){if(r&&e.length>1&&this.state.inheritOpt(this.name,"delimiter-precedes-last")==="after-inverted-name"){var i=e[e.length-2];i.blobs.length>0&&i.blobs[0].isInverted&&(r.strings.prefix=t)}return r};l.NameOutput.prototype._getAndJoin=function(e,t){var r=!1;if(e.length>1){var i="single";e.length>2&&(i="multiple"),e[e.length-1].isInstitution?r=this.institution.and[i]:r=this.name.and[i],r=JSON.parse(JSON.stringify(r)),r=this._getAfterInvertedName(e,t,r)}return r};l.NameOutput.prototype._joinEtAl=function(e){var t=this.state.inheritOpt(this.name,"delimiter","name-delimiter",", "),r=this._join(e,t);return this.state.output.openLevel(this._getToken("name")),this.state.output.current.value().strings.delimiter="",this.state.output.append(r,"literal",!0),e.length>1?this.state.output.append(this["et-al"].multiple,"literal",!0):e.length===1&&this.state.output.append(this["et-al"].single,"literal",!0),this.state.output.closeLevel(),this.state.output.pop()};l.NameOutput.prototype._joinEllipsis=function(e){var t=this.state.inheritOpt(this.name,"delimiter","name-delimiter",", "),r=!1;if(e.length>1){var i="single";e.length>2&&(i="multiple"),r=JSON.parse(JSON.stringify(this.name.ellipsis[i])),r=this._getAfterInvertedName(e,t,r)}return this._join(e,t,r)};l.NameOutput.prototype._joinAnd=function(e){var t=this.state.inheritOpt(this.name,"delimiter","name-delimiter",", "),r=this._getAndJoin(e,t);return this._join(e,t,r)};l.NameOutput.prototype._join=function(e,t,r){var i,s;if(!e||(e=this._purgeEmptyBlobs(e),!e.length))return!1;if(e.length>1)if(e.length===2)r?e=[e[0],r,e[1]]:e[0].strings.suffix+=t;else{var a;r?a=1:a=0;for(var n=e.pop(),i=0,s=e.length-a;i<s;i++)e[i].strings.suffix+=t;e.push(r),e.push(n)}for(this.state.output.openLevel(),i=0,s=e.length;i<s;i+=1)this.state.output.append(e[i],!1,!0);return this.state.output.closeLevel(),this.state.output.pop()};l.NameOutput.prototype._getToken=function(e){var t=this[e];if(e==="institution"){var r=new l.Token;return r}return t};l.NameOutput.prototype.checkCommonAuthor=function(e){if(!e)return!1;var t=!1;if(this.variables.length===2){var r=this.variables,i=r.slice();i.sort(),t=i.join("")}if(!t)return!1;var s=!1;if(this.state.locale[this.state.opt.lang].terms[t]&&(s=!0),!s)return this.state.tmp.done_vars.push(this.variables[0]),this.state.tmp.done_vars.push(this.variables[1]),!1;var a=this.Item[this.variables[0]],n=this.Item[this.variables[1]],o=this._compareNamesets(a,n);return o===!0&&(this.state.tmp.done_vars.push(this.variables[0]),this.state.tmp.done_vars.push(this.variables[1])),!o};l.NameOutput.prototype.setCommonTerm=function(){var e=this.variables,t=e.slice();if(t.sort(),this.common_term=t.join(""),!!this.common_term){var r=!1;if(this.label&&this.label[this.variables[0]]&&(this.label[this.variables[0]].before?r=this.state.getTerm(this.common_term,this.label[this.variables[0]].before.strings.form,0):this.label[this.variables[0]].after&&(r=this.state.getTerm(this.common_term,this.label[this.variables[0]].after.strings.form,0))),!this.state.locale[this.state.opt.lang].terms[this.common_term]||!r||this.variables.length<2){this.common_term=!1;return}for(var i=0,s=0,a=this.variables.length-1;s<a;s+=1){var n=this.variables[s],o=this.variables[s+1];if(this.freeters[n].length||this.freeters[o].length){if(this.etal_spec[n].freeters!==this.etal_spec[o].freeters||!this._compareNamesets(this.freeters[n],this.freeters[o])){this.common_term=!1;return}i+=1}if(this.persons[n].length!==this.persons[o].length){this.common_term=!1;return}for(var u=0,c=this.persons[n].length;u<c;u+=1)if(this.etal_spec[n].persons[u]!==this.etal_spec[o].persons[u]||!this._compareNamesets(this.persons[n][u],this.persons[o][u])){this.common_term=!1;return}}}};l.NameOutput.prototype._compareNamesets=function(e,t){if(!e||!t||e.length!==t.length)return!1;for(var r=0,i=t.length;r<i;r+=1)for(var s=0,a=l.NAME_PARTS.length;s<a;s+=1){var n=l.NAME_PARTS[s];if(!e[r]||e[r][n]!=t[r][n])return!1}return!0};l.NameOutput.prototype.constrainNames=function(){this.names_count=0;for(var e,t=0,r=this.variables.length;t<r;t+=1){var i=this.variables[t];e=this.nameset_base+t,this.freeters[i].length&&(this.state.tmp.names_max.push(this.freeters[i].length,"literal"),this._imposeNameConstraints(this.freeters,this.freeters_count,i,e),this.names_count+=this.freeters[i].length),this.institutions[i].length&&(this.state.tmp.names_max.push(this.institutions[i].length,"literal"),this._imposeNameConstraints(this.institutions,this.institutions_count,i,e),this.persons[i]=this.persons[i].slice(0,this.institutions[i].length),this.names_count+=this.institutions[i].length);for(var s=0,a=this.persons[i].length;s<a;s+=1)this.persons[i][s].length&&(this.state.tmp.names_max.push(this.persons[i][s].length,"literal"),this._imposeNameConstraints(this.persons[i],this.persons_count[i],s,e),this.names_count+=this.persons[i][s].length)}};l.NameOutput.prototype._imposeNameConstraints=function(e,t,r,i){var s=e[r],a=this.state.tmp["et-al-min"];this.state.tmp.suppress_decorations?this.state.tmp.disambig_request&&this.state.tmp.disambig_request.names[i]?a=this.state.tmp.disambig_request.names[i]:t[r]>=this.etal_min&&(a=this.etal_use_first):(this.state.tmp.disambig_request&&this.state.tmp.disambig_request.names[i]>this.etal_use_first?t[r]<this.etal_min?a=t[r]:a=this.state.tmp.disambig_request.names[i]:t[r]>=this.etal_min&&(a=this.etal_use_first),this.etal_use_last&&a>this.etal_min-2&&(a=this.etal_min-2));var n=this.etal_min>=this.etal_use_first,o=t[r]>a;a>t[r]&&(a=s.length),n&&o&&(this.etal_use_last?e[r]=s.slice(0,a).concat(s.slice(-1)):e[r]=s.slice(0,a)),this.state.tmp.disambig_settings.names[i]=e[r].length,this.state.disambiguate.padBase(this.state.tmp.disambig_settings)};l.NameOutput.prototype.disambigNames=function(){for(var e,t=0,r=this.variables.length;t<r;t+=1){var i=this.variables[t];if(e=this.nameset_base+t,this.freeters[i].length&&this._runDisambigNames(this.freeters[i],e),this.institutions[i].length){typeof this.state.tmp.disambig_settings.givens[e]=="undefined"&&(this.state.tmp.disambig_settings.givens[e]=[]);for(var s=0,a=this.institutions[i].length;s<a;s+=1)typeof this.state.tmp.disambig_settings.givens[e][s]=="undefined"&&this.state.tmp.disambig_settings.givens[e].push(2)}for(var s=0,a=this.persons[i].length;s<a;s+=1)this.persons[i][s].length&&this._runDisambigNames(this.persons[i][s],e)}};l.NameOutput.prototype._runDisambigNames=function(e,t){var r,i,s,a,n,o,u;for(n=0,o=e.length;n<o;n+=1)if(!(!e[n].given&&!e[n].family)){if(s=this.state.inheritOpt(this.name,"initialize-with"),this.state.registry.namereg.addname(""+this.Item.id,e[n],n),r=this.state.tmp.disambig_settings.givens[t],typeof r=="undefined")for(var c=0,p=t+1;c<p;c+=1)this.state.tmp.disambig_settings.givens[c]||(this.state.tmp.disambig_settings.givens[c]=[]);if(r=this.state.tmp.disambig_settings.givens[t][n],typeof r=="undefined"&&(i=this.state.inheritOpt(this.name,"form","name-form","long"),a=this.state.registry.namereg.evalname(""+this.Item.id,e[n],n,0,i,s),this.state.tmp.disambig_settings.givens[t].push(a)),i=this.state.inheritOpt(this.name,"form","name-form","long"),u=this.state.registry.namereg.evalname(""+this.Item.id,e[n],n,0,i,s),this.state.tmp.disambig_request){var f=this.state.tmp.disambig_settings.givens[t][n];f===1&&this.state.citation.opt["givenname-disambiguation-rule"]==="by-cite"&&(typeof this.state.inheritOpt(this.name,"initialize-with")=="undefined"||typeof e[n].given=="undefined")&&(f=2),a=f,this.state.opt["disambiguate-add-givenname"]&&e[n].given&&(a=this.state.registry.namereg.evalname(""+this.Item.id,e[n],n,a,this.state.inheritOpt(this.name,"form","name-form","long"),this.state.inheritOpt(this.name,"initialize-with")))}else a=u;!this.state.tmp.just_looking&&this.item&&this.item.position===l.POSITION_FIRST&&u>a&&(a=u),this.state.tmp.sort_key_flag||(this.state.tmp.disambig_settings.givens[t][n]=a,typeof s=="string"&&(typeof this.name.strings.initialize=="undefined"||this.name.strings.initialize===!0)&&(this.state.tmp.disambig_settings.use_initials=!0))}};l.NameOutput.prototype.getEtAlConfig=function(){var e=this.item;this["et-al"]={},this.state.output.append(this.etal_term,this.etal_style,!0),this["et-al"].single=this.state.output.pop(),this["et-al"].single.strings.suffix=this.etal_suffix,this["et-al"].single.strings.prefix=this.etal_prefix_single,this.state.output.append(this.etal_term,this.etal_style,!0),this["et-al"].multiple=this.state.output.pop(),this["et-al"].multiple.strings.suffix=this.etal_suffix,this["et-al"].multiple.strings.prefix=this.etal_prefix_multiple,typeof e=="undefined"&&(e={}),e.position?(this.state.inheritOpt(this.name,"et-al-subsequent-min")?this.etal_min=this.state.inheritOpt(this.name,"et-al-subsequent-min"):this.etal_min=this.state.inheritOpt(this.name,"et-al-min"),this.state.inheritOpt(this.name,"et-al-subsequent-use-first")?this.etal_use_first=this.state.inheritOpt(this.name,"et-al-subsequent-use-first"):this.etal_use_first=this.state.inheritOpt(this.name,"et-al-use-first")):(this.state.tmp["et-al-min"]?this.etal_min=this.state.tmp["et-al-min"]:this.etal_min=this.state.inheritOpt(this.name,"et-al-min"),this.state.tmp["et-al-use-first"]?this.etal_use_first=this.state.tmp["et-al-use-first"]:this.etal_use_first=this.state.inheritOpt(this.name,"et-al-use-first"),typeof this.state.tmp["et-al-use-last"]=="boolean"?this.etal_use_last=this.state.tmp["et-al-use-last"]:this.etal_use_last=this.state.inheritOpt(this.name,"et-al-use-last")),this.state.tmp["et-al-min"]||(this.state.tmp["et-al-min"]=this.etal_min)};l.NameOutput.prototype.setEtAlParameters=function(){var e,t,r,i;for(e=0,t=this.variables.length;e<t;e+=1){var s=this.variables[e];for(typeof this.etal_spec[s]=="undefined"&&(this.etal_spec[s]={freeters:0,institutions:0,persons:[]}),this.etal_spec[this.nameset_base+e]=this.etal_spec[s],this.freeters[s].length&&this._setEtAlParameter("freeters",s),r=0,i=this.persons[s].length;r<i;r+=1)typeof this.etal_spec[s][r]=="undefined"&&(this.etal_spec[s].persons[r]=0),this._setEtAlParameter("persons",s,r);this.institutions[s].length&&this._setEtAlParameter("institutions",s)}};l.NameOutput.prototype._setEtAlParameter=function(e,t,r){var i,s;e==="persons"?(i=this.persons[t][r],s=this.persons_count[t][r]):(i=this[e][t],s=this[e+"_count"][t]),i.length<s&&!this.state.tmp.sort_key_flag?this.etal_use_last?e==="persons"?this.etal_spec[t].persons[r]=2:this.etal_spec[t][e]=2:e==="persons"?this.etal_spec[t].persons[r]=1:this.etal_spec[t][e]=1:e==="persons"?this.etal_spec[t].persons[r]=0:this.etal_spec[t][e]=0};l.NameOutput.prototype.renderAllNames=function(){for(var e,t=0,r=this.variables.length;t<r;t+=1){var i=this.variables[t];(this.freeters[i].length||this.institutions[i].length)&&(this.state.tmp.group_context.tip.condition||(this.state.tmp.just_did_number=!1)),e=this.nameset_base+t,this.freeters[i].length&&(this.freeters[i]=this._renderNames(i,this.freeters[i],e));for(var s=0,a=this.institutions[i].length;s<a;s+=1)this.persons[i][s]=this._renderNames(i,this.persons[i][s],e,s)}this.renderInstitutionNames()};l.NameOutput.prototype.renderInstitutionNames=function(){for(var e=0,t=this.variables.length;e<t;e+=1)for(var r=this.variables[e],i=0,s=this.institutions[r].length;i<s;i+=1){var f,a=this.institutions[r][i],i,s,n;this.state.tmp.extension?n=["sort"]:a.isInstitution||a.literal?n=this.state.opt["cite-lang-prefs"].institutions:n=this.state.opt["cite-lang-prefs"].persons;var o={primary:"locale-orig",secondary:!1,tertiary:!1};if(n)for(var u=["primary","secondary","tertiary"],c=0,p=u.length;c<p&&!(n.length-1<c);c+=1)n[c]&&(o[u[c]]="locale-"+n[c]);else o.primary="locale-translat";this.state.tmp.area!=="bibliography"&&!(this.state.tmp.area==="citation"&&this.state.opt.xclass==="note"&&this.item&&!this.item.position)&&(o.secondary=!1,o.tertiary=!1),this.setRenderedName(a);var f=this._renderInstitutionName(r,a,o,i);this.institutions[r][i]=f}};l.NameOutput.prototype._renderInstitutionName=function(e,t,r,i){var s,a,n,o,u,c,p,f=this.getName(t,r.primary,!0),h=f.name,m=f.usedOrig;if(h&&(h=this.fixupInstitution(h,e,i)),s=!1,r.secondary){f=this.getName(t,r.secondary,!1,m);var s=f.name;m=f.usedOrig,s&&(s=this.fixupInstitution(s,e,i))}a=!1,r.tertiary&&(f=this.getName(t,r.tertiary,!1,m),a=f.name,a&&(a=this.fixupInstitution(a,e,i)));var g={l:{pri:!1,sec:!1,ter:!1},s:{pri:!1,sec:!1,ter:!1}};switch(h&&(g.l.pri=h.long,g.s.pri=h.short.length?h.short:h.long),s&&(g.l.sec=s.long,g.s.sec=s.short.length?s.short:s.long),a&&(g.l.ter=a.long,g.s.ter=a.short.length?a.short:a.long),this.institution.strings["institution-parts"]){case"short":h.short.length?(o=this._getShortStyle(),u=[this._composeOneInstitutionPart([g.s.pri,g.s.sec,g.s.ter],r,o,e)]):(n=this._getLongStyle(h,e,i),u=[this._composeOneInstitutionPart([g.l.pri,g.l.sec,g.l.ter],r,n,e)]);break;case"short-long":n=this._getLongStyle(h,e,i),o=this._getShortStyle(),c=this._renderOneInstitutionPart(h.short,o),p=this._composeOneInstitutionPart([g.l.pri,g.l.sec,g.l.ter],r,n,e),u=[c,p];break;case"long-short":n=this._getLongStyle(h,e,i),o=this._getShortStyle(),c=this._renderOneInstitutionPart(h.short,o),p=this._composeOneInstitutionPart([g.l.pri,g.l.sec,g.l.ter],r,n,e),u=[p,c];break;default:n=this._getLongStyle(h,e,i),u=[this._composeOneInstitutionPart([g.l.pri,g.l.sec,g.l.ter],r,n,e)];break}var d=this._join(u," ");return d&&(d.isInstitution=!0),this.state.tmp.name_node.children.push(d),d};l.NameOutput.prototype._composeOneInstitutionPart=function(e,t,r){var i=!1,s=!1,a=!1,n,o,u;if(e[0]){if(n=l.Util.cloneToken(r),this.state.opt.citeAffixes[t.primary]&&this.state.opt.citeAffixes.institutions[t.primary].prefix==="<i>"){for(var c=!1,p=0,f=n.decorations.length;p<f;p+=1)r.decorations[p][0]==="@font-style"&&n.decorations[p][1]==="italic"&&(c=!0);c||n.decorations.push(["@font-style","italic"])}i=this._renderOneInstitutionPart(e[0],n)}e[1]&&(s=this._renderOneInstitutionPart(e[1],r)),e[2]&&(a=this._renderOneInstitutionPart(e[2],r));var h;if(s||a){this.state.output.openLevel("empty"),this.state.output.append(i),o=l.Util.cloneToken(r),t.secondary&&(o.strings.prefix=this.state.opt.citeAffixes.institutions[t.secondary].prefix,o.strings.suffix=this.state.opt.citeAffixes.institutions[t.secondary].suffix,o.strings.prefix||(o.strings.prefix=" "));var m=new l.Token;m.decorations.push(["@font-style","normal"]),m.decorations.push(["@font-weight","normal"]),this.state.output.openLevel(m),this.state.output.append(s,o),this.state.output.closeLevel(),u=l.Util.cloneToken(r),t.tertiary&&(u.strings.prefix=this.state.opt.citeAffixes.institutions[t.tertiary].prefix,u.strings.suffix=this.state.opt.citeAffixes.institutions[t.tertiary].suffix,u.strings.prefix||(u.strings.prefix=" "));var g=new l.Token;g.decorations.push(["@font-style","normal"]),g.decorations.push(["@font-weight","normal"]),this.state.output.openLevel(g),this.state.output.append(a,u),this.state.output.closeLevel(),this.state.output.closeLevel(),h=this.state.output.pop()}else h=i;return h};l.NameOutput.prototype._renderOneInstitutionPart=function(e,t){for(var r=0,i=e.length;r<i;r+=1)if(e[r]){var s=e[r];if(this.state.tmp.strip_periods)s=s.replace(/\./g,"");else for(var a=0,n=t.decorations.length;a<n;a+=1)if(t.decorations[a][0]==="@strip-periods"&&t.decorations[a][1]==="true"){s=s.replace(/\./g,"");break}this.state.tmp.group_context.tip.variable_success=!0,this.state.tmp.can_substitute.replace(!1,l.LITERAL),s==="!here>>>"?e[r]=!1:(this.state.output.append(s,t,!0),e[r]=this.state.output.pop())}return typeof this.institution.strings["part-separator"]=="undefined"&&(this.institution.strings["part-separator"]=this.state.tmp.name_delimiter),this._join(e,this.institution.strings["part-separator"])};l.NameOutput.prototype._renderNames=function(e,t,r,i){var s=!1;if(t.length){for(var a=[],n=0,o=t.length;n<o;n+=1){var u=t[n],s,c;this.state.tmp.extension?c=["sort"]:u.isInstitution||u.literal?c=this.state.opt["cite-lang-prefs"].institutions:c=this.state.opt["cite-lang-prefs"].persons;var p={primary:"locale-orig",secondary:!1,tertiary:!1};if(c)for(var f=["primary","secondary","tertiary"],h=0,m=f.length;h<m&&!(c.length-1<h);h+=1)p[f[h]]="locale-"+c[h];else p.primary="locale-translat";if((this.state.tmp.sort_key_flag||this.state.tmp.area!=="bibliography"&&!(this.state.tmp.area==="citation"&&this.state.opt.xclass==="note"&&this.item&&!this.item.position))&&(p.secondary=!1,p.tertiary=!1),this.setRenderedName(u),!u.literal&&!u.isInstitution){var g=this._renderPersonalName(e,u,p,r,n,i),d=l.Util.cloneToken(this.name);this.state.output.append(g,d,!0),a.push(this.state.output.pop())}else a.push(this._renderInstitutionName(e,u,p,i))}s=this.joinPersons(a,r,i)}return s};l.NameOutput.prototype._renderPersonalName=function(e,t,r,i,s,a){var n=this.getName(t,r.primary,!0),o=this._renderOnePersonalName(n.name,i,s,a),u=!1;r.secondary&&(n=this.getName(t,r.secondary,!1,n.usedOrig),n.name&&(u=this._renderOnePersonalName(n.name,i,s,a)));var c=!1;r.tertiary&&(n=this.getName(t,r.tertiary,!1,n.usedOrig),n.name&&(c=this._renderOnePersonalName(n.name,i,s,a)));var p;if(u||c){this.state.output.openLevel("empty"),this.state.output.append(o);var f=new l.Token;r.secondary&&(f.strings.prefix=this.state.opt.citeAffixes.persons[r.secondary].prefix,f.strings.suffix=this.state.opt.citeAffixes.persons[r.secondary].suffix,f.strings.prefix||(f.strings.prefix=" ")),this.state.output.append(u,f);var h=new l.Token;r.tertiary&&(h.strings.prefix=this.state.opt.citeAffixes.persons[r.tertiary].prefix,h.strings.suffix=this.state.opt.citeAffixes.persons[r.tertiary].suffix,h.strings.prefix||(h.strings.prefix=" ")),this.state.output.append(c,h),this.state.output.closeLevel(),p=this.state.output.pop()}else p=o;return p};l.NameOutput.prototype._isRomanesque=function(e){var t=2;e.family.replace(/\"/g,"").match(l.ROMANESQUE_REGEXP)||(t=0),!t&&e.given&&e.given.match(l.STARTSWITH_ROMANESQUE_REGEXP)&&(t=1);var r;return t==2&&(e.multi&&e.multi.main?r=e.multi.main.slice(0,2):this.Item.language&&(r=this.Item.language.slice(0,2)),["ja","zh"].indexOf(r)>-1&&(t=1)),t};l.NameOutput.prototype._renderOnePersonalName=function(e,t,r,i){var s=e,a=this._droppingParticle(s,t,i),n=this._familyName(s),o=this._nonDroppingParticle(s),u=this._givenName(s,t,r),c=u.blob,p=this._nameSuffix(s);c===!1&&(a=!1,p=!1);var f=this.state.inheritOpt(this.name,"sort-separator");f||(f="");var h;s["comma-suffix"]?h=", ":h=" ";var m=this._isRomanesque(s);function g(C){return C?typeof C.blobs=="string"?["\u2019","'","-"," "].indexOf(C.blobs.slice(-1))>-1:g(C.blobs[C.blobs.length-1]):!1}var d=g(o),v;["fr","ru","cs"].indexOf(this.state.opt["default-locale"][0].slice(0,2))>-1?v="\xA0":v=" ";var b,E,x,w;if(m===0)b=this._join([o,n,c],"");else if(m===1||s["static-ordering"])E=this._join([o,n],v),b=this._join([E,c]," ");else if(s["reverse-ordering"])E=this._join([o,n],v),b=this._join([c,E]," ");else if(this.state.tmp.sort_key_flag)this.state.opt["demote-non-dropping-particle"]==="never"?(E=this._join([o,n],v),E=this._join([E,a]," "),E=this._join([E,c],this.state.opt.sort_sep),b=this._join([E,p]," ")):(w=this._join([c,a,o]," "),E=this._join([n,w],this.state.opt.sort_sep),b=this._join([E,p]," "));else if(this.state.inheritOpt(this.name,"name-as-sort-order")==="all"||this.state.inheritOpt(this.name,"name-as-sort-order")==="first"&&r===0&&(i===0||typeof i=="undefined"))["Lord","Lady"].indexOf(s.given)>-1&&(f=", "),["always","display-and-sort"].indexOf(this.state.opt["demote-non-dropping-particle"])>-1?(w=this._join([c,a],s["comma-dropping-particle"]+" "),w=this._join([w,o]," "),w&&this.given&&(w.strings.prefix=this.given.strings.prefix,w.strings.suffix=this.given.strings.suffix),n&&this.family&&(n.strings.prefix=this.family.strings.prefix,n.strings.suffix=this.family.strings.suffix),E=this._join([n,w],f),b=this._join([E,p],f)):(d?x=this._join([o,n],""):x=this._join([o,n],v),x&&this.family&&(x.strings.prefix=this.family.strings.prefix,x.strings.suffix=this.family.strings.suffix),w=this._join([c,a],s["comma-dropping-particle"]+" "),w&&this.given&&(w.strings.prefix=this.given.strings.prefix,w.strings.suffix=this.given.strings.suffix),E=this._join([x,w],f),b=this._join([E,p],f)),b.isInverted=!0;else{if(s["dropping-particle"]&&s.family&&!s["non-dropping-particle"]){var S=s["dropping-particle"],T=["'","\u02BC","\u2019","-"];T.indexOf(S.slice(-1))>-1&&S.slice(0,-1)!=="de"&&(n=this._join([a,n],""),a=!1)}d?(w=this._join([o,n],""),w=this._join([a,w],v)):w=this._join([a,o,n],v),w=this._join([w,p],h),w&&this.family&&(w.strings.prefix=this.family.strings.prefix,w.strings.suffix=this.family.strings.suffix),c&&this.given&&(c.strings.prefix=this.given.strings.prefix,c.strings.suffix=this.given.strings.suffix),w.strings.prefix&&(s["comma-dropping-particle"]="");var I;this.state.inheritOpt(this.name,"initialize-with")&&this.state.inheritOpt(this.name,"initialize-with").match(/[\u00a0\ufeff]/)&&u.initializationLevel===1?I=v:I=" ",b=this._join([c,w],s["comma-dropping-particle"]+I)}return this.state.tmp.group_context.tip.variable_success=!0,this.state.tmp.can_substitute.replace(!1,l.LITERAL),this.state.tmp.term_predecessor=!0,this.state.tmp.name_node.children.push(b),b};l.NameOutput.prototype._normalizeNameInput=function(e){var t={literal:e.literal,family:e.family,isInstitution:e.isInstitution,given:e.given,suffix:e.suffix,"comma-suffix":e["comma-suffix"],"non-dropping-particle":e["non-dropping-particle"],"dropping-particle":e["dropping-particle"],"static-ordering":e["static-ordering"],"static-particles":e["static-particles"],"reverse-ordering":e["reverse-ordering"],"full-form-always":e["full-form-always"],"parse-names":e["parse-names"],"comma-dropping-particle":"",block_initialize:e.block_initialize,multi:e.multi};return this._parseName(t),t};l.NameOutput.prototype._stripPeriods=function(e,t){var r=this[e+"_decor"];if(t){if(this.state.tmp.strip_periods)t=t.replace(/\./g,"");else if(r){for(var i=0,s=r.decorations.length;i<s;i+=1)if(r.decorations[i][0]==="@strip-periods"&&r.decorations[i][1]==="true"){t=t.replace(/\./g,"");break}}}return t};l.NameOutput.prototype._nonDroppingParticle=function(e){var t=e["non-dropping-particle"];t&&this.state.tmp.sort_key_flag&&(t=t.replace(/[\'\u2019]/,""));var r=this._stripPeriods("family",t);return this.state.output.append(r,this.family_decor,!0)?this.state.output.pop():!1};l.NameOutput.prototype._droppingParticle=function(e,t,r){var i=e["dropping-particle"];i&&this.state.tmp.sort_key_flag&&(i=i.replace(/[\'\u2019]/,""));var s=this._stripPeriods("given",i);if(e["dropping-particle"]&&e["dropping-particle"].match(/^et.?al[^a-z]$/))this.state.inheritOpt(this.name,"et-al-use-last")?typeof r=="undefined"?this.etal_spec[t].freeters=2:this.etal_spec[t].persons=2:typeof r=="undefined"?this.etal_spec[t].freeters=1:this.etal_spec[t].persons=1,e["comma-dropping-particle"]="";else if(this.state.output.append(s,this.given_decor,!0))return this.state.output.pop();return!1};l.NameOutput.prototype._familyName=function(e){var t=this._stripPeriods("family",e.family);return this.state.output.append(t,this.family_decor,!0)?this.state.output.pop():!1};l.NameOutput.prototype._givenName=function(e,t,r){var i,s=this.state.inheritOpt(this.name,"form","name-form","long")!=="long",a=this.state.inheritOpt(this.name,"initialize")!==!1,n=typeof this.state.inheritOpt(this.name,"initialize-with")=="string"&&!e.block_initialize,o,u;if(e["full-form-always"])u=2;else{s?o=0:n?o=1:o=2;var c=this.state.tmp.disambig_settings.givens[t][r];c>o?u=c:u=o}var p=this.state.citation.opt["givenname-disambiguation-rule"];if(p&&p.slice(-14)==="-with-initials"&&(n=!0),e.family&&u===1)if(n){var f=this.state.inheritOpt(this.name,"initialize-with",!1,"");e.given=l.Util.Names.initializeWith(this.state,e.given,f,!a)}else e.given=l.Util.Names.unInitialize(this.state,e.given);else{if(u===0)return{blob:!1};u===2&&(e.given=l.Util.Names.unInitialize(this.state,e.given))}var h=this._stripPeriods("given",e.given),m=this.state.output.append(h,this.given_decor,!0);return m?(i=this.state.output.pop(),{blob:i,initializationLevel:u}):{blob:!1}};l.NameOutput.prototype._nameSuffix=function(e){var t=e.suffix,r;t&&typeof this.state.inheritOpt(this.name,"initialize-with")=="string"&&(t=l.Util.Names.initializeWith(this.state,t,this.state.inheritOpt(this.name,"initialize-with"),!0)),t=this._stripPeriods("family",t);var i="";t&&t.slice(-1)==="."&&(t=t.slice(0,-1),i=".");var s=this.state.output.append(t,"empty",!0);return s?(r=this.state.output.pop(),r.strings.suffix=i+r.strings.suffix,r):!1};l.NameOutput.prototype._getLongStyle=function(e){var t;return e.short.length?this.institutionpart["long-with-short"]?t=this.institutionpart["long-with-short"]:t=this.institutionpart.long:t=this.institutionpart.long,t||(t=new l.Token),t};l.NameOutput.prototype._getShortStyle=function(){var e;return this.institutionpart.short?e=this.institutionpart.short:e=new l.Token,e};l.NameOutput.prototype._parseName=function(e){if(!e["parse-names"]&&typeof e["parse-names"]!="undefined")return e;e.family&&!e.given&&e.isInstitution&&(e.literal=e.family,e.family=void 0,e.isInstitution=void 0);var t;e.family&&e.family.slice(0,1)==='"'&&e.family.slice(-1)==='"'||!e["parse-names"]&&typeof e["parse-names"]!="undefined"?(e.family=e.family.slice(1,-1),t=!0,e["parse-names"]=0):t=!1,this.state.opt.development_extensions.parse_names&&!e["non-dropping-particle"]&&e.family&&!t&&e.given&&(e["static-particles"]||l.parseParticles(e,!0))};l.NameOutput.prototype.getName=function(e,t,r,i){if(i&&t==="locale-orig")return{name:!1,usedOrig:i};e.family||(e.family=""),e.given||(e.given="");var s={};s["static-ordering"]=this.getStaticOrder(e);var a=!0,n;if(t!=="locale-orig"&&(a=!1,e.multi)){for(var o=this.state.opt[t],u=0,c=o.length;u<c;u+=1)if(n=o[u],e.multi._key[n]){a=!0;var p=e.isInstitution;e=e.multi._key[n],e.isInstitution=p,s=this.getNameParams(n),s.transliterated=!0;break}}if(a||(n=!1,e.multi&&e.multi.main?n=e.multi.main:this.Item.language&&(n=this.Item.language),n&&(s=this.getNameParams(n))),!r&&!a)return{name:!1,usedOrig:i};e.family||(e.family=""),e.given||(e.given=""),e.literal&&(delete e.family,delete e.given),e={family:e.family,given:e.given,"non-dropping-particle":e["non-dropping-particle"],"dropping-particle":e["dropping-particle"],suffix:e.suffix,"static-ordering":s["static-ordering"],"static-particles":e["static-particles"],"reverse-ordering":s["reverse-ordering"],"full-form-always":s["full-form-always"],"parse-names":e["parse-names"],"comma-suffix":e["comma-suffix"],"comma-dropping-particle":e["comma-dropping-particle"],transliterated:s.transliterated,block_initialize:s["block-initialize"],literal:e.literal,isInstitution:e.isInstitution,multi:e.multi},!e.literal&&!e.given&&e.family&&e.isInstitution&&(e.literal=e.family),e.literal&&(delete e.family,delete e.given),e=this._normalizeNameInput(e);var f;return i?f=i:f=!a,{name:e,usedOrig:f}};l.NameOutput.prototype.getNameParams=function(e){var t={},r=l.localeResolve(this.Item.language,this.state.opt["default-locale"][0]),i=this.state.locale[r.best]?r.best:this.state.opt["default-locale"][0],s=this.state.locale[i].opts["name-as-sort-order"],a=this.state.locale[i].opts["name-as-reverse-order"],n=this.state.locale[i].opts["name-never-short"],o=e.split("-")[0];return s&&s[o]&&(t["static-ordering"]=!0,t["reverse-ordering"]=!1),a&&a[o]&&(t["reverse-ordering"]=!0,t["static-ordering"]=!1),n&&n[o]&&(t["full-form-always"]=!0),t["static-ordering"]&&(t["block-initialize"]=!0),t};l.NameOutput.prototype.setRenderedName=function(e){if(this.state.tmp.area==="bibliography"){for(var t="",r=0,i=l.NAME_PARTS.length;r<i;r+=1)e[l.NAME_PARTS[r]]&&(t+=e[l.NAME_PARTS[r]]);this.state.tmp.rendered_name.push(t)}};l.NameOutput.prototype.fixupInstitution=function(e,t,r){!e.literal&&e.family&&(e.literal=e.family,delete e.family);var i=e.literal,s=i,a={long:i.split(/\s*\|\s*/),short:s.split(/\s*\|\s*/)};if(this.state.sys.getAbbreviation){if(this.institution.strings.form==="short"){let h=this.Item.jurisdiction;h=this.state.transform.loadAbbreviation(h,"institution-entire",i,this.Item.language),this.state.transform.abbrevs[h]["institution-entire"][i]?i=this.state.transform.abbrevs[h]["institution-entire"][i]:(h=this.Item.jurisdiction,h=this.state.transform.loadAbbreviation(h,"institution-part",i,this.Item.language),this.state.transform.abbrevs[h]["institution-part"][i]&&(i=this.state.transform.abbrevs[h]["institution-part"][i])),i=this._quashChecks(h,i)}if(["short","short-long","long-short"].indexOf(this.institution.strings["institution-parts"])>-1){let h=this.Item.jurisdiction;h=this.state.transform.loadAbbreviation(h,"institution-part",s,this.Item.language),this.state.transform.abbrevs[h]["institution-part"][s]&&(s=this.state.transform.abbrevs[h]["institution-part"][s]),s=this._quashChecks(h,s),["short-long","long-short"].indexOf(this.institution.strings["institution-parts"])>-1&&s===i&&(s="")}if(a.long=i.split(/\s*\|\s*/),a.short=s.split(/\s*\|\s*/),["short","short-long","long-short"].indexOf(this.institution.strings["institution-parts"])>-1)for(var n=a.short.length-1;n>-1;n--){let h=this.Item.jurisdiction;var o=a.short[n];if(h=this.state.transform.loadAbbreviation(h,"institution-part",o,this.Item.language),this.state.transform.abbrevs[h]["institution-part"][o]&&(a.short[n]=this.state.transform.abbrevs[h]["institution-part"][o]),a.short[n].indexOf("|")>-1){let m=a.short,g=m[n].split(/\s*\|\s*/);a.short=m.slice(0,n).concat(g).concat(m.slice(n+1))}}if(this.state.opt.development_extensions.legacy_institution_name_ordering&&a.short.reverse(),a.short=this._trimInstitution(a.short),this.institution.strings["reverse-order"]&&a.short.reverse(),!this.state.tmp.just_looking&&this.Item.jurisdiction){let h=this.Item.jurisdiction;var u=this.state.tmp.abbrev_trimmer;if(u&&u[h]&&u[h][t])for(var c=0,p=a.short.length;c<p;c++){var f=a.short[c];a.short[c]=f.replace(u[h][t],"").trim()}}}return this.state.opt.development_extensions.legacy_institution_name_ordering&&a.long.reverse(),a.long=this._trimInstitution(a.long),this.institution.strings["reverse-order"]&&a.long.reverse(),a};l.NameOutput.prototype.getStaticOrder=function(e,t){var r=!1;return(!t&&e["static-ordering"]||this._isRomanesque(e)===0||(!e.multi||!e.multi.main)&&this.Item.language&&["vi","hu"].indexOf(this.Item.language)>-1||e.multi&&e.multi.main&&["vi","hu"].indexOf(e.multi.main.slice(0,2))>-1||this.state.opt["auto-vietnamese-names"]&&l.VIETNAMESE_NAMES.exec(e.family+" "+e.given)&&l.VIETNAMESE_SPECIALS.exec(e.family+e.given))&&(r=!0),r};l.NameOutput.prototype._quashChecks=function(e,r){var r=this.state.transform.quashCheck(e,r),i=r.split(/>>[0-9]{4}>>/),s=r.match(/>>([0-9]{4})>>/);r=i.pop();var a=this.Item["original-date"]?this.Item["original-date"]:this.Item.issued;if(a&&(a=parseInt(a.year,10),a=isNaN(a)?!1:a),a){if(i.length>0)for(var n=s.length-1;n>0&&!(a>=parseInt(s[n],10));n--)r=i.pop();r=r.replace(/\s*\|\s*/g,"|")}return r};l.NameOutput.prototype._trimInstitution=function(e){var t=!1,r=!1,i=!1,s=!1,a=e.slice();if(this.institution){if(typeof this.institution.strings["use-first"]!="undefined"&&(t=this.institution.strings["use-first"]),typeof this.institution.strings["use-last"]!="undefined"&&(i=this.institution.strings["use-last"]),typeof this.institution.strings["stop-first"]!="undefined"&&(s=this.institution.strings["stop-first"]),typeof this.institution.strings["stop-last"]!="undefined"&&(r=this.institution.strings["stop-last"]),t&&(r&&(a=a.slice(0,r*-1)),a=a.slice(0,t)),i){var n=e.slice();t?s=t:a=[],s&&(n=n.slice(s)),n=n.slice(i*-1),a=a.concat(n)}e=a}return e};l.PublisherOutput=function(e,t){this.state=e,this.group_tok=t,this.varlist=[]};l.PublisherOutput.prototype.render=function(){this.clearVars(),this.composeAndBlob(),this.composeElements(),this.composePublishers(),this.joinPublishers()};l.PublisherOutput.prototype.composeAndBlob=function(){this.and_blob={};var e=!1;this.group_tok.strings.and==="text"?e=this.state.getTerm("and"):this.group_tok.strings.and==="symbol"&&(e="&");var t=new l.Token;t.strings.suffix=" ",t.strings.prefix=" ",this.state.output.append(e,t,!0);var r=this.state.output.pop();t.strings.prefix=this.group_tok.strings["subgroup-delimiter"],this.state.output.append(e,t,!0);var i=this.state.output.pop();this.and_blob.single=!1,this.and_blob.multiple=!1,e&&(this.group_tok.strings["subgroup-delimiter-precedes-last"]==="always"?this.and_blob.single=i:this.group_tok.strings["subgroup-delimiter-precedes-last"]==="never"?(this.and_blob.single=r,this.and_blob.multiple=r):(this.and_blob.single=r,this.and_blob.multiple=i))};l.PublisherOutput.prototype.composeElements=function(){for(var e=0,t=2;e<t;e+=1)for(var r=["publisher","publisher-place"][e],i=0,s=this["publisher-list"].length;i<s;i+=1){var a=this[r+"-list"][i],n=this[r+"-token"];this.state.output.append(a,n,!0),this[r+"-list"][i]=this.state.output.pop()}};l.PublisherOutput.prototype.composePublishers=function(){for(var e,t=0,r=this["publisher-list"].length;t<r;t+=1)e=[this[this.varlist[0]+"-list"][t],this[this.varlist[1]+"-list"][t]],this["publisher-list"][t]=this._join(e,this.group_tok.strings.delimiter)};l.PublisherOutput.prototype.joinPublishers=function(){var e=this["publisher-list"],t=this._join(e,this.group_tok.strings["subgroup-delimiter"],this.and_blob.single,this.and_blob.multiple,this.group_tok);this.state.output.append(t,"literal")};l.PublisherOutput.prototype._join=l.NameOutput.prototype._join;l.PublisherOutput.prototype._getToken=l.NameOutput.prototype._getToken;l.PublisherOutput.prototype.clearVars=function(){this.state.tmp["publisher-list"]=!1,this.state.tmp["publisher-place-list"]=!1,this.state.tmp["publisher-group-token"]=!1,this.state.tmp["publisher-token"]=!1,this.state.tmp["publisher-place-token"]=!1};l.evaluateLabel=function(e,t,r,i){var s;e.strings.term==="locator"?(i&&i.label&&(i.label==="sub verbo"?s="sub-verbo":s=i.label),s||(s="page")):s=e.strings.term;var a=e.strings.plural;if(typeof a!="number"){var n=i&&e.strings.term==="locator"?i:r;n[e.strings.term]&&(t.processNumber(!1,n,e.strings.term,r.type),a=t.tmp.shadow_numbers[e.strings.term].plural,!t.tmp.shadow_numbers[e.strings.term].labelForm&&!t.tmp.shadow_numbers[e.strings.term].labelDecorations&&(e.strings.form?t.tmp.shadow_numbers[e.strings.term].labelForm=e.strings.form:t.tmp.group_context.tip.label_form&&(t.tmp.shadow_numbers[e.strings.term].labelForm=t.tmp.group_context.tip.label_form),t.tmp.shadow_numbers[e.strings.term].labelCapitalizeIfFirst=e.strings.capitalize_if_first,t.tmp.shadow_numbers[e.strings.term].labelDecorations=e.decorations.slice()),["locator","number","page"].indexOf(e.strings.term)>-1&&t.tmp.shadow_numbers[e.strings.term].label&&(s=t.tmp.shadow_numbers[e.strings.term].label),e.decorations&&t.opt.development_extensions.csl_reverse_lookup_support&&(e.decorations.reverse(),e.decorations.push(["@showid","true",e.cslid]),e.decorations.reverse()))}return l.castLabel(t,e,s,a,l.TOLERANT)};l.castLabel=function(e,t,r,i,s){var a=t.strings.form,n=t.strings.capitalize_if_first;e.tmp.group_context.tip.label_form&&(a==="static"?e.tmp.group_context.tip.label_static=!0:a=e.tmp.group_context.tip.label_form),e.tmp.group_context.tip.label_capitalize_if_first&&(n=e.tmp.group_context.tip.label_capitalize_if_first);var o=e.getTerm(r,a,i,!1,s,t.default_locale);if(n&&(o=l.Output.Formatters["capitalize-first"](e,o)),e.tmp.strip_periods)o=o.replace(/\./g,"");else for(var u=0,c=t.decorations.length;u<c;u+=1)if(t.decorations[u][0]==="@strip-periods"&&t.decorations[u][1]==="true"){o=o.replace(/\./g,"");break}return o};l.Node.name={build:function(e,t){var r;if([l.SINGLETON,l.START].indexOf(this.tokentype)>-1){var i;typeof e.tmp.root=="undefined"?(i=void 0,e.tmp.root="citation"):i=e.tmp.root,e.inheritOpt(this,"et-al-subsequent-min")&&e.inheritOpt(this,"et-al-subsequent-min")!==e.inheritOpt(this,"et-al-min")&&(e.opt.update_mode=l.POSITION),e.inheritOpt(this,"et-al-subsequent-use-first")&&e.inheritOpt(this,"et-al-subsequent-use-first")!==e.inheritOpt(this,"et-al-use-first")&&(e.opt.update_mode=l.POSITION),e.tmp.root=i,r=function(s){s.tmp.etal_term="et-al",s.tmp.name_delimiter=s.inheritOpt(this,"delimiter","name-delimiter",", "),s.tmp["delimiter-precedes-et-al"]=s.inheritOpt(this,"delimiter-precedes-et-al"),s.inheritOpt(this,"and")==="text"?this.and_term=s.getTerm("and","long",0):s.inheritOpt(this,"and")==="symbol"&&(s.opt.development_extensions.expect_and_symbol_form?this.and_term=s.getTerm("and","symbol",0):this.and_term="&"),s.tmp.and_term=this.and_term,l.STARTSWITH_ROMANESQUE_REGEXP.test(this.and_term)?(this.and_prefix_single=" ",this.and_prefix_multiple=", ",typeof s.tmp.name_delimiter=="string"&&(this.and_prefix_multiple=s.tmp.name_delimiter),this.and_suffix=" "):(this.and_prefix_single="",this.and_prefix_multiple="",this.and_suffix=""),s.inheritOpt(this,"delimiter-precedes-last")==="always"?this.and_prefix_single=s.tmp.name_delimiter:s.inheritOpt(this,"delimiter-precedes-last")==="never"?this.and_prefix_multiple&&(this.and_prefix_multiple=" "):s.inheritOpt(this,"delimiter-precedes-last")==="after-inverted-name"&&(this.and_prefix_single&&(this.and_prefix_single=s.tmp.name_delimiter),this.and_prefix_multiple&&(this.and_prefix_multiple=" ")),this.and={},s.inheritOpt(this,"and")?(s.output.append(this.and_term,"empty",!0),this.and.single=s.output.pop(),this.and.single.strings.prefix=this.and_prefix_single,this.and.single.strings.suffix=this.and_suffix,s.output.append(this.and_term,"empty",!0),this.and.multiple=s.output.pop(),this.and.multiple.strings.prefix=this.and_prefix_multiple,this.and.multiple.strings.suffix=this.and_suffix):s.tmp.name_delimiter&&(this.and.single=new l.Blob(s.tmp.name_delimiter),this.and.single.strings.prefix="",this.and.single.strings.suffix="",this.and.multiple=new l.Blob(s.tmp.name_delimiter),this.and.multiple.strings.prefix="",this.and.multiple.strings.suffix=""),this.ellipsis={},s.inheritOpt(this,"et-al-use-last")&&(this.ellipsis_term="\u2026",this.ellipsis_prefix_single=" ",this.ellipsis_prefix_multiple=s.inheritOpt(this,"delimiter","name-delimiter",", "),this.ellipsis_suffix=" ",this.ellipsis.single=new l.Blob(this.ellipsis_term),this.ellipsis.single.strings.prefix=this.ellipsis_prefix_single,this.ellipsis.single.strings.suffix=this.ellipsis_suffix,this.ellipsis.multiple=new l.Blob(this.ellipsis_term),this.ellipsis.multiple.strings.prefix=this.ellipsis_prefix_multiple,this.ellipsis.multiple.strings.suffix=this.ellipsis_suffix),typeof s.tmp["et-al-min"]=="undefined"&&(s.tmp["et-al-min"]=s.inheritOpt(this,"et-al-min")),typeof s.tmp["et-al-use-first"]=="undefined"&&(s.tmp["et-al-use-first"]=s.inheritOpt(this,"et-al-use-first")),typeof s.tmp["et-al-use-last"]=="undefined"&&(s.tmp["et-al-use-last"]=s.inheritOpt(this,"et-al-use-last")),s.nameOutput.name=this},e.build.name_flag=!0,this.execs.push(r)}t.push(this)}};l.Node["name-part"]={build:function(e){e.build[this.strings.name]=this}};l.Node.names={build:function(e,t){var r;if((this.tokentype===l.START||this.tokentype===l.SINGLETON)&&(l.Util.substituteStart.call(this,e,t),e.build.substitute_level.push(1)),this.tokentype===l.SINGLETON){e.build.names_variables[e.build.names_variables.length-1].concat(this.variables);for(var i in this.variables){var s=this.variables[i],a=e.build.name_label[e.build.name_label.length-1];Object.keys(a).length&&(a[s]=a[Object.keys(a)[0]])}r=function(u){u.nameOutput.reinit(this,this.variables_real[0])},this.execs.push(r)}if(this.tokentype===l.START&&(e.build.names_flag=!0,e.build.name_flag=!1,e.build.names_level+=1,e.build.names_variables.push(this.variables),e.build.name_label.push({}),r=function(u){u.tmp.can_substitute.push(!0),u.tmp.name_node={},u.tmp.name_node.children=[],u.nameOutput.init(this)},this.execs.push(r)),this.tokentype===l.END){for(var i=0,n=3;i<n;i+=1){var o=["family","given","et-al"][i];this[o]=e.build[o],e.build.names_level===1&&(e.build[o]=void 0)}this.label=e.build.name_label[e.build.name_label.length-1],e.build.names_level+=-1,e.build.names_variables.pop(),e.build.name_label.pop(),r=function(u){u.tmp.etal_node?this.etal_style=u.tmp.etal_node:this.etal_style="empty",this.etal_term=u.getTerm(u.tmp.etal_term,"long",0),this.etal_prefix_single=" ",this.etal_prefix_multiple=u.tmp.name_delimiter,u.tmp["delimiter-precedes-et-al"]==="always"?this.etal_prefix_single=u.tmp.name_delimiter:u.tmp["delimiter-precedes-et-al"]==="never"?this.etal_prefix_multiple=" ":u.tmp["delimiter-precedes-et-al"]==="after-inverted-name"&&(this.etal_prefix_single=u.tmp.name_delimiter,this.etal_prefix_multiple=" "),this.etal_suffix="",l.STARTSWITH_ROMANESQUE_REGEXP.test(this.etal_term)||(this.etal_prefix_single===" "&&(this.etal_prefix_single=""),this.etal_prefix_multiple===" "&&(this.etal_prefix_multiple=""),this.etal_suffix===" "&&(this.etal_suffix=""));for(var c=0,p=3;c<p;c+=1){var f=["family","given"][c];u.nameOutput[f]=this[f]}u.nameOutput.with=this.with;var h="with",m="",g="";l.STARTSWITH_ROMANESQUE_REGEXP.test(h)&&(m=" ",g=" ");var d={};d.single=new l.Blob(h),d.single.strings.suffix=g,d.multiple=new l.Blob(h),d.multiple.strings.suffix=g,u.inheritOpt(u.nameOutput.name,"delimiter-precedes-last")==="always"?(d.single.strings.prefix=u.inheritOpt(this,"delimiter","names-delimiter"),d.multiple.strings.prefix=u.inheritOpt(this,"delimiter","names-delimiter")):u.inheritOpt(u.nameOutput.name,"delimiter-precedes-last")==="contextual"?(d.single.strings.prefix=m,d.multiple.strings.prefix=u.inheritOpt(this,"delimiter","names-delimiter")):u.inheritOpt(u.nameOutput.name,"delimiter-precedes-last")==="after-inverted-name"?(d.single.strings.prefix=u.inheritOpt(this,"delimiter","names-delimiter"),d.multiple.strings.prefix=m):(d.single.strings.prefix=m,d.multiple.strings.prefix=m),u.nameOutput.with=d,u.nameOutput.label=this.label,u.nameOutput.etal_style=this.etal_style,u.nameOutput.etal_term=this.etal_term,u.nameOutput.etal_prefix_single=this.etal_prefix_single,u.nameOutput.etal_prefix_multiple=this.etal_prefix_multiple,u.nameOutput.etal_suffix=this.etal_suffix,u.nameOutput.outputNames(),u.tmp["et-al-use-first"]=void 0,u.tmp["et-al-min"]=void 0,u.tmp["et-al-use-last"]=void 0},this.execs.push(r),r=function(u){u.tmp.can_substitute.pop()||u.tmp.can_substitute.replace(!1,l.LITERAL),u.tmp.can_substitute.mystack.length===1&&(u.tmp.can_block_substitute=!1)},this.execs.push(r),e.build.name_flag=!1}t.push(this),(this.tokentype===l.END||this.tokentype===l.SINGLETON)&&(e.build.substitute_level.pop(),l.Util.substituteEnd.call(this,e,t))}};l.Node.number={build:function(e,t){var r;l.Util.substituteStart.call(this,e,t),this.strings.form==="roman"?this.formatter=e.fun.romanizer:this.strings.form==="ordinal"?this.formatter=e.fun.ordinalizer:this.strings.form==="long-ordinal"&&(this.formatter=e.fun.long_ordinalizer),typeof this.successor_prefix=="undefined"&&(this.successor_prefix=e[e.build.area].opt.layout_delimiter),typeof this.splice_prefix=="undefined"&&(this.splice_prefix=e[e.build.area].opt.layout_delimiter),r=function(i,s,a){if(this.variables.length!==0){var n;if(n=this.variables[0],typeof a=="undefined")var a={};if(["locator","locator-extra"].indexOf(n)>-1){if(i.tmp.just_looking||!a[n])return}else if(!s[n])return;n==="collection-number"&&s.type==="legal_case"&&(i.tmp.renders_collection_number=!0);var o=this;if(i.tmp.group_context.tip.force_suppress)return!1;if(["locator","locator-extra"].indexOf(n)>-1?i.processNumber.call(i,o,a,n,s.type):(!i.tmp.group_context.tip.condition&&s[n]&&(i.tmp.just_did_number=(""+s[n]).match(/[0-9]$/)),i.processNumber.call(i,o,s,n,s.type)),this.substring){var u=s[n].slice(this.substring);i.output.append(u,o)}else l.Util.outputNumericField(i,n,s.id);["locator","locator-extra"].indexOf(this.variables_real[0])>-1&&!i.tmp.just_looking&&(i.tmp.done_vars.push(this.variables_real[0]),i.tmp.group_context.tip.done_vars.push(this.variables_real[0]))}},this.execs.push(r),t.push(this),l.Util.substituteEnd.call(this,e,t)}};l.Node.sort={build:function(e,t){if(t=e[e.build.root+"_sort"].tokens,this.tokentype===l.START){e.build.area==="citation"&&(e.opt.sort_citations=!0),e.build.area=e.build.root+"_sort",e.build.extension="_sort";var r=function(i,s){if(i.opt.has_layout_locale){for(var a=l.localeResolve(s.language,i.opt["default-locale"][0]),n=i[i.tmp.area.slice(0,-5)].opt.sort_locales,o,u=0,c=n.length;u<c&&(o=n[u][a.bare],o||(o=n[u][a.best]),!o);u+=1);o||(o=i.opt["default-locale"][0]),i.tmp.lang_sort_hold=i.opt.lang,i.opt.lang=o}};this.execs.push(r)}if(this.tokentype===l.END){e.build.area=e.build.root,e.build.extension="";var r=function(s){s.opt.has_layout_locale&&(s.opt.lang=s.tmp.lang_sort_hold,delete s.tmp.lang_sort_hold)};this.execs.push(r)}t.push(this)}};l.Node.substitute={build:function(e,t){var r;if(this.tokentype===l.START){var i=new l.Token("choose",l.START);l.Node.choose.build.call(i,e,t);var s=new l.Token("if",l.SINGLETON);r=function(){return!!(e.tmp.value.length&&!e.tmp.common_term_match_fail)},s.tests=[r],s.test=e.fun.match.any(s,e,s.tests),t.push(s),r=function(n){n.tmp.can_block_substitute=!0,n.tmp.value.length&&!n.tmp.common_term_match_fail&&n.tmp.can_substitute.replace(!1,l.LITERAL),n.tmp.common_term_match_fail=!1},this.execs.push(r),t.push(this)}if(this.tokentype===l.END){t.push(this);var a=new l.Token("choose",l.END);l.Node.choose.build.call(a,e,t)}}};l.Node.text={build:function(e,t){var r,i,s,a,n,o,u,c,p,f,h,m;if(this.postponed_macro){var g=l.Util.cloneToken(this);g.name="group",g.tokentype=l.START,l.Node.group.build.call(g,e,t),l.expandMacro.call(e,this,t);var d=l.Util.cloneToken(this);d.name="group",d.tokentype=l.END,this.postponed_macro==="juris-locator-label"&&(d.isJurisLocatorLabel=!0),l.Node.group.build.call(d,e,t)}else{if(l.Util.substituteStart.call(this,e,t),this.variables_real||(this.variables_real=[]),this.variables||(this.variables=[]),i="long",s=0,this.strings.form&&(i=this.strings.form),this.strings.plural&&(s=this.strings.plural),this.variables_real[0]==="citation-number"||this.variables_real[0]==="year-suffix"||this.variables_real[0]==="citation-label")this.variables_real[0]==="citation-number"?(e.build.root==="citation"&&(e.opt.update_mode=l.NUMERIC),e.build.root==="bibliography"&&(e.opt.bib_mode=l.NUMERIC),e[e.tmp.area].opt.collapse==="citation-number"&&(this.range_prefix=e.getTerm("citation-range-delimiter")),this.successor_prefix=e[e.build.area].opt.layout_delimiter,this.splice_prefix=e[e.build.area].opt.layout_delimiter,r=function(w,S,T){if(a=""+S.id,!w.tmp.just_looking){if(w.tmp.area.slice(-5)==="_sort"&&this.variables[0]==="citation-number"){if(w.tmp.area==="bibliography_sort"&&w.tmp.group_context.tip.done_vars.push("citation-number"),w.tmp.area==="citation_sort"&&w.bibliography_sort.tmp.citation_number_map)var I=w.bibliography_sort.tmp.citation_number_map[w.registry.registry[S.id].seq];else var I=w.registry.registry[S.id].seq;I&&(I=l.Util.padding(""+I)),w.output.append(I,this);return}T&&T["author-only"]&&w.tmp.element_trace.replace("suppress-me"),w.tmp.area!=="bibliography_sort"&&w.bibliography_sort.tmp.citation_number_map&&w.bibliography_sort.opt.citation_number_sort_direction===l.DESCENDING?I=w.bibliography_sort.tmp.citation_number_map[w.registry.registry[a].seq]:I=w.registry.registry[a].seq,w.opt.citation_number_slug?w.output.append(w.opt.citation_number_slug,this):(o=new l.NumericBlob(w,!1,I,this,S.id),w.tmp.in_cite_predecessor&&(o.suppress_splice_prefix=!0),w.output.append(o,"literal"))}},this.execs.push(r)):this.variables_real[0]==="year-suffix"?(e.opt.has_year_suffix=!0,e[e.tmp.area].opt.collapse==="year-suffix-ranged"&&(this.range_prefix=e.getTerm("citation-range-delimiter")),this.successor_prefix=e[e.build.area].opt.layout_delimiter,e[e.tmp.area].opt["year-suffix-delimiter"]&&(this.successor_prefix=e[e.build.area].opt["year-suffix-delimiter"]),r=function(w,S){if(w.registry.registry[S.id]&&w.registry.registry[S.id].disambig.year_suffix!==!1&&!w.tmp.just_looking){n=parseInt(w.registry.registry[S.id].disambig.year_suffix,10),w[w.tmp.area].opt.cite_group_delimiter&&(this.successor_prefix=w[w.tmp.area].opt.cite_group_delimiter),o=new l.NumericBlob(w,!1,n,this,S.id),u=new l.Util.Suffixator(l.SUFFIX_CHARS),o.setFormatter(u),w.output.append(o,"literal"),c=!1;for(var T=0,I=w.tmp.group_context.mystack.length;T<I;T++){var C=w.tmp.group_context.mystack[T];if(!C.variable_success&&(C.variable_attempt||!C.variable_attempt&&!C.term_intended)){c=!0;break}}p=w[w.tmp.area].opt["year-suffix-delimiter"],c&&p&&!w.tmp.sort_key_flag&&(w.tmp.splice_delimiter=w[w.tmp.area].opt["year-suffix-delimiter"])}},this.execs.push(r)):this.variables_real[0]==="citation-label"&&(e.build.root==="bibliography"&&(e.opt.bib_mode=l.TRIGRAPH),e.opt.has_year_suffix=!0,r=function(w,S){f=S["citation-label"],f||(f=w.getCitationLabel(S)),w.tmp.just_looking||(h="",w.registry.registry[S.id]&&w.registry.registry[S.id].disambig.year_suffix!==!1&&(n=parseInt(w.registry.registry[S.id].disambig.year_suffix,10),h=w.fun.suffixator.format(n)),f+=h),w.output.append(f,this)},this.execs.push(r));else if(this.strings.term)r=function(w,S){var T=w.opt.gender[S.type],I=this.strings.term;I=w.getTerm(I,i,s,T,l.TOLERANT,this.default_locale);var C;if(I!==""&&(w.tmp.group_context.tip.term_intended=!0),l.UPDATE_GROUP_CONTEXT_CONDITION(w,I,null,this),!w.tmp.term_predecessor&&!(w.opt.class==="in-text"&&w.tmp.area==="citation")?C=l.Output.Formatters["capitalize-first"](w,I):C=I,w.tmp.strip_periods)C=C.replace(/\./g,"");else for(var A=0,y=this.decorations.length;A<y;A+=1)if(this.decorations[A][0]==="@strip-periods"&&this.decorations[A][1]==="true"){C=C.replace(/\./g,"");break}w.output.append(C,this),w.tmp.can_block_substitute&&w.tmp.can_substitute.replace(!1,l.LITERAL)},this.execs.push(r),e.build.term=!1,e.build.form=!1,e.build.plural=!1;else if(this.variables_real.length){if(r=function(w,S){this.variables_real[0]!=="locator"&&(w.tmp.have_collapsed=!1),!w.tmp.group_context.tip.condition&&S[this.variables[0]]&&(w.tmp.just_did_number=!1);var T=S[this.variables[0]];T&&!w.tmp.group_context.tip.condition&&((""+T).slice(-1).match(/[0-9]/)?w.tmp.just_did_number=!0:w.tmp.just_did_number=!1)},this.execs.push(r),l.MULTI_FIELDS.indexOf(this.variables_real[0])>-1||this.variables_real[0].indexOf("-main")>-1||this.variables_real[0].indexOf("-sub")>-1||["language-name","language-name-original"].indexOf(this.variables_real[0])>-1){var v=this.variables[0],b=!1,E=!1,x=!1;i==="short"?this.variables_real[0].slice(-6)!=="-short"&&(E=this.variables_real[0]+"-short"):v=!1,e.build.extension?x=!0:(x=!0,b=!0),r=e.transform.getOutputFunction(this.variables,v,b,E,x)}else l.CITE_FIELDS.indexOf(this.variables_real[0])>-1?r=function(w,S,T){T&&T[this.variables[0]]&&(w.processNumber(this,T,this.variables[0],S.type),l.Util.outputNumericField(w,this.variables[0],S.id),["locator","locator-extra"].indexOf(this.variables_real[0])>-1&&!w.tmp.just_looking&&w.tmp.done_vars.push(this.variables_real[0]))}:["page","page-first","chapter-number","collection-number","edition","issue","number","number-of-pages","number-of-volumes","volume"].indexOf(this.variables_real[0])>-1?r=function(w,S){w.processNumber(this,S,this.variables[0],S.type),l.Util.outputNumericField(w,this.variables[0],S.id)}:["URL","DOI"].indexOf(this.variables_real[0])>-1?r=function(w,S){var T;if(this.variables[0]&&(T=w.getVariable(S,this.variables[0],i),T))if(this.variables[0]==="URL"&&i==="short"&&(T=T.replace(/(.*\.[^\/]+)\/.*/,"$1"),T.match(/\/\/www\./)&&(T=T.replace(/https?:\/\//,""))),w.opt.development_extensions.wrap_url_and_doi)if(!this.decorations.length||this.decorations[0][0]!=="@"+this.variables[0]){var I=l.Util.cloneToken(this),C=new l.Blob(null,null,"url-wrapper");if(C.decorations.push(["@DOI","true"]),this.variables_real[0]==="DOI"){var A;this.strings.prefix&&this.strings.prefix.match(/^.*https:\/\/doi\.org\/$/)&&(T=T.replace(/^https?:\/\/doi\.org\//,""),T.match(/^https?:\/\//)?A="":A="https://doi.org/",I.strings.prefix=this.strings.prefix.slice(0,I.strings.prefix.length-16));var y=new l.Blob(A),_=new l.Blob(T);C.push(y),C.push(_),w.output.append(C,I,!1,!1,!0)}else{var _=new l.Blob(T);C.push(_),w.output.append(C,I,!1,!1,!0)}}else w.output.append(T,this,!1,!1,!0);else{if(this.decorations.length)for(var k=this.decorations.length-1;k>-1;k--)this.decorations[k][0]==="@"+this.variables[0]&&(this.decorations=this.decorations.slice(0,k).concat(this.decorations.slice(k+1)));w.output.append(T,this,!1,!1,!0)}}:this.variables_real[0]==="section"?r=function(w,S){var T;T=w.getVariable(S,this.variables[0],i),T&&w.output.append(T,this)}:this.variables_real[0]==="hereinafter"?r=function(w,S){var T=w.transform.abbrevs.default.hereinafter[S.id];T&&(w.output.append(T,this),w.tmp.group_context.tip.variable_success=!0)}:r=function(w,S){var T;this.variables[0]&&(T=w.getVariable(S,this.variables[0],i),T&&(T=""+T,T=T.split("\\").join(""),w.output.append(T,this)))};this.execs.push(r)}else this.strings.value&&(r=function(w){w.tmp.group_context.tip.term_intended=!0,l.UPDATE_GROUP_CONTEXT_CONDITION(w,this.strings.value,!0,this),w.output.append(this.strings.value,this),w.tmp.can_block_substitute&&w.tmp.can_substitute.replace(!1,l.LITERAL)},this.execs.push(r));t.push(this),l.Util.substituteEnd.call(this,e,t)}}};l.Node.intext={build:function(e,t){if(this.tokentype===l.START){e.build.area="intext",e.build.root="intext",e.build.extension="";var r=function(i,s){i.tmp.area="intext",i.tmp.root="intext",i.tmp.extension=""};this.execs.push(r)}this.tokentype===l.END&&(e.intext_sort={opt:{sort_directions:e.citation_sort.opt.sort_directions}},e.intext.srt=e.citation.srt),t.push(this)}};l.Attributes={};l.Attributes["@disambiguate"]=function(e,t){if(this.tests||(this.tests=[]),t==="true"){e.opt.has_disambiguate=!0;var r=function(i){if(e.tmp.area==="bibliography"){if(e.tmp.disambiguate_count<e.registry.registry[i.id].disambig.disambiguate)return e.tmp.disambiguate_count+=1,!0}else if(e.tmp.disambiguate_maxMax+=1,e.tmp.disambig_settings.disambiguate&&e.tmp.disambiguate_count<e.tmp.disambig_settings.disambiguate)return e.tmp.disambiguate_count+=1,!0;return!1};this.tests.push(r)}else if(t==="check-ambiguity-and-backreference"){var r=function(s){return!!(e.registry.registry[s.id].disambig.disambiguate&&e.registry.registry[s.id]["citation-count"]>1)};this.tests.push(r)}};l.Attributes["@is-numeric"]=function(e,t){this.tests||(this.tests=[]);for(var r=t.split(/\s+/),i=function(a){return function(n,o){var u=n;if(o&&["locator","locator-extra"].indexOf(a)>-1&&(u=o),!u[a])return!1;if(l.NUMERIC_VARIABLES.indexOf(a)>-1){if(e.tmp.shadow_numbers[a]||e.processNumber(!1,u,a,n.type),e.tmp.shadow_numbers[a].numeric)return!0}else if(["title","version"].indexOf(a)>-1&&u[a].slice(-1)===""+parseInt(u[a].slice(-1),10))return!0;return!1}},s=0;s<r.length;s+=1)this.tests.push(i(r[s]))};l.Attributes["@is-uncertain-date"]=function(e,t){this.tests||(this.tests=[]);for(var r=t.split(/\s+/),i=function(n){return function(o){return!!(o[n]&&o[n].circa)}},s=0,a=r.length;s<a;s+=1)this.tests.push(i(r[s]))};l.Attributes["@locator"]=function(e,t){this.tests||(this.tests=[]);var r=t.replace("sub verbo","sub-verbo");r=r.split(/\s+/);for(var i=function(n){return function(o,u){var c;return e.processNumber(!1,u,"locator"),c=e.tmp.shadow_numbers.locator.label,!!(c&&n===c)}},s=0,a=r.length;s<a;s+=1)this.tests.push(i(r[s]))};l.Attributes["@position"]=function(e,t){this.tests||(this.tests=[]);var r;e.opt.update_mode=l.POSITION;for(var i=t.split(/\s+/),s=function(c,p){return!!(p&&l.POSITION_MAP[p.position]>=l.POSITION_MAP[l.POSITION_SUBSEQUENT]&&p["near-note"])},a=function(c,p){return!!(p&&l.POSITION_MAP[p.position]==l.POSITION_MAP[l.POSITION_SUBSEQUENT]&&!p["near-note"])},n=function(c){return function(p,f){if(e.tmp.area==="bibliography")return!1;if(f&&typeof f.position=="undefined"&&(f.position=0),f&&typeof f.position=="number"){if(f.position===0&&c===0)return!0;if(c>0&&l.POSITION_MAP[f.position]>=l.POSITION_MAP[c])return!0}else if(c===0)return!0;return!1}},o=0,u=i.length;o<u;o+=1){var r=i[o];r==="first"?r=l.POSITION_FIRST:r==="container-subsequent"?r=l.POSITION_CONTAINER_SUBSEQUENT:r==="subsequent"?r=l.POSITION_SUBSEQUENT:r==="ibid"?r=l.POSITION_IBID:r==="ibid-with-locator"&&(r=l.POSITION_IBID_WITH_LOCATOR),r==="near-note"?this.tests.push(s):r==="far-note"?this.tests.push(a):this.tests.push(n(r))}};l.Attributes["@type"]=function(e,t){this.tests||(this.tests=[]);for(var r=t.split(/\s+/),i=function(o){return function(u){var c=u.type===o;return!!c}},s=[],a=0,n=r.length;a<n;a+=1)s.push(i(r[a]));this.tests.push(e.fun.match.any(this,e,s))};l.Attributes["@variable"]=function(e,t){this.tests||(this.tests=[]);var r;if(this.variables=t.split(/\s+/),this.variables_real=this.variables.slice(),this.name==="label"&&this.variables[0])this.strings.term=this.variables[0];else if(["names","date","text","number"].indexOf(this.name)>-1)r=function(n,o,u){for(var c=this.variables.length-1;c>-1;c+=-1)this.variables.pop();for(var c=0,p=this.variables_real.length;c<p;c++)n.tmp.done_vars.indexOf(this.variables_real[c])===-1&&this.variables.push(this.variables_real[c]),n.tmp.can_block_substitute&&n.tmp.done_vars.push(this.variables_real[c])},this.execs.push(r),r=function(n,o,u){for(var c=!1,p=0,f=this.variables.length;p<f;p++){var h=this.variables[p];if(["authority","committee"].indexOf(h)>-1&&typeof o[h]=="string"&&this.name==="names"){var m=!0,g=o[h].split(/\s*;\s*/),d={};if(o.multi&&o.multi._keys[h]){for(var v in o.multi._keys[h])if(d[v]=o.multi._keys[h][v].split(/\s*;\s*/),d[v].length!==g.length){m=!1;break}}m||(g=[o[h]],d=o.multi._keys[h]);for(var b=0,E=g.length;b<E;b++){var x={literal:g[b],multi:{_key:{}}};for(var v in d){var w={literal:d[v][b]};x.multi._key[v]=w}g[b]=x}o[h]=g}if(this.strings.form==="short"&&!o[h]&&(h==="title"?h="title-short":h==="container-title"&&(h="container-title-short")),h==="year-suffix"){c=!0;break}else if(l.DATE_VARIABLES.indexOf(h)>-1){if(n.opt.development_extensions.locator_date_and_revision&&h==="locator-date"){c=!0;break}if(o[h]){for(var S in o[h])if(!(this.dateparts.indexOf(S)===-1&&S!=="literal")&&o[h][S]){c=!0;break}if(c)break}}else if(h==="locator"){u&&u.locator&&(c=!0);break}else if(h==="locator-extra"){u&&u["locator-extra"]&&(c=!0);break}else if(["citation-number","citation-label"].indexOf(h)>-1){c=!0;break}else if(h==="first-reference-note-number"){u&&u["first-reference-note-number"]&&(c=!0);break}else if(h==="first-container-reference-note-number"){u&&u["first-container-reference-note-number"]&&(c=!0);break}else if(h==="hereinafter"){n.transform.abbrevs.default.hereinafter[o.id]&&n.sys.getAbbreviation&&o.id&&(c=!0);break}else{if(typeof o[h]=="object")break;if(typeof o[h]=="string"&&o[h]){c=!0;break}else if(typeof o[h]=="number"){c=!0;break}}if(c)break}if(c){for(var p=0,f=this.variables_real.length;p<f;p++){var h=this.variables_real[p];(h!=="citation-number"||n.tmp.area!=="bibliography")&&(n.tmp.cite_renders_content=!0),n.tmp.group_context.tip.variable_success=!0,n.tmp.can_substitute.value()&&n.tmp.area==="bibliography"&&typeof o[h]=="string"&&(n.tmp.name_node.top=n.output.current.value(),n.tmp.rendered_name.push(o[h]))}n.tmp.can_substitute.replace(!1,l.LITERAL)}else n.tmp.group_context.tip.variable_attempt=!0},this.execs.push(r);else if(["if","else-if","condition"].indexOf(this.name)>-1)for(var i=function(n){return function(o,u){var c=o;if(u&&["locator","locator-extra","first-reference-note-number","first-container-reference-note-number","locator-date"].indexOf(n)>-1&&(c=u),n==="hereinafter"&&e.sys.getAbbreviation&&c.id){if(e.transform.abbrevs.default.hereinafter[c.id])return!0}else if(c[n]){if(typeof c[n]=="number"||typeof c[n]=="string")return!0;if(typeof c[n]=="object"){for(var p in c[n])if(c[n][p])return!0}}return!1}},s=0,a=this.variables.length;s<a;s+=1)this.tests.push(i(this.variables[s]))};l.Attributes["@page"]=function(e,t){this.tests||(this.tests=[]);var r=t.replace("sub verbo","sub-verbo");r=r.split(/\s+/);for(var i=function(n){return function(o){var u;return e.processNumber(!1,o,"page",o.type),e.tmp.shadow_numbers.page.label?e.tmp.shadow_numbers.page.label==="sub verbo"?u="sub-verbo":u=e.tmp.shadow_numbers.page.label:u="page",e.tmp.shadow_numbers.page.values.length>0&&e.tmp.shadow_numbers.page.values[0].gotosleepability&&(e.tmp.shadow_numbers.page.values[0].labelVisibility=!1),n===u}},s=0,a=r.length;s<a;s+=1)this.tests.push(i(r[s]))};l.Attributes["@number"]=function(e,t){this.tests||(this.tests=[]);for(var r=t.split(/\s+/),i=function(n){return function(o){var u;return e.processNumber(!1,o,"number",o.type),e.tmp.shadow_numbers.number.label?u=e.tmp.shadow_numbers.number.label:u="number",n===u}},s=0,a=r.length;s<a;s+=1)this.tests.push(i(r[s]))};l.Attributes["@jurisdiction"]=function(e,t){this.tests||(this.tests=[]);var r=t.split(/\s+/),i=function(s){return function(a){if(!a.jurisdiction)return!1;for(var n=a.jurisdiction,o=0,u=s.length;o<u;o++)if(n===s[o])return!0;return!1}};this.tests.push(i(r))};l.Attributes["@country"]=function(e,t){this.tests||(this.tests=[]);var r=t.split(/\s+/),i=function(s){return function(a){if(!a.country)return!1;for(var n=a.country,o=0,u=s.length;o<u;o++)if(n===s[o])return!0;return!1}};this.tests.push(i(r))};l.Attributes["@context"]=function(e,t){this.tests||(this.tests=[]);var r=function(){if(["bibliography","citation"].indexOf(t)>-1){var i=e.tmp.area.slice(0,t.length);return i===t}else if(t==="alternative")return!!e.tmp.abort_alternative};this.tests.push(r)};l.Attributes["@has-year-only"]=function(e,t){this.tests||(this.tests=[]);for(var r=t.split(/\s+/),i=function(n){return function(o){var u=o[n];return!(!u||u.month||u.season)}},s=0,a=r.length;s<a;s+=1)this.tests.push(i(r[s]))};l.Attributes["@has-to-month-or-season"]=function(e,t){this.tests||(this.tests=[]);for(var r=t.split(/\s+/),i=function(n){return function(o){var u=o[n];return!(!u||!u.month&&!u.season||u.day)}},s=0,a=r.length;s<a;s+=1)this.tests.push(i(r[s]))};l.Attributes["@has-day"]=function(e,t){this.tests||(this.tests=[]);for(var r=t.split(/\s+/),i=function(n){return function(o){var u=o[n];return!(!u||!u.day)}},s=0,a=r.length;s<a;s+=1)this.tests.push(i(r[s]))};l.Attributes["@is-plural"]=function(e,t){this.tests||(this.tests=[]);var r=function(i){var s=i[t];if(s&&s.length){for(var a=0,n=0,o=!1,u=0,c=s.length;u<c;u+=1)e.opt.development_extensions.spoof_institutional_affiliations&&(s[u].literal||s[u].isInstitution&&s[u].family&&!s[u].given)?(n+=1,o=!1):(a+=1,o=!0);if(a>1)return!0;if(n>1)return!0;if(n&&o)return!0}return!1};this.tests.push(r)};l.Attributes["@is-multiple"]=function(e,t){this.tests||(this.tests=[]);var r=function(i){var s=""+i[t],a=s.split(/(?:,\s|\s(?:tot\sen\smet|ldz|oraz|and|bis|||och|a|do|en|et|in|ir|ja|og|sa|to|un|und|s|i|i|u|y||e|a||-|)\s||\&)/);return a.length>1};this.tests.push(r)};l.Attributes["@locale"]=function(e,t){this.tests||(this.tests=[]);var r,i,s,a,n,o,u=e.opt["default-locale"][0];if(this.name==="layout"){if(this.locale_raw=t,this.tokentype===l.START){e.opt.multi_layout||(e.opt.multi_layout=[]);var c=[],p=t.split(/\s+/),f={},h=l.localeResolve(p[0],u);c.push(h),h.generic?f[h.generic]=h.best:f[h.best]=h.best;for(var n=1,o=p.length;n<o;n+=1){var m=l.localeResolve(p[n],u);c.push(m),m.generic?f[m.generic]=h.best:f[m.best]=h.best}e[e.build.area].opt.sort_locales.push(f),e.opt.multi_layout.push(c)}e.opt.has_layout_locale=!0}else{a=t.split(/\s+/);var g=[];for(n=0,o=a.length;n<o;n+=1)s=a[n],i=l.localeResolve(s,u),a[n].length===2&&g.push(i.bare),e.localeConfigure(i,!0),a[n]=i;var d=a.slice(),v=function(b,E,x){return function(w){var S;r=[],S=!1;var T=!1,I;for(w.language?I=w.language:I=E,T=l.localeResolve(I,E),n=0,o=b.length;n<o;n+=1)if(T.best===b[n].best){e.tmp.condition_lang_counter_arr.push(e.tmp.condition_counter),e.tmp.condition_lang_val_arr.push(e.opt.lang),e.opt.lang=b[0].best,S=!0;break}return!S&&x.indexOf(T.bare)>-1&&(e.tmp.condition_lang_counter_arr.push(e.tmp.condition_counter),e.tmp.condition_lang_val_arr.push(e.opt.lang),e.opt.lang=b[0].best,S=!0),S}};this.tests.push(v(d,u,g))}};l.Attributes["@alternative-node-internal"]=function(e){this.tests||(this.tests=[]);var t=function(){return function(){return!e.tmp.abort_alternative}},r=this;this.tests.push(t(r))};l.Attributes["@locale-internal"]=function(e,t){this.tests||(this.tests=[]);var r,i,s,a,n;for(s=t.split(/\s+/),this.locale_bares=[],a=0,n=s.length;a<n;a+=1)i=s[a],r=l.localeResolve(i,e.opt["default-locale"][0]),s[a].length===2&&this.locale_bares.push(r.bare),e.localeConfigure(r),s[a]=r;this.locale_default=e.opt["default-locale"][0],this.locale=s[0].best,this.locale_list=s.slice();var o=function(c){return function(p){var f,h;f=[],h=!1;var m=!1;if(p.language&&(i=p.language,m=l.localeResolve(i,e.opt["default-locale"][0]),m.best===e.opt["default-locale"][0]&&(m=!1)),m){for(a=0,n=c.locale_list.length;a<n;a+=1)if(m.best===c.locale_list[a].best){e.opt.lang=c.locale,e.tmp.last_cite_locale=c.locale,e.output.openLevel("empty"),e.output.current.value().new_locale=c.locale,h=!0;break}!h&&c.locale_bares.indexOf(m.bare)>-1&&(e.opt.lang=c.locale,e.tmp.last_cite_locale=c.locale,e.output.openLevel("empty"),e.output.current.value().new_locale=c.locale,h=!0)}return h}},u=this;this.tests.push(o(u))};l.Attributes["@court-class"]=function(e,t){this.tests||(this.tests=[]);for(var r=t.split(/\s+/),i=function(n){return function(o){var u=l.GET_COURT_CLASS(e,o);return u===n}},s=0,a=r.length;s<a;s++)this.tests.push(i(r[s]))};l.Attributes["@container-multiple"]=function(e,t){this.tests||(this.tests=[]);var r=t==="true",i=function(s){return function(a){if(e.tmp.container_item_count[a.container_id]){if(e.tmp.container_item_count[a.container_id]>1)return s}else return!s;return!s}};this.tests.push(i(r))};l.Attributes["@container-subsequent"]=function(e,t){this.tests||(this.tests=[]);var r=t==="true",i=function(s){return function(a){return e.tmp.container_item_pos[a.container_id]>1?s:!s}};this.tests.push(i(r))};l.Attributes["@has-subunit"]=function(e,t){this.tests||(this.tests=[]);var r=function(i){return function(s){var a=0;for(var n in s[i]){var o=s[i][n];if(!o.given){var u=o.literal?o.literal:o.family,c=u.split("|").length;(a===0||c<a)&&(a=c)}}return a>1}};this.tests.push(r(t))};l.Attributes["@cite-form"]=function(e,t){this.tests||(this.tests=[]);var r=function(i){return function(s){return s["cite-form"]===i}};this.tests.push(r(t))};l.Attributes["@disable-duplicate-year-suppression"]=function(e,t){e.opt.disable_duplicate_year_suppression=t.split(/\s+/)};l.Attributes["@consolidate-containers"]=function(e,t){l.Attributes["@track-containers"](e,t);var r=t.split(/\s+/);e.bibliography.opt.consolidate_containers=r};l.Attributes["@track-containers"]=function(e,t){var r=t.split(/\s+/);e.bibliography.opt.track_container_items||(e.bibliography.opt.track_container_items=[]),e.bibliography.opt.consolidate_containers||(e.bibliography.opt.consolidate_containers=[]),e.bibliography.opt.track_container_items=e.bibliography.opt.track_container_items.concat(r)};l.Attributes["@parallel-first"]=function(e,t){e.opt.parallel.enable=!0;var r=t.split(/\s+/);e.opt.track_repeat||(e.opt.track_repeat={}),this.parallel_first={};for(var i in r){var s=r[i];this.parallel_first[s]=!0,e.opt.track_repeat[s]=!0}};l.Attributes["@parallel-last"]=function(e,t){e.opt.parallel.enable=!0;var r=t.split(/\s+/);e.opt.track_repeat||(e.opt.track_repeat={}),this.parallel_last={};for(var i in r){var s=r[i];this.parallel_last[s]=!0,e.opt.track_repeat[s]=!0}};l.Attributes["@parallel-last-to-first"]=function(e,t){e.opt.parallel.enable=!0;var r=t.split(/\s+/);this.parallel_last_to_first={};for(var i=0,s=r.length;i<s;i++)this.parallel_last_to_first[r[i]]=!0};l.Attributes["@parallel-delimiter-override"]=function(e,t){e.opt.parallel.enable=!0,this.strings.set_parallel_delimiter_override=t};l.Attributes["@parallel-delimiter-override-on-suppress"]=function(e,t){e.opt.parallel.enable=!0,this.strings.set_parallel_delimiter_override_on_suppress=t};l.Attributes["@no-repeat"]=function(e,t){e.opt.parallel.enable=!0;var r=t.split(/\s+/);e.opt.track_repeat||(e.opt.track_repeat={}),this.non_parallel={};for(var i in r){var s=r[i];this.non_parallel[s]=!0,e.opt.track_repeat[s]=!0}};l.Attributes["@require"]=function(e,t){e.opt.use_context_condition=!0,this.strings.require=t};l.Attributes["@reject"]=function(e,t){e.opt.use_context_condition=!0,this.strings.reject=t};l.Attributes["@require-comma-on-symbol"]=function(e,t){e.opt.require_comma_on_symbol=t};l.Attributes["@gender"]=function(e,t){this.gender=t};l.Attributes["@cslid"]=function(e,t){this.cslid=parseInt(t,10)};l.Attributes["@capitalize-if-first"]=function(e,t){this.strings.capitalize_if_first_override=t};l.Attributes["@label-capitalize-if-first"]=function(e,t){this.strings.label_capitalize_if_first_override=t};l.Attributes["@label-form"]=function(e,t){this.strings.label_form_override=t};l.Attributes["@part-separator"]=function(e,t){this.strings["part-separator"]=t};l.Attributes["@leading-noise-words"]=function(e,t){this["leading-noise-words"]=t};l.Attributes["@name-never-short"]=function(e,t){this["name-never-short"]=t};l.Attributes["@class"]=function(e,t){e.opt.class=t};l.Attributes["@version"]=function(e,t){e.opt.version=t};l.Attributes["@value"]=function(e,t){this.strings.value=t};l.Attributes["@name"]=function(e,t){this.strings.name=t};l.Attributes["@form"]=function(e,t){this.strings.form=t};l.Attributes["@date-parts"]=function(e,t){this.strings["date-parts"]=t};l.Attributes["@range-delimiter"]=function(e,t){this.strings["range-delimiter"]=t};l.Attributes["@macro"]=function(e,t){this.postponed_macro=t};l.Attributes["@term"]=function(e,t){t==="sub verbo"?this.strings.term="sub-verbo":this.strings.term=t};l.Attributes["@xmlns"]=function(){};l.Attributes["@lang"]=function(e,t){t&&(e.build.lang=t)};l.Attributes["@lingo"]=function(){};l.Attributes["@macro-has-date"]=function(){this["macro-has-date"]=!0};l.Attributes["@suffix"]=function(e,t){this.strings.suffix=t};l.Attributes["@prefix"]=function(e,t){this.strings.prefix=t};l.Attributes["@delimiter"]=function(e,t){this.strings.delimiter=t};l.Attributes["@match"]=function(e,t){this.match=t};l.Attributes["@names-min"]=function(e,t){var r=parseInt(t,10);e[e.build.area].opt.max_number_of_names<r&&(e[e.build.area].opt.max_number_of_names=r),this.strings["et-al-min"]=r};l.Attributes["@names-use-first"]=function(e,t){this.strings["et-al-use-first"]=parseInt(t,10)};l.Attributes["@names-use-last"]=function(e,t){t==="true"?this.strings["et-al-use-last"]=!0:this.strings["et-al-use-last"]=!1};l.Attributes["@sort"]=function(e,t){t==="descending"&&(this.strings.sort_direction=l.DESCENDING)};l.Attributes["@plural"]=function(e,t){t==="always"||t==="true"?this.strings.plural=1:t==="never"||t==="false"?this.strings.plural=0:t==="contextual"&&(this.strings.plural=!1)};l.Attributes["@has-publisher-and-publisher-place"]=function(){this.strings["has-publisher-and-publisher-place"]=!0};l.Attributes["@publisher-delimiter-precedes-last"]=function(e,t){this.strings["publisher-delimiter-precedes-last"]=t};l.Attributes["@publisher-delimiter"]=function(e,t){this.strings["publisher-delimiter"]=t};l.Attributes["@publisher-and"]=function(e,t){this.strings["publisher-and"]=t};l.Attributes["@givenname-disambiguation-rule"]=function(e,t){l.GIVENNAME_DISAMBIGUATION_RULES.indexOf(t)>-1&&(e.citation.opt["givenname-disambiguation-rule"]=t)};l.Attributes["@collapse"]=function(e,t){t&&(e[this.name].opt.collapse=t)};l.Attributes["@cite-group-delimiter"]=function(e,t){t&&(e[e.tmp.area].opt.cite_group_delimiter=t)};l.Attributes["@names-delimiter"]=function(e,t){e.setOpt(this,"names-delimiter",t)};l.Attributes["@name-form"]=function(e,t){e.setOpt(this,"name-form",t)};l.Attributes["@subgroup-delimiter"]=function(e,t){this.strings["subgroup-delimiter"]=t};l.Attributes["@subgroup-delimiter-precedes-last"]=function(e,t){this.strings["subgroup-delimiter-precedes-last"]=t};l.Attributes["@name-delimiter"]=function(e,t){e.setOpt(this,"name-delimiter",t)};l.Attributes["@et-al-min"]=function(e,t){var r=parseInt(t,10);e[e.build.area].opt.max_number_of_names<r&&(e[e.build.area].opt.max_number_of_names=r),e.setOpt(this,"et-al-min",r)};l.Attributes["@et-al-use-first"]=function(e,t){e.setOpt(this,"et-al-use-first",parseInt(t,10))};l.Attributes["@et-al-use-last"]=function(e,t){t==="true"?e.setOpt(this,"et-al-use-last",!0):e.setOpt(this,"et-al-use-last",!1)};l.Attributes["@et-al-subsequent-min"]=function(e,t){var r=parseInt(t,10);e[e.build.area].opt.max_number_of_names<r&&(e[e.build.area].opt.max_number_of_names=r),e.setOpt(this,"et-al-subsequent-min",r)};l.Attributes["@et-al-subsequent-use-first"]=function(e,t){e.setOpt(this,"et-al-subsequent-use-first",parseInt(t,10))};l.Attributes["@suppress-min"]=function(e,t){this.strings["suppress-min"]=parseInt(t,10)};l.Attributes["@suppress-max"]=function(e,t){this.strings["suppress-max"]=parseInt(t,10)};l.Attributes["@and"]=function(e,t){e.setOpt(this,"and",t)};l.Attributes["@delimiter-precedes-last"]=function(e,t){e.setOpt(this,"delimiter-precedes-last",t)};l.Attributes["@delimiter-precedes-et-al"]=function(e,t){e.setOpt(this,"delimiter-precedes-et-al",t)};l.Attributes["@initialize-with"]=function(e,t){e.setOpt(this,"initialize-with",t)};l.Attributes["@initialize"]=function(e,t){t==="false"&&e.setOpt(this,"initialize",!1)};l.Attributes["@name-as-reverse-order"]=function(e,t){this["name-as-reverse-order"]=t};l.Attributes["@name-as-sort-order"]=function(e,t){this.name==="style-options"?this["name-as-sort-order"]=t:e.setOpt(this,"name-as-sort-order",t)};l.Attributes["@sort-separator"]=function(e,t){e.setOpt(this,"sort-separator",t)};l.Attributes["@require-match"]=function(e,t){t==="true"&&(this.requireMatch=!0)};l.Attributes["@exclude-types"]=function(e,t){e.bibliography.opt.exclude_types=t.split(/\s+/)};l.Attributes["@exclude-with-fields"]=function(e,t){e.bibliography.opt.exclude_with_fields=t.split(/\s+/)};l.Attributes["@year-suffix-delimiter"]=function(e,t){e[this.name].opt["year-suffix-delimiter"]=t};l.Attributes["@after-collapse-delimiter"]=function(e,t){e[this.name].opt["after-collapse-delimiter"]=t};l.Attributes["@subsequent-author-substitute"]=function(e,t){e[this.name].opt["subsequent-author-substitute"]=t};l.Attributes["@subsequent-author-substitute-rule"]=function(e,t){e[this.name].opt["subsequent-author-substitute-rule"]=t};l.Attributes["@disambiguate-add-names"]=function(e,t){t==="true"&&(e.opt["disambiguate-add-names"]=!0)};l.Attributes["@disambiguate-add-givenname"]=function(e,t){t==="true"&&(e.opt["disambiguate-add-givenname"]=!0)};l.Attributes["@disambiguate-add-year-suffix"]=function(e,t){t==="true"&&e.opt.xclass!=="numeric"&&(e.opt["disambiguate-add-year-suffix"]=!0)};l.Attributes["@second-field-align"]=function(e,t){(t==="flush"||t==="margin")&&(e[this.name].opt["second-field-align"]=t)};l.Attributes["@hanging-indent"]=function(e,t){t==="true"&&(e.opt.development_extensions.hanging_indent_legacy_number?e[this.name].opt.hangingindent=2:e[this.name].opt.hangingindent=!0)};l.Attributes["@line-spacing"]=function(e,t){t&&t.match(/^[.0-9]+$/)&&(e[this.name].opt["line-spacing"]=parseFloat(t,10))};l.Attributes["@entry-spacing"]=function(e,t){t&&t.match(/^[.0-9]+$/)&&(e[this.name].opt["entry-spacing"]=parseFloat(t,10))};l.Attributes["@near-note-distance"]=function(e,t){e[this.name].opt["near-note-distance"]=parseInt(t,10)};l.Attributes["@substring"]=function(e,t){this.substring=parseInt(t,10)};l.Attributes["@text-case"]=function(e,t){var r=function(i,s){t==="normal"?this.text_case_normal=!0:(this.strings["text-case"]=t,t==="title"&&s.jurisdiction&&(this.strings["text-case"]="passthrough"))};this.execs.push(r)};l.Attributes["@page-range-format"]=function(e,t){e.opt["page-range-format"]=t};l.Attributes["@year-range-format"]=function(e,t){e.opt["year-range-format"]=t};l.Attributes["@default-locale"]=function(e,t){if(this.name==="style"){var r,i,s,n,a,n=t.match(/-x-(sort|translit|translat)-/g);if(n)for(s=0,i=n.length;s<i;s+=1)n[s]=n[s].replace(/^-x-/,"").replace(/-$/,"");for(r=t.split(/-x-(?:sort|translit|translat)-/),a=[r[0]],s=1,i=r.length;s<i;s+=1)a.push(n[s-1]),a.push(r[s]);for(r=a.slice(),i=r.length,s=1;s<i;s+=2)e.opt["locale-"+r[s]].push(r[s+1].replace(/^\s*/g,"").replace(/\s*$/g,""));r.length?e.opt["default-locale"]=r.slice(0,1):e.opt["default-locale"]=["en"]}else t==="true"&&(this.default_locale=!0)};l.Attributes["@default-locale-sort"]=function(e,t){e.opt["default-locale-sort"]=t};l.Attributes["@demote-non-dropping-particle"]=function(e,t){e.opt["demote-non-dropping-particle"]=t};l.Attributes["@initialize-with-hyphen"]=function(e,t){t==="false"&&(e.opt["initialize-with-hyphen"]=!1)};l.Attributes["@institution-parts"]=function(e,t){this.strings["institution-parts"]=t};l.Attributes["@if-short"]=function(e,t){t==="true"&&(this.strings["if-short"]=!0)};l.Attributes["@substitute-use-first"]=function(e,t){this.strings["substitute-use-first"]=parseInt(t,10)};l.Attributes["@use-first"]=function(e,t){this.strings["use-first"]=parseInt(t,10)};l.Attributes["@use-last"]=function(e,t){this.strings["use-last"]=parseInt(t,10)};l.Attributes["@stop-first"]=function(e,t){this.strings["stop-first"]=parseInt(t,10)};l.Attributes["@stop-last"]=function(e,t){this.strings["stop-last"]=parseInt(t,10)*-1};l.Attributes["@reverse-order"]=function(e,t){t==="true"&&(this.strings["reverse-order"]=!0)};l.Attributes["@display"]=function(e,t){e.bibliography.tokens.length===2&&(e.opt.using_display=!0),this.strings.cls=t};l.Stack=function(e,t){this.mystack=[],(t||e)&&this.mystack.push(e),this.tip=this.mystack[0]};l.Stack.prototype.push=function(e,t){t||e?this.mystack.push(e):this.mystack.push(""),this.tip=this.mystack[this.mystack.length-1]};l.Stack.prototype.clear=function(){this.mystack=[],this.tip={}};l.Stack.prototype.replace=function(e,t){this.mystack.length===0&&l.error("Internal CSL processor error: attempt to replace nonexistent stack item with "+e),t||e?this.mystack[this.mystack.length-1]=e:this.mystack[this.mystack.length-1]="",this.tip=this.mystack[this.mystack.length-1]};l.Stack.prototype.pop=function(){var e=this.mystack.pop();return this.mystack.length?this.tip=this.mystack[this.mystack.length-1]:this.tip={},e};l.Stack.prototype.value=function(){return this.mystack.slice(-1)[0]};l.Stack.prototype.length=function(){return this.mystack.length};l.Parallel=function(e){this.state=e};l.Parallel.prototype.StartCitation=function(e,t){if(this.state.tmp.suppress_repeats=[],!(e.length<2)){for(var r=0,i=!1,s=[],a=0,n=e.length-1;a<n;a++){var o=e[a][0],u=e[a+1][0],c=!1,p={};if(e[a][0].seeAlso&&e[a][0].seeAlso.length>0&&!i){c=!0,i=[e[a][0].id].concat(e[a][0].seeAlso);var f=i.slice(),h=e.slice(a);h[0][1].parallel="first";for(var m=0,g=h.length;m<g;m++){var d=h[m][0].id,v=f.indexOf(d);if(r=!1,v===-1?r=a+m-1:a+m===e.length-1&&(r=a+m),r){s.push([a,r]);break}else f=f.slice(0,v).concat(f.slice(v+1))}}a>0&&c&&(this.state.tmp.suppress_repeats[a-1].START=!0,c=!1);for(var b in this.state.opt.track_repeat)if(!o[b]||!u[b])p[b]=!1;else if(typeof u[b]=="string"||typeof u[b]=="number"){if(b==="title"&&o["title-short"]&&u["title-short"])var E=o["title-short"],x=u["title-short"];else var E=o[b],x=u[b];E==x?p[b]=!0:p[b]=!1}else if(typeof o[b].length=="undefined"){p[b]=!1;var w=o[b].year,S=u[b].year;w&&S&&w==S&&(p[b]=!0)}else{var E=JSON.stringify(o[b]),x=JSON.stringify(u[b]);E===x?p[b]=!0:p[b]=!1}i||(p.ORPHAN=!0),r===a&&(p.END=!0,i=!1),this.state.tmp.suppress_repeats.push(p)}for(var m=0,g=s.length;m<g;m++){var T=e[s[m][0]][0].id;this.state.registry.registry[T].master=!0,this.state.registry.registry[T].siblings=[];for(var I=s[m][0],C=s[m][1],A=I;A<C;A++){this.state.tmp.suppress_repeats[A].SIBLING=!0;var y=e[A+1][0].id;e[A+1][1].parallel="other",this.state.registry.registry[T].siblings.push(y)}}}};l.Parallel.prototype.checkRepeats=function(e){var t=this.state.tmp.cite_index;if(this.state.tmp.suppress_repeats){if(e.parallel_first&&Object.keys(e.parallel_first).length>0){var r=[{}].concat(this.state.tmp.suppress_repeats),i=!0;for(var s in e.parallel_first)(!r[t][s]||r[t].START)&&(i=!1);return i}if(e.parallel_last&&Object.keys(e.parallel_last).length>0){var r=this.state.tmp.suppress_repeats.concat([{}]),i=Object.keys(e.parallel_last).length>0;for(var s in e.parallel_last)(!r[t][s]||r[t].END)&&(i=!1);return i}if(e.non_parallel&&Object.keys(e.non_parallel).length>0){var r=[{}].concat(this.state.tmp.suppress_repeats),i=!0;for(var s in e.non_parallel)r[t][s]||(i=!1);return i}}return!1};l.Util={};l.Util.Match=function(){this.any=function(e,t,r){return function(i,s){for(var a=0,n=r.length;a<n;a+=1){var o=r[a](i,s);if(o)return!0}return!1}},this.none=function(e,t,r){return function(i,s){for(var a=0,n=r.length;a<n;a+=1){var o=r[a](i,s);if(o)return!1}return!0}},this.all=function(e,t,r){return function(i,s){for(var a=0,n=r.length;a<n;a+=1){var o=r[a](i,s);if(!o)return!1}return!0}},this[void 0]=this.all,this.nand=function(e,t,r){return function(i,s){for(var a=0,n=r.length;a<n;a+=1){var o=r[a](i,s);if(!o)return!0}return!1}}};l.Transform=function(e){this.abbrevs={},this.abbrevs.default=new e.sys.AbbreviationSegments;function t(p,f,h){var m="";return e.sys.getHumanForm&&(p==="country"?(m=e.sys.getHumanForm(f.toLowerCase(),!1,!0),m=m.split("|")[0]):p==="jurisdiction"&&(m=e.sys.getHumanForm(f.toLowerCase(),!1,!0),h?m="":m=m.split("|").slice(1).join(", "))),m}function r(p,f,h,m,g,d,v){var b="",E=l.FIELD_CATEGORY_REMAP[d],x;if(!E)return g;var w=d,S=g;p.sys.normalizeAbbrevsKey&&(S=p.sys.normalizeAbbrevsKey(d,g));var T=!1;if(w==="jurisdiction"&&S&&(T=S.indexOf(":")===-1),["jurisdiction","country"].indexOf(d)>-1&&g===g.toLowerCase()&&(S=g.toUpperCase()),p.sys.getAbbreviation){["jurisdiction","country","language-name","language-name-original"].indexOf(w)>-1?x="default":h.jurisdiction?x=h.jurisdiction:x="default";var I=p.transform.loadAbbreviation(x,E,S,h.language);if(p.transform.abbrevs[I][E]&&S){var C=p.transform.abbrevs[I][E][S];f.strings.form==="short"&&C?T?b="":b=C:b=t(w,S,T)}}return!b&&(!p.opt.development_extensions.require_explicit_legal_case_title_short||h.type!=="legal_case")&&m&&h[m]&&v&&(b=h[m]),!b&&!p.sys.getAbbreviation&&p.sys.getHumanForm&&(b=t(w,S,T)),!b&&!T&&(!p.sys.getHumanForm||w!=="jurisdiction")&&(b=g),p.opt.development_extensions.force_title_abbrev_fallback&&w==="title"&&b===g&&h["title-short"]&&(b=h["title-short"]),b}function i(p,f){var h=e.opt["default-locale"][0].slice(0,2),m;if(e.opt.development_extensions.strict_text_case_locales?m=new RegExp("^([a-zA-Z]{2})(?:$|-.*| .*)"):m=new RegExp("^([a-zA-Z]{2})(?:$|-.*|.*)"),p.language){var g=(""+p.language).match(m);g?h=g[1]:h="tlh"}return p.multi&&p.multi&&p.multi.main&&p.multi.main[f]&&(h=p.multi.main[f]),(!e.opt.development_extensions.strict_text_case_locales||e.opt.development_extensions.normalize_lang_keys_to_lowercase)&&(h=h.toLowerCase()),h}function s(p,f,h,m,g,d){var v,b,E,x,w=g,S=!1;if(!p[f])return{name:"",usedOrig:g,token:l.Util.cloneToken(this)};var T=!1;l.VARIABLES_WITH_SHORT_FORM.indexOf(f)>-1&&d&&(f=f+"-short",T=!0);var I=!1,C=null,A=[];f.slice(-6)==="-short"?(A.push(f),A.push(f.slice(0,-6))):A.push(f);for(var y=0,_=A.length;y<_;y++){var k=!1,f=A[y];E={name:"",usedOrig:g,locale:i(p,f)},x=e.opt[h]?e.opt[h].slice():[];var Q=!1;if(h==="locale-orig"?(g||(E.name=p[f],E.usedOrig=!1),Q=!0,S=!0):m&&(typeof x=="undefined"||x.length===0)&&(E.name=p[f],E.usedOrig=!0,Q=!0,S=!0),!Q){for(var O=0,N=x.length;O<N;O+=1)if(v=x[O],b=v.split(/[\-_]/)[0],v&&p.multi&&p.multi._keys[f]&&p.multi._keys[f][v]){E.name=p.multi._keys[f][v],E.locale=v,Q=!0,k=!0,S=!1;break}else if(b&&p.multi&&p.multi._keys[f]&&p.multi._keys[f][b]){E.name=p.multi._keys[f][b],E.locale=b,Q=!0,k=!0,S=!1;break}!E.name&&m&&(E={name:p[f],usedOrig:!0,locale:i(p,f)},S=!0)}if(E.token=l.Util.cloneToken(this),y===0?(k&&(E.found_variant_ok=!0),C=E,!T&&(typeof x=="undefined"||x.length===0)&&(I=!0),k&&(I=!0)):!T&&!k&&C?(E=C,f=A[0]):k&&(E.found_variant_ok=!0),["title","container-title"].indexOf(f)>-1&&!w&&(!E.token.strings["text-case"]||E.token.strings["text-case"]==="sentence"||E.token.strings["text-case"]==="normal")){var B=e.opt.lang,q;S?q=!1:q=E.locale;var P=f.slice(0,-5),F=E.token.strings["text-case"]==="sentence";E.name=l.titlecaseSentenceOrNormal(e,p,P,q,F),delete E.token.strings["text-case"]}if(I)break}return E}this.getTextSubField=s;function a(p,f,h,m){p||(p="default");var g=p.split(":")[0],d=l.getAbbrevsDomain(e,g,m);return d&&(p+="@"+d),h?(e.sys.getAbbreviation&&(p=e.sys.getAbbreviation(e.opt.styleID,e.transform.abbrevs,p,f,h),p||(p="default",d&&(p+="@"+d))),p):(e.transform.abbrevs[p]||(e.transform.abbrevs[p]=new e.sys.AbbreviationSegments),e.transform.abbrevs[p][f]||(e.transform.abbrevs[p][f]={}),p)}this.loadAbbreviation=a;function n(p,f,h,m){var g=p.variables[0];if(e.publisherOutput&&h){if(["publisher","publisher-place"].indexOf(g)===-1)return!1;e.publisherOutput[g+"-token"]=p,e.publisherOutput.varlist.push(g);var d=h.split(/;\s*/);d.length===e.publisherOutput[g+"-list"].length&&(e.publisherOutput[g+"-list"]=d);for(var v=0,b=d.length;v<b;v+=1)d[v]=r(e,p,f,!1,d[v],m,!0);return e.tmp[g+"-token"]=p,!0}return!1}function o(p,f){var h=f.match(/^#([0-9]+).*>>>/);h&&h[1]&&(p["cite-form"]=h[1])}function u(p,f){var h=f.match(/^(?:#[0-9]+)*(?:!((?:[-_a-z]+(?:(?:.*)))(?:,(?:[-_a-z]+(?:(?:.*))))*))*>>>/);if(h&&(f=f.slice(h[0].length),h[1]))for(var m=h[1].split(","),g=0,d=m.length;g<d;g+=1){var v=m[g],b=v.match(/^([-_a-z]+)(?:\:(.*))*$/),E=b[1],x=e.tmp.abbrev_trimmer;b[2]?x&&p&&(x[p]||(x[p]={}),x[p][E]=b[2]):e.tmp.done_vars.indexOf(E)===-1&&(x&&p&&(x.QUASHES[p]||(x.QUASHES[p]={}),x.QUASHES[p][E]=!0),e.tmp.done_vars.push(E))}return f}this.quashCheck=u;function c(p,f,h,m){var g,d=l.LangPrefsMap[p[0]];return d?g=e.opt["cite-lang-prefs"][d]:g=!1,function(v,b,E){var x,w,S,T,I,C,N;if(!p[0]||!b[p[0]]&&!b[m]||!v.tmp.just_looking&&E&&E["suppress-author"]&&!v.tmp.probably_rendered_something&&v.tmp.can_substitute.length()>1)return null;var A={primary:!1,secondary:!1,tertiary:!1};if(v.tmp.area.slice(-5)==="_sort")A.primary="locale-sort";else if(g&&g.length===1&&g[0]==="locale-orig")A.primary="locale-orig",g=!1;else if(g&&!v.tmp.multi_layout)for(var y=["primary","secondary","tertiary"],_=0,k=y.length;_<k&&!(g.length-1<_);_+=1)g[_]&&(A[y[_]]="locale-"+g[_]);else A.primary="locale-orig";if((p[0]==="title-short"||v.tmp.area!=="bibliography"&&!(v.tmp.area==="citation"&&v.opt.xclass==="note"&&E&&!E.position))&&(A.secondary=!1,A.tertiary=!1),v.tmp.multi_layout&&(A.secondary=!1,A.tertiary=!1),v.tmp["publisher-list"])return p[0]==="publisher"?v.tmp["publisher-token"]=this:p[0]==="publisher-place"&&(v.tmp["publisher-place-token"]=this),null;var Q=v.tmp.lang_array.slice(),O=s.call(this,b,p[0],A.primary,!0,null,f);x=O.name,w=O.locale;var N=O.token,B=O.usedOrig;if(f&&!O.found_variant_ok&&(x=r(v,N,b,m,x,f,!0),x&&(o(b,x),v.tmp.just_looking||(x=u(b.jurisdiction,x)))),n(this,b,x,f))return v.tmp.lang_array=Q,null;S=!1,I=!1;var q,P;A.secondary&&(O=s.call(this,b,p[0],A.secondary,!1,O.usedOrig,null,f),S=O.name,T=O.locale,q=O.token,f&&!O.found_variant_ok&&S&&(S=r(v,q,b,!1,S,f,!0))),A.tertiary&&(O=s.call(this,b,p[0],A.tertiary,!1,O.usedOrig,null,f),I=O.name,C=O.locale,P=O.token,f&&!O.found_variant_ok&&I&&(I=r(v,P,b,!1,I,f,!0)));var F;if(A.primary==="locale-translit"&&(F=v.opt.citeAffixes[d][A.primary].prefix),F==="<i>"&&p[0]==="title"&&!B){for(var j=!1,_=0,k=N.decorations.length;_<k;_+=1)N.decorations[_][0]==="@font-style"&&N.decorations[_][1]==="italic"&&(j=!0);j||N.decorations.push(["@font-style","italic"])}if(w!=="en"&&N.strings["text-case"]==="title"&&(N.strings["text-case"]="passthrough"),p[0]==="title"&&(x=l.demoteNoiseWords(v,x,this["leading-noise-words"])),S||I){if(v.output.openLevel("empty"),N.strings.suffix=N.strings.suffix.replace(/[ .,]+$/,""),w&&(v.tmp.lang_array=[w].concat(Q)),l.UPDATE_GROUP_CONTEXT_CONDITION(v,null,null,N,N.strings.prefix+x),v.output.append(x,N),v.tmp.probably_rendered_something=!0,x===S&&(S=!1),S){q.strings.prefix=v.opt.citeAffixes[d][A.secondary].prefix,q.strings.suffix=v.opt.citeAffixes[d][A.secondary].suffix,q.strings.prefix||(q.strings.prefix=" ");for(var _=q.decorations.length-1;_>-1;_+=-1)["@quotes/true","@font-style/italic","@font-style/oblique","@font-weight/bold"].indexOf(q.decorations[_].join("/"))>-1&&(q.decorations=q.decorations.slice(0,_).concat(q.decorations.slice(_+1)));T!=="en"&&q.strings["text-case"]==="title"&&(q.strings["text-case"]="passthrough"),T&&(v.tmp.lang_array=[T].concat(Q));var D=new l.Token;D.decorations.push(["@font-style","normal"]),D.decorations.push(["@font-weight","normal"]),v.output.openLevel(D),v.output.append(S,q),v.output.closeLevel();var L=v.output.current.value(),U=v.output.current.value().blobs.length-1}if(x===I&&(I=!1),I){P.strings.prefix=v.opt.citeAffixes[d][A.tertiary].prefix,P.strings.suffix=v.opt.citeAffixes[d][A.tertiary].suffix,P.strings.prefix||(P.strings.prefix=" ");for(var _=P.decorations.length-1;_>-1;_+=-1)["@quotes/true","@font-style/italic","@font-style/oblique","@font-weight/bold"].indexOf(P.decorations[_].join("/"))>-1&&(P.decorations=P.decorations.slice(0,_).concat(P.decorations.slice(_+1)));C!=="en"&&P.strings["text-case"]==="title"&&(P.strings["text-case"]="passthrough"),C&&(v.tmp.lang_array=[C].concat(Q));var H=new l.Token;H.decorations.push(["@font-style","normal"]),H.decorations.push(["@font-weight","normal"]),v.output.openLevel(H),v.output.append(I,P),v.output.closeLevel();var L=v.output.current.value(),U=v.output.current.value().blobs.length-1}v.output.closeLevel()}else w&&(v.tmp.lang_array=[w].concat(Q)),l.UPDATE_GROUP_CONTEXT_CONDITION(v,null,null,N,N.strings.prefix+x),v.output.append(x,N),v.tmp.probably_rendered_something=!0;return v.tmp.lang_array=Q,v.tmp.can_block_substitute&&v.tmp.name_node.children.push(v.output.current.value()),null}}this.getOutputFunction=c};l.Token=function(e,t,r){this.name=e,this.strings={},this.strings.delimiter=void 0,this.strings.prefix="",this.strings.suffix="",this.decorations=[],this.variables=[],this.execs=[],this.tokentype=t};l.Util.cloneToken=function(e){var t,r,i,s;if(typeof e=="string")return e;t=new l.Token(e.name,e.tokentype);for(var r in e.strings)e.strings.hasOwnProperty(r)&&(t.strings[r]=e.strings[r]);if(e.decorations)for(t.decorations=[],i=0,s=e.decorations.length;i<s;i+=1)t.decorations.push(e.decorations[i].slice());return e.variables&&(t.variables=e.variables.slice()),e.execs&&(t.execs=e.execs.slice(),e.tests&&(t.tests=e.tests.slice())),t};l.AmbigConfig=function(){this.maxvals=[],this.minval=1,this.names=[],this.givens=[],this.year_suffix=!1,this.disambiguate=0};l.Blob=function(e,t,r){var i,s,a;if(this.levelname=r,t){this.strings={prefix:"",suffix:""};for(var a in t.strings)t.strings.hasOwnProperty(a)&&(this.strings[a]=t.strings[a]);for(this.decorations=[],t.decorations===void 0?i=0:i=t.decorations.length,s=0;s<i;s+=1)this.decorations.push(t.decorations[s].slice())}else this.strings={},this.strings.prefix="",this.strings.suffix="",this.strings.delimiter="",this.decorations=[];typeof e=="string"?this.blobs=e:e?this.blobs=[e]:this.blobs=[],this.alldecor=[this.decorations]};l.Blob.prototype.push=function(e){typeof this.blobs=="string"?l.error("Attempt to push blob onto string object"):e!==!1&&(e.alldecor=e.alldecor.concat(this.alldecor),this.blobs.push(e))};l.NumericBlob=function(e,t,r,i,s){if(this.id=s,this.alldecor=[],this.num=r,this.particle=t,this.blobs=r.toString(),this.status=l.START,this.strings={},i){if(i.strings["text-case"]){var a=i.strings["text-case"];this.particle=l.Output.Formatters[a](e,this.particle),this.blobs=l.Output.Formatters[a](e,this.blobs)}this.gender=i.gender,this.decorations=i.decorations,this.strings.prefix=i.strings.prefix,this.strings.suffix=i.strings.suffix,this.strings["text-case"]=i.strings["text-case"],this.successor_prefix=i.successor_prefix,this.range_prefix=i.range_prefix,this.splice_prefix=i.splice_prefix,this.formatter=i.formatter,this.formatter||(this.formatter=new l.Output.DefaultFormatter),this.formatter&&(this.type=this.formatter.format(1))}else this.decorations=[],this.strings.prefix="",this.strings.suffix="",this.successor_prefix="",this.range_prefix="",this.splice_prefix="",this.formatter=new l.Output.DefaultFormatter};l.NumericBlob.prototype.setFormatter=function(e){this.formatter=e,this.type=this.formatter.format(1)};l.Output.DefaultFormatter=function(){};l.Output.DefaultFormatter.prototype.format=function(e){return e.toString()};l.NumericBlob.prototype.checkNext=function(e,t){t?(this.status=l.START,typeof e=="object"&&(e.num===this.num+1?e.status=l.SUCCESSOR:e.status=l.SEEN)):!e||!e.num||this.type!==e.type||e.num!==this.num+1?(this.status===l.SUCCESSOR_OF_SUCCESSOR&&(this.status=l.END),typeof e=="object"&&(e.status=l.SEEN)):this.status===l.START||this.status===l.SEEN?e.status=l.SUCCESSOR:(this.status===l.SUCCESSOR||this.status===l.SUCCESSOR_OF_SUCCESSOR)&&(this.range_prefix?(e.status=l.SUCCESSOR_OF_SUCCESSOR,this.status=l.SUPPRESS):e.status=l.SUCCESSOR)};l.NumericBlob.prototype.checkLast=function(e){return this.status===l.SEEN||e.num!==this.num-1&&this.status===l.SUCCESSOR?(this.status=l.SUCCESSOR,!0):!1};l.Util.fixDateNode=function(e,t,r){var i,s,a,n,o,u,c,p,f,h,m,g,d,b=this.cslXml.getAttributeValue(r,"lingo"),v=this.cslXml.getAttributeValue(r,"default-locale");this.build.date_key=!0,i=this.cslXml.getAttributeValue(r,"form");var b;if(v?b=this.opt["default-locale"][0]:b=this.cslXml.getAttributeValue(r,"lingo"),!this.getDate(i,v))return e;var E=this.cslXml.getAttributeValue(r,"date-parts");s=this.cslXml.getAttributeValue(r,"variable"),p=this.cslXml.getAttributeValue(r,"prefix"),f=this.cslXml.getAttributeValue(r,"suffix"),g=this.cslXml.getAttributeValue(r,"display"),d=this.cslXml.getAttributeValue(r,"cslid"),a=this.cslXml.nodeCopy(this.getDate(i,v)),this.cslXml.setAttribute(a,"lingo",this.opt.lang),this.cslXml.setAttribute(a,"form",i),this.cslXml.setAttribute(a,"date-parts",E),this.cslXml.setAttribute(a,"cslid",d),this.cslXml.setAttribute(a,"variable",s),this.cslXml.setAttribute(a,"default-locale",v),p&&this.cslXml.setAttribute(a,"prefix",p),f&&this.cslXml.setAttribute(a,"suffix",f),g&&this.cslXml.setAttribute(a,"display",g),h=this.cslXml.children(a);for(var x in h)n=h[x],this.cslXml.nodename(n)==="date-part"&&(o=this.cslXml.getAttributeValue(n,"name"),v&&this.cslXml.setAttributeOnNodeIdentifiedByNameAttribute(a,"date-part",o,"@default-locale","true"));h=this.cslXml.children(r);for(var x in h)if(n=h[x],this.cslXml.nodename(n)==="date-part"){o=this.cslXml.getAttributeValue(n,"name"),m=this.cslXml.attributes(n);for(u in m)u!=="@name"&&(b&&b!==this.opt.lang&&["@suffix","@prefix","@form"].indexOf(u)>-1||(c=m[u],this.cslXml.setAttributeOnNodeIdentifiedByNameAttribute(a,"date-part",o,u,c)))}if(this.cslXml.getAttributeValue(r,"date-parts")==="year")this.cslXml.deleteNodeByNameAttribute(a,"month"),this.cslXml.deleteNodeByNameAttribute(a,"day");else if(this.cslXml.getAttributeValue(r,"date-parts")==="year-month")this.cslXml.deleteNodeByNameAttribute(a,"day");else if(this.cslXml.getAttributeValue(r,"date-parts")==="month-day"){for(var w=this.cslXml.children(a),S=1,T=this.cslXml.numberofnodes(w);S<T;S++)if(this.cslXml.getAttributeValue(w[S],"name")==="year"){this.cslXml.setAttribute(w[S-1],"suffix","");break}this.cslXml.deleteNodeByNameAttribute(a,"year")}return this.cslXml.insertChildNodeAfter(e,r,t,a)};l.dateMacroAsSortKey=function(e,t){l.dateAsSortKey.call(this,e,t,!0)};l.dateAsSortKey=function(e,t,r){var i,s,a,n,o,u,c,p,f=this.variables[0],h="empty";if(r&&e.tmp.extension&&(h="macro-with-date"),i=t[f],typeof i=="undefined"&&(i={"date-parts":[[0]]}),typeof this.dateparts=="undefined"&&(this.dateparts=["year","month","day"]),i.raw?i=e.fun.dateparser.parseDateToArray(i.raw):i["date-parts"]&&(i=e.dateParseArray(i)),typeof i=="undefined"&&(i={}),i.year)for(c=0,p=l.DATE_PARTS_INTERNAL.length;c<p;c+=1)if(s=l.DATE_PARTS_INTERNAL[c],a=0,n=s,n.slice(-4)==="_end"&&(n=n.slice(0,-4)),i[s]&&this.dateparts.indexOf(n)>-1&&(a=i[s]),s.slice(0,4)==="year"){o=l.Util.Dates[n].numeric(e,a);var u="1";o[0]==="-"&&(u="0",o=o.slice(1),o=9999-parseInt(o,10)),e.output.append(l.Util.Dates[s.slice(0,4)].numeric(e,u+o),h)}else a=l.Util.Dates[n]["numeric-leading-zeros"](e,a),a||(a="00"),e.output.append(a,h)};l.Engine.prototype.dateParseArray=function(e){var t,r,i,s;t={};for(r in e)if(r==="date-parts"){i=e["date-parts"],i.length>1&&i[0].length!==i[1].length&&l.error("CSL data error: element mismatch in date range input."),s=["","_end"];for(var a=0,n=i.length;a<n;a+=1)for(var o=0,u=l.DATE_PARTS.length;o<u;o+=1)isNaN(parseInt(i[a][o],10))?t[l.DATE_PARTS[o]+s[a]]=void 0:t[l.DATE_PARTS[o]+s[a]]=parseInt(i[a][o],10)}else e.hasOwnProperty(r)&&(r==="literal"&&typeof e.literal=="object"&&typeof e.literal.part=="string"?(l.debug("Warning: fixing up weird literal date value"),t.literal=e.literal.part):t[r]=e[r]);return t};l.Util.Names={};l.Util.Names.compareNamesets=l.NameOutput.prototype._compareNamesets;l.Util.Names.unInitialize=function(e,t){var r,i,s,a,n;if(!t)return"";for(s=t.split(/(?:\-|\s+)/),a=t.match(/(\-|\s+)/g),n="",r=0,i=s.length;r<i;r+=1)n+=s[r],r<i-1&&(n+=a[r]);return n};l.Util.Names.initializeWith=function(e,t,r,i){var s,a,n,o,u;if(!t)return"";if(r||(r=""),["Lord","Lady"].indexOf(t)>-1||!t.replace(/^(?:<[^>]+>)*/,"").match(l.STARTSWITH_ROMANESQUE_REGEXP)&&!r.match("%s"))return t;e.opt["initialize-with-hyphen"]===!1&&(t=t.replace(/\-/g," ")),t=t.replace(/\s*\-\s*/g,"-").replace(/\s+/g," "),t=t.replace(/-([a-z])/g,"\u2013$1");for(var s=t.length-2;s>-1;s+=-1)t.slice(s,s+1)==="."&&t.slice(s+1,s+2)!==" "&&(t=t.slice(0,s)+". "+t.slice(s+1));var c=l.Output.Formatters.nameDoppel.split(t),p=[];if(p=[c.strings[0]],c.tags.length===0){var f=p[0].match(/[^\.]+$/);f&&f[0].length===1&&f[0]!==f[0].toLowerCase()&&(p[0]+=".")}for(s=1,a=c.strings.length;s<a;s+=1)p.push(c.tags[s-1]),p.push(c.strings[s]);return i?u=this.doNormalize(e,p,r):u=this.doInitialize(e,p,r),u=u.replace(/\u2013([a-z])/g,"-$1"),u};l.Util.Names.notag=function(e){return e.replace(/^(?:<[^>]+>)*/,"")};l.Util.Names.mergetag=function(e,t,r){var i=t.match(/(?:-*<[^>]+>-*)/g);if(i)t=i.join("");else return r;return i=r.match(/^(.*[^\s])*(\s+)$/),i?(i[1]=i[1]?i[1]:"",r=i[1]+t+i[2]):r=r+t,r};l.Util.Names.tagonly=function(e,t){var r=t.match(/(?:<[^>]+>)+/);return r?r.join(""):t};l.Util.Names.doNormalize=function(e,t,r){var i,s;r=r||"";var a=[];for(i=0,s=t.length;i<s;i+=1)this.notag(t[i]).length>1&&this.notag(t[i]).slice(-1)==="."?(t[i]=t[i].replace(/^(.*)\.(.*)$/,"$1$2"),a.push(!0)):t[i].length===1&&t[i].toUpperCase()===t[i]?a.push(!0):a.push(!1);for(i=0,s=t.length;i<s;i+=2)a[i]&&(i<t.length-2&&(t[i+1]=this.tagonly(e,t[i+1]),a[i+2]||(t[i+1]=this.tagonly(e,t[i+1])+" "),t[i+2].length>1?t[i+1]=r.replace(/\ufeff$/,"")+t[i+1]:t[i+1]=this.mergetag(e,t[i+1],r)),i===t.length-1&&(t[i]=t[i]+r));return t.join("").replace(/[\u0009\u000a\u000b\u000c\u000d\u0020\ufeff\u00a0]+$/,"").replace(/\s*\-\s*/g,"-").replace(/[\u0009\u000a\u000b\u000c\u000d\u0020]+/g," ")};l.Util.Names.doInitialize=function(e,t,r){var i,s,a,n,o,u,c;for(i=0,s=t.length;i<s;i+=2)if(c=t[i],!!c)if(a=c.match(l.NAME_INITIAL_REGEXP),!a&&!c.match(l.STARTSWITH_ROMANESQUE_REGEXP)&&c.length>1&&r.match("%s")&&(a=c.match(/(.)(.*)/)),a&&a[2]&&a[3]&&(a[1]=a[1]+a[2],a[2]=""),a&&a[1].slice(0,1)===a[1].slice(0,1).toUpperCase()){var p="";if(a[2]){var f="";for(u=a[2].split(""),n=0,o=u.length;n<o;n+=1){var h=u[n];if(h===h.toUpperCase())f+=h;else break}f.length<a[2].length&&(p=l.toLocaleLowerCase.call(e,f))}t[i]=a[1]+p,i<s-1?r.match("%s")?t[i]=r.replace("%s",t[i]):t[i+1].indexOf("-")>-1?t[i+1]=this.mergetag(e,t[i+1].replace("-",""),r)+"-":t[i+1]=this.mergetag(e,t[i+1],r):r.match("%s")?t[i]=r.replace("%s",t[i]):t.push(r)}else c.match(l.ROMANESQUE_REGEXP)&&(!a||!a[3])&&(t[i]=" "+c);var m=t.join("");return m=m.replace(/[\u0009\u000a\u000b\u000c\u000d\u0020\ufeff\u00a0]+$/,"").replace(/\s*\-\s*/g,"-").replace(/[\u0009\u000a\u000b\u000c\u000d\u0020]+/g," "),m};l.Util.Names.getRawName=function(e){var t=[];return e.literal?t.push(e.literal):(e.given&&t.push(e.given),e.family&&t.push(e.family)),t.join(" ")};l.Util.Dates={};l.Util.Dates.year={};l.Util.Dates.year.long=function(e,t){return t||(typeof t=="boolean"?t="":t=0),t.toString()};l.Util.Dates.year.imperial=function(e,t,r){var i="";t||(typeof t=="boolean"?t="":t=0),r=r?"_end":"";var s=e.tmp.date_object["month"+r];for(s=s?""+s:"1";s.length<2;)s="0"+s;var a=e.tmp.date_object["day"+r];for(a=a?""+a:"1";a.length<2;)a="0"+a;var n=parseInt(t+s+a,10),o,u;if(n>=18680908&&n<19120730?(o="\u660E\u6CBB",u=1867):n>=19120730&&n<19261225?(o="\u5927\u6B63",u=1911):n>=19261225&&n<19890108?(o="\u662D\u548C",u=1925):n>=19890108&&(o="\u5E73\u6210",u=1988),o&&u){var c=o;e.sys.normalizeAbbrevsKey&&(c=e.sys.normalizeAbbrevsKey("number",o)),e.transform.abbrevs.default.number[c]||e.transform.loadAbbreviation("default","number",c,null),e.transform.abbrevs.default.number[c]&&(o=e.transform.abbrevs.default.number[c]),i=o+(t-u)}return i};l.Util.Dates.year.short=function(e,t){if(t=t.toString(),t&&t.length===4)return t.substr(2)};l.Util.Dates.year.numeric=function(e,t){var i,r;t=""+t;var i=t.match(/([0-9]*)$/);for(i?(r=t.slice(0,i[1].length*-1),t=i[1]):(r=t,t="");t.length<4;)t="0"+t;return r+t};l.Util.Dates.normalizeMonth=function(e,t){var r;if(e||(e=0),e=""+e,e.match(/^[0-9]+$/)||(e=0),e=parseInt(e,10),t){var i={stub:"month-",num:e};if(i.num<1||i.num>24)i.num=0;else{for(;i.num>16;)i.num=i.num-4;i.num>12&&(i.stub="season-",i.num=i.num-12)}r=i}else(e<1||e>12)&&(e=0),r=e;return r};l.Util.Dates.month={};l.Util.Dates.month.numeric=function(e,r){var r=l.Util.Dates.normalizeMonth(r);return r||(r=""),r};l.Util.Dates.month["numeric-leading-zeros"]=function(e,r){var r=l.Util.Dates.normalizeMonth(r);if(!r)r="";else for(r=""+r;r.length<2;)r="0"+r;return r};l.Util.Dates.month.long=function(e,a,r,i){var s=l.Util.Dates.normalizeMonth(a,!0),a=s.num;if(!a)a="";else{for(a=""+a;a.length<2;)a="0"+a;a=e.getTerm(s.stub+a,"long",0,0,!1,i)}return a};l.Util.Dates.month.short=function(e,a,r,i){var s=l.Util.Dates.normalizeMonth(a,!0),a=s.num;if(!a)a="";else{for(a=""+a;a.length<2;)a="0"+a;a=e.getTerm(s.stub+a,"short",0,0,!1,i)}return a};l.Util.Dates.day={};l.Util.Dates.day.numeric=function(e,t){return t.toString()};l.Util.Dates.day.long=l.Util.Dates.day.numeric;l.Util.Dates.day["numeric-leading-zeros"]=function(e,t){for(t||(t=0),t=t.toString();t.length<2;)t="0"+t;return t.toString()};l.Util.Dates.day.ordinal=function(e,t,r){return e.fun.ordinalizer.format(t,r)};l.Util.Sort={};l.Util.Sort.strip_prepositions=function(e){var t;return typeof e=="string"&&(t=e.match(/^(([aA]|[aA][nN]|[tT][hH][eE])\s+)/)),t&&(e=e.substr(t[1].length)),e};l.Util.substituteStart=function(e,t){var r,i,s,a,n,o,u;a=function(c,p,f){for(var h=0,m=this.decorations.length;h<m;h+=1)if(this.decorations[h][0]==="@strip-periods"&&this.decorations[h][1]==="true"){c.tmp.strip_periods+=1;break}},this.execs.push(a),this.decorations&&e.opt.development_extensions.csl_reverse_lookup_support&&(this.decorations.reverse(),this.decorations.push(["@showid","true",this.cslid]),this.decorations.reverse()),u=["number","date","names"],(this.name==="text"&&!this.postponed_macro||u.indexOf(this.name)>-1)&&(r=function(c,p,f){c.tmp.element_trace.value()==="author"||this.name==="names"?(!c.tmp.just_looking&&f&&f["author-only"]&&c.tmp.area!=="intext"&&c.tmp.probably_rendered_something&&c.tmp.element_trace.push("suppress-me"),!c.tmp.just_looking&&f&&f["suppress-author"]&&(c.tmp.probably_rendered_something||c.tmp.element_trace.push("suppress-me"))):this.name==="date"?!c.tmp.just_looking&&f&&f["author-only"]&&c.tmp.area!=="intext"&&c.tmp.probably_rendered_something&&c.tmp.element_trace.push("suppress-me"):!c.tmp.just_looking&&f&&f["author-only"]&&c.tmp.area!=="intext"?!c.tmp.probably_rendered_something&&c.tmp.can_block_substitute||c.tmp.element_trace.push("suppress-me"):f&&f["suppress-author"]&&c.tmp.element_trace.push("do-not-suppress-me")},this.execs.push(r)),i=this.strings.cls,this.strings.cls=!1,e.build.render_nesting_level===0&&(e.build.area==="bibliography"&&e.bibliography.opt["second-field-align"]?(s=new l.Token("group",l.START),s.decorations=[["@display","left-margin"]],a=function(c,p){c.tmp.render_seen||(s.strings.first_blob=p.id,c.output.startTag("bib_first",s))},s.execs.push(a),t.push(s)):l.DISPLAY_CLASSES.indexOf(i)>-1&&(s=new l.Token("group",l.START),s.decorations=[["@display",i]],a=function(c,p){s.strings.first_blob=p.id,c.output.startTag("bib_first",s)},s.execs.push(a),t.push(s)),e.build.cls=i),e.build.render_nesting_level+=1,e.build.substitute_level.value()===1&&(n=new l.Token("choose",l.START),l.Node.choose.build.call(n,e,t),o=new l.Token("if",l.START),a=function(){return!!e.tmp.can_substitute.value()},o.tests||(o.tests=[]),o.tests.push(a),o.test=e.fun.match.any(this,e,o.tests),t.push(o)),e.sys.variableWrapper&&this.variables_real&&this.variables_real.length&&(a=function(c,p,f){if(!c.tmp.just_looking&&!c.tmp.suppress_decorations){var h=new l.Token("text",l.START);h.decorations=[["@showid","true"]],c.output.startTag("variable_entry",h);var m=null;f&&(m=f.position),m||(m=0);var g=["first","container-subsequent","subsequent","ibid","ibid-with-locator"],d=0;f&&f.noteIndex&&(d=f.noteIndex);var v=0;f&&f["first-reference-note-number"]&&(v=f["first-reference-note-number"]);var b=0;f&&f["first-container-reference-note-number"]&&(b=f["first-container-reference-note-number"]);var E=0;f&&f["citation-number"]&&(E=f["citation-number"]);var x=0;f&&f.index&&(x=f.index);var w={itemData:p,variableNames:this.variables,context:c.tmp.area,xclass:c.opt.xclass,position:g[m],"note-number":d,"first-reference-note-number":v,"first-container-reference-note-number":b,"citation-number":E,index:x,mode:c.opt.mode};c.output.current.value().params=w}},this.execs.push(a))};l.Util.substituteEnd=function(e,t){var r,i,s,a,n,o,u;if(e.sys.variableWrapper&&(this.hasVariable||this.variables_real&&this.variables_real.length)&&(r=function(p){!p.tmp.just_looking&&!p.tmp.suppress_decorations&&p.output.endTag("variable_entry")},this.execs.push(r)),r=function(p){for(var f=0,h=this.decorations.length;f<h;f+=1)if(this.decorations[f][0]==="@strip-periods"&&this.decorations[f][1]==="true"){p.tmp.strip_periods+=-1;break}},this.execs.push(r),e.build.render_nesting_level+=-1,e.build.render_nesting_level===0&&(e.build.cls?(r=function(p){p.output.endTag("bib_first")},this.execs.push(r),e.build.cls=!1):e.build.area==="bibliography"&&e.bibliography.opt["second-field-align"]&&(i=new l.Token("group",l.END),r=function(p){p.tmp.render_seen||p.output.endTag("bib_first")},i.execs.push(r),t.push(i),s=new l.Token("group",l.START),s.decorations=[["@display","right-inline"]],r=function(p){p.tmp.render_seen||(p.tmp.render_seen=!0,p.output.startTag("bib_other",s))},s.execs.push(r),t.push(s))),e.build.substitute_level.value()===1&&(a=new l.Token("if",l.END),t.push(a),n=new l.Token("choose",l.END),l.Node.choose.build.call(n,e,t)),this.name==="names"||this.name==="text"&&this.variables_real!=="title"){o=new l.Token("text",l.SINGLETON);var c=this.name;r=function(p,f){if(p.tmp.area==="bibliography"&&typeof p.bibliography.opt["subsequent-author-substitute"]=="string"&&!(this.variables_real&&!f[this.variables_real])&&!(this.variables_real&&c==="names")){var h=p.bibliography.opt["subsequent-author-substitute-rule"],m,g,d=!p.tmp.suppress_decorations;if(d&&p.tmp.subsequent_author_substitute_ok&&p.tmp.rendered_name){if(h==="partial-each"||h==="partial-first"){var v=!0,b=[];for(m=0,g=p.tmp.name_node.children.length;m<g;m+=1){var E=p.tmp.rendered_name[m];v&&p.tmp.last_rendered_name&&p.tmp.last_rendered_name.length>m-1&&E&&!E.localeCompare(p.tmp.last_rendered_name[m])?(u=new l.Blob(p[p.tmp.area].opt["subsequent-author-substitute"]),p.tmp.name_node.children[m].blobs=[u],h==="partial-first"&&(v=!1)):v=!1,b.push(E)}p.tmp.last_rendered_name=b}else if(h==="complete-each"){var b=p.tmp.rendered_name.join(",");if(b){if(p.tmp.last_rendered_name&&!b.localeCompare(p.tmp.last_rendered_name))for(m=0,g=p.tmp.name_node.children.length;m<g;m+=1)u=new l.Blob(p[p.tmp.area].opt["subsequent-author-substitute"]),p.tmp.name_node.children[m].blobs=[u];p.tmp.last_rendered_name=b}}else{var b=p.tmp.rendered_name.join(",");b&&(p.tmp.last_rendered_name&&!b.localeCompare(p.tmp.last_rendered_name)&&(u=new l.Blob(p[p.tmp.area].opt["subsequent-author-substitute"]),p.tmp.label_blob?p.tmp.name_node.top.blobs=[u,p.tmp.label_blob]:p.tmp.name_node.top.blobs.length?p.tmp.name_node.top.blobs[0].blobs=[u]:p.tmp.name_node.top.blobs=[u],p.tmp.substituted_variable=c),p.tmp.last_rendered_name=b)}p.tmp.subsequent_author_substitute_ok=!1}}},this.execs.push(r)}(this.name==="text"&&!this.postponed_macro||["number","date","names"].indexOf(this.name)>-1)&&(r=function(p,f){p.tmp.element_trace.mystack.length>1&&p.tmp.element_trace.pop()},this.execs.push(r))};l.Util.padding=function(e){var t=e.match(/\s*(-{0,1}[0-9]+)/);if(t)for(e=parseInt(t[1],10),e<0&&(e=1e20+e),e=""+e;e.length<20;)e="0"+e;return e};l.Util.LongOrdinalizer=function(){};l.Util.LongOrdinalizer.prototype.init=function(e){this.state=e};l.Util.LongOrdinalizer.prototype.format=function(e,t){e<10&&(e="0"+e);var r=l.Engine.getField(l.LOOSE,this.state.locale[this.state.opt.lang].terms,"long-ordinal-"+e,"long",0,t);return r||(r=this.state.fun.ordinalizer.format(e,t)),this.state.tmp.cite_renders_content=!0,r};l.Util.Ordinalizer=function(e){this.state=e,this.suffixes={}};l.Util.Ordinalizer.prototype.init=function(){if(!this.suffixes[this.state.opt.lang]){this.suffixes[this.state.opt.lang]={};for(var e=0,t=3;e<t;e+=1){var r=[void 0,"masculine","feminine"][e];this.suffixes[this.state.opt.lang][r]=[];for(var i=1;i<5;i+=1){var s=this.state.getTerm("ordinal-0"+i,"long",!1,r);if(typeof s=="undefined"){delete this.suffixes[this.state.opt.lang][r];break}this.suffixes[this.state.opt.lang][r].push(s)}}}};l.Util.Ordinalizer.prototype.format=function(e,t){var r;e=parseInt(e,10),r=""+e;var i="",s=[];if(t&&s.push(t),s.push("neuter"),this.state.locale[this.state.opt.lang].ord["1.0.1"]){i=this.state.getTerm("ordinal",!1,0,t);for(var a,n=0,o=s.length;n<o;n+=1){a=s[n];var u=this.state.locale[this.state.opt.lang].ord["1.0.1"];if(u["whole-number"][r]&&u["whole-number"][r][a]?i=this.state.getTerm(this.state.locale[this.state.opt.lang].ord["1.0.1"]["whole-number"][r][a],!1,0,t):u["last-two-digits"][r.slice(r.length-2)]&&u["last-two-digits"][r.slice(r.length-2)][a]?i=this.state.getTerm(this.state.locale[this.state.opt.lang].ord["1.0.1"]["last-two-digits"][r.slice(r.length-2)][a],!1,0,t):u["last-digit"][r.slice(r.length-1)]&&u["last-digit"][r.slice(r.length-1)][a]&&(i=this.state.getTerm(this.state.locale[this.state.opt.lang].ord["1.0.1"]["last-digit"][r.slice(r.length-1)][a],!1,0,t)),i)break}}else t||(t=void 0),this.state.fun.ordinalizer.init(),e/10%10===1||e>10&&e<20?i=this.suffixes[this.state.opt.lang][t][3]:e%10===1&&e%100!==11?i=this.suffixes[this.state.opt.lang][t][0]:e%10===2&&e%100!==12?i=this.suffixes[this.state.opt.lang][t][1]:e%10===3&&e%100!==13?i=this.suffixes[this.state.opt.lang][t][2]:i=this.suffixes[this.state.opt.lang][t][3];return r=r+=i,r};l.Util.Romanizer=function(){};l.Util.Romanizer.prototype.format=function(e){var t,r,i,s,a;if(t="",e<6e3)for(s=e.toString().split(""),s.reverse(),r=0,i=0,a=s.length,r=0;r<a;r+=1)i=parseInt(s[r],10),t=l.ROMAN_NUMERALS[r][i]+t;return t};l.Util.Suffixator=function(e){e||(e=l.SUFFIX_CHARS),this.slist=e.split(",")};l.Util.Suffixator.prototype.format=function(e){var t;e+=1;var r="";do{t=e%26===0?26:e%26;var r=this.slist[t-1]+r;e=(e-t)/26}while(e!==0);return r};l.Engine.prototype.processNumber=function(e,t,r){var i,s=this,a=r;r=r==="page-first"?"page":r;var n=",\\s+and\\s+|\\s+and\\s+";this.opt.lang.slice(0,2)!=="en"&&(n+="|,\\s+"+this.getTerm("and")+"\\s+|\\s+"+this.getTerm("and")+"\\s+");var o="\\s*&\\s*",u=new RegExp("^"+o+"$"),c=new RegExp("("+o+"|"+n+"|;\\s+|,\\s+|\\s*\\\\*[\\-\\u2013]+\\s*)","g"),p=new RegExp("(?:"+o+"|"+n+"|;\\s+|,\\s+|\\s*\\\\*[\\-\\u2013]+\\s*)"),f=this.getTerm("and"),h=this.getTerm("and","symbol");f===h&&(h="&");function m(D){D=D.trim();var L=D.match(/^([^ ]+)/);if(L&&!l.STATUTE_SUBDIV_STRINGS[L[1]]){var U=null;["locator","locator-extra","page"].indexOf(r)>-1?t.label?U=l.STATUTE_SUBDIV_STRINGS_REVERSE[t.label]:U="p.":U=l.STATUTE_SUBDIV_STRINGS_REVERSE[r],U&&(D=U+" "+D)}return D}function g(D,L,U,H,G){H=H||"";var $={};if(!L&&!l.STATUTE_SUBDIV_STRINGS_REVERSE[r]&&(L="var:"+r),L){var z=L.match(/(\s*)([^\s]+)(\s*)/);a==="page"&&G===0&&["p.","pp."].indexOf(z[2])===-1?($.gotosleepability=!0,$.labelVisibility=!0):$.labelVisibility=!1,$.label=z[2],$.origLabel=D,$.labelSuffix=z[3]?z[3]:"",$.plural=0}var z=U.match(/^([0-9]*[a-zA-Z]+0*)?([0-9]+(?:[a-zA-Z]*|[-,a-zA-Z]+))$/);return z?($.particle=z[1]?z[1]:"",$.value=z[2]):($.particle="",$.value=U),$.joiningSuffix=H.replace(/\s*-\s*/,"-"),$}function d(D){for(var L=D.length-2;L>-1;L-=2)D[L]==="-"&&D[L-1].match(/^(?:(?:[a-z]|[a-z][a-z]|[a-z][a-z][a-z]|[a-z][a-z][a-z][a-z])\.  *)*[0-9]+[,a-zA-Z]+$/)&&D[L+1].match(/^[,a-zA-Z]+$/)&&(D[L-1]=D.slice(L-1,L+2).join(""),D=D.slice(0,L).concat(D.slice(L+2)));return D}function v(D,L){L=L||"",D=m(D,L);var U,H,G;if(r==="page"&&D.indexOf("\u2013")>-1&&(D=D.replace(/\u2013/g,"-")),D.indexOf("\\-")>-1){U=new RegExp(c.source.replace("\\-","")),H=new RegExp(p.source.replace("\\-",""));for(var $=D.split("\\-"),z=0,Y=$.length;z<Y;z++)$[z]=$[z].replace(/\-/g,"\u2013");G=$.join("\\-"),G=G.replace(/\\/g,"")}else U=c,H=p,G=D;var J=[],ee=G.match(U);if(ee){for(var $=G.split(H),z=0,Y=ee.length;z<Y;z++)ee[z].match(u)&&($[z].match(/[a-zA-Z]$/)&&$[z].match(/^[a-zA-Z]/)?ee[z]=h:ee[z]=" "+h+" ");var le=!1;for(var z in $)if((""+$[z]).replace(/^[a-z]\.\s+/,"").match(/[^\s0-9ivxlcmIVXLCM]/))break;if(le)J=[G];else{for(var z=0,Y=$.length-1;z<Y;z++)J.push($[z]),J.push(ee[z]);J.push($[$.length-1]),J=d(J)}}else var J=[G];for(var X=[],W=L,fe="",z=0,Y=J.length;z<Y;z+=2){var ee=J[z].match(/((?:^| )(?:[a-z]|[a-z][a-z]|[a-z][a-z][a-z]|[a-z][a-z][a-z][a-z]|subpara|subch|amend|bibliog|annot|illus|princ|intro|sched|subdiv|subsec)(?:\.| ) *)/g);if(ee){for(var $=J[z].split(/(?:(?:^| )(?:[a-z]|[a-z][a-z]|[a-z][a-z][a-z]|[a-z][a-z][a-z][a-z]|subpara|subch|amend|bibliog|annot|illus|princ|intro|sched|subdiv|subsec)(?:\.| ) *)/),te=$.length-1;te>0;te--)$[te-1]&&(!$[te].match(/^[0-9]+([-;,:a-zA-Z]*)$/)||!$[te-1].match(/^[0-9]+([-;,:a-zA-Z]*)$/))&&($[te-1]=$[te-1]+ee[te-1]+$[te],$=$.slice(0,te).concat($.slice(te+1)),ee=ee.slice(0,te-1).concat(ee.slice(te)));if(ee.length>0){var ve=ee[0].trim(),Re=!l.STATUTE_SUBDIV_STRINGS[ve]||typeof s.getTerm(l.STATUTE_SUBDIV_STRINGS[ve])=="undefined"||["locator","number","locator-extra","page"].indexOf(r)===-1&&l.STATUTE_SUBDIV_STRINGS[ve]!==r;Re?z===0&&(ee=ee.slice(1),$[0]=$[0]+" "+ve+" "+$[1],$=$.slice(0,1).concat($.slice(2))):fe=ve}for(var te=0,ae=$.length;te<ae;te++)if($[te]||te===$.length-1){var _e;W=ee[te-1]?ee[te-1]:W,fe===W.trim()?_e="":_e=fe,G=$[te]?$[te].trim():"",te===$.length-1?X.push(g(_e,W,G,J[z+1],z)):X.push(g(_e,W,G,null,z))}}else{var _e;fe===W.trim()?_e="":_e=fe,X.push(g(_e,W,J[z],J[z+1]))}}return X}function b(D){for(var L=0,U=D.length-1;L<U;L++)!D[L].joiningSuffix&&D[L+1].label&&(D[L].joiningSuffix=" ")}function E(D,L,U){var H=D[U.pos],G=D[L].value,$=H.joiningSuffix==="\\-";G.particle&&G.particle!==H.particle&&(U.collapsible=!1);var z=G.match(/^[0-9]+([-,:a-zA-Z]*)$/),Y=H.value.match(/^(?:[0-9]+|[ixv]+)([-,:a-zA-Z]*|\-[\-0-9]+)$/);if((!G||!z||!Y||$)&&(U.collapsible=!1,(!G||!Y)&&(U.numeric=!1),$&&U.count--),(z&&z[1]||Y&&Y[1])&&(U.collapsible=!1),D[L].collapsible===void 0){for(var J=L,ee=L+U.count;J<ee;J++)isNaN(parseInt(D[J].value))&&!D[J].value.match(/^[ivxlcmIVXLCM]+$/)?D[J].collapsible=!1:D[J].collapsible=!0;U.collapsible=D[L].collapsible}for(var le=U.collapsible,J=U.pos,ee=U.pos+U.count;J<ee;J++)U.count>1&&le&&(D[J].plural=1),D[J].numeric=U.numeric,D[J].collapsible=U.collapsible}function x(D,L,U){U.label.slice(0,4)!=="var:"&&(U.pos===0?(["locator","number","locator-extra","page"].indexOf(r)>-1&&typeof s.getTerm(l.STATUTE_SUBDIV_STRINGS[U.label])=="undefined"&&(D[U.pos].labelVisibility=!0),["locator","number","locator-extra","page"].indexOf(r)===-1&&l.STATUTE_SUBDIV_STRINGS[U.label]!==r&&(D[0].labelVisibility=!0)):D[U.pos].labelVisibility=!0)}function w(D){if(D.length!==0){for(var L=0,U=1,H=1,G=D.length;H<G;H++){var $=D[H-1],z=D[H];if($.label===z.label&&$.particle===$.particle)U++;else{var Y=JSON.parse(JSON.stringify(D[L]));Y.pos=L,Y.count=U,Y.numeric=!0,E(D,L,Y),$.label!==z.label&&x(D,L,Y),L=H,U=1}}var Y=JSON.parse(JSON.stringify(D[L]));Y.pos=L,Y.count=U,Y.numeric=!0,E(D,L,Y),x(D,L,Y),D.length&&D[0].numeric&&r.slice(0,10)==="number-of-"&&parseInt(t[a],10)>1&&(D[0].plural=1)}}function S(D){return D.replace("\\-","-")}function T(D){var L=l.Util.cloneToken(e),U=new l.Token;s.tmp.just_looking||(U.decorations=L.decorations,L.decorations=[],U.strings.prefix=L.strings.prefix,L.strings.prefix="",U.strings.suffix=L.strings.suffix,L.strings.suffix="");var H=D.length?D[0].label:null;if(D.length){for(var G=0,$=D.length;G<$;G++){var z=D[G],Y=l.Util.cloneToken(L);Y.gender=e.gender,H===z.label&&(Y.formatter=e.formatter),z.numeric&&(Y.successor_prefix=z.successor_prefix),Y.strings.suffix=Y.strings.suffix+S(z.joiningSuffix),z.styling=Y}s.tmp.just_looking||D[0].value.slice(0,1)==='"'&&D[D.length-1].value.slice(-1)==='"'&&(D[0].value=D[0].value.slice(1),D[D.length-1].value=D[D.length-1].value.slice(0,-1),U.decorations.push(["@quotes",!0]))}return U}function I(D,L){var U=!0;if(["locator","locator-extra","page"].indexOf(D)>-1){var H;L.origLabel?H=L.origLabel:H=L.label,U=!!s.getTerm(l.STATUTE_SUBDIV_STRINGS[H])}return U}function C(D,L){return D==="page"||["locator","locator-extra"].indexOf(D)>-1&&(["p."].indexOf(L.label)>-1||["p."].indexOf(L.origLabel)>-1)}function A(D,L,U,H){var G=C(D,L),$=I(D,L);return $&&U==="-"&&H&&((G||["locator","locator-extra","issue","volume","edition","number"].indexOf(D)>-1)&&(U=s.getTerm("page-range-delimiter"),U||(U="\u2013")),D==="collection-number"&&(U=s.getTerm("year-range-delimiter"),U||(U="\u2013"))),U}function y(D,L,U){if(!(L<1)&&U.count===2&&D[L-1].particle===D[L].particle){if(D[L-1].joiningSuffix!=="-"){U.count=1;return}if(!s.opt["page-range-format"]&&parseInt(D[L-1].value,10)>parseInt(D[L].value,10)){D[L-1].joiningSuffix=A(r,D[L],D[L-1].joiningSuffix,!0);return}var H=D[L],G=C(r,H),$;G&&!isNaN(parseInt(D[L-1].value))&&!isNaN(parseInt(D[L].value))?($=D[L-1].particle+D[L-1].value+" - "+D[L].particle+D[L].value,$=s.fun.page_mangler($)):((""+D[L-1].value).match(/^([0-9]+|[ivxlcmIVXLCM]+)$/)&&(""+D[L].value).match(/^([0-9]+|[ivxlcmIVXLCM]+)$/)&&(D[L-1].joiningSuffix=s.getTerm("page-range-delimiter")),$=D[L-1].value+S(D[L-1].joiningSuffix)+D[L].value);var z=$.match(/^((?:[0-9]*[a-zA-Z]+0*))?([0-9]+[a-z]*)(\s*[^0-9]+\s*)([-,a-zA-Z]?0*)([0-9]+[a-z]*)$/);if(z){var Y=z[3];Y=A(r,H,Y,D[L].numeric),D[L-1].particle=z[1],D[L-1].value=z[2],D[L-1].joiningSuffix=Y,D[L].particle=z[4],D[L].value=z[5]}U.count=0}}function _(D){if(e&&["page","chapter-number","collection-number","edition","issue","number","number-of-pages","number-of-volumes","volume","locator","locator-extra"].indexOf(r)!==-1){for(var L={count:0,label:null,lastHadRangeDelimiter:!1},U=0,H=D.length;U<H;U++){var G=D[U];if(G.collapsible)L.label===G.label&&G.joiningSuffix==="-"?L.count=1:L.label===G.label&&G.joiningSuffix!=="-"?(L.count++,L.count===2&&y(D,U,L)):L.label!==G.label?(L.label=G.label,L.count=1):(L.count=1,L.label=G.label);else{L.count=0,L.label=null;var $=G.numeric;G.joiningSuffix=A(r,G,G.joiningSuffix,$)}}L.count===2&&y(D,D.length-1,L)}}function k(D,L,U){var H=D[L];U.length&&(H.numeric=U[0].numeric,H.collapsible=U[0].collapsible,H.plural=U[0].plural,H.label=l.STATUTE_SUBDIV_STRINGS[U[0].label],r==="number"&&H.label==="issue"&&s.getTerm("number")&&(H.label="number"))}if(e&&this.tmp.shadow_numbers[a]&&this.tmp.shadow_numbers[a].values.length){var Q=this.tmp.shadow_numbers[a].values;_(Q),this.tmp.shadow_numbers[a].masterStyling=T(Q);return}if(this.tmp.shadow_numbers[a]||(this.tmp.shadow_numbers[a]={values:[]}),!!t){var O=l.LangPrefsMap[r];if(O){var N=this.opt["cite-lang-prefs"][O][0];i=this.transform.getTextSubField(t,a,"locale-"+N,!0),i=i.name}else i=t[a];if(i&&a==="number"&&t.type==="legal_case"&&(i=i.replace(/[\\]*-/g,"\\-")),i&&this.sys.getAbbreviation){if(this.sys.normalizeAbbrevsKey)var B=this.sys.normalizeAbbrevsKey(a,i);else var B=i;var q=this.transform.loadAbbreviation(t.jurisdiction,"number",B,t.language);this.transform.abbrevs[q].number&&(this.transform.abbrevs[q].number[B]?i=this.transform.abbrevs[q].number[B]:typeof this.transform.abbrevs[q].number[B]!="undefined"&&delete this.transform.abbrevs[q].number[B])}if(typeof i!="undefined"&&(typeof i=="string"||typeof i=="number")){typeof i=="number"&&(i=""+i);var P=l.STATUTE_SUBDIV_STRINGS_REVERSE[r];if(this.tmp.shadow_numbers[a].values.length===0){var Q=v(i,P);b(Q),w(Q);for(var F of Q)F.numeric||(F.plural=0);this.tmp.shadow_numbers[a].values=Q,e&&(_(Q),this.tmp.shadow_numbers[a].masterStyling=T(Q)),k(this.tmp.shadow_numbers,a,Q)}var j=this.tmp.shadow_numbers[a];r==="number"&&j.values.length===1&&j.values[0].value.indexOf("|")>-1&&(j.values[0].value=j.values[0].value.replace(/\|/g,", "),j.values[0].numeric=!0,j.values[0].plural=1,j.values[0].collapsible=!1,j.numeric=!0,j.plural=1,j.collapsible=!1),j.values.length===1&&j.values[0].value.match(/^[0-9]+(?:\/[0-9]+)+$/)&&(j.values[0].numeric=!0,j.values[0].plural=0,j.values[0].collapsible=!1,j.numeric=!0,j.plural=0,j.collapsible=!1),r==="page"&&j.values.length>0&&j.values[0].gotosleepability&&(j.labelForm="short")}}};l.Util.outputNumericField=function(e,t,r){e.output.openLevel(e.tmp.shadow_numbers[t].masterStyling);var i=e.tmp.shadow_numbers[t].masterStyling,s=e.tmp.shadow_numbers[t].values,a=s.length?s[0].label:null,n=e.tmp.shadow_numbers[t].labelForm,o=e.tmp.group_context.tip.label_static,u;n?u=n:u="short";for(var c=e.tmp.shadow_numbers[t].labelCapitalizeIfFirst,p=e.tmp.shadow_numbers[t].labelDecorations,f=null,h=0,m=s.length;h<m;h++){var g=s[h],d="",v;g.label&&(g.label.slice(0,4)==="var:"?v=g.label.slice(4):v=l.STATUTE_SUBDIV_STRINGS[g.label],v&&(g.label===a?(o&&(d=e.getTerm(v,"static",g.plural),d.indexOf("%s")===-1&&(d="")),d||(d=e.getTerm(v,n,g.plural))):(o&&(d=e.getTerm(v,"static",g.plural),d.indexOf("%s")===-1&&(d="")),d||(d=e.getTerm(v,u,g.plural))),c&&(d=l.Output.Formatters["capitalize-first"](e,d))));var b=-1;d&&(b=d.indexOf("%s"));var E=l.Util.cloneToken(g.styling);if(E.formatter=g.styling.formatter,E.type=g.styling.type,E.num=g.styling.num,E.gender=g.styling.gender,b>0&&b<d.length-2)E.strings.prefix+=d.slice(0,b),E.strings.suffix=d.slice(b+2)+E.strings.suffix;else if(g.labelVisibility)if(d||(d=g.label,v=g.label),b>0){var x=new l.Token;x.decorations=p,e.output.append(d.slice(0,b),x)}else(b===d.length-2||b===-1)&&e.output.append(d+g.labelSuffix,"empty");if(l.UPDATE_GROUP_CONTEXT_CONDITION(e,i.strings.prefix,null,i,`${g.particle}${g.value}`),g.collapsible){var w;g.value.match(/^[1-9][0-9]*$/)&&Number.isSafeInteger(parseInt(g.value,10))?w=new l.NumericBlob(e,g.particle,parseInt(g.value,10),E,r):w=new l.NumericBlob(e,g.particle,g.value,E,r),typeof w.gender=="undefined"&&(w.gender=e.locale[e.opt.lang]["noun-genders"][t]),e.output.append(w,"literal")}else e.output.append(g.particle+g.value,E);if(b===0&&b<d.length-2&&(f===null&&(f=v),v!==f||h===s.length-1)){var S=new l.Token;S.decorations=p,e.output.append(d.slice(b+2),S)}f=v,e.tmp.term_predecessor=!0}e.output.closeLevel()};l.Util.PageRangeMangler={};l.Util.PageRangeMangler.getFunction=function(e,t){var r,i,s,a,n,o,u,c,p,f,h,m,g,d,v,b,E,x,w=e.getTerm(t+"-range-delimiter");r=/([0-9]*[a-zA-Z]+0*)?([0-9]+[a-z]*)\s*(?:\u2013|-)\s*([0-9]*[a-zA-Z]+0*)?([0-9]+[a-z]*)/,a=function(T){for(s=T.length,i=1;i<s;i+=2)typeof T[i]=="object"&&(T[i]=T[i].join(""));var I=T.join("");return I=I.replace(/([^\\])\-/g,"$1"+e.getTerm(t+"-range-delimiter")),I},n=function(T){var I,C,A,y="\\s+\\-\\s+",_=w==="-"?"":w,k=new RegExp("([^\\\\])[-"+_+"\\u2013]","g");T=T.replace(k,"$1 - ").replace(/\s+-\s+/g," - ");var Q=new RegExp("((?:[0-9]*[a-zA-Z]+0*)?[0-9]+[a-z]*"+y+"(?:[0-9]*[a-zA-Z]+0*)?[0-9]+[a-z]*)","g"),O=new RegExp("(?:[0-9]*[a-zA-Z]+0*)?[0-9]+[a-z]*"+y+"(?:[0-9]*[a-zA-Z]+0*)?[0-9]+[a-z]*");if(I=T.match(Q),C=T.split(O),C.length===0)A=I;else for(A=[C[0]],i=1,s=C.length;i<s;i+=1)A.push(I[i-1].replace(/\s*\-\s*/g,"-")),A.push(C[i]);return A},o=function(T){for(T=""+T,h=n(T),s=h.length,i=1;i<s;i+=2)m=h[i].match(r),m&&(!m[3]||m[1]===m[3])&&(m[4].length<m[2].length&&(m[4]=m[2].slice(0,m[2].length-m[4].length)+m[4]),parseInt(m[2],10)<parseInt(m[4],10)&&(m[3]=w+(m[1]?m[1]:""),h[i]=m.slice(1))),typeof h[i]=="string"&&(h[i]=h[i].replace(/\-/g,w));return h},u=function(T,I,C){s=T.length;for(var A=1,y=T.length;A<y;A+=2)typeof T[A]=="object"&&(T[A][3]=c(T[A][1],T[A][3],I,C),T[A][2].slice(1)===T[A][0]&&(T[A][2]=w));return a(T)},c=function(T,I,C,A){if(C||(C=0),g=(""+T).split(""),d=(""+I).split(""),v=d.slice(),v.reverse(),g.length===d.length)for(var y=0,_=g.length;y<_;y+=1)if(g[y]===d[y]&&v.length>C)v.pop();else{if(C&&A&&v.length===3){var k=g.slice(0,y);k.reverse(),v=v.concat(k)}break}return v.reverse(),v.join("")},p=function(T){for(s=T.length,i=1;i<s;i+=2)typeof T[i]=="object"&&(m=T[i],b=parseInt(m[1],10),E=parseInt(m[3],10),b>100&&b%100&&parseInt(b/100,10)===parseInt(E/100,10)?m[3]=""+E%100:b>=1e4&&(m[3]=""+E%1e3)),m[2].slice(1)===m[0]&&(m[2]=w);return a(T)},f=function(T){for(s=T.length,i=1;i<s;i+=2){if(typeof T[i]=="object"&&(m=T[i],b=parseInt(m[1],10),E=parseInt(m[3],10),d=""+E,b>100&&b%100))for(var I=2;I<d.length;I++){var C=Math.pow(10,I);if(Math.floor(b/C)===Math.floor(E/C)){m[3]=""+E%C;break}}m[2].slice(1)===m[0]&&(m[2]=w)}return a(T)};var S=function(T,I,C,A){var _;T=""+T;var y=o(T),_=I(y,C,A);return _};return e.opt[t+"-range-format"]?e.opt[t+"-range-format"]==="expanded"?x=function(T){return S(T,a)}:e.opt[t+"-range-format"]==="minimal"?x=function(T){return S(T,u)}:e.opt[t+"-range-format"]==="minimal-two"?x=function(T,I){return S(T,u,2,I)}:e.opt[t+"-range-format"]==="chicago"?x=function(T){return S(T,p)}:e.opt[t+"-range-format"]==="chicago-15"?x=function(T){return S(T,p)}:e.opt[t+"-range-format"]==="chicago-16"&&(x=function(T){return S(T,f)}):x=function(T){return S(T,a)},x};l.Util.FlipFlopper=function(e){var t=[],r={'<span class="nocase">':{type:"nocase",opener:'<span class="nocase">',closer:"</span>",attr:null,outer:null,flipflop:null},'<span class="nodecor">':{type:"nodecor",opener:'<span class="nodecor">',closer:"</span>",attr:"@class",outer:"nodecor",flipflop:{nodecor:"nodecor"}},'<span style="font-variant:small-caps;">':{type:"tag",opener:'<span style="font-variant:small-caps;">',closer:"</span>",attr:"@font-variant",outer:"small-caps",flipflop:{"small-caps":"normal",normal:"small-caps"}},"<sc>":{type:"tag",opener:"<sc>",closer:"</sc>",attr:"@font-variant",outer:"small-caps",flipflop:{"small-caps":"normal",normal:"small-caps"}},"<i>":{type:"tag",opener:"<i>",closer:"</i>",attr:"@font-style",outer:"italic",flipflop:{italic:"normal",normal:"italic"}},"<b>":{type:"tag",opener:"<b>",closer:"</b>",attr:"@font-weight",outer:"bold",flipflop:{bold:"normal",normal:"bold"}},"<sup>":{type:"tag",opener:"<sup>",closer:"</sup>",attr:"@vertical-align",outer:"sup",flipflop:{sub:"sup",sup:"sup"}},"<sub>":{type:"tag",opener:"<sub>",closer:"</sub>",attr:"@vertical-align",outer:"sub",flipflop:{sup:"sub",sub:"sub"}},' "':{type:"quote",opener:' "',closer:'"',attr:"@quotes",outer:"true",flipflop:{true:"inner",inner:"true",false:"true"}}," '":{type:"quote",opener:" '",closer:"'",attr:"@quotes",outer:"inner",flipflop:{true:"inner",inner:"true",false:"true"}}};r['("']=r[' "'],r["('"]=r[" '"];var i=e.getTerm("open-quote"),s=e.getTerm("close-quote"),a=e.getTerm("open-inner-quote"),n=e.getTerm("close-inner-quote");i&&s&&[' "'," '",'"',"'"].indexOf(i)===-1&&(r[i]=JSON.parse(JSON.stringify(r[' "'])),r[i].opener=i,r[i].closer=s),a&&n&&[' "'," '",'"',"'"].indexOf(a)===-1&&(r[a]=JSON.parse(JSON.stringify(r[" '"])),r[a].opener=a,r[a].closer=n);function o(E){var x={" '":' "',' "':" '",'("':"('","('":'("'};r[E].outer="true",r[x[E]].outer="inner"}function u(E){for(var x=[],w=Object.keys(r),S=0,T=w.length;S<T;S++){var I=w[S];(r[E].type!=="quote"||!r[E])&&x.push(I)}var C=r[E];return C.opener=new RegExp("^(?:"+x.map(function(A){return A.replace("(","\\(")}).join("|")+")"),C}var c=function(){for(var E={},x=Object.keys(r),w=0,S=x.length;w<S;w++){var T=x[w];E[T]=u(T)}return E}(),p=function(){var E=[],x=[],w={};for(var S in c)E.push(S),w[c[S].closer]=!0;for(var T=Object.keys(w),I=0,C=T.length;I<C;I++){var A=T[I];x.push(A)}var y=E.concat(x).map(function(_){return _.replace("(","\\(")}).join("|");return{matchAll:new RegExp("((?:"+y+"))","g"),splitAll:new RegExp("(?:"+y+")","g"),open:new RegExp("(^(?:"+E.map(function(_){return _.replace("(","\\(")}).join("|")+")$)"),close:new RegExp("(^(?:"+x.join("|")+")$)")}}();function f(E,x){var w=t[t.length-1];return!w||E.match(w.opener)?(t.push({type:c[E].type,opener:c[E].opener,closer:c[E].closer,pos:x}),!1):(t.pop(),t.push({type:c[E].type,opener:c[E].opener,closer:c[E].closer,pos:x}),{fixtag:w.pos})}function h(E,x){var w=t[t.length-1];return w&&E===w.closer?(t.pop(),w.type==="nocase"?{nocase:{open:w.pos,close:x}}:!1):w?{fixtag:w.pos}:{fixtag:x}}function m(E,x){return E.match(p.open)?f(E,x):h(E,x)}function g(E){var x=[];E=E.replace(/(<span)\s+(style=\"font-variant:)\s*(small-caps);?\"[^>]*(>)/g,'$1 $2$3;"$4'),E=E.replace(/(<span)\s+(class=\"no(?:case|decor)\")[^>]*(>)/g,"$1 $2$3");var w=E.match(p.matchAll);if(!w)return{tags:[],strings:[E],forcedSpaces:[]};for(var S=E.split(p.splitAll),T=0,I=w.length-1;T<I;T++)r[w[T]]&&(S[T+1]===""&&['"',"'"].indexOf(w[T+1])>-1?(w[T+1]=" "+w[T+1],x.push(!0)):x.push(!1));return{tags:w,strings:S,forcedSpaces:x}}var d=function(E){var x=[];this.set=function(w){for(var S=r[w].attr,T=null,I=x.length-1;I>-1;I--){var C=x[I];if(C[0]===S){T=C;break}}if(!T){var A=[e[e.tmp.area].opt.layout_decorations].concat(E.alldecor);e:for(var I=A.length-1;I>-1;I--){var y=A[I];if(y)for(var _=y.length-1;_>-1;_--){var C=y[_];if(C[0]===S){T=C;break e}}}}T?T=[S,r[w].flipflop[T[1]]]:T=[S,r[w].outer],x.push(T)},this.pair=function(){return x[x.length-1]},this.pop=function(){x.pop()}};function v(E,x){if(E==="'"){if(x&&x.match(/^[^\,\.\?\:\;\ ]/))return"\u2019"}else if(E===" '"&&x&&x.match(/^[\ ]/))return" \u2019";return!1}function b(E,x,w){var S=!0,T=new d(E);E.blobs=[];function I(Q){this.stack=[Q],this.latest=Q,this.addStyling=function(O,N){if(S&&(O.slice(0,1)===" "&&(O=O.slice(1)),O.slice(0,1)===" "&&(O=O.slice(1)),S=!1),this.latest=this.stack[this.stack.length-1],N){if(typeof this.latest.blobs=="string"){var B=new l.Blob;B.blobs=this.latest.blobs,B.alldecor=this.latest.alldecor.slice(),this.latest.blobs=[B]}var q=new l.Token,P=new l.Blob(null,q);if(P.alldecor=this.latest.alldecor.slice(),N[0]==="@class"&&N[1]==="nodecor"){for(var F=[],j={},D=[e[e.tmp.area].opt.layout_decorations].concat(P.alldecor),L=D.length-1;L>-1;L--){var U=D[L];if(U)for(var H=U.length-1;H>-1;H--){var G=U[H];["@font-weight","@font-style","@font-variant"].indexOf(G[0])>-1&&!j[G[0]]&&(N[1]!=="normal"&&(P.decorations.push([G[0],"normal"]),F.push([G[0],"normal"])),j[G[0]]=!0)}}P.alldecor.push(F)}else P.decorations.push(N),P.alldecor.push([N]);if(this.latest.blobs.push(P),this.stack.push(P),this.latest=P,O){var q=new l.Token,P=new l.Blob(null,q);P.blobs=O,P.alldecor=this.latest.alldecor.slice(),this.latest.blobs.push(P)}}else if(O){var B=new l.Blob;B.blobs=O,B.alldecor=this.latest.alldecor.slice(),this.latest.blobs.push(B)}},this.popStyling=function(){this.stack.pop()}}var C=new I(E);if(x.strings.length){var A=x.strings[0];w&&(A=" "+A),C.addStyling(A)}for(var y=0,_=x.tags.length;y<_;y++){var k=x.tags[y],A=x.strings[y+1];k.match(p.open)?(T.set(k),C.addStyling(A,T.pair())):(T.pop(),C.popStyling(),C.addStyling(A))}}this.processTags=function(E){var S=E.blobs,x=!1;S.slice(0,1)===" "&&!S.match(/^\s+[\'\"]/)&&(x=!0);var w=new RegExp("("+l.ROMANESQUE_REGEXP.source+")\u2019("+l.ROMANESQUE_REGEXP.source+")","g"),S=" "+S.replace(w,"$1'$2"),T=g(S);if(T.tags.length!==0){for(var I=!1,C=0,A=T.tags.length;C<A;C++){var y=T.tags[C],S=T.strings[C+1],_=v(y,S);if(_)T.strings[C+1]=_+T.strings[C+1],T.tags[C]="";else{for(var k;k=m(y,C),k;)if(Object.keys(k).indexOf("fixtag")>-1){if(y.match(p.close)&&y==="'")T.strings[C+1]="\u2019"+T.strings[C+1],T.tags[C]="";else{var Q=T.tags[k.fixtag];T.forcedSpaces[k.fixtag-1]&&(Q=Q.slice(1)),T.strings[k.fixtag+1]=Q+T.strings[k.fixtag+1],T.tags[k.fixtag]=""}if(t.length>0)if(y!=="'")t.pop();else break;else break}else if(k.nocase){T.tags[k.nocase.open]="",T.tags[k.nocase.close]="";break}else break;k&&(k.fixtag||k.fixtag===0)&&(T.strings[C+1]=T.tags[C]+T.strings[C+1],T.tags[C]="")}}for(var C=t.length-1;C>-1;C--){var O=t[C].pos,y=T.tags[O];y===" '"||y==="'"?T.strings[O+1]=" \u2019"+T.strings[O+1]:T.strings[O+1]=T.tags[O]+T.strings[O+1],T.tags[O]="",t.pop()}for(var C=T.tags.length-1;C>-1;C--)T.tags[C]||(T.tags=T.tags.slice(0,C).concat(T.tags.slice(C+1)),T.strings[C]=T.strings[C]+T.strings[C+1],T.strings=T.strings.slice(0,C+1).concat(T.strings.slice(C+2)));for(var C=0,A=T.tags.length;C<A;C++){var y=T.tags[C],N=T.forcedSpaces[C-1];[' "'," '",'("',"('"].indexOf(y)>-1&&(I||(o(y),I=!0),N||(T.strings[C]+=y.slice(0,1)))}b(E,T,x)}}};l.Output.Formatters=function(){var e=`(?:\u2018|\u2019|\u201C|\u201D| "| '|"|'|[-\u2013\u2014/.,;?!:]|\\[|\\]|\\(|\\)|<span style="font-variant: small-caps;">|<span class="no(?:case|decor)">|</span>|</?(?:i|sc|b|sub|sup)>)`,t=new l.Doppeler(e,function(d){return d.replace(/(<span)\s+(class=\"no(?:case|decor)\")[^>]*(>)/g,"$1 $2$3").replace(/(<span)\s+(style=\"font-variant:)\s*(small-caps);?(\")[^>]*(>)/g,"$1 $2 $3;$4$5")}),r='(?:[-\\s]*<\\/*(?:spans+class="no(?:case|decor)"|i|sc|b|sub|sup)>[-\\s]*|[-\\s]+)',i=new l.Doppeler(r),s=new l.Doppeler("(?:[\xA0 \xA0\u2000-\u200B\u205F\u3000]+)"),a={'<span style="font-variant: small-caps;">':"</span>",'<span class="nocase">':"</span>",'<span class="nodecor">':"</span>","<sc>":"</sc>","<sub>":"</sub>","<sup>":"</sup>"};function n(d){var v=d.match(/(^\s*)((?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]))(.*)/);return v&&!(v[2].match(/^[\u0370-\u03FF]$/)&&!v[3])?v[1]+l.toLocaleUpperCase.call(this,v[2])+v[3]:d}function o(d,v){if(!v)return"";d.doppel=t.split(v);var b={' "':{opener:" '",closer:'"'}," '":{opener:' "',closer:"'"},"\u2018":{opener:"\u2018",closer:"\u2019"},"\u201C":{opener:"\u201C",closer:"\u201D"}};function E(O,N){if(d.quoteState.length===0||O===d.quoteState[d.quoteState.length-1].opener)return d.quoteState.push({opener:b[O].opener,closer:b[O].closer,pos:N}),!1;var B=d.quoteState[d.quoteState.length-1].pos;return d.quoteState.pop(),d.quoteState.push({opener:b[O].opener,closer:b[O].closer,positions:N}),B}function x(O,N){if(d.quoteState.length>0&&O===d.quoteState[d.quoteState.length-1].closer)d.quoteState.pop();else return N}function w(O,N){var B=["\u201C","\u2018",' "'," '"].indexOf(O)>-1;return B?E(O,N):x(O,N)}function S(O,N){var B=O.match(/(^(?:\u2018|\u2019|\u201C|\u201D|\"|\')|(?: \"| \')$)/);if(B)return w(B[1],N)}d.doppel.strings.length&&d.doppel.strings[0].trim()&&(d.doppel.strings[0]=d.capitaliseWords(d.doppel.strings[0],0,d.doppel.tags[0]));for(var T=0,I=d.doppel.tags.length;T<I;T++){var C=d.doppel.tags[T],A=d.doppel.strings[T+1];if(d.tagState!==null&&(a[C]?d.tagState.push(a[C]):d.tagState.length&&C===d.tagState[d.tagState.length-1]&&d.tagState.pop()),d.afterPunct!==null&&C.match(/[\!\?\:]$/)&&(d.afterPunct=!0),d.tagState.length===0?d.doppel.strings[T+1]=d.capitaliseWords(A,T+1,d.doppel,d.doppel.tags[T+1]):d.doppel.strings[T+1].trim()&&(d.lastWordPos=null),d.quoteState!==null){var y=S(C,T);if(y||y===0){var _=d.doppel.origStrings[y+1].slice(0,1);d.doppel.strings[y+1]=_+d.doppel.strings[y+1].slice(1),d.lastWordPos=null}}d.isFirst&&A.trim()&&(d.isFirst=!1),d.afterPunct&&A.trim()&&(d.afterPunct=!1)}if(d.quoteState)for(var T=0,I=d.quoteState.length;T<I;T++){var y=d.quoteState[T].pos;if(typeof y!="undefined"){var _=d.doppel.origStrings[y+1].slice(0,1);d.doppel.strings[y+1]=_+d.doppel.strings[y+1].slice(1)}}if(d.lastWordPos){var k=s.split(d.doppel.strings[d.lastWordPos.strings]),Q=k.strings[d.lastWordPos.words];Q.length>1&&l.toLocaleLowerCase.call(this,Q).match(d.skipWordsRex)&&(Q=n.call(this,Q),k.strings[d.lastWordPos.words]=Q),d.doppel.strings[d.lastWordPos.strings]=s.join(k)}return t.join(d.doppel)}function u(d,v){return v}function c(d,v){var b={quoteState:null,capitaliseWords:function(E){for(var x=E.split(" "),w=0,S=x.length;w<S;w++){var T=x[w];T&&(x[w]=l.toLocaleLowerCase.call(d,T))}return x.join(" ")},skipWordsRex:null,tagState:[],afterPunct:null,isFirst:null};return o.call(d,b,v)}function p(d,v){var b={quoteState:null,capitaliseWords:function(E){for(var x=E.split(" "),w=0,S=x.length;w<S;w++){var T=x[w];T&&(x[w]=l.toLocaleUpperCase.call(d,T))}return x.join(" ")},skipWordsRex:null,tagState:[],afterPunct:null,isFirst:null};return o.call(d,b,v)}function f(d,v){var b={quoteState:[],capitaliseWords:function(E){for(var x=E.split(" "),w=0,S=x.length;w<S;w++){var T=x[w];T&&(b.isFirst?(x[w]=n.call(d,T),b.isFirst=!1):x[w]=l.toLocaleLowerCase.call(d,T))}return x.join(" ")},skipWordsRex:null,tagState:[],afterPunct:null,isFirst:!0};return o.call(d,b,v)}function h(d,v){var b={quoteState:[],capitaliseWords:function(E,x,w){if(E.trim()){for(var S=s.split(E),T=S.strings,I=0,C=T.length;I<C;I++){var A=T[I];if(!A)continue;let y=l.toLocaleLowerCase.call(d,A),_=!1;(A.length>1&&!y.match(b.skipWordsRex)||I===T.length-1&&w==="-"||b.isFirst||b.afterPunct)&&(_=!0),_&&A===y&&(T[I]=n.call(d,A)),b.afterPunct=!1,b.isFirst=!1,b.lastWordPos={strings:x,words:I}}E=s.join(S)}return E},skipWordsRex:d.locale[d.opt.lang].opts["skip-words-regexp"],tagState:[],afterPunct:!1,isFirst:!0};return o.call(d,b,v)}function m(d,v){var b={quoteState:[],capitaliseWords:function(E){for(var x=s.split(E),w=x.strings,S=0,T=w.length;S<T;S++){var I=w[S];if(I&&b.isFirst){I===l.toLocaleLowerCase.call(d,I)&&(w[S]=n.call(d,I)),b.isFirst=!1;break}}return s.join(x)},skipWordsRex:null,tagState:[],afterPunct:null,isFirst:!0};return o.call(d,b,v)}function g(d,v){var b={quoteState:[],capitaliseWords:function(E){for(var x=s.split(E),w=x.strings,S=0,T=w.length;S<T;S++){var I=w[S];I&&I===l.toLocaleLowerCase.call(d,I)&&(w[S]=n.call(d,I))}return s.join(x)},skipWordsRex:null,tagState:[],afterPunct:null,isFirst:null};return o.call(d,b,v)}return{nameDoppel:i,passthrough:u,lowercase:c,uppercase:p,sentence:f,title:h,"capitalize-first":m,"capitalize-all":g}}();l.Output.Formats=function(){};l.Output.Formats.prototype.html={text_escape:function(e){return e||(e=""),e.replace(/&/g,"&#38;").replace(/</g,"&#60;").replace(/>/g,"&#62;").replace(/\s\s/g,"\xA0 ").replace(l.SUPERSCRIPTS_REGEXP,function(t){return"<sup>"+l.SUPERSCRIPTS[t]+"</sup>"})},bibstart:`<div class="csl-bib-body">
`,bibend:"</div>","@font-style/italic":"<i>%%STRING%%</i>","@font-style/oblique":"<em>%%STRING%%</em>","@font-style/normal":'<span style="font-style:normal;">%%STRING%%</span>',"@font-variant/small-caps":'<span style="font-variant:small-caps;">%%STRING%%</span>',"@passthrough/true":l.Output.Formatters.passthrough,"@font-variant/normal":'<span style="font-variant:normal;">%%STRING%%</span>',"@font-weight/bold":"<b>%%STRING%%</b>","@font-weight/normal":'<span style="font-weight:normal;">%%STRING%%</span>',"@font-weight/light":!1,"@text-decoration/none":'<span style="text-decoration:none;">%%STRING%%</span>',"@text-decoration/underline":'<span style="text-decoration:underline;">%%STRING%%</span>',"@vertical-align/sup":"<sup>%%STRING%%</sup>","@vertical-align/sub":"<sub>%%STRING%%</sub>","@vertical-align/baseline":'<span style="baseline">%%STRING%%</span>',"@strip-periods/true":l.Output.Formatters.passthrough,"@strip-periods/false":l.Output.Formatters.passthrough,"@quotes/true":function(e,t){return typeof t=="undefined"?e.getTerm("open-quote"):e.getTerm("open-quote")+t+e.getTerm("close-quote")},"@quotes/inner":function(e,t){return typeof t=="undefined"?"\u2019":e.getTerm("open-inner-quote")+t+e.getTerm("close-inner-quote")},"@quotes/false":!1,"@cite/entry":function(e,t){return e.sys.wrapCitationEntry(t,this.item_id,this.locator_txt,this.suffix_txt)},"@bibliography/entry":function(e,t){var r="";return e.sys.embedBibliographyEntry&&(r=e.sys.embedBibliographyEntry(this.item_id)+`
`),'  <div class="csl-entry">'+t+`</div>
`+r},"@display/block":function(e,t){return`

    <div class="csl-block">`+t+`</div>
`},"@display/left-margin":function(e,t){return`
    <div class="csl-left-margin">`+t+"</div>"},"@display/right-inline":function(e,t){return'<div class="csl-right-inline">'+t+`</div>
  `},"@display/indent":function(e,t){return'<div class="csl-indent">'+t+`</div>
  `},"@showid/true":function(e,t,r){if(!e.tmp.just_looking&&!e.tmp.suppress_decorations){if(r)return'<span class="'+e.opt.nodenames[r]+'" cslid="'+r+'">'+t+"</span>";if(this.params&&typeof t=="string"){var i="";if(t){var s=t.match(l.VARIABLE_WRAPPER_PREPUNCT_REX);i=s[1],t=s[2]}var a="";return t&&l.SWAPPING_PUNCTUATION.indexOf(t.slice(-1))>-1&&(a=t.slice(-1),t=t.slice(0,-1)),e.sys.variableWrapper(this.params,i,t,a)}else return t}else return t},"@URL/true":function(e,t){return'<a href="'+t+'">'+t+"</a>"},"@DOI/true":function(e,t){var r=t;return t.match(/^https?:\/\//)||(r="https://doi.org/"+t),'<a href="'+r+'">'+t+"</a>"}};l.Output.Formats.prototype.text={text_escape:function(e){return e||(e=""),e},bibstart:"",bibend:"","@font-style/italic":!1,"@font-style/oblique":!1,"@font-style/normal":!1,"@font-variant/small-caps":!1,"@passthrough/true":l.Output.Formatters.passthrough,"@font-variant/normal":!1,"@font-weight/bold":!1,"@font-weight/normal":!1,"@font-weight/light":!1,"@text-decoration/none":!1,"@text-decoration/underline":!1,"@vertical-align/baseline":!1,"@vertical-align/sup":!1,"@vertical-align/sub":!1,"@strip-periods/true":l.Output.Formatters.passthrough,"@strip-periods/false":l.Output.Formatters.passthrough,"@quotes/true":function(e,t){return typeof t=="undefined"?e.getTerm("open-quote"):e.getTerm("open-quote")+t+e.getTerm("close-quote")},"@quotes/inner":function(e,t){return typeof t=="undefined"?"\u2019":e.getTerm("open-inner-quote")+t+e.getTerm("close-inner-quote")},"@quotes/false":!1,"@cite/entry":function(e,t){return e.sys.wrapCitationEntry(t,this.item_id,this.locator_txt,this.suffix_txt)},"@bibliography/entry":function(e,t){return t+`
`},"@display/block":function(e,t){return`
`+t},"@display/left-margin":function(e,t){return t+" "},"@display/right-inline":function(e,t){return t},"@display/indent":function(e,t){return`
    `+t},"@showid/true":function(e,t){return t},"@URL/true":function(e,t){return t},"@DOI/true":function(e,t){return t}};l.Output.Formats.prototype.rtf={text_escape:function(e){return e||(e=""),e.replace(/([\\{}])/g,"\\$1").replace(l.SUPERSCRIPTS_REGEXP,function(t){return"\\super "+l.SUPERSCRIPTS[t]+"\\nosupersub{}"}).replace(/[\u007F-\uFFFF]/g,function(t){return"\\uc0\\u"+t.charCodeAt(0).toString()+"{}"}).split("	").join("\\tab{}")},"@passthrough/true":l.Output.Formatters.passthrough,"@font-style/italic":"{\\i{}%%STRING%%}","@font-style/normal":"{\\i0{}%%STRING%%}","@font-style/oblique":"{\\i{}%%STRING%%}","@font-variant/small-caps":"{\\scaps %%STRING%%}","@font-variant/normal":"{\\scaps0{}%%STRING%%}","@font-weight/bold":"{\\b{}%%STRING%%}","@font-weight/normal":"{\\b0{}%%STRING%%}","@font-weight/light":!1,"@text-decoration/none":!1,"@text-decoration/underline":"{\\ul{}%%STRING%%}","@vertical-align/baseline":!1,"@vertical-align/sup":"\\super %%STRING%%\\nosupersub{}","@vertical-align/sub":"\\sub %%STRING%%\\nosupersub{}","@strip-periods/true":l.Output.Formatters.passthrough,"@strip-periods/false":l.Output.Formatters.passthrough,"@quotes/true":function(e,t){return typeof t=="undefined"?l.Output.Formats.rtf.text_escape(e.getTerm("open-quote")):l.Output.Formats.rtf.text_escape(e.getTerm("open-quote"))+t+l.Output.Formats.rtf.text_escape(e.getTerm("close-quote"))},"@quotes/inner":function(e,t){return typeof t=="undefined"?l.Output.Formats.rtf.text_escape("\u2019"):l.Output.Formats.rtf.text_escape(e.getTerm("open-inner-quote"))+t+l.Output.Formats.rtf.text_escape(e.getTerm("close-inner-quote"))},"@quotes/false":!1,bibstart:"{\\rtf ",bibend:"}","@display/block":`\\line{}%%STRING%%\\line\r
`,"@cite/entry":function(e,t){return e.sys.wrapCitationEntry(t,this.item_id,this.locator_txt,this.suffix_txt)},"@bibliography/entry":function(e,t){return t},"@display/left-margin":function(e,t){return t+"\\tab "},"@display/right-inline":function(e,t){return t+`\r
`},"@display/indent":function(e,t){return`
\\tab `+t+`\\line\r
`},"@showid/true":function(e,t){if(!e.tmp.just_looking&&!e.tmp.suppress_decorations){var r="";if(t){var i=t.match(l.VARIABLE_WRAPPER_PREPUNCT_REX);r=i[1],t=i[2]}var s="";return t&&l.SWAPPING_PUNCTUATION.indexOf(t.slice(-1))>-1&&(s=t.slice(-1),t=t.slice(0,-1)),e.sys.variableWrapper(this.params,r,t,s)}else return t},"@URL/true":function(e,t){return t},"@DOI/true":function(e,t){return t}};l.Output.Formats.prototype.asciidoc={text_escape:function(e){return e||(e=""),e.replace("*","pass:[*]","g").replace("_","pass:[_]","g").replace("#","pass:[#]","g").replace("^","pass:[^]","g").replace("~","pass:[~]","g").replace("[[","pass:[[[]","g").replace("  ","&#160; ","g").replace(l.SUPERSCRIPTS_REGEXP,function(t){return"^"+l.SUPERSCRIPTS[t]+"^"})},bibstart:"",bibend:"","@passthrough/true":l.Output.Formatters.passthrough,"@font-style/italic":"__%%STRING%%__","@font-style/oblique":"__%%STRING%%__","@font-style/normal":!1,"@font-variant/small-caps":"[small-caps]#%%STRING%%#","@font-variant/normal":!1,"@font-weight/bold":"**%%STRING%%**","@font-weight/normal":!1,"@font-weight/light":!1,"@text-decoration/none":!1,"@text-decoration/underline":"[underline]##%%STRING%%##","@vertical-align/sup":"^^%%STRING%%^^","@vertical-align/sub":"~~%%STRING%%~~","@vertical-align/baseline":!1,"@strip-periods/true":l.Output.Formatters.passthrough,"@strip-periods/false":l.Output.Formatters.passthrough,"@quotes/true":function(e,t){return typeof t=="undefined"?"``":"``"+t+"''"},"@quotes/inner":function(e,t){return typeof t=="undefined"?"`":"`"+t+"'"},"@quotes/false":!1,"@cite/entry":function(e,t){return e.sys.wrapCitationEntry(t,this.item_id,this.locator_txt,this.suffix_txt)},"@bibliography/entry":function(e,t){return t+`
`},"@display/block":function(e,t){return t},"@display/left-margin":function(e,t){return t},"@display/right-inline":function(e,t){return" "+t},"@display/indent":function(e,t){return" "+t},"@showid/true":function(e,t){if(!e.tmp.just_looking&&!e.tmp.suppress_decorations&&this.params&&typeof t=="string"){var r="";if(t){var i=t.match(l.VARIABLE_WRAPPER_PREPUNCT_REX);r=i[1],t=i[2]}var s="";return t&&l.SWAPPING_PUNCTUATION.indexOf(t.slice(-1))>-1&&(s=t.slice(-1),t=t.slice(0,-1)),e.sys.variableWrapper(this.params,r,t,s)}else return t},"@URL/true":function(e,t){return t},"@DOI/true":function(e,t){var r=t;return t.match(/^https?:\/\//)||(r="https://doi.org/"+t),r+"["+t+"]"}};l.Output.Formats.prototype.fo={text_escape:function(e){return e||(e=""),e.replace(/&/g,"&#38;").replace(/</g,"&#60;").replace(/>/g,"&#62;").replace("  ","&#160; ","g").replace(l.SUPERSCRIPTS_REGEXP,function(t){return'<fo:inline vertical-align="super">'+l.SUPERSCRIPTS[t]+"</fo:inline>"})},bibstart:"",bibend:"","@passthrough/true":l.Output.Formatters.passthrough,"@font-style/italic":'<fo:inline font-style="italic">%%STRING%%</fo:inline>',"@font-style/oblique":'<fo:inline font-style="oblique">%%STRING%%</fo:inline>',"@font-style/normal":'<fo:inline font-style="normal">%%STRING%%</fo:inline>',"@font-variant/small-caps":'<fo:inline font-variant="small-caps">%%STRING%%</fo:inline>',"@font-variant/normal":'<fo:inline font-variant="normal">%%STRING%%</fo:inline>',"@font-weight/bold":'<fo:inline font-weight="bold">%%STRING%%</fo:inline>',"@font-weight/normal":'<fo:inline font-weight="normal">%%STRING%%</fo:inline>',"@font-weight/light":'<fo:inline font-weight="lighter">%%STRING%%</fo:inline>',"@text-decoration/none":'<fo:inline text-decoration="none">%%STRING%%</fo:inline>',"@text-decoration/underline":'<fo:inline text-decoration="underline">%%STRING%%</fo:inline>',"@vertical-align/sup":'<fo:inline vertical-align="super">%%STRING%%</fo:inline>',"@vertical-align/sub":'<fo:inline vertical-align="sub">%%STRING%%</fo:inline>',"@vertical-align/baseline":'<fo:inline vertical-align="baseline">%%STRING%%</fo:inline>',"@strip-periods/true":l.Output.Formatters.passthrough,"@strip-periods/false":l.Output.Formatters.passthrough,"@quotes/true":function(e,t){return typeof t=="undefined"?e.getTerm("open-quote"):e.getTerm("open-quote")+t+e.getTerm("close-quote")},"@quotes/inner":function(e,t){return typeof t=="undefined"?"\u2019":e.getTerm("open-inner-quote")+t+e.getTerm("close-inner-quote")},"@quotes/false":!1,"@cite/entry":function(e,t){return e.sys.wrapCitationEntry(t,this.item_id,this.locator_txt,this.suffix_txt)},"@bibliography/entry":function(e,t){var r="";if(e.bibliography&&e.bibliography.opt&&e.bibliography.opt.hangingindent){var i=e.bibliography.opt.hangingindent;r=' start-indent="'+i+'em" text-indent="-'+i+'em"'}var s="";return e.sys.embedBibliographyEntry&&(s=e.sys.embedBibliographyEntry(this.item_id)+`
`),'<fo:block id="'+this.system_id+'"'+r+">"+t+`</fo:block>
`+s},"@display/block":function(e,t){return`
  <fo:block>`+t+`</fo:block>
`},"@display/left-margin":function(e,t){return`
  <fo:table table-layout="fixed" width="100%">
    <fo:table-column column-number="1" column-width="$$$__COLUMN_WIDTH_1__$$$"/>
    <fo:table-column column-number="2" column-width="proportional-column-width(1)"/>
    <fo:table-body>
      <fo:table-row>
        <fo:table-cell>
          <fo:block>`+t+`</fo:block>
        </fo:table-cell>
        `},"@display/right-inline":function(e,t){return`<fo:table-cell>
          <fo:block>`+t+`</fo:block>
        </fo:table-cell>
      </fo:table-row>
    </fo:table-body>
  </fo:table>
`},"@display/indent":function(e,t){return'<fo:block margin-left="2em">'+t+`</fo:block>
`},"@showid/true":function(e,t){if(!e.tmp.just_looking&&!e.tmp.suppress_decorations&&this.params&&typeof t=="string"){var r="";if(t){var i=t.match(l.VARIABLE_WRAPPER_PREPUNCT_REX);r=i[1],t=i[2]}var s="";return t&&l.SWAPPING_PUNCTUATION.indexOf(t.slice(-1))>-1&&(s=t.slice(-1),t=t.slice(0,-1)),e.sys.variableWrapper(this.params,r,t,s)}else return t},"@URL/true":function(e,t){return`<fo:basic-link external-destination="url('`+t+`')">`+t+"</fo:basic-link>"},"@DOI/true":function(e,t){var r=t;return t.match(/^https?:\/\//)||(r="https://doi.org/"+t),`<fo:basic-link external-destination="url('`+r+`')">`+t+"</fo:basic-link>"}};l.Output.Formats.prototype.latex={text_escape:function(e){return e||(e=""),e},bibstart:"\\begin{thebibliography}{4}",bibend:"\\end{thebibliography}","@font-style/italic":"{\\em %%STRING%%}","@font-style/oblique":!1,"@font-style/normal":!1,"@font-variant/small-caps":!1,"@passthrough/true":l.Output.Formatters.passthrough,"@font-variant/normal":!1,"@font-weight/bold":"{\\bf %%STRING%%}","@font-weight/normal":!1,"@font-weight/light":!1,"@text-decoration/none":!1,"@text-decoration/underline":!1,"@vertical-align/baseline":!1,"@vertical-align/sup":!1,"@vertical-align/sub":!1,"@strip-periods/true":l.Output.Formatters.passthrough,"@strip-periods/false":l.Output.Formatters.passthrough,"@quotes/true":function(e,t){return typeof t=="undefined"?e.getTerm("open-quote"):e.getTerm("open-quote")+t+e.getTerm("close-quote")},"@quotes/inner":function(e,t){return typeof t=="undefined"?"\u2019":e.getTerm("open-inner-quote")+t+e.getTerm("close-inner-quote")},"@quotes/false":!1,"@cite/entry":function(e,t){return e.sys.wrapCitationEntry(t,this.item_id,this.locator_txt,this.suffix_txt)},"@bibliography/entry":function(e,t){return"\\bibitem{"+e.sys.embedBibliographyEntry(this.item_id)+`}
`},"@display/block":function(e,t){return`
`+t},"@display/left-margin":function(e,t){return t},"@display/right-inline":function(e,t){return t},"@display/indent":function(e,t){return`
    `+t},"@showid/true":function(e,t,r){return t},"@URL/true":function(e,t){return t},"@DOI/true":function(e,t){return t}};l.Output.Formats=new l.Output.Formats;l.Registry=function(e){this.debug=!1,this.state=e,this.registry={},this.reflist=[],this.refhash={},this.namereg=new l.Registry.NameReg(e),this.citationreg=new l.Registry.CitationReg(e),this.authorstrings={},this.masterMap={},this.mylist=[],this.myhash={},this.deletes=[],this.inserts=[],this.uncited={},this.refreshes={},this.akeys={},this.oldseq={},this.return_data={},this.ambigcites={},this.ambigresets={},this.sorter=new l.Registry.Comparifier(e,"bibliography_sort"),this.getSortedIds=function(){for(var t=[],r=0,i=this.reflist.length;r<i;r+=1)t.push(""+this.reflist[r].id);return t},this.getSortedRegistryItems=function(){for(var t=[],r=0,i=this.reflist.length;r<i;r+=1)t.push(this.reflist[r]);return t}};l.Registry.prototype.init=function(e,t){var r,i;if(this.oldseq={},t){this.uncited={};for(var r=0,i=e.length;r<i;r+=1)this.myhash[e[r]]||this.mylist.push(""+e[r]),this.uncited[e[r]]=!0,this.myhash[e[r]]=!0}else{for(var s in this.uncited)e.push(s);var a={};for(r=e.length-1;r>-1;r+=-1)a[e[r]]?e=e.slice(0,r).concat(e.slice(r+1)):a[e[r]]=!0;this.mylist=e,this.myhash=a}this.refreshes={},this.touched={},this.ambigsTouched={},this.ambigresets={}};l.Registry.prototype.dopurge=function(e){for(var t=this.mylist.length-1;t>-1;t+=-1)this.citationreg.citationsByItemId&&(!this.citationreg.citationsByItemId||!this.citationreg.citationsByItemId[this.mylist[t]])&&!e[this.mylist[t]]&&(delete this.myhash[this.mylist[t]],delete this.uncited[this.mylist[t]],this.mylist=this.mylist.slice(0,t).concat(this.mylist.slice(t+1)));this.dodeletes(this.myhash)};l.Registry.prototype.dodeletes=function(e){var t,r,i,s,a,n,o,u,c;if(typeof e=="string"){var r=e;e={},e[r]=!0}for(var r in this.registry)if(!e[r]){if(this.uncited[r])continue;t=this.namereg.delitems(r);for(o in t)this.refreshes[o]=!0;for(i=this.registry[r].ambig,u=this.ambigcites[i].indexOf(r),u>-1&&(n=this.ambigcites[i].slice(),this.ambigcites[i]=n.slice(0,u).concat(n.slice(u+1,n.length)),this.ambigresets[i]=this.ambigcites[i].length),a=this.ambigcites[i].length,s=0;s<a;s+=1)c=""+this.ambigcites[i][s],this.refreshes[c]=!0;if(this.registry[r].siblings){if(this.registry[r].siblings.length==1){var p=this.registry[r].siblings[0];this.registry[p].siblings&&(this.registry[p].siblings.pop(),this.registry[p].master=!0)}else if(this.registry[r].siblings.length>1){var f=[r];if(this.registry[r].master){var h=this.registry[r].siblings[0],m=this.registry[h];m.master=!0,f.push(h)}for(var g=[],d=this.registry[r].siblings.length-1;d>-1;d+=-1){var v=this.registry[r].siblings.pop();f.indexOf(v)===-1&&g.push(v)}for(var d=g.length-1;d>-1;d+=-1)this.registry[r].siblings.push(g[d])}}for(var b=this.reflist.length-1;b>-1;b--)this.reflist[b].id===r&&(this.reflist=this.reflist.slice(0,b).concat(this.reflist.slice(b+1)));delete this.registry[r],delete this.refhash[r],this.return_data.bibchange=!0}};l.Registry.prototype.doinserts=function(e){var t,r,i,s,a,n,o;typeof e=="string"&&(e=[e]);for(var n=0,o=e.length;n<o;n+=1)t=e[n],this.registry[t]||(r=this.state.retrieveItem(t),i=l.getAmbiguousCite.call(this.state,r),this.ambigsTouched[i]=!0,r.legislation_id||(this.akeys[i]=!0),s={id:""+t,seq:0,offset:0,sortkeys:!1,ambig:!1,rendered:!1,disambig:!1,ref:r,newItem:!0},this.registry[t]=s,this.citationreg.citationsByItemId&&this.citationreg.citationsByItemId[t]&&(this.registry[t]["first-reference-note-number"]=this.citationreg.citationsByItemId[t][0].properties.noteIndex),a=l.getAmbigConfig.call(this.state),this.registerAmbigToken(i,t,a),this.touched[t]=!0,this.return_data.bibchange=!0)};l.Registry.prototype.rebuildlist=function(e){var t,r,i,s;if(e)for(this.reflist=[],t=this.mylist.length,r=0;r<t;r+=1)i=this.mylist[r],s=this.registry[i],this.reflist.push(s),this.oldseq[i]=this.registry[i].seq,this.registry[i].seq=r+1;else for(this.reflist_inserts=[],t=this.mylist.length,r=0;r<t;r+=1)i=this.mylist[r],s=this.registry[i],s.newItem&&this.reflist_inserts.push(s),this.oldseq[i]=this.registry[i].seq,this.registry[i].seq=r+1};l.Registry.prototype.dorefreshes=function(){var e,t,r,i,s;for(var e in this.refreshes)if(t=this.registry[e],!!t){t.sortkeys=void 0,r=this.state.refetchItem(e);var i=t.ambig;typeof i=="undefined"&&(this.state.tmp.disambig_settings=!1,i=l.getAmbiguousCite.call(this.state,r),s=l.getAmbigConfig.call(this.state),this.registerAmbigToken(i,e,s));for(var a in this.ambigresets)if(this.ambigresets[a]===1){var n=this.ambigcites[i][0],r=this.state.refetchItem(n);this.registry[n].disambig=new l.AmbigConfig,this.state.tmp.disambig_settings=!1;var i=l.getAmbiguousCite.call(this.state,r),s=l.getAmbigConfig.call(this.state);this.registerAmbigToken(i,n,s)}this.state.tmp.taintedItemIDs[e]=!0,this.ambigsTouched[i]=!0,r.legislation_id||(this.akeys[i]=!0),this.touched[e]=!0}};l.Registry.prototype.setdisambigs=function(){for(var e in this.ambigsTouched)this.state.disambiguate.run(e);this.ambigsTouched={},this.akeys={}};l.Registry.prototype.renumber=function(){var e,t,r;for(this.state.bibliography_sort.opt.citation_number_sort_direction===l.DESCENDING&&(this.state.bibliography_sort.tmp.citation_number_map={}),e=this.reflist.length,t=0;t<e;t+=1)r=this.reflist[t],r.seq=t+1,this.state.bibliography_sort.opt.citation_number_sort_direction===l.DESCENDING&&(this.state.bibliography_sort.tmp.citation_number_map[r.seq]=this.reflist.length-r.seq+1),this.state.opt.update_mode===l.NUMERIC&&r.seq!=this.oldseq[r.id]&&(this.state.tmp.taintedItemIDs[r.id]=!0),r.seq!=this.oldseq[r.id]&&(this.return_data.bibchange=!0)};l.Registry.prototype.setsortkeys=function(){for(var e,t=0,r=this.mylist.length;t<r;t+=1){var e=this.mylist[t];(this.touched[e]||this.state.tmp.taintedItemIDs[e]||!this.registry[e].sortkeys)&&(this.registry[e].sortkeys=l.getSortKeys.call(this.state,this.state.retrieveItem(e),"bibliography_sort"))}};l.Registry.prototype._insertItem=function(e,t){return t.splice(this._locationOf(e,t)+1,0,e),t};l.Registry.prototype._locationOf=function(e,t,r,i){if(t.length===0)return-1;r=r||0,i=i||t.length;var s=r+i>>1,a=this.sorter.compareKeys(e,t[s]);if(i-r<=1)return a==-1?s-1:s;switch(a){case-1:return this._locationOf(e,t,r,s);case 0:return s;case 1:return this._locationOf(e,t,s,i)}};l.Registry.prototype.sorttokens=function(e){var t,r,i,s;if(!e){for(this.reflist_inserts=[],t=this.mylist.length,s=0;s<t;s+=1)r=this.mylist[s],i=this.registry[r],i.newItem&&this.reflist_inserts.push(i);for(var a in this.state.tmp.taintedItemIDs)if(this.registry[a]&&!this.registry[a].newItem)for(var n=this.reflist.length-1;n>-1;n--)this.reflist[n].id===a&&(this.reflist_inserts.push(this.reflist[n]),this.reflist=this.reflist.slice(0,n).concat(this.reflist.slice(n+1)));for(var n=0,o=this.reflist_inserts.length;n<o;n++){var i=this.reflist_inserts[n];delete i.newItem,this.reflist=this._insertItem(i,this.reflist)}for(s=0;s<t;s+=1)r=this.mylist[s],i=this.registry[r],this.registry[r].seq=s+1}};l.Registry.Comparifier=function(e,t){var r,i,s,a,n=l.getSortCompare.call(e,e.opt["default-locale-sort"]);r=e[t].opt.sort_directions,this.compareKeys=function(o,u){for(i=o.sortkeys?o.sortkeys.length:0,s=0;s<i;s+=1){var c=0;if(o.sortkeys[s]===u.sortkeys[s]?c=0:typeof o.sortkeys[s]=="undefined"?c=r[s][1]:typeof u.sortkeys[s]=="undefined"?c=r[s][0]:c=n(o.sortkeys[s],u.sortkeys[s]),0<c)return r[s][1];if(0>c)return r[s][0]}return o.seq>u.seq?1:o.seq<u.seq?-1:0},a=this.compareKeys,this.compareCompositeKeys=function(o,u){return a(o[1],u[1])}};l.Registry.prototype.compareRegistryTokens=function(e,t){return e.seq>t.seq?1:e.seq<t.seq?-1:0};l.Registry.prototype.registerAmbigToken=function(e,t,r){if(this.registry[t]||l.debug("Warning: unregistered item: itemID=("+t+"), akey=("+e+")"),this.registry[t]&&this.registry[t].disambig&&this.registry[t].disambig.names)for(var i=0,s=r.names.length;i<s;i+=1){var a=r.names[i],n=this.registry[t].disambig.names[i];if(a!==n)this.state.tmp.taintedItemIDs[t]=!0;else if(r.givens[i])for(var o=0,u=r.givens[i].length;o<u;o+=1){var c=r.givens[i][o],p=this.registry[t].disambig.givens[i][o];c!==p&&(this.state.tmp.taintedItemIDs[t]=!0)}}this.ambigcites[e]||(this.ambigcites[e]=[]),this.ambigcites[e].indexOf(""+t)===-1&&this.ambigcites[e].push(""+t),this.registry[t].ambig=e,this.registry[t].disambig=l.cloneAmbigConfig(r)};l.getSortKeys=function(e,t){var r,i,s,a,n,o;for(r=this.tmp.area,i=this.tmp.root,s=this.tmp.extension,a=l.Util.Sort.strip_prepositions,this.tmp.area=t,this.tmp.root=t.indexOf("_")>-1?t.slice(0,-5):t,this.tmp.extension="_sort",this.tmp.disambig_override=!0,this.tmp.disambig_request=!1,this.tmp.suppress_decorations=!0,l.getCite.call(this,e),this.tmp.suppress_decorations=!1,this.tmp.disambig_override=!1,n=this[t].keys.length,o=0;o<n;o+=1)this[t].keys[o]=a(this[t].keys[o]);return this.tmp.area=r,this.tmp.root=i,this.tmp.extension=s,this[t].keys};l.Registry.NameReg=function(e){var t,r,i,s,a,n,o,u,c,p,f,h;this.state=e,this.namereg={},this.nameind={},this.nameindpkeys={},this.itemkeyreg={},o=function(m){return m||(m=""),m.replace(/\./g," ").replace(/\s+/g," ").replace(/\s+$/,"")},u=function(m,g,d){t=o(d.family),m.opt["demote-non-dropping-particle"]==="never"&&d["non-dropping-particle"]&&d.family&&(t=`${t} ${d["non-dropping-particle"]}`),i=o(d.given);var v=i.match(/[,\!]* ([^,]+)$/);v&&v[1]===v[1].toLowerCase()&&(i=i.replace(/[,\!]* [^,]+$/,"")),r=l.Util.Names.initializeWith(m,i,"%s"),m.citation.opt["givenname-disambiguation-rule"]==="by-cite"&&(t=""+g+t)},c=function(m,g,d,v,b,E){var x;if(e.tmp.area.slice(0,12)==="bibliography"&&!b)return typeof E=="string"?1:2;var w=e.nameOutput.getName(g,"locale-translit",!0);g=w.name,u(this.state,""+m,g),x=2,s=e.opt["disambiguate-add-givenname"],a=e.citation.opt["givenname-disambiguation-rule"];var S=a;if(a==="by-cite"&&(a="all-names"),b==="short"?x=0:typeof E=="string"&&(x=1),typeof this.namereg[t]=="undefined"||typeof this.namereg[t].ikey[r]=="undefined")return x;if(S==="by-cite"&&x<=v)return v;if(!s||typeof a=="string"&&a.slice(0,12)==="primary-name"&&d>0||(!a||a==="all-names"||a==="primary-name"?(this.namereg[t].count>1&&(x=1),(this.namereg[t].ikey&&this.namereg[t].ikey[r].count>1||this.namereg[t].count>1&&typeof E!="string")&&(x=2)):(a==="all-names-with-initials"||a==="primary-name-with-initials")&&(this.namereg[t].count>1?x=1:x=0),e.registry.registry[m]))return x;if(b=="short")return 0;if(typeof E=="string")return 1},p=function(m){var g,d,v,b,E;(typeof m=="string"||typeof m=="number")&&(m=[""+m]);var x={};for(d=m.length,g=0;g<d;g+=1)if(b=""+m[g],!!this.nameind[b]){for(E in this.nameind[b])if(this.nameind[b].hasOwnProperty(E)){var w=E.split("::");if(t=w[0],r=w[1],i=w[2],typeof this.namereg[t]=="undefined")continue;if(n=this.namereg[t].items,i&&this.namereg[t].ikey[r]&&this.namereg[t].ikey[r].skey[i]&&(h=this.namereg[t].ikey[r].skey[i].items,v=h.indexOf(""+b),v>-1&&(this.namereg[t].ikey[r].skey[i].items=h.slice(0,v).concat(h.slice([v+1]))),this.namereg[t].ikey[r].skey[i].items.length===0&&(delete this.namereg[t].ikey[r].skey[i],this.namereg[t].ikey[r].count+=-1,this.namereg[t].ikey[r].count<2)))for(var S=0,T=this.namereg[t].ikey[r].items.length;S<T;S+=1)e.tmp.taintedItemIDs[this.namereg[t].ikey[r].items[S]]=!0;if(r&&this.namereg[t].ikey[r]&&(v=this.namereg[t].ikey[r].items.indexOf(""+b),v>-1&&(n=this.namereg[t].ikey[r].items.slice(),this.namereg[t].ikey[r].items=n.slice(0,v).concat(n.slice([v+1]))),this.namereg[t].ikey[r].items.length===0&&(delete this.namereg[t].ikey[r],this.namereg[t].count+=-1,this.namereg[t].count<2)))for(var S=0,T=this.namereg[t].items.length;S<T;S+=1)e.tmp.taintedItemIDs[this.namereg[t].items[S]]=!0;t&&(v=this.namereg[t].items.indexOf(""+b),v>-1&&(n=this.namereg[t].items.slice(),this.namereg[t].items=n.slice(0,v).concat(n.slice([v+1],n.length))),this.namereg[t].items.length<2&&delete this.namereg[t]),delete this.nameind[b][E]}delete this.nameind[b],delete this.nameindpkeys[b]}return x},f=function(m,g,d){var v,b,E=e.nameOutput.getName(g,"locale-translit",!0);if(g=E.name,!(e.citation.opt["givenname-disambiguation-rule"]&&e.citation.opt["givenname-disambiguation-rule"].slice(0,8)==="primary-"&&d!==0)){if(u(this.state,""+m,g),t&&(typeof this.namereg[t]=="undefined"?(this.namereg[t]={},this.namereg[t].count=0,this.namereg[t].ikey={},this.namereg[t].items=[m]):this.namereg[t].items.indexOf(m)===-1&&this.namereg[t].items.push(m)),t&&r)if(typeof this.namereg[t].ikey[r]=="undefined"){if(this.namereg[t].ikey[r]={},this.namereg[t].ikey[r].count=0,this.namereg[t].ikey[r].skey={},this.namereg[t].ikey[r].items=[m],this.namereg[t].count+=1,this.namereg[t].count===2)for(var v=0,b=this.namereg[t].items.length;v<b;v+=1)e.tmp.taintedItemIDs[this.namereg[t].items[v]]=!0}else this.namereg[t].ikey[r].items.indexOf(m)===-1&&this.namereg[t].ikey[r].items.push(m);if(t&&r&&i)if(typeof this.namereg[t].ikey[r].skey[i]=="undefined"){if(this.namereg[t].ikey[r].skey[i]={},this.namereg[t].ikey[r].skey[i].items=[m],this.namereg[t].ikey[r].count+=1,this.namereg[t].ikey[r].count===2)for(var v=0,b=this.namereg[t].ikey[r].items.length;v<b;v+=1)e.tmp.taintedItemIDs[this.namereg[t].ikey[r].items[v]]=!0}else this.namereg[t].ikey[r].skey[i].items.indexOf(m)===-1&&this.namereg[t].ikey[r].skey[i].items.push(m);typeof this.nameind[m]=="undefined"&&(this.nameind[m]={},this.nameindpkeys[m]={}),t&&(this.nameind[m][t+"::"+r+"::"+i]=!0,this.nameindpkeys[m][t]=this.namereg[t])}},this.addname=f,this.delitems=p,this.evalname=c};l.Registry.CitationReg=function(){this.citationById={},this.citationByIndex=[]};l.Disambiguation=function(e){this.state=e,this.sys=this.state.sys,this.registry=e.registry.registry,this.ambigcites=e.registry.ambigcites,this.configModes(),this.debug=!1};l.Disambiguation.prototype.run=function(e){this.modes.length&&(this.debug&&this.state.sys.print("[A] === RUN ==="),this.akey=e,this.initVars(e)&&this.runDisambig())};l.Disambiguation.prototype.runDisambig=function(){var e;for(this.debug&&this.state.sys.print("[C] === runDisambig() ==="),this.initGivens=!0;this.lists.length;){for(this.gnameset=0,this.gname=0,this.clashes=[1,0];this.lists[0][1].length;)this.listpos=0,this.base||(this.base=this.lists[0][0]),e=this.incrementDisambig(),this.scanItems(this.lists[0]),this.evalScan(e);this.lists=this.lists.slice(1)}};l.Disambiguation.prototype.scanItems=function(e){var t,r,i;this.debug&&this.state.sys.print("[2] === scanItems() ==="),this.Item=e[1][0],this.ItemCite=l.getAmbiguousCite.call(this.state,this.Item,this.base,!0),this.scanlist=e[1],this.partners=[],this.partners.push(this.Item),this.nonpartners=[];for(var s=0,t=1,r=e[1].length;t<r;t+=1){i=e[1][t];var a=l.getAmbiguousCite.call(this.state,i,this.base,!0);this.debug&&t>1&&this.state.sys.print("  -----------"),this.ItemCite===a?(this.debug&&(this.state.sys.print("  [CLASH]--> "+this.Item.id+": "+this.ItemCite),this.state.sys.print("             "+i.id+": "+a)),s+=1,this.partners.push(i)):(this.debug&&(this.state.sys.print("  [clear]--> "+this.Item.id+": "+this.ItemCite),this.state.sys.print("             "+i.id+": "+a)),this.nonpartners.push(i))}this.clashes[0]=this.clashes[1],this.clashes[1]=s};l.Disambiguation.prototype.evalScan=function(e){this[this.modes[this.modeindex]](e),e&&(this.modeindex<this.modes.length-1?this.modeindex+=1:this.lists[this.listpos+1]=[this.base,[]])};l.Disambiguation.prototype.disNames=function(e){var t,r;if(this.debug&&this.state.sys.print("[3] == disNames() =="),this.clashes[1]===0&&this.nonpartners.length===1)this.captureStepToBase(),this.debug&&(this.state.sys.print("  ** RESOLUTION [a]: lone partner, one nonpartner"),this.state.sys.print("  registering "+this.partners[0].id+" and "+this.nonpartners[0].id)),this.state.registry.registerAmbigToken(this.akey,""+this.nonpartners[0].id,this.betterbase),this.state.registry.registerAmbigToken(this.akey,""+this.partners[0].id,this.betterbase),this.lists[this.listpos]=[this.betterbase,[]];else if(this.clashes[1]===0)this.captureStepToBase(),this.debug&&(this.state.sys.print("  ** RESOLUTION [b]: lone partner, unknown number of remaining nonpartners"),this.state.sys.print("  registering "+this.partners[0].id)),this.state.registry.registerAmbigToken(this.akey,""+this.partners[0].id,this.betterbase),this.lists[this.listpos]=[this.betterbase,this.nonpartners],this.nonpartners.length&&(this.initGivens=!0);else if(this.nonpartners.length===1)this.captureStepToBase(),this.debug&&(this.state.sys.print("  ** RESOLUTION [c]: lone nonpartner, unknown number of partners remaining"),this.state.sys.print("  registering "+this.nonpartners[0].id)),this.state.registry.registerAmbigToken(this.akey,""+this.nonpartners[0].id,this.betterbase),this.lists[this.listpos]=[this.betterbase,this.partners];else if(this.clashes[1]<this.clashes[0])this.captureStepToBase(),this.debug&&this.state.sys.print("  ** RESOLUTION [d]: better result, but no entries safe to register"),this.lists[this.listpos]=[this.betterbase,this.partners],this.lists.push([this.betterbase,this.nonpartners]);else if(this.debug&&this.state.sys.print("  ** RESOLUTION [e]: no improvement, and clashes remain"),e&&(this.lists[this.listpos]=[this.betterbase,this.nonpartners],this.lists.push([this.betterbase,this.partners]),this.modeindex===this.modes.length-1)){this.debug&&this.state.sys.print("     (registering clashing entries because we've run out of options)");for(var t=0,r=this.partners.length;t<r;t+=1)this.state.registry.registerAmbigToken(this.akey,""+this.partners[t].id,this.betterbase);this.lists[this.listpos]=[this.betterbase,[]]}};l.Disambiguation.prototype.disExtraText=function(){this.debug&&this.state.sys.print("[3] === disExtraText ==");var e=!1;if(this.clashes[1]===0&&this.nonpartners.length<2&&(e=!0),!e&&(!this.base.disambiguate||this.state.tmp.disambiguate_count!==this.state.tmp.disambiguate_maxMax))if(this.modeindex=0,this.base.disambiguate=this.state.tmp.disambiguate_count,this.betterbase.disambiguate=this.state.tmp.disambiguate_count,this.base.disambiguate)this.disNames();else{this.initGivens=!0,this.base.disambiguate=1;for(var t=0,r=this.lists[this.listpos][1].length;t<r;t+=1)this.state.tmp.taintedItemIDs[this.lists[this.listpos][1][t].id]=!0}else if(e||this.state.tmp.disambiguate_count===this.state.tmp.disambiguate_maxMax)if(e||this.modeindex===this.modes.length-1){for(var i=this.lists[this.listpos][0],t=0,r=this.lists[this.listpos][1].length;t<r;t+=1)this.state.tmp.taintedItemIDs[this.lists[this.listpos][1][t].id]=!0,this.state.registry.registerAmbigToken(this.akey,""+this.lists[this.listpos][1][t].id,i);this.lists[this.listpos]=[this.betterbase,[]]}else{this.modeindex=this.modes.length-1;var i=this.lists[this.listpos][0];i.disambiguate=!0;for(var t=0,r=this.lists[this.listpos][1].length;t<r;t+=1)this.state.tmp.taintedItemIDs[this.lists[this.listpos][1][t].id]=!0,this.state.registry.registerAmbigToken(this.akey,""+this.lists[this.listpos][1][t].id,i)}};l.Disambiguation.prototype.disYears=function(){var e,t,r,i;this.debug&&this.state.sys.print("[3] === disYears =="),r=[];var s=this.lists[this.listpos][0];if(this.clashes[1])for(var a=0,n=this.state.registry.mylist.length;a<n;a+=1)for(var o=this.state.registry.mylist[a],u=0,c=this.lists[this.listpos][1].length;u<c;u+=1){var i=this.lists[this.listpos][1][u];if(i.id==o){r.push(this.registry[i.id]);break}}r.sort(this.state.registry.sorter.compareKeys);for(var e=0,t=r.length;e<t;e+=1){s.year_suffix=""+e;var p=this.state.registry.registry[r[e].id].disambig;this.state.registry.registerAmbigToken(this.akey,""+r[e].id,s),l.ambigConfigDiff(p,s)&&(this.state.tmp.taintedItemIDs[r[e].id]=!0)}this.lists[this.listpos]=[this.betterbase,[]]};l.Disambiguation.prototype.incrementDisambig=function(){if(this.debug&&this.state.sys.print(`
[1] === incrementDisambig() ===`),this.initGivens)return this.initGivens=!1,!1;var e=!1,t=!0;if(this.modes[this.modeindex]==="disNames"){t=!1,typeof this.givensMax!="number"&&(t=!0);var r=!1;typeof this.namesMax!="number"&&(r=!0),typeof this.givensMax=="number"&&(this.base.givens.length&&this.base.givens[this.gnameset][this.gname]<this.givensMax?this.base.givens[this.gnameset][this.gname]+=1:t=!0),typeof this.namesMax=="number"&&t&&(this.state.opt["disambiguate-add-names"]?(r=!1,this.gname<this.namesMax?(this.base.names[this.gnameset]+=1,this.gname+=1):r=!0):r=!0),typeof this.namesetsMax=="number"&&r&&this.gnameset<this.namesetsMax&&(this.gnameset+=1,this.base.names[this.gnameset]=1,this.gname=0),this.debug&&(this.state.sys.print("    ------------------"),this.state.sys.print("    incremented values"),this.state.sys.print("    ------------------"),this.state.sys.print("    | gnameset: "+this.gnameset),this.state.sys.print("    | gname: "+this.gname),this.state.sys.print("    | names value: "+this.base.names[this.gnameset]),this.base.givens.length?this.state.sys.print("    | givens value: "+this.base.givens[this.gnameset][this.gname]):this.state.sys.print("    | givens value: nil"),this.state.sys.print("    | namesetsMax: "+this.namesetsMax),this.state.sys.print("    | namesMax: "+this.namesMax),this.state.sys.print("    | givensMax: "+this.givensMax)),(typeof this.namesetsMax!="number"||this.namesetsMax===-1||this.gnameset===this.namesetsMax)&&(!this.state.opt["disambiguate-add-names"]||typeof this.namesMax!="number"||this.gname===this.namesMax)&&(typeof this.givensMax!="number"||typeof this.base.givens[this.gnameset]=="undefined"||typeof this.base.givens[this.gnameset][this.gname]=="undefined"||this.base.givens[this.gnameset][this.gname]===this.givensMax)&&(e=!0,this.debug&&this.state.sys.print("    MAXED"))}else this.modes[this.modeindex]==="disExtraText"&&(this.base.disambiguate+=1,this.betterbase.disambiguate+=1);return e};l.Disambiguation.prototype.initVars=function(e){var t,r,i,s,a;if(this.debug&&this.state.sys.print("[B] === initVars() ==="),this.lists=[],this.base=!1,this.betterbase=!1,this.akey=e,this.maxNamesByItemId={},s=[],i=this.ambigcites[e],!i||!i.length)return!1;var n=this.state.refetchItem(""+i[0]);if(this.getCiteData(n),this.base=l.getAmbigConfig.call(this.state),i&&i.length>1){s.push([this.maxNamesByItemId[n.id],n]);for(var t=1,r=i.length;t<r;t+=1)n=this.state.refetchItem(""+i[t]),this.getCiteData(n,this.base),s.push([this.maxNamesByItemId[n.id],n]);s.sort(function(u,c){return u[0]>c[0]?1:u[0]<c[0]?-1:u[1].id>c[1].id?1:u[1].id<c[1].id?-1:0}),a=[];for(var t=0,r=s.length;t<r;t+=1)a.push(s[t][1]);this.lists.push([this.base,a]),this.Item=this.lists[0][1][0]}else this.Item=this.state.refetchItem(""+i[0]);if(this.modeindex=0,this.state.citation.opt["disambiguate-add-names"]||!0)this.namesMax=this.maxNamesByItemId[this.Item.id][0];else{var o;for(var t,r;t<r;t+=1);}return this.padBase(this.base),this.padBase(this.betterbase),this.base.year_suffix=!1,this.base.disambiguate=!1,this.betterbase.year_suffix=!1,this.betterbase.disambiguate=!1,this.state.citation.opt["givenname-disambiguation-rule"]==="by-cite"&&this.state.opt["disambiguate-add-givenname"]&&(this.givensMax=2),!0};l.Disambiguation.prototype.padBase=function(e){for(var t=0,r=e.names.length;t<r;t+=1){e.givens[t]||(e.givens[t]=[]);for(var i=0,s=e.names[t];i<s;i+=1)e.givens[t][i]||(e.givens[t][i]=0)}};l.Disambiguation.prototype.configModes=function(){var e,t;this.modes=[],e=this.state.opt["disambiguate-add-givenname"],t=this.state.citation.opt["givenname-disambiguation-rule"],(this.state.opt["disambiguate-add-names"]||e&&t==="by-cite")&&this.modes.push("disNames"),this.state.opt.development_extensions.prioritize_disambiguate_condition?(this.state.opt.has_disambiguate&&this.modes.push("disExtraText"),this.state.opt["disambiguate-add-year-suffix"]&&this.modes.push("disYears")):(this.state.opt["disambiguate-add-year-suffix"]&&this.modes.push("disYears"),this.state.opt.has_disambiguate&&this.modes.push("disExtraText"))};l.Disambiguation.prototype.getCiteData=function(e,t){if(!this.maxNamesByItemId[e.id]){l.getAmbiguousCite.call(this.state,e,t),t=l.getAmbigConfig.call(this.state),this.maxNamesByItemId[e.id]=l.getMaxVals.call(this.state),this.state.registry.registry[e.id].disambig.givens=this.state.tmp.disambig_settings.givens.slice();for(var r=0,i=this.state.registry.registry[e.id].disambig.givens.length;r<i;r+=1)this.state.registry.registry[e.id].disambig.givens[r]=this.state.tmp.disambig_settings.givens[r].slice();this.namesetsMax=this.state.registry.registry[e.id].disambig.names.length-1,this.base||(this.base=t,this.betterbase=l.cloneAmbigConfig(t)),t.names.length<this.base.names.length&&(this.base=t);for(var r=0,i=t.names.length;r<i;r+=1)t.names[r]>this.base.names[r]&&(this.base.givens[r]=t.givens[r].slice(),this.base.names[r]=t.names[r],this.betterbase.names=this.base.names.slice(),this.betterbase.givens=this.base.givens.slice(),this.padBase(this.base),this.padBase(this.betterbase));this.betterbase.givens=this.base.givens.slice();for(var s=0,a=this.base.givens.length;s<a;s+=1)this.betterbase.givens[s]=this.base.givens[s].slice()}};l.Disambiguation.prototype.captureStepToBase=function(){this.state.citation.opt["givenname-disambiguation-rule"]==="by-cite"&&this.base.givens&&this.base.givens.length&&typeof this.base.givens[this.gnameset][this.gname]!="undefined"&&(this.betterbase.givens.length<this.base.givens.length&&(this.betterbase.givens=JSON.parse(JSON.stringify(this.base.givens))),this.betterbase.givens[this.gnameset][this.gname]=this.base.givens[this.gnameset][this.gname]),this.betterbase.names[this.gnameset]=this.base.names[this.gnameset]};l.Engine.prototype.getJurisdictionList=function(e){for(var t=[],r=e.split(":"),i=r.length;i>0;i--){var s=r.slice(0,i).join(":");if(t.push(s),this.opt.jurisdiction_fallbacks[s]){var a=this.opt.jurisdiction_fallbacks[s];t.push(a)}}return t.indexOf("us")===-1&&t.push("us"),t};l.Engine.prototype.loadStyleModule=function(e,t,r){var i=null,s=0;this.juris[e]={};var a=l.setupXml(t);a.addMissingNameNodes(a.dataObj),a.addInstitutionNodes(a.dataObj),a.insertPublisherAndPlace(a.dataObj),a.flagDateMacros(a.dataObj);for(var h=a.getNodesByName(a.dataObj,"law-module"),n=0,o=h.length;n<o;n++){var u=a.getAttributeValue(h[n],"types");if(u){this.juris[e].types={},u=u.split(/\s+/);for(var c=0,p=u.length;c<p;c++)this.juris[e].types[u[c]]=!0}r||(i=a.getAttributeValue(h[n],"fallback"),i&&e!=="us"&&(this.opt.jurisdiction_fallbacks[e]=i))}var f=this.opt.lang?this.opt.lang:this.opt["default-locale"][0];l.SET_COURT_CLASSES(this,f,a,a.dataObj),this.juris[e].types||(this.juris[e].types=l.MODULE_TYPES);for(var h=a.getNodesByName(a.dataObj,"macro"),n=0,o=h.length;n<o;n++){var m=a.getAttributeValue(h[n],"name");if(!l.MODULE_MACROS[m]){l.debug('CSL: skipping non-modular macro name "'+m+'" in module context');continue}s++,this.juris[e][m]=[],this.buildTokenLists(h[n],this.juris[e][m]),this.configureTokenList(this.juris[e][m])}return i};l.Engine.prototype.retrieveAllStyleModules=function(e){var t={},r=this.locale[this.opt.lang].opts["jurisdiction-preference"];r=r||[],r=[""].concat(r);for(var i=r.length-1;i>-1;i--)for(var s=r[i],a=0,n=e.length;a<n;a++){var o=e[a];if(!this.opt.jurisdictions_seen[o]){var u=this.sys.retrieveStyleModule(o,s);(!u&&!s||u)&&(this.opt.jurisdictions_seen[o]=!0),u&&(t[o]=u)}}return t};l.ParticleList=function(){var e=[[[0,1],null]],t=[[[0,3],null]],r=[[null,[0,1]]],i=[[null,[0,2]]],s=[[null,[0,3]]],a=[[null,[0,1]],[[0,1],null]],n=[[null,[0,2]],[[0,2],null]],o=[[[0,1],null],[null,[0,1]]],u=[[[0,2],null],[null,[0,2]]],c=[[[0,3],null],[null,[0,3]]],p=[[null,[0,2]],[[0,1],[1,2]]],f=[["'s",r],["'s-",r],["'t",r],["a",r],["aan 't",i],["aan de",i],["aan den",i],["aan der",i],["aan het",i],["aan t",i],["aan",r],["ad-",a],["adh-",a],["af",a],["al",a],["al-",a],["am de",i],["am",r],["an-",a],["ar-",a],["as-",a],["ash-",a],["at-",a],["ath-",a],["auf dem",u],["auf den",u],["auf der",u],["auf ter",i],["auf",o],["aus 'm",u],["aus dem",u],["aus den",u],["aus der",u],["aus m",u],["aus",o],["aus'm",u],["az-",a],["a\u0161-",a],["a\u1E0D-",a],["a\u1E0F-",a],["a\u1E63-",a],["a\u1E6D-",a],["a\u1E6F-",a],["a\u1E93-",a],["ben",r],["bij 't",i],["bij de",i],["bij den",i],["bij het",i],["bij t",i],["bij",r],["bin",r],["boven d",i],["boven d'",i],["d",r],["d'",a],["da",a],["dal",r],["dal'",r],["dall'",r],["dalla",r],["das",a],["de die le",s],["de die",i],["de l",i],["de l'",i],["de la",p],["de las",p],["de le",i],["de li",n],["de van der",s],["de",a],["de'",a],["deca",r],["degli",a],["dei",a],["del",a],["dela",e],["dell'",a],["della",a],["delle",a],["dello",a],["den",a],["der",a],["des",a],["di",a],["die le",i],["do",r],["don",r],["dos",a],["du",a],["ed-",a],["edh-",a],["el",a],["el-",a],["en-",a],["er-",a],["es-",a],["esh-",a],["et-",a],["eth-",a],["ez-",a],["e\u0161-",a],["e\u1E0D-",a],["e\u1E0F-",a],["e\u1E63-",a],["e\u1E6D-",a],["e\u1E6F-",a],["e\u1E93-",a],["het",r],["i",r],["il",e],["im",r],["in 't",i],["in de",i],["in den",i],["in der",n],["in het",i],["in t",i],["in",r],["l",r],["l'",r],["la",r],["las",r],["le",r],["les",a],["lo",a],["los",r],["lou",r],["of",r],["onder 't",i],["onder de",i],["onder den",i],["onder het",i],["onder t",i],["onder",r],["op 't",i],["op de",n],["op den",i],["op der",i],["op gen",i],["op het",i],["op t",i],["op ten",i],["op",r],["over 't",i],["over de",i],["over den",i],["over het",i],["over t",i],["over",r],["s",r],["s'",r],["sen",e],["t",r],["te",r],["ten",r],["ter",r],["tho",r],["thoe",r],["thor",r],["to",r],["toe",r],["tot",r],["uijt 't",i],["uijt de",i],["uijt den",i],["uijt te de",s],["uijt ten",i],["uijt",r],["uit 't",i],["uit de",i],["uit den",i],["uit het",i],["uit t",i],["uit te de",s],["uit ten",i],["uit",r],["unter",r],["v",r],["v.",r],["v.d.",r],["van 't",i],["van de l",s],["van de l'",s],["van de",i],["van de",i],["van den",i],["van der",i],["van gen",i],["van het",i],["van la",i],["van t",i],["van ter",i],["van van de",s],["van",a],["vander",r],["vd",r],["ver",r],["vom und zum",t],["vom",a],["von 't",i],["von dem",u],["von den",u],["von der",u],["von t",i],["von und zu",c],["von zu",u],["von",o],["voor 't",i],["voor de",i],["voor den",i],["voor in 't",s],["voor in t",s],["voor",r],["vor der",u],["vor",o],["z",e],["ze",e],["zu",o],["zum",a],["zur",a]];return f}();l.parseParticles=function(){function e(i,s,a){var n=i;i=a?i.toLowerCase():i;var o=[],u,c;s?(i=i.split("").reverse().join(""),u=l.PARTICLE_GIVEN_REGEXP):u=l.PARTICLE_FAMILY_REGEXP;for(var p=i.match(u);p;){var f=s?p[1].split("").reverse().join(""):p[1],h=p?f:!1,h=h?f.replace(/^[-\'\u02bb\u2019\s]*(.).*$/,"$1"):!1;if(c=h?h.toUpperCase()!==h:!1,!c)break;s?(o.push(n.slice(f.length*-1)),n=n.slice(0,f.length*-1)):(o.push(n.slice(0,f.length)),n=n.slice(f.length)),i=p[2],p=i.match(u)}if(s){i=i.split("").reverse().join(""),o.reverse();for(var m=1,g=o.length;m<g;m++)o[m].slice(0,1)==" "&&(o[m-1]+=" ");for(var m=0,g=o.length;m<g;m++)o[m].slice(0,1)==" "&&(o[m]=o[m].slice(1));i=n.slice(0,i.length)}else i=n.slice(i.length*-1);return[c,i,o]}function t(i){var s=i.slice(-1);return i=i.trim(),s===" "&&["'","\u2019"].indexOf(i.slice(-1))>-1&&(i+=" "),i}function r(i){if(!i.suffix&&i.given){var s=i.given.match(/(\s*,!*\s*)/);if(s){var a=i.given.indexOf(s[1]),n=i.given.slice(a+s[1].length),o=i.given.slice(a,a+s[1].length).replace(/\s*/g,"");n.replace(/\./g,"")==="et al"&&!i["dropping-particle"]?(i["dropping-particle"]=n,i["comma-dropping-particle"]=","):(o.length===2&&(i["comma-suffix"]=!0),i.suffix=n),i.given=i.given.slice(0,a)}}}return function(i){var o=e(i.family),s=o[1],a=o[2];i.family=s;var n=t(a.join(""));n&&(i["non-dropping-particle"]=n),r(i);var o=e(i.given,!0),u=o[1],c=o[2];i.given=u;var p=c.join("").trim();p&&(i["dropping-particle"]=p)}}();wp.exports=l});var hi=R(Ir=>{"use strict";Object.defineProperty(Ir,"__esModule",{value:!0});Ir.fetchEngine=Ir.default=void 0;var Wt=c1(Zn()),xp=Kn(),pi=Xn();function c1(e){return e&&e.__esModule?e:{default:e}}var Tp=Symbol.for("proxied"),p1=function(e){let t=function(r,i){if(r.sys.wrapBibliographyEntry){let[s,a]=r.sys.wrapBibliographyEntry(this.system_id);i=[s,i,a].join("")}return e.call(this,r,i)};return t[Tp]=!0,t};for(let e in Wt.default.Output.Formats){let t=Wt.default.Output.Formats[e]["@bibliography/entry"];!t||t[Tp]||(Wt.default.Output.Formats[e]["@bibliography/entry"]=p1(t))}function h1(e){let t=e.replace("-","_");if(pi.locales.has(e))return pi.locales.get(e);if(pi.locales.has(t))return pi.locales.get(t)}var eo={},Ap=function(e,t,r,i,s){let a=`${e}|${t}`,n;return eo[a]instanceof Wt.default.Engine?(n=eo[a],n.sys.retrieveItem=i,n.updateItems([])):n=eo[a]=new Wt.default.Engine({retrieveLocale:s,retrieveItem:i},r,t,!0),n};Ir.fetchEngine=Ap;var f1=function(e,t,r,i){if(!Wt.default.Output.Formats[i]||!Wt.default.Output.Formats[i]["@bibliography/entry"])throw new TypeError(`Cannot find format '${i}'`);let s=e.reduce((u,c)=>(u[c.id]=c,u),{}),a=xp.templates.get(xp.templates.has(t)?t:"apa");r=pi.locales.has(r)?r:"en-US";let o=Ap(t,r,a,function(u){if(Object.prototype.hasOwnProperty.call(s,u))return s[u];throw new Error(`Cannot find entry with id '${u}'`)},h1);return o.setOutputFormat(i),o},m1=f1;Ir.default=m1});var Cp=R(Dr=>{"use strict";Object.defineProperty(Dr,"__esModule",{value:!0});Dr.getPrefixedEntry=Dr.getAttributedEntry=void 0;var Sp=(e,t,r)=>e.replace(/^\s*<[a-z]+/i,`$& data-${t}="${r}"`);Dr.getAttributedEntry=Sp;var d1=(e,t)=>Sp(e,"csl-entry-id",t);Dr.getPrefixedEntry=d1});var kp=R(to=>{"use strict";Object.defineProperty(to,"__esModule",{value:!0});to.default=v1;var g1=y1(hi()),b1=Cp();function y1(e){return e&&e.__esModule?e:{default:e}}var Op=(e,t)=>typeof t=="function"?t(e):t||"";function v1(e,t={}){let{template:r="apa",lang:i="en-US",format:s="text",nosort:a=!1}=t,n=t.entry?[].concat(t.entry):e.map(({id:g})=>g),o=(0,g1.default)(e,r,i,s),u=o.updateItems(n,a);if(t.append||t.prepend){let g=e.reduce((d,v)=>(d[v.id]=v,d),{});o.sys.wrapBibliographyEntry=function(d){let v=g[d];return[Op(v,t.prepend),Op(v,t.append)]}}else o.sys.wrapBibliographyEntry=()=>["",""];let c=o.makeBibliography(),[{bibstart:p,bibend:f},h]=c,m=h.map((g,d)=>(0,b1.getPrefixedEntry)(g,u[d]));return t.asEntryArray?m.map((g,d)=>[u[d],g]):p+m.join("")+f}});var Qp=R(ro=>{"use strict";Object.defineProperty(ro,"__esModule",{value:!0});ro.default=w1;var _1=E1(hi());function E1(e){return e&&e.__esModule?e:{default:e}}function w1(e,t={}){let{template:r="apa",lang:i="en-US",format:s="text"}=t,a=e.map(({id:f})=>f),n=t.entry?[].concat(t.entry):a,o=(0,_1.default)(e,r,i,s);o.updateItems(a);let{citationsPre:u=[],citationsPost:c=[]}=t;return o.previewCitationCluster({citationItems:n.map(f=>typeof f=="object"?f:{id:f}),properties:{noteIndex:0}},u,c,s)}});var Np=R(()=>{"use strict";var x1=me(),T1=Xn(),A1=Kn(),S1=io(hi()),C1=io(kp()),O1=io(Qp());function io(e){return e&&e.__esModule?e:{default:e}}x1.plugins.add("@csl",{output:{bibliography:C1.default,citation:O1.default},config:{engine:S1.default,locales:T1.locales,templates:A1.templates}})});var Ip=R(Fs=>{"use strict";Object.defineProperty(Fs,"__esModule",{value:!0});Fs.default=Fs.parse=k1;function k1(e){return(Array.isArray(e)?e:e.trim().split(/(?:\s+)/g)).map(r=>`https://doi.org/${r}`)}});var so=R(Ms=>{"use strict";Object.defineProperty(Ms,"__esModule",{value:!0});Ms.default=Ms.parse=N1;var Q1={"journal-article":"article-journal","book-chapter":"chapter","posted-content":"manuscript","proceedings-article":"paper-conference"};function N1(e,t){return e==="posted-content"&&t.subtype==="preprint"?"article":Q1[e]||e}});var ao=R(Us=>{"use strict";Object.defineProperty(Us,"__esModule",{value:!0});Us.default=Us.parse=P1;var I1=D1(so());function D1(e){return e&&e.__esModule?e:{default:e}}function P1(e){let t={type:(0,I1.default)(e.type,e)};return["submitted","issued","event-date","original-date","container","accessed"].forEach(i=>{let s=e[i];s&&s["date-parts"]&&typeof s["date-parts"][0]=="number"&&(s["date-parts"]=[s["date-parts"]])}),Object.assign({},e,t)}});var Lp=R(qs=>{"use strict";Object.defineProperty(qs,"__esModule",{value:!0});qs.parse=M1;qs.parseAsync=B1;var Dp=me(),Pp=R1(ao());function R1(e){return e&&e.__esModule?e:{default:e}}var Rp={checkContentType:!0,headers:{Accept:"application/vnd.citationstyles.csl+json"}};async function L1(e){let t=await Dp.util.fetchFileAsync(e,Rp);return t==="[]"?{}:JSON.parse(t)}async function B1(e){return(await Promise.all([].concat(e).map(L1))).map(Pp.default)}function F1(e){let t=Dp.util.fetchFile(e,Rp);return t==="[]"?{}:JSON.parse(t)}function M1(e){return[].concat(e).map(F1).map(Pp.default)}});var oo=R(Tt=>{"use strict";Object.defineProperty(Tt,"__esModule",{value:!0});Tt.ref=Tt.parsers=Tt.formats=void 0;var U1=me(),js=Gs(Ip()),no=Gs(Lp()),q1=Gs(ao()),Bp=Gs(so());function Fp(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,r=new WeakMap;return(Fp=function(i){return i?r:t})(e)}function Gs(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||typeof e!="object"&&typeof e!="function")return{default:e};var r=Fp(t);if(r&&r.has(e))return r.get(e);var i={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(a!=="default"&&Object.prototype.hasOwnProperty.call(e,a)){var n=s?Object.getOwnPropertyDescriptor(e,a):null;n&&(n.get||n.set)?Object.defineProperty(i,a,n):i[a]=e[a]}return i.default=e,r&&r.set(e,i),i}var Mp="@doi";Tt.ref=Mp;var j1={id:js,api:no,json:q1,type:Bp};Tt.parsers=j1;var Up={"@doi/api":{parse:no.parse,parseAsync:no.parseAsync,parseType:{dataType:"String",predicate:/^\s*(https?:\/\/(?:dx\.)?doi\.org\/(10.\d{4,9}\/[-._;()/:A-Z0-9]+))\s*$/i,extends:"@else/url"}},"@doi/id":{parse:js.parse,parseType:{dataType:"String",predicate:/^\s*(10.\d{4,9}\/[-._;()/:A-Z0-9]+)\s*$/i}},"@doi/list+text":{parse:js.parse,parseType:{dataType:"String",tokenList:/^10.\d{4,9}\/[-._;()/:A-Z0-9]+$/i}},"@doi/list+object":{parse:js.parse,parseType:{dataType:"Array",elementConstraint:"@doi/id"}},"@doi/type":{parse:Bp.parse}};Tt.formats=Up;U1.plugins.add(Mp,{input:Up})});var lo=R((DT,G1)=>{G1.exports={outputSpec:"mixed"}});var uo=R((PT,$1)=>{$1.exports={RIS:{ABST:"article-journal",ADVS:"motion_picture",AGGR:"dataset",ANCIENT:"manuscript",ART:"graphic",BILL:"bill",BLOG:"post-weblog",BOOK:"book",CASE:"legal_case",CHAP:"chapter",CHART:"figure",CLSWK:"manuscript",COMP:"book",CONF:"paper-conference",CPAPER:"paper-conference",CTLG:"entry",DATA:"dataset",DBASE:"dataset",DICT:"entry-dictionary",EBOOK:"book",ECHAP:"chapter",EDBOOK:"book",EJOUR:"article-journal",ELEC:"webpage",ENCYC:"entry-encyclopedia",EQUA:"article",FIGURE:"figure",GEN:"book",GOVDOC:"report",GRANT:"article",HEAR:"interview",ICOMM:"personal_communication",INPR:"article-journal",JFULL:"article-journal",JOUR:"article-journal",LEGAL:"legislation",MANSCPT:"manuscript",MAP:"map",MGZN:"article-magazine",MPCT:"broadcast",MULTI:"motion_picture",MUSIC:"musical_score",NEWS:"article-newspaper",PAMP:"pamphlet",PAT:"patent",PCOMM:"personal_communication",RPRT:"report",SER:"book",SLIDE:"motion_picture",SOUND:"motion_picture",STAND:"report",STAT:"legislation",THES:"thesis",UNBILL:"manuscript",UNPB:"manuscript",VIDEO:"motion_picture",WEB:"webpage"},CSL:{"article-journal":"JOUR","article-magazine":"MGZN","article-newspaper":"NEWS",article:"JOUR",bill:"BILL",book:"BOOK",broadcast:"MPCT",chapter:"CHAP",dataset:"DATA",entry:"CTLG","entry-dictionary":"DICT","entry-encyclopedia":"ENCYC",figure:"FIGURE",graphic:"ART",interview:"GEN",legal_case:"CASE",legislation:"LEGAL",manuscript:"MANSCPT",map:"MAP",motion_picture:"MPCT",musical_score:"MUSIC",pamphlet:"PAMP","paper-conference":"CONF",patent:"PAT",personal_communication:"PCOMM","post-weblog":"BLOG",post:"ICOMM",report:"RPRT","review-book":"BOOK",review:"JOUR",song:"SOUND",speech:"SOUND",thesis:"THES",treaty:"GEN",webpage:"ELEC"}}});var co=R((RT,z1)=>{z1.exports=[{source:"A2",target:"editor",when:{source:{TY:["ANCIENT","BLOG","CHAP","CONF","CPAPER","DICT","EBOOK","ECHAP","ENCYC","MUSIC","SER"]},target:{type:["chapter","entry-dictionary","entry-encyclopedia","musical_score","paper-conference","post-weblog"]}}},{source:"A2",target:"collection-editor",when:{source:{TY:["BOOK","CLSWK","COMP","EDBOOK","ELEC","MAP","MULTI","RPRT","UNPB"]},target:{type:["book","map","report","review-book","webpage"]}}},{source:"A2",target:"reporter",when:{source:{TY:["CASE"]},target:{type:["legal_case"]}}},{source:"A2",target:"recipient",when:{source:{TY:["ICOMM","PCOMM"]},target:{type:["personal_communication","post"]}}},{source:"A3",target:"collection-editor",when:{source:{TY:["ADVS","CHAP","CONF","EBOOK","MUSIC","SER","SLIDE","SOUND","VIDEO"]},target:{type:["chapter","musical_score","paper-conference","song","speech"]}}},{source:"A3",target:"illustrator",when:{source:{TY:["BLOG"]},target:{type:["post-weblog"]}}},{source:"A3",target:"editor",when:{source:{TY:["BOOK"]},target:{type:["book","review-book"]}}},{source:["A3","PB"],target:"publisher",when:{source:{TY:["RPRT"]},target:{type:["report"]}}},{source:"A4",target:"translator",when:{source:{TY:["ANCIENT","BOOK","CHAP","CLSWK","CTLG","DICT","EDBOOK","ENCYC","GRANT","PAMP"]},target:{type:["book","chapter","entry","entry-dictionary","entry-encyclopedia","pamphlet","review-book"]}}},{source:"AB",target:"abstract",when:{source:{TY:["ABST","ADVS","AGGR","ANCIENT","ART","BILL","BLOG","BOOK","CASE","CHAP","CHART","CLSWK","COMP","CONF","CPAPER","CTLG","DATA","DBASE","DICT","EBOOK","ECHAP","EDBOOK","EJOUR","ELEC","ENCYC","EQUA","FIGURE","GEN","GOVDOC","GRANT","HEAR","ICOMM","INPR","JFULL","JOUR","LEGAL","MANSCPT","MAP","MGZN","MPCT","MULTI","MUSIC","NEWS","PAMP","PAT","PCOMM","RPRT","SER","SLIDE","SOUND","STAND","STAT","THES","UNBILL","UNPB","VIDEO"]},target:{type:["article","article-journal","article-magazine","article-newspaper","bill","book","broadcast","chapter","dataset","entry","entry-dictionary","entry-encyclopedia","figure","graphic","interview","legal_case","legislation","manuscript","map","motion_picture","musical_score","pamphlet","paper-conference","patent","personal_communication","post","post-weblog","report","review","review-book","song","speech","thesis","treaty","webpage"]}}},{source:"AU",target:"author",when:{source:{TY:["ABST","ADVS","AGGR","ANCIENT","ART","BLOG","BOOK","CHAP","CHART","CLSWK","COMP","CONF","CPAPER","CTLG","DATA","DBASE","DICT","EBOOK","ECHAP","EJOUR","ELEC","ENCYC","EQUA","FIGURE","GEN","GOVDOC","GRANT","ICOMM","INPR","JFULL","JOUR","LEGAL","MANSCPT","MAP","MGZN","MULTI","PAMP","PAT","PCOMM","RPRT","SER","SLIDE","SOUND","STAND","THES","UNPB","VIDEO"]},target:{type:["article","article-journal","article-magazine","book","chapter","dataset","entry","entry-dictionary","entry-encyclopedia","figure","graphic","interview","legislation","manuscript","map","pamphlet","paper-conference","patent","personal_communication","post","post-weblog","report","review","review-book","song","speech","thesis","treaty","webpage"]}}},{source:"AU",target:"editor",when:{source:{TY:["EDBOOK"]},target:!1}},{source:"AU",target:"director",when:{source:{TY:["MPCT"]},target:{type:["broadcast","motion_picture"]}}},{source:"AU",target:"composer",when:{source:{TY:["MUSIC"]},target:{type:["musical_score"]}}},{source:"AU",target:"reporter",when:{source:{TY:["NEWS"]},target:{type:["article-newspaper"]}}},{source:"C1",target:"section",when:{source:{TY:["CHAP","ECHAP","SER"]},target:{type:["chapter"]}}},{source:"C1",target:"publisher-place",when:{source:{TY:["CONF","CPAPER"]},target:{type:["paper-conference"]}}},{source:"C1",target:"scale",when:{source:{TY:["MAP"]},target:{type:["map"]}}},{source:"C2",target:"PMCID",when:{source:{TY:["ABST","INPR","JFULL","JOUR"]},target:{type:["article","article-journal","review"]}}},{source:"C2",target:"issue",when:{source:{TY:["NEWS"]},target:{type:["article-newspaper"]}}},{source:"C2",target:"number",when:{source:{TY:["SER"]},target:!1}},{source:["C2","DA"],target:"issued",when:{source:{TY:["CONF"]},target:{type:["paper-conference"]}}},{source:["C2","DA","PY"],target:"issued",when:{source:{TY:["PAT"]},target:{type:["patent"]}}},{source:"C3",target:"dimensions",when:{source:{TY:["ADVS","MAP","SLIDE","SOUND","VIDEO"]},target:{type:["map","song","speech"]}}},{source:"C3",target:"container-title",when:{source:{TY:["CONF"]},target:{type:["paper-conference"]}}},{source:"C3",target:"PMCID",when:{source:{TY:["EJOUR"]},target:!1}},{source:"C3",target:"jurisdiction",when:{source:{TY:["PAT"]},target:{type:["patent"]}}},{source:["C3","M1"],target:"dimensions",when:{source:{TY:["ART"]},target:{type:["graphic"]}}},{source:"C5",target:"number",when:{source:{TY:["GRANT"]},target:!1}},{source:"C5",target:"dimensions",when:{source:{TY:["MULTI"]},target:!1}},{source:"C5",target:"references",when:{source:{TY:["PAT"]},target:{type:["patent"]}}},{source:["C5","PB"],target:"publisher",when:{source:{TY:["STAT"]},target:!1}},{source:["C5","PY"],target:"issued",when:{source:{TY:["EBOOK"]},target:!1}},{source:"C6",target:"status",when:{source:{TY:["PAT"]},target:{type:["patent"]}}},{source:"C6",target:"issue",when:{source:{TY:["RPRT"]},target:{type:["report"]}}},{source:"C6",target:"volume",when:{source:{TY:["STAT"]},target:!1}},{source:"C7",target:"number",when:{source:{TY:["ABST","INPR","JFULL","JOUR"]},target:{type:["article","article-journal","review"]}}},{source:"C7",target:"PMCID",when:{source:{TY:["EBOOK","ECHAP"]},target:!1}},{source:["C7","NV"],target:"number",when:{source:{TY:["EJOUR"]},target:!1}},{source:"CN",target:"call-number",when:{source:{TY:["ABST","ADVS","ANCIENT","ART","BILL","BLOG","BOOK","CASE","CHAP","CHART","CLSWK","COMP","CONF","CTLG","DATA","DICT","EBOOK","ECHAP","EDBOOK","ELEC","ENCYC","EQUA","FIGURE","GEN","GRANT","HEAR","ICOMM","INPR","JFULL","JOUR","LEGAL","MANSCPT","MAP","MGZN","MPCT","MUSIC","NEWS","PAMP","PAT","PCOMM","RPRT","SER","SLIDE","SOUND","STAND","STAT","THES","UNBILL","VIDEO"]},target:{type:["article","article-journal","article-magazine","article-newspaper","bill","book","broadcast","chapter","dataset","entry","entry-dictionary","entry-encyclopedia","figure","graphic","interview","legal_case","legislation","manuscript","map","motion_picture","musical_score","pamphlet","paper-conference","patent","personal_communication","post","post-weblog","report","review","review-book","song","speech","thesis","treaty","webpage"]}}},{source:"CY",target:"publisher-place",when:{source:{TY:["ADVS","AGGR","ANCIENT","ART","BLOG","BOOK","CHAP","CHART","CLSWK","COMP","CTLG","DATA","DBASE","DICT","EBOOK","ECHAP","EDBOOK","EJOUR","ELEC","ENCYC","EQUA","FIGURE","GEN","GOVDOC","HEAR","ICOMM","LEGAL","MANSCPT","MAP","MGZN","MUSIC","NEWS","PAMP","PCOMM","RPRT","SER","SLIDE","SOUND","STAND","THES","UNPB","VIDEO"]},target:{type:["article-magazine","article-newspaper","book","chapter","dataset","entry","entry-dictionary","entry-encyclopedia","figure","graphic","interview","legislation","manuscript","map","musical_score","pamphlet","personal_communication","post","post-weblog","report","review-book","song","speech","thesis","treaty","webpage"]}}},{source:"CY",target:"event-place",when:{source:{TY:["CONF","CPAPER"]},target:{type:["paper-conference"]}}},{source:"DA",target:"accessed",when:{source:{TY:["AGGR","DBASE","EBOOK","EJOUR","MULTI"]},target:!1}},{source:["DA","PY"],target:"issued",when:{source:{TY:["ABST","ADVS","ANCIENT","ART","BILL","BLOG","BOOK","CASE","CHART","CPAPER","CTLG","DATA","EDBOOK","ELEC","ENCYC","EQUA","FIGURE","GEN","GRANT","HEAR","ICOMM","INPR","JFULL","JOUR","LEGAL","MANSCPT","MAP","MGZN","MPCT","MUSIC","PAMP","PCOMM","RPRT","SER","SLIDE","SOUND","STAND","THES","UNBILL","UNPB","VIDEO"]},target:{type:["article","article-journal","article-magazine","bill","book","broadcast","dataset","entry","entry-encyclopedia","figure","graphic","interview","legal_case","legislation","manuscript","map","motion_picture","musical_score","pamphlet","personal_communication","post","post-weblog","report","review","review-book","song","speech","thesis","treaty","webpage"]}}},{source:["DA","PY","Y2"],target:"issued",when:{source:{TY:["STAT"]},target:!1}},{source:["DA","Y2"],target:"accessed",when:{source:{TY:["ECHAP"]},target:!1}},{source:"DB",target:"source",when:{source:{TY:["ABST","ADVS","AGGR","ANCIENT","ART","BILL","BLOG","BOOK","CASE","CHAP","CHART","CLSWK","COMP","CONF","CPAPER","CTLG","DATA","DBASE","DICT","EBOOK","ECHAP","EDBOOK","EJOUR","ELEC","ENCYC","EQUA","FIGURE","GEN","GOVDOC","GRANT","HEAR","ICOMM","INPR","JFULL","JOUR","LEGAL","MANSCPT","MAP","MGZN","MPCT","MULTI","MUSIC","NEWS","PAMP","PAT","PCOMM","RPRT","SER","SLIDE","SOUND","STAND","STAT","THES","UNBILL","UNPB","VIDEO"]},target:{type:["article","article-journal","article-magazine","article-newspaper","bill","book","broadcast","chapter","dataset","entry","entry-dictionary","entry-encyclopedia","figure","graphic","interview","legal_case","legislation","manuscript","map","motion_picture","musical_score","pamphlet","paper-conference","patent","personal_communication","post","post-weblog","report","review","review-book","song","speech","thesis","treaty","webpage"]}}},{source:"DO",target:"DOI",when:{source:{TY:["ABST","ADVS","AGGR","ANCIENT","ART","BILL","BLOG","BOOK","CASE","CHAP","CHART","CLSWK","COMP","CONF","CPAPER","CTLG","DATA","DBASE","DICT","EBOOK","ECHAP","EDBOOK","EJOUR","ELEC","ENCYC","EQUA","FIGURE","GEN","GOVDOC","GRANT","HEAR","ICOMM","INPR","JFULL","JOUR","LEGAL","MANSCPT","MAP","MGZN","MPCT","MULTI","MUSIC","NEWS","PAMP","PAT","PCOMM","RPRT","SER","SLIDE","SOUND","STAND","STAT","THES","UNBILL","UNPB","VIDEO"]},target:{type:["article","article-journal","article-magazine","article-newspaper","bill","book","broadcast","chapter","dataset","entry","entry-dictionary","entry-encyclopedia","figure","graphic","interview","legal_case","legislation","manuscript","map","motion_picture","musical_score","pamphlet","paper-conference","patent","personal_communication","post","post-weblog","report","review","review-book","song","speech","thesis","treaty","webpage"]}}},{source:"ET",target:"edition",when:{source:{TY:["ADVS","ANCIENT","ART","BLOG","BOOK","CHAP","CLSWK","CONF","CTLG","DICT","EBOOK","ECHAP","EDBOOK","EJOUR","ELEC","ENCYC","GEN","GOVDOC","LEGAL","MAP","MGZN","MPCT","MUSIC","NEWS","PAMP","RPRT","SER","SLIDE","SOUND","VIDEO"]},target:{type:["article-magazine","article-newspaper","book","broadcast","chapter","entry","entry-dictionary","entry-encyclopedia","graphic","interview","legislation","map","motion_picture","musical_score","pamphlet","paper-conference","post-weblog","report","review-book","song","speech","treaty","webpage"]}}},{source:"ET",target:"version",when:{source:{TY:["CHART","COMP","DATA","EQUA","FIGURE"]},target:{type:["dataset","figure"]}}},{source:"ET",target:"medium",when:{source:{TY:["MANSCPT"]},target:{type:["manuscript"]}}},{source:["ET","PY"],target:"issued",when:{source:{TY:["AGGR","DBASE"]},target:!1}},{source:"ID",target:"id"},{source:"IS",target:"number-of-volumes",when:{source:{TY:["CHAP"]},target:{type:["chapter"]}}},{source:"IS",target:"issue",when:{source:{TY:["ABST","INPR","JFULL","JOUR"]},target:{type:["article","article-journal","review"]}}},{source:"J2",target:"container-title-short",when:{source:{TY:["ABST","ANCIENT","BOOK","CHAP","CTLG","DATA","DICT","ENCYC","GRANT","ICOMM","INPR","JFULL","JOUR","LEGAL","MANSCPT","MGZN","PAMP","PCOMM","SER","STAND","STAT","UNPB"]},target:{type:["article","article-journal","article-magazine","book","chapter","dataset","entry","entry-dictionary","entry-encyclopedia","legislation","manuscript","pamphlet","personal_communication","post","review","review-book"]}}},{source:"KW",target:"keyword",when:{source:{TY:["ABST","ADVS","AGGR","ANCIENT","ART","BILL","BLOG","BOOK","CASE","CHAP","CHART","CLSWK","COMP","CONF","CPAPER","CTLG","DATA","DBASE","DICT","EBOOK","ECHAP","EDBOOK","EJOUR","ELEC","ENCYC","EQUA","FIGURE","GEN","GOVDOC","GRANT","HEAR","ICOMM","INPR","JFULL","JOUR","LEGAL","MANSCPT","MAP","MGZN","MPCT","MULTI","MUSIC","NEWS","PAMP","PAT","PCOMM","RPRT","SER","SLIDE","SOUND","STAND","STAT","THES","UNBILL","UNPB","VIDEO"]},target:{type:["article","article-journal","article-magazine","article-newspaper","bill","book","broadcast","chapter","dataset","entry","entry-dictionary","entry-encyclopedia","figure","graphic","interview","legal_case","legislation","manuscript","map","motion_picture","musical_score","pamphlet","paper-conference","patent","personal_communication","post","post-weblog","report","review","review-book","song","speech","thesis","treaty","webpage"]}}},{source:["L4","UR"],target:"URL",when:{source:{TY:["HEAR"]},target:!1}},{source:"LA",target:"language",when:{source:{TY:["ABST","ADVS","AGGR","ANCIENT","ART","BILL","BLOG","BOOK","CASE","CHAP","CHART","CLSWK","COMP","CONF","CPAPER","CTLG","DATA","DBASE","DICT","EBOOK","ECHAP","EDBOOK","EJOUR","ELEC","ENCYC","EQUA","FIGURE","GEN","GOVDOC","GRANT","HEAR","ICOMM","INPR","JFULL","JOUR","LEGAL","MANSCPT","MAP","MGZN","MPCT","MULTI","MUSIC","NEWS","PAMP","PAT","PCOMM","RPRT","SER","SLIDE","SOUND","STAND","STAT","THES","UNBILL","UNPB","VIDEO"]},target:{type:["article","article-journal","article-magazine","article-newspaper","bill","book","broadcast","chapter","dataset","entry","entry-dictionary","entry-encyclopedia","figure","graphic","interview","legal_case","legislation","manuscript","map","motion_picture","musical_score","pamphlet","paper-conference","patent","personal_communication","post","post-weblog","report","review","review-book","song","speech","thesis","treaty","webpage"]}}},{source:"LB",target:"citation-label",when:{source:{TY:["ABST","ADVS","AGGR","ANCIENT","ART","BILL","BLOG","BOOK","CASE","CHAP","CHART","CLSWK","COMP","CONF","CPAPER","CTLG","DATA","DBASE","DICT","EBOOK","ECHAP","EDBOOK","EJOUR","ELEC","ENCYC","EQUA","FIGURE","GEN","GOVDOC","GRANT","HEAR","ICOMM","INPR","JFULL","JOUR","LEGAL","MANSCPT","MAP","MGZN","MPCT","MULTI","MUSIC","PAMP","PAT","PCOMM","RPRT","SER","SLIDE","SOUND","STAND","STAT","THES","UNBILL","UNPB","VIDEO"]},target:{type:["article","article-journal","article-magazine","bill","book","broadcast","chapter","dataset","entry","entry-dictionary","entry-encyclopedia","figure","graphic","interview","legal_case","legislation","manuscript","map","motion_picture","musical_score","pamphlet","paper-conference","patent","personal_communication","post","post-weblog","report","review","review-book","song","speech","thesis","treaty","webpage"]}}},{source:"M1",target:"number",when:{source:{TY:["ADVS","AGGR","ANCIENT","BILL","CHART","DICT","EQUA","FIGURE","GEN","HEAR","SLIDE","SOUND","THES","UNBILL","UNPB","VIDEO"]},target:{type:["bill","entry-dictionary","figure","interview","song","speech","thesis","treaty"]}}},{source:"M1",target:"collection-number",when:{source:{TY:["BOOK","CLSWK","CTLG","EDBOOK","PAMP","SER"]},target:{type:["book","entry","pamphlet","review-book"]}}},{source:"M1",target:"issue",when:{source:{TY:["CONF","EJOUR","GOVDOC","MGZN"]},target:{type:["article-magazine","paper-conference"]}}},{source:"M1",target:"chapter-number",when:{source:{TY:["ECHAP"]},target:!1}},{source:"M1",target:"status",when:{source:{TY:["GRANT"]},target:!1}},{source:"M1",target:"page-first",when:{source:{TY:["LEGAL","NEWS","STAND"]},target:{type:["article-newspaper","legislation"]}}},{source:["M1","NV"],target:"number",when:{source:{TY:["ICOMM","MANSCPT","PCOMM","STAT"]},target:{type:["manuscript","personal_communication","post"]}}},{source:["M1","SE","SN"],target:"number",when:{source:{TY:["PAT"]},target:{type:["patent"]}}},{source:["M1","SN"],target:"number",when:{source:{TY:["RPRT"]},target:{type:["report"]}}},{source:["M1","VL"],target:"accessed",when:{source:{TY:["ELEC"]},target:{type:["webpage"]}}},{source:"M2",target:"page-first",when:{source:{TY:["ABST","INPR","JFULL","JOUR"]},target:{type:["article","article-journal","review"]}}},{source:"M2",target:"number-of-pages",when:{source:{TY:["PAMP"]},target:{type:["pamphlet"]}}},{source:"M3",target:"genre",when:{source:{TY:["ABST","ADVS","AGGR","ANCIENT","ART","BOOK","CHART","CLSWK","COMP","CPAPER","CTLG","DBASE","DICT","ECHAP","EDBOOK","EJOUR","EQUA","FIGURE","GEN","GRANT","ICOMM","INPR","JFULL","JOUR","LEGAL","MANSCPT","MAP","MGZN","MULTI","NEWS","PAMP","PAT","PCOMM","RPRT","SER","SLIDE","SOUND","STAND","THES","UNPB","VIDEO"]},target:{type:["article","article-journal","article-magazine","article-newspaper","book","entry","entry-dictionary","figure","graphic","interview","legislation","manuscript","map","pamphlet","patent","personal_communication","post","report","review","review-book","song","speech","thesis","treaty"]}}},{source:"M3",target:"medium",when:{source:{TY:["BLOG","EBOOK","ELEC","MPCT","MUSIC"]},target:{type:["broadcast","motion_picture","musical_score","post-weblog","webpage"]}}},{source:["N1","RN"],target:"note",when:{source:{TY:["ABST","ADVS","AGGR","ANCIENT","ART","BILL","BLOG","BOOK","CASE","CHAP","CHART","CLSWK","COMP","CONF","CPAPER","CTLG","DATA","DBASE","DICT","EBOOK","ECHAP","EDBOOK","EJOUR","ELEC","ENCYC","EQUA","FIGURE","GEN","GOVDOC","GRANT","HEAR","ICOMM","INPR","JFULL","JOUR","LEGAL","MANSCPT","MAP","MGZN","MPCT","MULTI","MUSIC","NEWS","PAMP","PCOMM","SER","SLIDE","SOUND","STAND","STAT","THES","UNBILL","UNPB","VIDEO"]},target:{type:["article","article-journal","article-magazine","article-newspaper","bill","book","broadcast","chapter","dataset","entry","entry-dictionary","entry-encyclopedia","figure","graphic","interview","legal_case","legislation","manuscript","map","motion_picture","musical_score","pamphlet","paper-conference","personal_communication","post","post-weblog","review","review-book","song","speech","thesis","treaty","webpage"]}}},{source:["N1","RN","RP"],target:"note",when:{source:{TY:["PAT","RPRT"]},target:{type:["patent","report"]}}},{source:"NV",target:"number-of-volumes",when:{source:{TY:["ANCIENT","BOOK","CLSWK","CONF","DICT","ECHAP","EDBOOK","ENCYC","GEN","HEAR","MUSIC","SER"]},target:{type:["book","entry-dictionary","entry-encyclopedia","interview","musical_score","paper-conference","review-book","treaty"]}}},{source:"NV",target:"number",when:{source:{TY:["CTLG","DATA"]},target:{type:["dataset","entry"]}}},{source:"NV",target:"version",when:{source:{TY:["EBOOK"]},target:!1}},{source:"NV",target:"dimensions",when:{source:{TY:["GRANT"]},target:!1}},{source:"NV",target:"collection-number",when:{source:{TY:["RPRT"]},target:{type:["report"]}}},{source:"OP",target:"original-title",when:{source:{TY:["ABST","AGGR","ANCIENT","BOOK","CHAP","CLSWK","CTLG","DICT","EBOOK","ECHAP","EDBOOK","ENCYC","GEN","INPR","JFULL","JOUR","MGZN","MUSIC","PAMP","SER"]},target:{type:["article","article-journal","article-magazine","book","chapter","entry","entry-dictionary","entry-encyclopedia","interview","musical_score","pamphlet","review","review-book","treaty"]}}},{source:"OP",target:"references",when:{source:{TY:["BILL","CASE","HEAR","LEGAL","STAT","UNBILL"]},target:{type:["bill","legal_case","legislation"]}}},{source:"PB",target:"publisher",when:{source:{TY:["ADVS","AGGR","ANCIENT","ART","BLOG","BOOK","CHAP","CHART","CLSWK","COMP","CONF","CPAPER","CTLG","DATA","DBASE","DICT","EBOOK","ECHAP","EDBOOK","EJOUR","ELEC","ENCYC","EQUA","FIGURE","GEN","GOVDOC","GRANT","HEAR","ICOMM","LEGAL","MAP","MGZN","MPCT","MULTI","MUSIC","NEWS","PAMP","PCOMM","SER","SLIDE","SOUND","STAND","THES","UNPB","VIDEO"]},target:{type:["article-magazine","article-newspaper","book","broadcast","chapter","dataset","entry","entry-dictionary","entry-encyclopedia","figure","graphic","interview","legislation","map","motion_picture","musical_score","pamphlet","paper-conference","personal_communication","post","post-weblog","review-book","song","speech","thesis","treaty","webpage"]}}},{source:"PB",target:"authority",when:{source:{TY:["CASE"]},target:{type:["legal_case"]}}},{source:"PB",target:"archive",when:{source:{TY:["MANSCPT"]},target:{type:["manuscript"]}}},{source:"PY",target:"issued",when:{source:{TY:["CHAP","CLSWK","COMP","DICT","ECHAP","GOVDOC","MULTI","NEWS"]},target:{type:["article-newspaper","chapter","entry-dictionary"]}}},{source:"PY",target:"event-date",when:{source:{TY:["CONF"]},target:{type:["paper-conference"]}}},{source:["PY","SE"],target:"issued",when:{source:{TY:["EJOUR"]},target:!1}},{source:"RI",target:"reviewed-title",when:{source:{TY:["ABST","ANCIENT","CHAP","DICT","EBOOK","ECHAP","EJOUR","ENCYC","GEN","GRANT","INPR","JFULL","JOUR","MGZN","NEWS","SER"]},target:{type:["article","article-journal","article-magazine","article-newspaper","chapter","entry-dictionary","entry-encyclopedia","interview","review","treaty"]}}},{source:"RI",target:"locator",when:{source:{TY:["STAT"]},target:!1}},{source:"SE",target:"section",when:{source:{TY:["BILL","GEN","GOVDOC","MUSIC","NEWS","STAT","UNBILL"]},target:{type:["article-newspaper","bill","interview","musical_score","treaty"]}}},{source:"SE",target:"number",when:{source:{TY:["BLOG"]},target:{type:["post-weblog"]}}},{source:"SE",target:"chapter-number",when:{source:{TY:["CHAP","SER"]},target:{type:["chapter"]}}},{source:"SE",target:"page",when:{source:{TY:["BOOK"]},target:{type:["book","review-book"]}}},{source:"SE",target:"submitted",when:{source:{TY:["CASE"]},target:{type:["legal_case"]}}},{source:"SE",target:"number-of-pages",when:{source:{TY:["CTLG"]},target:{type:["entry"]}}},{source:"SE",target:"original-date",when:{source:{TY:["DATA"]},target:{type:["dataset"]}}},{source:"SE",target:"version",when:{source:{TY:["DICT"]},target:{type:["entry-dictionary"]}}},{source:"SE",target:"locator",when:{source:{TY:["STAND"]},target:!1}},{source:"SE",target:"page-first",when:{source:{TY:["MANSCPT","MGZN"]},target:{type:["article-magazine","manuscript"]}}},{source:["SE","T2"],target:"locator",when:{source:{TY:["LEGAL"]},target:{type:["legislation"]}}},{source:"SN",target:["ISBN","ISSN"],when:{source:{TY:["AGGR","CLSWK","GEN"]},target:{type:["interview","treaty"]}}},{source:"SN",target:"ISBN",when:{source:{TY:["ADVS","ANCIENT","BLOG","BOOK","CHAP","COMP","CONF","CTLG","DICT","EBOOK","ECHAP","EDBOOK","ELEC","ENCYC","HEAR","MAP","PAMP","SER","SLIDE","SOUND","VIDEO"]},target:{type:["book","chapter","entry","entry-dictionary","entry-encyclopedia","map","pamphlet","paper-conference","post-weblog","review-book","song","speech","webpage"]}}},{source:"SN",target:"ISSN",when:{source:{TY:["ABST","DATA","EJOUR","INPR","JFULL","JOUR","MGZN","MUSIC","NEWS"]},target:{type:["article","article-journal","article-magazine","article-newspaper","dataset","musical_score","review"]}}},{source:"SN",target:"number",when:{source:{TY:["DBASE","GOVDOC"]},target:!1}},{source:["SN","T3"],target:"number",when:{source:{TY:["LEGAL","STAND"]},target:{type:["legislation"]}}},{source:"SP",target:"page",when:{source:{TY:["ABST","AGGR","ANCIENT","BILL","CHAP","CONF","CPAPER","CTLG","DBASE","DICT","ECHAP","EJOUR","ENCYC","GEN","GOVDOC","GRANT","HEAR","ICOMM","INPR","JFULL","JOUR","LEGAL","MANSCPT","MGZN","MUSIC","NEWS","PAMP","PAT","PCOMM","RPRT","SER","STAND","STAT","UNBILL","UNPB"]},target:{type:["article","article-journal","article-magazine","article-newspaper","bill","chapter","entry","entry-dictionary","entry-encyclopedia","interview","legislation","manuscript","musical_score","pamphlet","paper-conference","patent","personal_communication","post","report","review","treaty"]}}},{source:"SP",target:"number-of-pages",when:{source:{TY:["BOOK","CLSWK","EBOOK","EDBOOK","THES"]},target:{type:["book","review-book","thesis"]}}},{source:"SP",target:"page-first",when:{source:{TY:["CASE"]},target:{type:["legal_case"]}}},{source:"SP",target:"dimensions",when:{source:{TY:["MPCT"]},target:{type:["broadcast","motion_picture"]}}},{source:"ST",target:"title-short",when:{source:{TY:["ABST","ADVS","AGGR","ANCIENT","ART","BILL","BLOG","BOOK","CASE","CHAP","CLSWK","COMP","CONF","CTLG","DATA","DICT","ECHAP","EDBOOK","EJOUR","ELEC","ENCYC","GEN","GRANT","HEAR","ICOMM","INPR","JFULL","JOUR","MANSCPT","MAP","MGZN","MPCT","MUSIC","NEWS","PAMP","PAT","PCOMM","RPRT","SER","SLIDE","SOUND","STAT","THES","UNBILL","UNPB","VIDEO"]},target:{type:["article","article-journal","article-magazine","article-newspaper","bill","book","broadcast","chapter","dataset","entry","entry-dictionary","entry-encyclopedia","graphic","interview","legal_case","manuscript","map","motion_picture","musical_score","pamphlet","paper-conference","patent","personal_communication","post","post-weblog","report","review","review-book","song","speech","thesis","treaty","webpage"]}}},{source:"SV",target:"collection-number",when:{source:{TY:["CHAP"]},target:{type:["chapter"]}}},{source:"T2",target:"collection-title",when:{source:{TY:["AGGR","BOOK","CLSWK","COMP","CTLG","DBASE","ELEC","MANSCPT","MAP","MPCT","MULTI","RPRT","UNPB"]},target:{type:["book","broadcast","entry","manuscript","map","motion_picture","report","review-book","webpage"]}}},{source:"T2",target:"container-title",when:{source:{TY:["ABST","ANCIENT","BILL","BLOG","CHAP","DICT","EBOOK","ECHAP","EDBOOK","EJOUR","ENCYC","GEN","INPR","JFULL","JOUR","MGZN","MUSIC","NEWS","PAMP","PAT","SER","STAT","THES","UNBILL"]},target:{type:["article","article-journal","article-magazine","article-newspaper","bill","chapter","entry-dictionary","entry-encyclopedia","interview","musical_score","pamphlet","patent","post-weblog","review","thesis","treaty"]}}},{source:"T2",target:"event",when:{source:{TY:["CONF","CPAPER"]},target:{type:["paper-conference"]}}},{source:"T2",target:"committee",when:{source:{TY:["HEAR"]},target:!1}},{source:"T2",target:"section",when:{source:{TY:["STAND"]},target:!1}},{source:"T3",target:"collection-title",when:{source:{TY:["ADVS","ANCIENT","CHAP","CONF","DATA","EBOOK","ECHAP","EJOUR","GEN","GOVDOC","MUSIC","SER","SLIDE","SOUND","VIDEO"]},target:{type:["chapter","dataset","interview","musical_score","paper-conference","song","speech","treaty"]}}},{source:"TI",target:"title",when:{source:{TY:["ABST","ADVS","AGGR","ANCIENT","ART","BILL","BLOG","BOOK","CASE","CHAP","CHART","CLSWK","COMP","CONF","CPAPER","CTLG","DATA","DBASE","DICT","EBOOK","ECHAP","EDBOOK","EJOUR","ELEC","ENCYC","EQUA","FIGURE","GEN","GOVDOC","GRANT","HEAR","ICOMM","INPR","JFULL","JOUR","LEGAL","MANSCPT","MAP","MGZN","MPCT","MULTI","MUSIC","NEWS","PAMP","PAT","PCOMM","RPRT","SER","SLIDE","SOUND","STAND","STAT","THES","UNBILL","UNPB","VIDEO"]},target:{type:["article","article-journal","article-magazine","article-newspaper","bill","book","broadcast","chapter","dataset","entry","entry-dictionary","entry-encyclopedia","figure","graphic","interview","legal_case","legislation","manuscript","map","motion_picture","musical_score","pamphlet","paper-conference","patent","personal_communication","post","post-weblog","report","review","review-book","song","speech","thesis","treaty","webpage"]}}},{source:"TY",target:"type"},{source:"UR",target:"URL",when:{source:{TY:["ABST","ADVS","AGGR","ANCIENT","ART","BILL","BLOG","BOOK","CASE","CHAP","CHART","CLSWK","COMP","CONF","CPAPER","CTLG","DATA","DBASE","DICT","EBOOK","ECHAP","EDBOOK","EJOUR","ELEC","ENCYC","EQUA","FIGURE","GEN","GOVDOC","GRANT","ICOMM","INPR","JFULL","JOUR","LEGAL","MANSCPT","MAP","MGZN","MPCT","MULTI","MUSIC","NEWS","PAMP","PAT","PCOMM","RPRT","SER","SLIDE","SOUND","STAND","STAT","THES","UNBILL","UNPB","VIDEO"]},target:{type:["article","article-journal","article-magazine","article-newspaper","bill","book","broadcast","chapter","dataset","entry","entry-dictionary","entry-encyclopedia","figure","graphic","interview","legal_case","legislation","manuscript","map","motion_picture","musical_score","pamphlet","paper-conference","patent","personal_communication","post","post-weblog","report","review","review-book","song","speech","thesis","treaty","webpage"]}}},{source:"VL",target:"volume",when:{source:{TY:["ABST","ADVS","AGGR","ANCIENT","BILL","BOOK","CASE","CHAP","CLSWK","CONF","CPAPER","CTLG","DBASE","DICT","EBOOK","ECHAP","EDBOOK","EJOUR","ENCYC","GEN","GOVDOC","INPR","JFULL","JOUR","LEGAL","MANSCPT","MGZN","MUSIC","NEWS","RPRT","SER","SLIDE","SOUND","STAND","UNBILL","VIDEO"]},target:{type:["article","article-journal","article-magazine","article-newspaper","bill","book","chapter","entry","entry-dictionary","entry-encyclopedia","interview","legal_case","legislation","manuscript","musical_score","paper-conference","report","review","review-book","song","speech","treaty"]}}},{source:"VL",target:"dimensions",when:{source:{TY:["CHART","EQUA","FIGURE"]},target:{type:["figure"]}}},{source:"VL",target:"edition",when:{source:{TY:["COMP"]},target:!1}},{source:"VL",target:"number",when:{source:{TY:["PAMP"]},target:{type:["pamphlet"]}}},{source:"VL",target:"version",when:{source:{TY:["PAT"]},target:{type:["patent"]}}},{source:["VL","Y2"],target:"accessed",when:{source:{TY:["BLOG"]},target:{type:["post-weblog"]}}},{source:"Y2",target:"accessed",when:{source:{TY:["ABST","ADVS","ANCIENT","ART","BILL","BOOK","CASE","CHAP","CHART","CLSWK","COMP","CONF","CPAPER","CTLG","DATA","DICT","EDBOOK","ENCYC","EQUA","FIGURE","GEN","GOVDOC","GRANT","HEAR","ICOMM","INPR","JFULL","JOUR","LEGAL","MANSCPT","MAP","MGZN","MPCT","MUSIC","NEWS","PAMP","PAT","PCOMM","RPRT","SER","SLIDE","SOUND","STAND","THES","UNBILL","UNPB","VIDEO"]},target:{type:["article","article-journal","article-magazine","article-newspaper","bill","book","broadcast","chapter","dataset","entry","entry-dictionary","entry-encyclopedia","figure","graphic","interview","legal_case","legislation","manuscript","map","motion_picture","musical_score","pamphlet","paper-conference","patent","personal_communication","post","report","review","review-book","song","speech","thesis","treaty"]}}},{source:"C4",target:"author",when:{source:{TY:["BOOK","CHAP","EBOOK","ECHAP","EJOUR"]},target:{"reviewed-author":!0,type:["book","chapter","review-book","review"]}}},{source:"AU",target:"reviewed-author",when:{source:{C4:!0,TY:["BOOK","CHAP","EBOOK","ECHAP","EJOUR"]},target:{type:["book","chapter","review-book","review"]}}},{source:"TA",target:"author",when:{source:{TY:["ABST","ADVS","AGGR","ANCIENT","ART","BILL","BLOG","BOOK","CASE","CHAP","CHART","CLSWK","COMP","CONF","CPAPER","CTLG","DATA","DBASE","DICT","EBOOK","ECHAP","EDBOOK","EJOUR","ELEC","ENCYC","EQUA","FIGURE","GEN","GOVDOC","GRANT","HEAR","ICOMM","INPR","JFULL","JOUR","LEGAL","MANSCPT","MAP","MGZN","MPCT","MULTI","MUSIC","NEWS","PAMP","PAT","PCOMM","RPRT","SER","SLIDE","SOUND","STAND","STAT","THES","UNBILL","UNPB","VIDEO"]},target:{"original-author":!0,translator:!0,type:["article","article-journal","article-magazine","article-newspaper","bill","book","broadcast","chapter","dataset","entry","entry-dictionary","entry-encyclopedia","figure","graphic","interview","legal_case","legislation","manuscript","map","motion_picture","musical_score","pamphlet","paper-conference","patent","personal_communication","post","post-weblog","report","review","review-book","song","speech","thesis","treaty","webpage"]}}},{source:"AU",target:"original-author",when:{source:{TA:!0,TY:["ABST","ADVS","AGGR","ANCIENT","ART","BILL","BLOG","BOOK","CASE","CHAP","CHART","CLSWK","COMP","CONF","CPAPER","CTLG","DATA","DBASE","DICT","EBOOK","ECHAP","EDBOOK","EJOUR","ELEC","ENCYC","EQUA","FIGURE","GEN","GOVDOC","GRANT","HEAR","ICOMM","INPR","JFULL","JOUR","LEGAL","MANSCPT","MAP","MGZN","MPCT","MULTI","MUSIC","NEWS","PAMP","PAT","PCOMM","RPRT","SER","SLIDE","SOUND","STAND","STAT","THES","UNBILL","UNPB","VIDEO"]},target:{translator:!0,type:["article","article-journal","article-magazine","article-newspaper","bill","book","broadcast","chapter","dataset","entry","entry-dictionary","entry-encyclopedia","figure","graphic","interview","legal_case","legislation","manuscript","map","motion_picture","musical_score","pamphlet","paper-conference","patent","personal_communication","post","post-weblog","report","review","review-book","song","speech","thesis","treaty","webpage"]}}},{source:"TT",target:"title",when:{source:{TY:["ABST","ADVS","AGGR","ANCIENT","ART","BILL","BLOG","BOOK","CASE","CHAP","CHART","CLSWK","COMP","CONF","CPAPER","CTLG","DATA","DBASE","DICT","EBOOK","ECHAP","EDBOOK","EJOUR","ELEC","ENCYC","EQUA","FIGURE","GEN","GOVDOC","GRANT","HEAR","ICOMM","INPR","JFULL","JOUR","LEGAL","MANSCPT","MAP","MGZN","MPCT","MULTI","MUSIC","NEWS","PAMP","PAT","PCOMM","RPRT","SER","SLIDE","SOUND","STAND","STAT","THES","UNBILL","UNPB","VIDEO"]},target:{"original-author":!0,translator:!0,type:["article","article-journal","article-magazine","article-newspaper","bill","book","broadcast","chapter","dataset","entry","entry-dictionary","entry-encyclopedia","figure","graphic","interview","legal_case","legislation","manuscript","map","motion_picture","musical_score","pamphlet","paper-conference","patent","personal_communication","post","post-weblog","report","review","review-book","song","speech","thesis","treaty","webpage"]}}},{source:"TI",target:"original-title",when:{source:{TT:!0,TY:["ABST","ADVS","AGGR","ANCIENT","ART","BILL","BLOG","BOOK","CASE","CHAP","CHART","CLSWK","COMP","CONF","CPAPER","CTLG","DATA","DBASE","DICT","EBOOK","ECHAP","EDBOOK","EJOUR","ELEC","ENCYC","EQUA","FIGURE","GEN","GOVDOC","GRANT","HEAR","ICOMM","INPR","JFULL","JOUR","LEGAL","MANSCPT","MAP","MGZN","MPCT","MULTI","MUSIC","NEWS","PAMP","PAT","PCOMM","RPRT","SER","SLIDE","SOUND","STAND","STAT","THES","UNBILL","UNPB","VIDEO"]},target:{translator:!0,type:["article","article-journal","article-magazine","article-newspaper","bill","book","broadcast","chapter","dataset","entry","entry-dictionary","entry-encyclopedia","figure","graphic","interview","legal_case","legislation","manuscript","map","motion_picture","musical_score","pamphlet","paper-conference","patent","personal_communication","post","post-weblog","report","review","review-book","song","speech","thesis","treaty","webpage"]}}}]});var po=R($s=>{"use strict";Object.defineProperty($s,"__esModule",{value:!0});$s.default=void 0;var H1=vt(),qp=V1(uo());function V1(e){return e&&e.__esModule?e:{default:e}}var Y1=/^\d{4}-\d{4}$/,jp=/10(?:\.[0-9]{4,})?\/[^\s]*[^\s.,]/,J1={ANY:{toTarget(...e){return e.find(Boolean)},toSource(e){return[e]}},PAGE:{keepAll:!0,toTarget(e,t){return[e,t].filter(Boolean).join("-")},toSource(e){return e.replace(/[-]/g,"-")}},ISBN:{toTarget(e){return Y1.test(e)?[e]:[void 0,e]},toSource(...e){return e.find(Boolean)}},DATE:{toTarget(e){return e&&(0,H1.parse)(e.split("/").slice(0,3).filter(Boolean).join("/"))},toSource(e){let t=Array(4).fill("");return e["date-parts"][0].forEach((r,i)=>{t[i]=r}),e.season&&(t[3]=e.season),t.join("/")}},NAME:{toTarget(e){return e&&[].concat(e).map(t=>{let r=t.split(/, ?/),[i,s,a]=r;switch(r.length){case 3:return{family:i,given:s,suffix:a};case 2:return{family:i,given:s};case 1:if(i.indexOf(" ")>-1)return{family:i};default:return{literal:t}}})},toSource(e){return e.map(({family:t,given:r,suffix:i,literal:s})=>{let a=[t,r,i].filter(Boolean);return a.length?a.join(", "):s})}},KEYWORD:{toTarget(e){return e=[].concat(e),e.join(",")},toSource(e){return e.split(",")}},ID:{toSource(e){return e.slice(0,20)}},TYPE:{toTarget(e){return qp.default.RIS[e]},toSource(e){return qp.default.CSL[e]}},DOI:{toTarget(e){return e.match(jp)[0]},toSource(e){return e.match(jp)[0]}}},W1=J1;$s.default=W1});var Gp=R(Hs=>{"use strict";Object.defineProperty(Hs,"__esModule",{value:!0});Hs.default=void 0;var zs=X1(po());function X1(e){return e&&e.__esModule?e:{default:e}}var K1=[{source:"TY",target:"type"},{source:"ID",target:"id"},{source:["T1","TI","CT"],target:"title"},{source:"BT",target:"title",when:{source:{type:["BOOK","UNPB"],T1:!1,TI:!1,CT:!1},target:!1}},{source:"T2",target:"container-title",when:{target:{type:["bill","book","broadcast","chapter","dataset","entry","entry-dictionary","entry-encyclopedia","figure","graphic","interview","legal_case","legislation","manuscript","map","motion_picture","musical_score","pamphlet","paper-conference","patent","personal_communication","post","post-weblog","report","review","review-book","song","speech","thesis","treaty","webpage"]}}},{source:"BT",target:"container-title",when:{source:{type:["ABST","ADVS","ART","BILL","CASE","CHAP","COMP","CONF","CTLG","DATA","ELEC","GEN","HEAR","ICOMM","INPR","JFULL","JOUR","MAP","MGZN","MPCT","MUSIC","NEWS","PAMP","PAT","PCOMM","RPRT","SER","SLIDE","SOUND","STAT","THES","UNBILL","VIDEO"],T2:!1},target:!1}},{source:"T3",target:"collection-title"},{source:["A1","AU"],target:"author"},{source:["A2","ED"],target:"editor"},{source:"A3",target:"collection-editor"},{source:["Y1","PY"],target:"issued"},{source:"Y2",target:"event-date",convert:zs.default.DATE,when:{source:{type:["CONF","CPAPER"]},target:{type:["paper-conference"]}}},{source:"Y2",target:"submitted",convert:zs.default.DATE,when:{source:{type:["PAT"]},target:{type:"patent"}}},{source:["AB","N1"],target:"note"},{source:"N2",target:"abstract"},{source:"KW",target:"keyword"},{source:["JF","JO"],target:"container-title",convert:zs.default.ANY,when:{target:{type:["article","article-journal","article-magazine","article-newspaper"]}}},{source:["JA","J1","J2"],target:"container-title-short"},{source:"VL",target:"volume"},{source:["IS","CP"],target:"issue"},{source:"SP",target:"page-first"},{source:["SP","EP"],target:"page",convert:zs.default.PAGE,when:{source:{SP:!0,EP:!0}}},{source:"CY",target:"publisher-place"},{source:"PB",target:"publisher"},{source:"SN",target:["ISSN","ISBN"]},{source:"AV",target:"archive_location"},{source:"UR",target:"URL"}];Hs.default=K1});var $p=R((FT,Z1)=>{Z1.exports=[{source:["T1","BT"],target:"title",when:{source:{TY:["ABST","ADVS","AGGR","ANCIENT","ART","BILL","BLOG","BOOK","CASE","CHAP","CHART","CLSWK","COMP","CONF","CPAPER","CTLG","DATA","DBASE","DICT","EBOOK","ECHAP","EDBOOK","EJOUR","ELEC","ENCYC","EQUA","FIGURE","GEN","GOVDOC","GRANT","HEAR","ICOMM","INPR","JFULL","JOUR","LEGAL","MANSCPT","MAP","MGZN","MPCT","MULTI","MUSIC","NEWS","PAMP","PAT","PCOMM","RPRT","SER","SLIDE","SOUND","STAND","STAT","THES","UNBILL","UNPB","VIDEO"],TI:!1},target:!1}},{source:"A1",target:"author",when:{source:{TY:["ABST","ADVS","AGGR","ANCIENT","ART","BLOG","BOOK","CHAP","CHART","CLSWK","COMP","CONF","CPAPER","CTLG","DATA","DBASE","DICT","EBOOK","ECHAP","EJOUR","ELEC","ENCYC","EQUA","FIGURE","GEN","GOVDOC","GRANT","ICOMM","INPR","JFULL","JOUR","LEGAL","MANSCPT","MAP","MGZN","MULTI","PAMP","PAT","PCOMM","RPRT","SER","SLIDE","SOUND","STAND","THES","UNPB","VIDEO"],AU:!1},target:!1}},{source:"Y1",target:"issued",when:{source:{TY:["CONF"],C2:!1,DA:!1},target:!1}},{source:"Y1",target:"issued",when:{source:{TY:["PAT"],C2:!1,DA:!1,PY:!1},target:!1}},{source:"Y1",target:"issued",when:{source:{TY:["EBOOK"],C5:!1,PY:!1},target:!1}},{source:"Y1",target:"issued",when:{source:{TY:["ABST","ADVS","ANCIENT","ART","BILL","BLOG","BOOK","CASE","CHART","CPAPER","CTLG","DATA","EDBOOK","ELEC","ENCYC","EQUA","FIGURE","GEN","GRANT","HEAR","ICOMM","INPR","JFULL","JOUR","LEGAL","MANSCPT","MAP","MGZN","MPCT","MUSIC","PAMP","PCOMM","RPRT","SER","SLIDE","SOUND","STAND","THES","UNBILL","UNPB","VIDEO"],DA:!1,PY:!1},target:!1}},{source:"Y1",target:"issued",when:{source:{TY:["STAT"],DA:!1,PY:!1,Y2:!1},target:!1}},{source:"Y1",target:"issued",when:{source:{TY:["AGGR","DBASE"],ET:!1,PY:!1},target:!1}},{source:"Y1",target:"issued",when:{source:{TY:["CHAP","CLSWK","COMP","DICT","ECHAP","GOVDOC","MULTI","NEWS"],PY:!1},target:!1}},{source:"Y1",target:"issued",when:{source:{TY:["EJOUR"],PY:!1,SE:!1},target:!1}},{source:["JO","JF","J1"],target:"container-title",when:{source:{TY:["CONF"],C3:!1},target:!1}},{source:["JO","JF","J1"],target:"container-title",when:{source:{TY:["ABST","ANCIENT","BILL","BLOG","CHAP","DICT","EBOOK","ECHAP","EDBOOK","EJOUR","ENCYC","GEN","INPR","JFULL","JOUR","MGZN","MUSIC","NEWS","PAMP","PAT","SER","STAT","THES","UNBILL"],T2:!1},target:!1}},{source:"JA",target:"container-title-short",when:{source:{TY:["ABST","ANCIENT","BOOK","CHAP","CTLG","DATA","DICT","ENCYC","GRANT","ICOMM","INPR","JFULL","JOUR","LEGAL","MANSCPT","MGZN","PAMP","PCOMM","SER","STAND","STAT","UNPB"],J2:!1},target:!1}},{source:"N2",target:"abstract",when:{source:{TY:["ABST","ADVS","AGGR","ANCIENT","ART","BILL","BLOG","BOOK","CASE","CHAP","CHART","CLSWK","COMP","CONF","CPAPER","CTLG","DATA","DBASE","DICT","EBOOK","ECHAP","EDBOOK","EJOUR","ELEC","ENCYC","EQUA","FIGURE","GEN","GOVDOC","GRANT","HEAR","ICOMM","INPR","JFULL","JOUR","LEGAL","MANSCPT","MAP","MGZN","MPCT","MULTI","MUSIC","NEWS","PAMP","PAT","PCOMM","RPRT","SER","SLIDE","SOUND","STAND","STAT","THES","UNBILL","UNPB","VIDEO"],AB:!1},target:!1}},{source:["SP","EP"],target:"page",when:{source:{TY:["BOOK"],SE:!1},target:!1}},{source:["SP","EP"],target:"page",when:{source:{TY:["ABST","AGGR","ANCIENT","BILL","CHAP","CONF","CPAPER","CTLG","DBASE","DICT","ECHAP","EJOUR","ENCYC","GEN","GOVDOC","GRANT","HEAR","ICOMM","INPR","JFULL","JOUR","LEGAL","MANSCPT","MGZN","MUSIC","NEWS","PAMP","PAT","PCOMM","RPRT","SER","STAND","STAT","UNBILL","UNPB"],EP:!0},target:!1}},{source:"AV",target:"archive_location",when:{target:!1}},{source:"LK",target:"URL",when:{source:{TY:["HEAR"],L4:!1,UR:!1},target:!1}},{source:"LK",target:"URL",when:{source:{TY:["ABST","ADVS","AGGR","ANCIENT","ART","BILL","BLOG","BOOK","CASE","CHAP","CHART","CLSWK","COMP","CONF","CPAPER","CTLG","DATA","DBASE","DICT","EBOOK","ECHAP","EDBOOK","EJOUR","ELEC","ENCYC","EQUA","FIGURE","GEN","GOVDOC","GRANT","ICOMM","INPR","JFULL","JOUR","LEGAL","MANSCPT","MAP","MGZN","MPCT","MULTI","MUSIC","NEWS","PAMP","PAT","PCOMM","RPRT","SER","SLIDE","SOUND","STAND","STAT","THES","UNBILL","UNPB","VIDEO"],UR:!1},target:!1}},{source:"IS",target:"issue",when:{source:{TY:"MGZN",M1:!1},target:!1}}]});var Hp=R(Vs=>{"use strict";Object.defineProperty(Vs,"__esModule",{value:!0});Vs.default=void 0;var e_=zp(co()),t_=zp($p());function zp(e){return e&&e.__esModule?e:{default:e}}var r_=e_.default.concat(t_.default);Vs.default=r_});var Vp=R(fi=>{"use strict";Object.defineProperty(fi,"__esModule",{value:!0});fi.SPECS=void 0;Object.defineProperty(fi,"TYPES",{enumerable:!0,get:function(){return i_.default}});var i_=Ys(uo()),s_=Ys(co()),a_=Ys(Gp()),n_=Ys(Hp());function Ys(e){return e&&e.__esModule?e:{default:e}}var o_={new:s_.default,old:a_.default,mixed:n_.default};fi.SPECS=o_});var Yp=R((qT,l_)=>{l_.exports={author:"NAME","collection-editor":"NAME",composer:"NAME","container-author":"NAME",director:"NAME",editor:"NAME","editorial-director":"NAME",interviewer:"NAME",illustrator:"NAME","original-author":"NAME",recipient:"NAME","reviewed-author":"NAME",translator:"NAME",accessed:"DATE",container:"DATE","event-date":"DATE",issued:"DATE","original-date":"DATE",submitted:"DATE",id:"ID","ISSN,ISBN":"ISBN",keyword:"KEYWORD",page:"PAGE",type:"TYPE",DOI:"DOI"}});var Wp=R(Xt=>{"use strict";Object.defineProperty(Xt,"__esModule",{value:!0});Xt.format=b_;Xt.parse=f_;Xt.parseMixed=g_;Xt.parseNew=d_;Xt.parseOld=m_;var u_=me(),c_=fo(lo()),Ws=Vp(),Js=fo(po()),Jp=fo(Yp());function fo(e){return e&&e.__esModule?e:{default:e}}var p_=/^[A-Z][A-Z0-9] {2}-( |$)/,h_=/ {2}-(?: |$)/,ho=new Map;function Xs(e){if(!ho.has(e)){for(let t of e)if(t.target in Jp.default&&(t.convert=Js.default[Jp.default[t.target]]),!(t.convert&&t.convert.keepAll===!0)&&Array.isArray(t.source))if(t.convert){let{toSource:r,toTarget:i}=t.convert;t.convert={toTarget(...s){return i(Js.default.ANY.toTarget(...s))},toSource(...s){return Js.default.ANY.toSource(r(...s))}}}else t.convert=Js.default.ANY;ho.set(e,new u_.util.Translator(e))}return ho.get(e)}function f_(e){let t=[],r,i;for(let s of e.split(/\r?\n/)){if(s=s.trim(),!p_.test(s)){r&&i&&(r[i]+=" "+s);continue}let[a,n]=s.split(h_);switch(a){case"ER":r=void 0,i=void 0;break;case"TY":r={},t.push(r);default:Array.isArray(r[a])?r[a].push(n):r[a]=r[a]?[r[a],n]:n,i=a}}return t}function m_(e){return Xs(Ws.SPECS.old).convertToTarget(e)}function d_(e){return Xs(Ws.SPECS.new).convertToTarget(e)}function g_(e){return Xs(Ws.SPECS.mixed).convertToTarget(e)}function b_(e,{type:t,format:r=t||"text",spec:i}={}){let s=i||c_.default.outputSpec,a=e.map(Xs(Ws.SPECS[s]).convertToSource);return r==="object"?a:a.map(n=>{let o=[];for(let u in n)u!=="TY"&&o.push(...[].concat(n[u]).map(c=>`${u}  - ${c.toString().replace(/(.{70})/g,`$1
`)}`));return o.unshift(`TY  - ${n.TY}`),o.push("ER  - "),o.join(`
`)}).join(`
`)}});var Zp=R(()=>{"use strict";var y_=me(),v_=__(lo()),mi=Wp();function __(e){return e&&e.__esModule?e:{default:e}}var Xp=["A1","AV","BT","CP","ED","EP","ID","J1","JA","JF","JO","L2","L3","N2","T1","U1","U2","U3","U4","U5","U6","Y1"],Kp=["A4","AD","AN","C1","C2","C3","C4","C5","C6","C7","C8","CA","CN","DA","DB","DO","DP","ET","LA","LB","NV","OP","PY","RI","RN","SE","ST","SV","TA","TT"];y_.plugins.add("@ris",{input:{"@ris/file":{parse:mi.parse,parseType:{dataType:"String",predicate:/^TY {2}- /m}},"@ris/record":{parse:mi.parseMixed,parseType:{dataType:"SimpleObject",propertyConstraint:{props:["TY"]}}},"@ris/new+record":{parse:mi.parseNew,parseType:{extends:"@ris/record",propertyConstraint:[{props:Kp,match:"some"},{props:Xp,match:"none"}]}},"@ris/old+record":{parse:mi.parseOld,parseType:{extends:"@ris/record",propertyConstraint:[{props:Xp,match:"some"},{props:Kp,match:"none"}]}}},config:v_.default,output:{ris:mi.format}})});var Le=R((zT,eh)=>{eh.exports={shortLang:e=>e.toLowerCase().split("_")[0],forceArray:e=>(typeof e=="string"&&(e=[e]),e||[]),isPlainObject:e=>!(!e||typeof e!="object"||e instanceof Array),fixedEncodeURIComponent:e=>encodeURIComponent(e).replace(/[!'()*]/g,E_),replaceSpaceByUnderscores:e=>e.replace(/\s/g,"_"),uniq:e=>Array.from(new Set(e))};var E_=e=>"%"+e.charCodeAt(0).toString(16)});var Ks=R((HT,rh)=>{var th=e=>t=>{let r={};return Object.keys(t).forEach(i=>{let s=t[i];s!=null?r[i]=e?s.map(w_):s.value:r[i]=e?[]:null}),r},w_=e=>e.value,di=th(!1);rh.exports={labels:di,descriptions:di,aliases:th(!0),lemmas:di,representations:di,glosses:di}});var sh=R((VT,ih)=>{ih.exports=e=>{typeof e=="object"&&(e=e.time);let t=e[0],[r,i]=e.slice(1).split("T");r=r.replace(/-00/g,"-01");let s=`${r}T${i}`;return x_(t,s)};var x_=(e,t)=>{let r=t.split("-")[0];return e==="-"||r.length>4?T_(e,t,r):new Date(t)},T_=(e,t,r)=>{let i;return r.length===4?i=`${e}00${t}`:r.length===5?i=`${e}0${t}`:i=e+t,new Date(i)}});var At=R((YT,ah)=>{var mo=sh(),ne={};ne.isNumericId=e=>/^[1-9][0-9]*$/.test(e);ne.isEntityId=e=>/^((Q|P|L)[1-9][0-9]*|L[1-9][0-9]*-(F|S)[1-9][0-9]*)$/.test(e);ne.isEntitySchemaId=e=>/^E[1-9][0-9]*$/.test(e);ne.isItemId=e=>/^Q[1-9][0-9]*$/.test(e);ne.isPropertyId=e=>/^P[1-9][0-9]*$/.test(e);ne.isLexemeId=e=>/^L[1-9][0-9]*$/.test(e);ne.isFormId=e=>/^L[1-9][0-9]*-F[1-9][0-9]*$/.test(e);ne.isSenseId=e=>/^L[1-9][0-9]*-S[1-9][0-9]*$/.test(e);ne.isGuid=e=>/^((Q|P|L)[1-9][0-9]*|L[1-9][0-9]*-(F|S)[1-9][0-9]*)\$[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e);ne.isHash=e=>/^[0-9a-f]{40}$/.test(e);ne.isPropertyClaimsId=e=>{let[t,r]=e.split("#");return ne.isEntityId(t)&&ne.isPropertyId(r)};ne.isRevisionId=e=>/^\d+$/.test(e);ne.isEntityPageTitle=e=>{if(typeof e!="string")return!1;let[t,r]=e.split(":");return t&&r?S_(t)&&ne[`is${t}Id`](r):(r=t,ne.isItemId(r))};var A_=["Item","Property","Lexeme"],S_=e=>A_.includes(e),C_=e=>/^(Q|P|L)[1-9][0-9]*$/.test(e);ne.getNumericId=e=>{if(!C_(e))throw new Error(`invalid entity id: ${e}`);return e.replace(/^(Q|P|L)/,"")};ne.wikibaseTimeToDateObject=mo;var go=e=>t=>{try{return e(t)}catch(r){t=t.time||t;let i=t[0],[s,a]=t.slice(1).split("T");return s=s.replace(/-00/g,"-01"),`${i}${s}T${a}`}},O_=e=>mo(e).getTime(),k_=e=>mo(e).toISOString(),Q_=e=>{if(typeof e=="object"){let{time:t,precision:r}=e;r===9?e=t.replace("-01-01T","-00-00T"):r===10?e=t.replace("-01T","-00T"):e=t}return e.split("T")[0].replace(/^\+/,"").replace(/^(-?)0+/,"$1").replace(/-00$/,"").replace(/-00$/,"")};ne.wikibaseTimeToEpochTime=go(O_);ne.wikibaseTimeToISOString=go(k_);ne.wikibaseTimeToSimpleDay=go(Q_);ne.getImageUrl=(e,t)=>{let r=`https://commons.wikimedia.org/wiki/Special:FilePath/${e}`;return typeof t=="number"&&(r+=`?width=${t}`),r};ne.getEntityIdFromGuid=e=>{let t=e.split(/[$-]/);if(t.length===6)return t[0].toUpperCase();if(t.length===7)return t.slice(0,2).join("-").toUpperCase();throw new Error(`invalid guid: ${e}`)};ah.exports=ne});var lh=R((JT,oh)=>{var{wikibaseTimeToISOString:N_,wikibaseTimeToEpochTime:I_,wikibaseTimeToSimpleDay:D_}=At(),St=e=>e.value,P_=(e,t)=>t.keepRichValues?e.value:e.value.text,Pr=(e,t)=>L_(e,t.entityPrefix),R_={item:"Q",lexeme:"L",property:"P"},L_=(e,t)=>{let{value:r}=e,i=r.id||R_[r["entity-type"]]+r["numeric-id"];return typeof t=="string"?`${t}:${i}`:i},B_=(e,t)=>{let{value:r}=e,i=parseFloat(r.amount);if(t.keepRichValues){let s={amount:parseFloat(r.amount),unit:r.unit.replace(/^https?:\/\/.*\/entity\//,"")};return r.upperBound!=null&&(s.upperBound=parseFloat(r.upperBound)),r.lowerBound!=null&&(s.lowerBound=parseFloat(r.lowerBound)),s}else return i},F_=(e,t)=>t.keepRichValues?e.value:[e.value.latitude,e.value.longitude],M_=(e,t)=>{let r;if(typeof t.timeConverter=="function"?r=t.timeConverter(e.value):r=U_(t.timeConverter)(e.value),t.keepRichValues){let{timezone:i,before:s,after:a,precision:n,calendarmodel:o}=e.value;return{time:r,timezone:i,before:s,after:a,precision:n,calendarmodel:o}}else return r},U_=(e="iso")=>{let t=q_[e];if(!t)throw new Error(`invalid converter key: ${JSON.stringify(e).substring(0,100)}`);return t},q_={iso:N_,epoch:I_,"simple-day":D_,none:e=>e.time||e},nh={commonsMedia:St,"external-id":St,"geo-shape":St,"globe-coordinate":F_,math:St,monolingualtext:P_,"musical-notation":St,quantity:B_,string:St,"tabular-data":St,time:M_,url:St,"wikibase-entityid":Pr,"wikibase-form":Pr,"wikibase-item":Pr,"wikibase-lexeme":Pr,"wikibase-property":Pr,"wikibase-sense":Pr};oh.exports={parsers:nh,parse:(e,t,r,i)=>{e=e||t.type,e=e.replace(" ","-");try{return nh[e](t,r)}catch(s){throw s.message==="parsers[datatype] is not a function"&&(s.message=`${e} claim parser isn't implemented
        Claim id: ${i}
        Please report to https://github.com/maxlath/wikibase-sdk/issues`),s}}}});var bo=R((WT,ch)=>{var uh=e=>{let t=e.reduce(G_,{});return t.preferred||t.normal||[]},j_=e=>e.filter(t=>t.rank!=="deprecated"),G_=(e,t)=>{let{rank:r}=t;return e[r]||(e[r]=[]),e[r].push(t),e},$_=e=>{let t={};return Object.keys(e).forEach(r=>{t[r]=uh(e[r])}),t};ch.exports={truthyClaims:$_,truthyPropertyClaims:uh,nonDeprecatedPropertyClaims:j_}});var ea=R((XT,fh)=>{var{parse:z_}=lh(),{uniq:H_}=Le(),{truthyPropertyClaims:V_,nonDeprecatedPropertyClaims:Y_}=bo(),vo=(e,...t)=>{let{propertyPrefix:r}=Eo(t),i={};for(let s in e){let a=e[s];r&&(s=r+":"+s),i[s]=_o(a,...t)}return i},_o=(e,...t)=>{if(e==null||e.length===0)return[];let{keepNonTruthy:r,keepNonDeprecated:i,areSubSnaks:s}=Eo(t);return i?e=Y_(e):r||s||(e=V_(e)),e=e.map(a=>yo(a,...t)).filter(J_),e[0]&&typeof e[0]!="object"?H_(e):e},J_=e=>e!==void 0,yo=(e,...t)=>{t=Eo(t);let{keepQualifiers:r,keepReferences:i,keepIds:s,keepHashes:a,keepTypes:n,keepSnaktypes:o,keepRanks:u}=Z_(t),{mainsnak:c,rank:p}=e,f,h,m,g,d,v;if(c?(h=c.datatype,m=c.datavalue,g=c.snaktype):(m=e.datavalue,h=e.datatype,g=e.snaktype,e.hash?d=!0:v=!0),m)f=z_(h,m,t,e.id);else if(g==="somevalue")f=t.somevalueValue;else if(g==="novalue")f=t.novalueValue;else throw new Error("no datavalue or special snaktype found");if(d){if(!(a||n||o))return f;let x={value:f};return a&&(x.hash=e.hash),n&&(x.type=h),o&&(x.snaktype=g),x}if(v)return n?{type:h,value:f}:f;if(!(r||i||s||n||o||u))return f;let b={value:f};n&&(b.type=h),o&&(b.snaktype=g),u&&(b.rank=p);let E=Zs(t);return E.keepHashes=a,r&&(b.qualifiers=ph(e.qualifiers,E)),i&&(e.references=e.references||[],b.references=hh(e.references,E)),s&&(b.id=e.id),b},Eo=e=>{if(e==null)return{};if(e[0]&&typeof e[0]=="object")return e[0];let[t,r,i]=e;return{entityPrefix:t,propertyPrefix:r,keepQualifiers:i}},ph=(e,t)=>vo(e,Zs(t)),W_=(e,t)=>_o(e,Zs(t)),hh=(e,t)=>e.map(r=>X_(r,t)),X_=(e,t)=>{let r=Zs(t),i=vo(e.snaks,r);return r.keepHashes?{snaks:i,hash:e.hash}:i},Zs=(e={})=>e.areSubSnaks?e:Object.assign({},e,{areSubSnaks:!0}),K_=["keepQualifiers","keepReferences","keepIds","keepHashes","keepTypes","keepSnaktypes","keepRanks","keepRichValues"],Z_=e=>(e.keepAll&&K_.forEach(t=>{e[t]==null&&(e[t]=!0)}),e);fh.exports={simplifyClaims:vo,simplifyPropertyClaims:_o,simplifyClaim:yo,simplifyQualifiers:ph,simplifyPropertyQualifiers:W_,simplifyQualifier:yo,simplifyReferences:hh}});var gh=R((KT,dh)=>{var{isFormId:eE}=At(),{representations:tE}=Ks(),{simplifyClaims:rE}=ea(),mh=(e,t)=>{let{id:r,representations:i,grammaticalFeatures:s,claims:a}=e;if(!eE(r))throw new Error("invalid form object");return{id:r,representations:tE(i),grammaticalFeatures:s,claims:rE(a,t)}},iE=(e,t)=>e.map(r=>mh(r,t));dh.exports={simplifyForm:mh,simplifyForms:iE}});var vh=R((ZT,yh)=>{var{isSenseId:sE}=At(),{glosses:aE}=Ks(),{simplifyClaims:nE}=ea(),bh=(e,t)=>{let{id:r,glosses:i,claims:s}=e;if(!sE(r))throw new Error("invalid sense object");return{id:r,glosses:aE(i),claims:nE(s,t)}},oE=(e,t)=>e.map(r=>bh(r,t));yh.exports={simplifySense:bh,simplifySenses:oE}});var Eh=R((eA,_h)=>{_h.exports=["aa","ab","ace","ady","af","ak","als","alt","ami","am","ang","an","arc","ar","ary","arz","ast","as","atj","avk","av","awa","ay","azb","az","ban","bar","bat_smg","ba","bcl","be_x_old","be","bg","bh","bi","bjn","bm","bn","bo","bpy","br","bs","bug","bxr","ca","cbk_zam","cdo","ceb","ce","cho","chr","ch","chy","ckb","co","crh","cr","csb","cs","cu","cv","cy","dag","da","de","din","diq","dsb","dty","dv","dz","ee","el","eml","en","eo","es","et","eu","ext","fa","ff","fiu_vro","fi","fj","fo","frp","frr","fr","fur","fy","gag","gan","ga","gcr","gd","glk","gl","gn","gom","gor","got","gu","gv","hak","ha","haw","he","hif","hi","ho","hr","hsb","ht","hu","hy","hyw","hz","ia","id","ie","ig","ii","ik","ilo","inh","io","is","it","iu","jam","ja","jbo","jv","kaa","kab","ka","kbd","kbp","kg","ki","kj","kk","kl","km","kn","koi","ko","krc","kr","ksh","ks","ku","kv","kw","ky","lad","la","lbe","lb","lez","lfn","lg","lij","li","lld","lmo","ln","lo","lrc","ltg","lt","lv","mad","mai","map_bms","mdf","mg","mhr","mh","min","mi","mk","ml","mni","mn","mnw","mo","mrj","mr","ms","mt","mus","mwl","myv","my","mzn","nah","nap","na","nds_nl","nds","ne","new","ng","nia","nl","nn","nov","no","nqo","nrm","nso","nv","ny","oc","olo","om","or","os","pag","pam","pap","pa","pcd","pdc","pfl","pih","pi","pl","pms","pnb","pnt","ps","pt","pwn","qu","rm","rmy","rn","roa_rup","roa_tara","ro","rue","ru","rw","sah","sat","sa","scn","sco","sc","sd","se","sg","shi","shn","sh","shy","simple","si","skr","sk","sl","smn","sm","sn","sources","so","sq","srn","sr","ss","stq","st","su","sv","sw","szl","szy","ta","tay","tcy","tet","te","tg","th","ti","tk","tl","tn","to","tpi","trv","tr","ts","tt","tum","tw","tyv","ty","udm","ug","uk","ur","uz","vec","vep","ve","vi","vls","vo","war","wa","wo","wuu","xal","xh","xmf","yi","yo","yue","za","zea","zh_classical","zh_min_nan","zh_yue","zh","zu"]});var xo=R((tA,Th)=>{var{fixedEncodeURIComponent:lE,replaceSpaceByUnderscores:uE,isPlainObject:cE}=Le(),{isPropertyId:pE}=At(),wh="https://www.wikidata.org/wiki/",hE=Eh(),fE=(e,t)=>{if(cE(e)&&(t=e.title,e=e.site),!e)throw new Error("missing a site");if(!t)throw new Error("missing a title");let r=e.replace(/wiki$/,""),i=xh[r]||xh[e];if(i)return i(t);let{lang:s,project:a}=wo(e);return t=lE(uE(t)),`https://${s}.${a}.org/wiki/${t}`},ta=e=>t=>`https://${e}.wikimedia.org/wiki/${t}`,xh={commons:ta("commons"),mediawiki:e=>`https://www.mediawiki.org/wiki/${e}`,meta:ta("meta"),species:ta("species"),wikidata:e=>pE(e)?`${wh}Property:${e}`:`${wh}${e}`,wikimania:ta("wikimania")},mE=/^https?:\/\/([\w-]{2,10})\.(\w+)\.org\/\w+\/(.*)/,wo=e=>{if(e.startsWith("http")){let t=e,r=t.match(mE);if(!r)throw new Error(`invalid sitelink url: ${t}`);let[i,s,a]=r.slice(1);a=decodeURIComponent(a);let n;return i==="www"?(i="en",n=s):i==="commons"?(i="en",s=n="commons"):n=`${i}${s}`.replace("wikipedia","wiki"),{lang:i,project:s,key:n,title:a,url:t}}else{let t=e,r=dE[t];if(r)return{lang:"en",project:r,key:t};let[i,s,a]=t.split("wik");if(a!=null)throw new Error(`invalid sitelink key: ${t}`);if(hE.indexOf(i)===-1)throw new Error(`sitelink lang not found: ${i}`);let n=bE[s];if(!n)throw new Error(`sitelink project not found: ${n}`);return{lang:i,project:n,key:t}}},dE={commonswiki:"commons",mediawikiwiki:"mediawiki",metawiki:"meta",specieswiki:"specieswiki",wikidatawiki:"wikidata",wikimaniawiki:"wikimania"},gE=e=>{try{return wo(e),!0}catch(t){return!1}},bE={i:"wikipedia",isource:"wikisource",iquote:"wikiquote",tionary:"wiktionary",ibooks:"wikibooks",iversity:"wikiversity",ivoyage:"wikivoyage",inews:"wikinews"};Th.exports={getSitelinkUrl:fE,getSitelinkData:wo,isSitelinkKey:gE}});var Sh=R((rA,Ah)=>{var{getSitelinkUrl:yE}=xo();Ah.exports=(e,t={})=>{let{addUrl:r}=t;return Object.keys(e).reduce(vE(e,r),{})};var vE=(e,t)=>(r,i)=>{if(e[i]==null)return r[i]=e[i],r;let{title:s}=e[i];return t?r[i]={title:s,url:yE(i,s)}:r[i]=s,r}});var Oh=R((iA,Ch)=>{Ch.exports=(e,t={})=>{typeof e=="string"&&(e=JSON.parse(e));let{vars:r}=e.head,i=e.results.bindings;if(r.length===1&&t.minimize===!0){let o=r[0];return i.map(u=>To(u[o])).filter(u=>u!=null)}let{richVars:s,associatedVars:a,standaloneVars:n}=SE(r);return i.map(OE(s,a,n))};var To=e=>{if(!e)return;let{datatype:t}=e;return t=t&&t.replace("http://www.w3.org/2001/XMLSchema#",""),(_E[e.type]||EE(t))(e)},_E={uri:e=>TE(e.value),bnode:()=>null},ra=e=>parseFloat(e.value),EE=e=>(e=e&&e.replace("http://www.w3.org/2001/XMLSchema#",""),wE[e]||xE),wE={decimal:ra,integer:ra,float:ra,double:ra,boolean:e=>e.value==="true"},xE=e=>e.value,TE=e=>e.match(/http.*\/entity\/statement\//)?AE(e):e.replace(/^https?:\/\/.*\/entity\//,"").replace(/^https?:\/\/.*\/prop\/direct\//,""),AE=e=>{e=e.replace(/^https?:\/\/.*\/entity\/statement\//,"");let t=e.split("-");return t[0]+"$"+t.slice(1).join("-")},SE=e=>{let t=e.filter(a=>e.some(CE(a)));t=t.filter(a=>!t.some(n=>a!==n&&a.startsWith(n)));let r=new RegExp(`^(${t.join("|")})[A-Z]`),i=e.filter(a=>r.test(a)),s=e.filter(a=>!t.includes(a)&&!r.test(a));return{richVars:t,associatedVars:i,standaloneVars:s}},CE=e=>{let t=new RegExp(`^${e}[A-Z]\\w+`);return t.test.bind(t)},OE=(e,t,r)=>i=>{let s={};for(let a of e){let n={},o=To(i[a]);o!=null&&(n.value=o);for(let u of t)u.startsWith(a)&&kE(i,a,u,n);Object.keys(n).length>0&&(s[a]=n)}for(let a of r)s[a]=To(i[a]);return s},kE=(e,t,r,i)=>{let s=r.split(t)[1];s=s[0].toLowerCase()+s.slice(1),s=QE[s]||s;let a=e[r];a!=null&&(i[s]=a.value)},QE={altLabel:"aliases"}});var Ao=R((sA,Ih)=>{var{labels:NE,descriptions:IE,aliases:DE,lemmas:PE,glosses:RE}=Ks(),{simplifyClaim:kh,simplifyPropertyClaims:Qh,simplifyClaims:Nh,simplifyQualifier:LE,simplifyPropertyQualifiers:BE,simplifyQualifiers:FE,simplifyReferences:ME}=ea(),{simplifyForm:UE,simplifyForms:qE}=gh(),{simplifySense:jE,simplifySenses:GE}=vh(),$E=Sh(),zE=Oh();Ih.exports={labels:NE,descriptions:IE,aliases:DE,claim:kh,propertyClaims:Qh,claims:Nh,qualifier:LE,propertyQualifiers:BE,qualifiers:FE,references:ME,sitelinks:$E,snak:kh,propertySnaks:Qh,snaks:Nh,lemmas:PE,glosses:RE,form:UE,forms:qE,sense:jE,senses:GE,sparqlResults:zE}});var Rh=R((aA,Ph)=>{var So=Ao(),Co=(e,t)=>{let{type:r}=e,i={id:e.id,type:r,modified:e.modified};return e.datatype&&(i.datatype=e.datatype),r==="item"?(Be(e,i,"labels"),Be(e,i,"descriptions"),Be(e,i,"aliases"),Be(e,i,"claims",t),Be(e,i,"sitelinks",t)):r==="property"?(i.datatype=e.datatype,Be(e,i,"labels"),Be(e,i,"descriptions"),Be(e,i,"aliases"),Be(e,i,"claims",t)):r==="lexeme"&&(Be(e,i,"lemmas"),i.lexicalCategory=e.lexicalCategory,i.language=e.language,Be(e,i,"claims",t),Be(e,i,"forms",t),Be(e,i,"senses",t)),i},Be=(e,t,r,i)=>{e[r]!=null&&(t[r]=So[r](e[r],i))},Dh=(e,t={})=>{e.entities&&(e=e.entities);let{entityPrefix:r}=t;return Object.keys(e).reduce((i,s)=>{let a=e[s];return r&&(s=`${r}:${s}`),i[s]=Co(a,t),i},{})};So.entity=Co;So.entities=Dh;Ph.exports={simplifyEntity:Co,simplifyEntities:Dh}});var Fh=R((nA,Bh)=>{var{simplifyEntity:HE}=Rh(),Lh={entities:e=>{e=e.body||e;let{entities:t}=e;return Object.keys(t).forEach(r=>{t[r]=HE(t[r])}),t},pagesTitles:e=>(e=e.body||e,e.query.search.map(t=>t.title))};Bh.exports={wb:Lh,wd:Lh}});var qh=R((oA,Uh)=>{var Mh=typeof location!="undefined"&&typeof document!="undefined",Oo;Mh?Oo=e=>new URLSearchParams(e).toString():Oo=require("querystring").stringify;Uh.exports=e=>t=>(Mh&&(t.origin="*"),Object.keys(t).forEach(r=>{t[r]==null&&delete t[r]}),e+"?"+Oo(t))});var Gh=R((lA,jh)=>{var{isPlainObject:VE}=Le(),YE=["item","property","lexeme","form","sense"];jh.exports=e=>(t,r,i,s,a)=>{let n,o;if(VE(t)){let u=t;t=u.search,r=u.language,i=u.limit,o=u.continue,s=u.format,a=u.uselang,n=u.type}if(!(t&&t.length>0))throw new Error("search can't be empty");if(r=r||"en",a=a||r,i=i||"20",s=s||"json",n=n||"item",o=o||"0",!YE.includes(n))throw new Error(`invalid type: ${n}`);return e({action:"wbsearchentities",search:t,language:r,limit:i,continue:o,format:s,uselang:a,type:n})}});var zh=R((uA,$h)=>{var{isPlainObject:JE}=Le(),WE=/^\d+[|\d]*$/;$h.exports=e=>t=>{if(!JE(t))throw new Error(`expected parameters to be passed as an object, got ${t} (${typeof t})`);for(let h in t)if(h.startsWith("sr")){let m=h.replace(/^sr/,"");if(t[m]!=null)throw new Error(`${m} and ${h} are the same`);t[m]=t[h]}let{search:r,haswbstatement:i,format:s="json",limit:a,offset:n,profile:o,sort:u}=t,{namespace:c,prop:p}=t;if(!(r||i))throw new Error('missing "search" or "haswbstatement" parameter');let f="";if(r&&(f+=r),i){let h=i instanceof Array?i:[i];for(let m of h)m[0]==="-"?f+=` -haswbstatement:${m.slice(1)}`:f+=` haswbstatement:${m}`}if(a!=null&&(typeof a!="number"||a<1))throw new Error(`invalid limit: ${a}`);if(n!=null&&(typeof n!="number"||n<0))throw new Error(`invalid offset: ${n}`);if(c instanceof Array?c=c.join("|"):typeof c=="number"&&(c=c.toString()),c&&!WE.test(c))throw new Error(`invalid namespace: ${c}`);if(o!=null&&typeof o!="string")throw new Error(`invalid profile: ${o} (${typeof o}, expected string)`);if(u!=null&&typeof u!="string")throw new Error(`invalid sort: ${u} (${typeof u}, expected string)`);if(p!=null&&(c instanceof Array&&(p=p.join("|")),typeof p!="string"))throw new Error(`invalid prop: ${p} (${typeof p}, expected string)`);return e({action:"query",list:"search",srsearch:f.trim(),format:s,srnamespace:c,srlimit:a,sroffset:n,srqiprofile:o,srsort:u,srprop:p})}});var gi=R((cA,Hh)=>{var XE=At(),ia=(e,t)=>r=>{if(!XE[t](r))throw new Error(`invalid ${e}: ${r}`)};Hh.exports={entityId:ia("entity id","isEntityId"),propertyId:ia("property id","isPropertyId"),entityPageTitle:ia("entity page title","isEntityPageTitle"),revisionId:ia("revision id","isRevisionId")}});var Qo=R((pA,Vh)=>{var{isPlainObject:KE,forceArray:ko,shortLang:ZE}=Le(),ew=gi();Vh.exports=e=>(t,r,i,s,a)=>{if(KE(t)&&({ids:t,languages:r,props:i,format:s,redirects:a}=t),s=s||"json",!(t&&t.length>0))throw new Error("no id provided");t=ko(t),t.forEach(ew.entityId),t.length>50&&console.warn(`getEntities accepts 50 ids max to match Wikidata API limitations:
      this request won't get all the desired entities.
      You can use getManyEntities instead to generate several request urls
      to work around this limitation`);let n={action:"wbgetentities",ids:t.join("|"),format:s};return a===!1&&(n.redirects="no"),r&&(r=ko(r).map(ZE),n.languages=r.join("|")),i&&i.length>0&&(n.props=ko(i).join("|")),e(n)}});var Jh=R((hA,Yh)=>{var{isPlainObject:tw}=Le();Yh.exports=e=>{let t=Qo()(e);return(r,i,s,a,n)=>{if(tw(r)&&({ids:r,languages:i,props:s,format:a,redirects:n}=r),!(r instanceof Array))throw new Error("getManyEntities expects an array of ids");return rw(r).map(o=>t(o,i,s,a,n))}};var rw=e=>{let t=[];for(;e.length>0;){let r=e.slice(0,50);e=e.slice(50),t.push(r)}return t}});var Zh=R((fA,Kh)=>{var{forceArray:Wh}=Le(),iw=gi();Kh.exports=e=>(t,r={})=>{t=Wh(t),t.forEach(iw.entityPageTitle);let i=t.length===1,s={action:"query",prop:"revisions"};s.titles=t.join("|"),s.format=r.format||"json",i&&(s.rvlimit=r.limit||"max"),i&&r.start&&(s.rvstart=Xh(r.start)),i&&r.end&&(s.rvend=Xh(r.end));let{prop:a,user:n,excludeuser:o,tag:u}=r;return a?s.rvprop=Wh(a).join("|"):s.rvprop="ids|flags|timestamp|user|userid|size|slotsize|sha1|slotsha1|contentmodel|comment|parsedcomment|content|tags|roles|oresscores",s.rvslots="*",n&&(s.rvuser=n),o&&(s.rvexcludeuser=o),u&&(s.rvtag=u),e(s)};var Xh=e=>typeof e=="number"&&e<sw?e:Math.trunc(new Date(e).getTime()/1e3),sw=new Date("2000-01-01").getTime()});var rf=R((mA,tf)=>{var ef=gi(),{isPlainObject:aw}=Le();tf.exports=(e,t)=>(r,i)=>(aw(r)&&(i=r.revision,r=r.id),ef.entityId(r),ef.revisionId(i),`${e}/${t}/index.php?title=Special:EntityData/${r}.json&revision=${i}`)});var af=R((dA,sf)=>{var{isPlainObject:nw,forceArray:sa,shortLang:ow}=Le();sf.exports=e=>(t,r,i,s,a,n)=>{if(nw(t)){let u=t;t=u.titles,r=u.sites,i=u.languages,s=u.props,a=u.format,n=u.redirects}if(a=a||"json",!(t&&t.length>0))throw new Error("no titles provided");r&&r.length>0||(r=["enwiki"]),t=sa(t),r=sa(r).map(lw),s=sa(s);let o={action:"wbgetentities",titles:t.join("|"),sites:r.join("|"),format:a};return r.length===1&&t.length===1&&(o.normalize=!0),i&&(i=sa(i).map(ow),o.languages=i.join("|")),s&&s.length>0&&(o.props=s.join("|")),n===!1&&(o.redirects="no"),e(o)};var lw=e=>e.length===2?`${e}wiki`:e});var No=R((gA,nf)=>{var{fixedEncodeURIComponent:uw}=Le();nf.exports=e=>t=>{let r=uw(t);return`${e}?format=json&query=${r}`}});var uf=R((bA,lf)=>{var{forceArray:cw}=Le(),{isItemId:pw}=At(),hw=gi(),fw="FILTER NOT EXISTS { ?subject rdf:type wikibase:Property . } ";lf.exports=e=>{let t=No()(e);return(r,i,s={})=>{let{limit:a,caseInsensitive:n,keepProperties:o}=s,u=n?gw:dw,c=o?"":fw,p=cw(r);p.forEach(hw.propertyId),p=p.map(bw).join("|");let h=`SELECT DISTINCT ?subject WHERE { ${mw(i,u,p,c)} }`;return a&&(h+=` LIMIT ${a}`),t(h)}};var mw=(e,t,r,i)=>e instanceof Array?"{ "+e.map(of).map(a=>t(r,a,i)).join("} UNION {")+" }":t(r,of(e),i),of=e=>(pw(e)?e=`wd:${e}`:typeof e=="string"&&(e=`'${e}'`),e),dw=(e,t,r,i)=>`?subject ${e} ${t} .
    ${r}`,gw=(e,t,r,i)=>`?subject ${e} ?value .
    FILTER (lcase(?value) = ${t.toLowerCase()})
    ${r}`,bw=e=>"wdt:"+e});var gf=R((yA,df)=>{var{isPlainObject:yw}=Le(),vw=Ao(),_w=Fh(),Ew=At(),ww=xo(),xw=bo(),Tw=`Tip: if you just want to access functions that don't need an instance or a sparqlEndpoint,
those are also exposed directly on the module object. Exemple:
const { isItemId, simplify } = require('wikibase-sdk')`,hf=Object.assign({simplify:vw,parse:_w},Ew,ww,xw),ff=e=>{if(!yw(e))throw new Error("invalid config");let{instance:t,sparqlEndpoint:r}=e,{wgScriptPath:i="w"}=e;if(i=i.replace(/^\//,""),!(t||r))throw new Error(`one of instance or sparqlEndpoint should be set at initialization.
${Tw}`);let s,a,n;if(t){cf("instance",t),a=t.replace(/\/$/,"").replace(`/${i}/api.php`,""),n=`${a}/${i}/api.php`;let c=qh()(n);s={searchEntities:Gh()(c),cirrusSearchPages:zh()(c),getEntities:Qo()(c),getManyEntities:Jh()(c),getRevisions:Zh()(c),getEntityRevision:rf()(t,i),getEntitiesFromSitelinks:af()(c)}}else s={searchEntities:Kt("searchEntities"),cirrusSearchPages:Kt("cirrusSearchPages"),getEntities:Kt("getEntities"),getManyEntities:Kt("getManyEntities"),getRevisions:Kt("getRevisions"),getEntityRevision:Kt("getEntityRevision"),getEntitiesFromSitelinks:Kt("getEntitiesFromSitelinks")};let o;return r?(cf("sparqlEndpoint",r),o={sparqlQuery:No()(r),getReverseClaims:uf()(r)}):o={sparqlQuery:pf("sparqlQuery"),getReverseClaims:pf("getReverseClaims")},Object.assign({instance:{root:a,apiEndpoint:n}},hf,s,o)};Object.assign(ff,hf);var cf=(e,t)=>{if(!(typeof t=="string"&&t.startsWith("http")))throw new Error(`invalid ${e}: ${t}`)},mf=e=>t=>()=>{throw new Error(`${t} requires ${e} to be set at initialization`)},pf=mf("a sparqlEndpoint"),Kt=mf("an instance");df.exports=ff});var Io=R((vA,bf)=>{bf.exports=gf()({instance:"https://www.wikidata.org",sparqlEndpoint:"https://query.wikidata.org/sparql"})});var aa=R((_A,Aw)=>{Aw.exports={langs:["en"]}});var Do=R(Rr=>{"use strict";Object.defineProperty(Rr,"__esModule",{value:!0});Rr.parse=Rr.default=void 0;var Sw=yf(Io()),Cw=yf(aa());function yf(e){return e&&e.__esModule?e:{default:e}}var Ow=function(e,t){let r=[].concat(e);return[].concat(Sw.default.getManyEntities(r,t||Cw.default.langs))};Rr.default=Rr.parse=Ow});var Po=R(na=>{"use strict";Object.defineProperty(na,"__esModule",{value:!0});na.parse=Iw;na.parseAsync=Dw;var kw=me(),{fetchFile:Qw,fetchFileAsync:Nw}=kw.util;function Iw(e){return[].concat(e).map(Qw)}function Dw(e){return Promise.all([].concat(e).map(Nw))}});var Qf=R(Lr=>{"use strict";Object.defineProperty(Lr,"__esModule",{value:!0});Lr.fillCache=Of;Lr.fillCacheAsync=kf;Lr.parse=Mw;Lr.parseAsync=Uw;var Pw=Io(),Ef=Po(),Rw=Do(),Lw={keepQualifiers:!0,timeConverter:"simple-day"},Ro={P17:null},vf={P740:Ro,P159:Ro},Bw={P50:null,P57:null,P86:null,P98:null,P110:null,P655:null,P1817:null,P921:{P50:null},P407:null,P364:null,P123:vf,P629:{P50:null,P123:vf},P437:null,P186:null,P179:{P98:null},P1433:{P4745:{P276:Ro}},P361:{P50:null}};function Fw(e,t){return e.push(...t),e}function _f(e,t){return t?(e._needed=Object.assign(e._needed||{},t),Object.keys(e.claims).filter(r=>r in t).map(r=>e.claims[r].map(({value:i})=>i.id||i)).reduce(Fw,[])):[]}function wf(e,t){if(!t){let i=[];for(let s in e){let a=_f(e[s],Bw);for(let n of a)i.includes(n)||i.push(n)}return i}let r=[];for(let i of t){let s=e[i];if(s._needed){for(let a in s.claims)if(a in s._needed)for(let n of s.claims[a])n.value&&n.value.id||(n.value=e[n.value],r.push(..._f(n.value,s._needed[a])));delete s._needed}}return r}function Lo(e){return Pw.simplify.entities(e,Lw)}function xf(e,t){return{needed:wf(t),incomplete:Object.keys(e)}}function Tf(e,t){let r=e.filter((i,s)=>!(i in t)&&e.indexOf(i)===s);return(0,Rw.parse)(r)}function Af(e,t){let{entities:r}=JSON.parse(e);Object.assign(t,Lo(r))}function Sf(e,t){return{needed:wf(t,e.incomplete),incomplete:e.needed}}function Cf(e,t){return Object.keys(e).map(r=>t[r])}function Of(e){let t=Lo(e),r=xf(e,t);for(;r.needed.length;)Tf(r.needed,t).map(s=>Af((0,Ef.parse)(s),t)),r=Sf(r,t);return t}function Mw(e){let t=Of(e);return Cf(e,t)}async function kf(e){let t=Lo(e),r=xf(e,t);for(;r.needed.length;){let i=Tf(r.needed,t);await Promise.all(i.map(async s=>Af(await(0,Ef.parseAsync)(s),t))),r=Sf(r,t)}return t}async function Uw(e){let t=await kf(e);return Cf(e,t)}});var Nf=R((TA,qw)=>{qw.exports={Q191067:"article",Q1266946:"thesis",Q187685:"thesis",Q265158:"review",Q1172284:"dataset",Q2352616:"dataset",Q367035:"dataset",Q4006:"map",Q133792:"map",Q842617:"map",Q1425895:"map",Q2334719:"legal_case",Q36774:"webpage",Q15474042:"webpage",Q58494026:"webpage",Q17379835:"webpage",Q17442446:"webpage",Q21281405:"webpage",Q16222597:"webpage",Q653848:"map",Q21944833:"map",Q11424:"motion_picture",Q157443:"motion_picture",Q571:"book",Q87167:"manuscript",Q131569:"treaty",Q216665:"book",Q686822:"bill",Q10870555:"report",Q3099732:"report",Q252550:"treaty",Q3536928:"treaty",Q5707594:"article-newspaper",Q59908:"article",Q1164267:"book",Q18011172:"motion_picture",Q19389637:"article",Q11578774:"broadcast",Q15416:"broadcast",Q1555508:"broadcast",Q26260507:"broadcast",Q580922:"article",Q651270:"article",Q759838:"article",Q1580166:"entry-dictionary",Q1809676:"article",Q2106255:"article",Q1004391:"report",Q2438528:"article",Q6646525:"article",Q7216866:"post",Q7318358:"article",Q7582241:"article",Q10389811:"entry",Q13442814:"article-journal",Q17518557:"article",Q19917774:"article",Q30070590:"article-magazine",Q37974534:"article",Q637866:"review-book",Q5196473:"review",Q5251247:"review",Q42350535:"article",Q51282711:"thesis",Q51282766:"thesis",Q51282798:"thesis",Q51282875:"thesis",Q51282918:"thesis",Q51282969:"thesis",Q51282999:"thesis",Q51283026:"thesis",Q51283053:"thesis",Q51283145:"thesis",Q51283327:"thesis",Q55399605:"thesis",Q58010711:"article",Q60559362:"article",Q480498:"legal_case",Q697327:"legal_case",Q1469824:"dataset",Q2055205:"legal_case",Q162827:"map",Q460214:"map",Q2259701:"map",Q253623:"patent",Q22909582:"review",Q1172480:"dataset",Q45941145:"dataset",Q56515249:"review",Q61992233:"review",Q16968990:"book",Q21191270:"broadcast",Q26225677:"motion_picture",Q56753859:"map",Q57933693:"book",Q2823677:"legal_case",Q2865639:"legal_case",Q7307130:"legal_case",Q8016240:"legal_case",Q11827307:"legal_case",Q16738832:"legal_case",Q18146819:"legal_case",Q18536127:"legal_case",Q20917517:"legal_case",Q7366:"song",Q7302866:"song",Q25203386:"song",Q30637971:"legal_case",Q52768654:"map",Q56123235:"song",Q56612794:"song",Q60566516:"song",Q60809954:"song",Q61221204:"legal_case",Q24634210:"broadcast",Q61855877:"broadcast",Q1006160:"dataset",Q1980247:"chapter",Q19692072:"legal_case",Q23927052:"paper-conference",Q178651:"interview",Q861911:"speech",Q216526:"map",Q2940514:"map",Q3391101:"map",Q55089312:"dataset",Q56704157:"legal_case",Q26205359:"webpage",Q28326484:"webpage",Q28326490:"webpage",Q57312861:"webpage",Q106833:"book",Q128093:"book",Q20540385:"book",Q7433672:"book",Q193495:"book",Q3831846:"book",Q203490:"book",Q254554:"book",Q448980:"book",Q604219:"book",Q605076:"book",Q642946:"book",Q48498:"manuscript",Q727715:"book",Q747381:"book",Q855753:"book",Q890239:"book",Q913554:"book",Q918038:"book",Q922203:"book",Q944359:"book",Q1009641:"book",Q1631107:"dataset",Q26876682:"dataset",Q47114558:"dataset",Q1050259:"book",Q1062404:"book",Q1106827:"book",Q1173065:"book",Q1184488:"book",Q1238720:"book",Q1414013:"book",Q1415108:"book",Q162206:"map",Q191072:"map",Q320228:"map",Q352416:"map",Q441903:"map",Q573980:"map",Q602481:"map",Q715789:"map",Q728502:"map",Q1403728:"map",Q1410020:"map",Q1496857:"book",Q1528894:"book",Q1609706:"book",Q1616547:"book",Q1650727:"book",Q1760610:"book",Q1785330:"book",Q1870591:"book",Q1883939:"book",Q1977520:"book",Q1986787:"book",Q2069066:"book",Q2072218:"book",Q2104296:"book",Q2122442:"book",Q2128336:"book",Q2135225:"book",Q2208044:"book",Q2314679:"book",Q2331348:"book",Q2363145:"book",Q2374324:"book",Q2377289:"book",Q2396513:"book",Q2514954:"book",Q2537127:"book",Q2787237:"book",Q2831984:"book",Q3045706:"book",Q3831821:"book",Q3831847:"book",Q3915339:"book",Q4067007:"book",Q4224691:"book",Q4515179:"book",Q4677625:"book",Q4686085:"book",Q4931288:"book",Q5073531:"book",Q5093328:"book",Q5159310:"book",Q6675210:"book",Q8275050:"book",Q10666342:"book",Q11396303:"book",Q11750596:"book",Q12308638:"book",Q12410152:"book",Q12731131:"book",Q13137339:"book",Q13430107:"book",Q13636757:"book",Q13751595:"book",Q16046027:"book",Q16385949:"book",Q16507688:"book",Q16736578:"book",Q17134316:"book",Q21598767:"book",Q21662746:"book",Q22988237:"book",Q25679217:"book",Q12912091:"motion_picture",Q1453402:"map",Q1502030:"map",Q1664468:"map",Q1783108:"map",Q1787111:"dataset",Q1875628:"map",Q2089517:"map",Q2127425:"map",Q2353983:"map",Q2368091:"map",Q2426254:"map",Q2470969:"map",Q2471702:"map",Q2620815:"map",Q2656361:"map",Q2940478:"map",Q3509676:"map",Q3515498:"map",Q4505959:"map",Q4845530:"map",Q26267321:"book",Q26271823:"book",Q27560760:"book",Q29154430:"book",Q29586870:"book",Q31946409:"book",Q38143661:"book",Q52005090:"book",Q52153485:"book",Q55610842:"book",Q56552233:"book",Q57790812:"book",Q58142059:"book",Q58211632:"book",Q58807269:"book",Q60226001:"book",Q60475414:"book",Q60475468:"book",Q60627667:"book",Q61696018:"book",Q5047387:"map",Q5177325:"map",Q5434353:"map",Q6017843:"map",Q6664848:"map",Q7104865:"map",Q10544122:"map",Q11426259:"map",Q11618908:"map",Q14321585:"map",Q15877105:"map",Q17047956:"map",Q21935483:"map",Q22125384:"map",Q59457513:"map",Q60054914:"map",Q846662:"broadcast",Q5778924:"motion_picture",Q8513:"dataset",Q178376:"dataset",Q1675302:"map",Q267628:"article",Q871232:"article",Q3694604:"article",Q3719255:"article",Q19375673:"article",Q442919:"interview",Q850171:"interview",Q1384479:"interview",Q1477475:"interview",Q1067324:"motion_picture",Q1941707:"motion_picture",Q3055290:"interview",Q3055291:"interview",Q450873:"patent",Q681875:"patent",Q913351:"patent",Q5465504:"patent",Q2049275:"manuscript",Q213924:"manuscript",Q274076:"manuscript",Q597695:"manuscript",Q720106:"manuscript",Q865595:"manuscript",Q1067768:"manuscript",Q1266076:"manuscript",Q2209578:"manuscript",Q2217259:"manuscript",Q2531964:"manuscript",Q2816501:"manuscript",Q19787436:"patent",Q19787437:"patent",Q35639987:"patent",Q43305660:"patent",Q59818481:"dataset",Q1949797:"legal_case",Q18918145:"article-journal",Q2782326:"article-journal",Q3149408:"legal_case",Q18342738:"speech",Q3228788:"speech",Q3731370:"legal_case",Q17123524:"book",Q336144:"motion_picture",Q867242:"book",Q1093720:"treaty",Q193170:"treaty",Q625298:"treaty",Q837144:"treaty",Q864737:"treaty",Q931855:"treaty",Q1242841:"treaty",Q1414340:"treaty",Q1414472:"treaty",Q1498487:"treaty",Q1646218:"treaty",Q1671773:"treaty",Q1711115:"treaty",Q2290707:"treaty",Q2300991:"treaty",Q2465017:"treaty",Q3125472:"manuscript",Q3220177:"manuscript",Q3240926:"manuscript",Q3252544:"manuscript",Q3560324:"manuscript",Q3749265:"manuscript",Q3824506:"treaty",Q3960554:"manuscript",Q4426710:"treaty",Q4475654:"manuscript",Q4872029:"treaty",Q4985043:"treaty",Q7012086:"manuscript",Q7452368:"manuscript",Q9026959:"manuscript",Q11613006:"manuscript",Q13430250:"manuscript",Q17143154:"manuscript",Q21089188:"manuscript",Q22669850:"manuscript",Q22948347:"manuscript",Q25351420:"manuscript",Q31078443:"manuscript",Q33308141:"manuscript",Q11122:"treaty",Q451584:"legal_case",Q876477:"bill",Q1006544:"bill",Q1288220:"legal_case",Q2206565:"legal_case",Q2783852:"legal_case",Q5500839:"legal_case",Q7246224:"bill",Q7257705:"bill",Q7885007:"bill",Q859161:"dataset",Q1650567:"webpage",Q11439:"webpage",Q16602140:"bill",Q16821677:"bill",Q28457660:"bill",Q2261569:"webpage",Q2641220:"webpage",Q2737701:"webpage",Q14204246:"webpage",Q21025364:"webpage",Q23691297:"webpage",Q58040463:"webpage",Q44873079:"interview",Q4202018:"interview",Q4317093:"interview",Q7256239:"interview",Q7625207:"interview",Q8776455:"interview",Q45933791:"interview",Q60723716:"interview",Q6908053:"treaty",Q6934728:"treaty",Q6944158:"treaty",Q9160460:"treaty",Q9557810:"treaty",Q11455760:"treaty",Q11637357:"treaty",Q16567729:"treaty",Q19357149:"book",Q184528:"speech",Q203737:"speech",Q261197:"speech",Q554211:"speech",Q749054:"speech",Q787020:"speech",Q805093:"speech",Q960189:"speech",Q1346967:"speech",Q1840948:"speech",Q1980740:"speech",Q2183050:"speech",Q2895132:"speech",Q3030189:"speech",Q3040417:"speech",Q4329077:"speech",Q4388316:"speech",Q5152362:"speech",Q200092:"motion_picture",Q224700:"motion_picture",Q248583:"motion_picture",Q457832:"motion_picture",Q622548:"motion_picture",Q624771:"motion_picture",Q16835935:"treaty",Q16956642:"treaty",Q19958750:"treaty",Q27768121:"treaty",Q29526855:"treaty",Q29527278:"treaty",Q29527544:"treaty",Q29883540:"treaty",Q30921722:"treaty",Q38653134:"treaty",Q39234269:"treaty",Q41535471:"treaty",Q50192946:"treaty",Q57205857:"treaty",Q1194534:"dataset",Q7979513:"speech",Q11261492:"speech",Q11496736:"speech",Q11504413:"speech",Q13611058:"speech",Q13632631:"speech",Q15853847:"speech",Q18907443:"speech",Q19776345:"speech",Q28472611:"speech",Q56191193:"speech",Q56192445:"speech",Q60061482:"speech",Q60780612:"speech",Q47123453:"report",Q1054574:"motion_picture",Q860626:"motion_picture",Q959790:"motion_picture",Q1788980:"motion_picture",Q2331945:"motion_picture",Q188473:"motion_picture",Q2678111:"motion_picture",Q2991560:"motion_picture",Q2484376:"motion_picture",Q16950433:"motion_picture",Q18331260:"motion_picture",Q19952560:"motion_picture",Q5428822:"broadcast",Q13582719:"song",Q388480:"song",Q950683:"book",Q39825:"dataset",Q49918:"dataset",Q82753:"dataset",Q186588:"dataset",Q15706459:"article-journal",Q59387148:"report",Q6960620:"book",Q7094076:"dataset",Q367680:"dataset",Q857354:"dataset",Q1503133:"book",Q3219655:"dataset",Q3304360:"dataset",Q5227330:"dataset",Q7943567:"dataset",Q17305522:"dataset",Q18814183:"dataset",Q21264512:"dataset",Q43570203:"dataset",Q44106130:"dataset",Q50826803:"dataset",Q55387750:"dataset",Q593744:"dataset",Q83790:"book",Q539662:"dataset",Q605175:"dataset",Q550089:"dataset",Q36524:"dataset",Q1673963:"dataset",Q17152639:"dataset",Q20088085:"entry-dictionary",Q15633587:"webpage",Q15138389:"webpage",Q20088089:"entry-dictionary",Q5398426:"broadcast",Q1259759:"broadcast",Q7724161:"broadcast",Q21664088:"broadcast",Q234262:"chapter",Q21481766:"chapter",Q26989423:"chapter",Q29154515:"chapter",Q43148525:"chapter",Q43180447:"chapter",Q53460949:"chapter",Q327349:"dataset",Q1394657:"dataset",Q1988927:"dataset",Q201456:"dataset",Q220393:"dataset",Q3071343:"dataset",Q254213:"dataset",Q319949:"dataset",Q672598:"dataset",Q780605:"dataset",Q815410:"dataset",Q819688:"dataset",Q854459:"dataset",Q897682:"dataset",Q1114135:"dataset",Q1147639:"dataset",Q1400059:"dataset",Q1665882:"dataset",Q1754061:"dataset",Q1915979:"dataset",Q1991865:"dataset",Q2038458:"dataset",Q2249973:"dataset",Q2597555:"dataset",Q3346024:"dataset",Q5141544:"dataset",Q5146094:"dataset",Q5962346:"dataset",Q6941730:"dataset",Q7096331:"dataset",Q10413470:"dataset",Q15194024:"dataset",Q11722865:"dataset",Q273057:"dataset",Q16832380:"dataset",Q20820424:"dataset",Q22692845:"dataset",Q52666561:"dataset",Q59209277:"dataset",Q59977151:"dataset",Q60686104:"dataset",Q2262868:"dataset",Q7449052:"dataset",Q596138:"motion_picture",Q3464665:"broadcast",Q24862:"motion_picture",Q7751682:"motion_picture",Q187044:"article-newspaper",Q22812458:"broadcast",Q170238:"broadcast",Q309481:"article-newspaper",Q2495037:"article-newspaper",Q2602337:"article-newspaper",Q5149212:"article-newspaper",Q17628188:"article-newspaper",Q17633526:"article-newspaper",Q17928402:"post-weblog",Q50081413:"webpage",Q20136634:"article",Q43290228:"article",Q57988118:"post",Q40745:"legal_case",Q245072:"legal_case",Q321568:"legal_case",Q375727:"legal_case",Q699735:"report",Q836925:"report",Q788874:"legal_case",Q830689:"report",Q1668727:"report",Q1498464:"legal_case",Q1926270:"report",Q2070370:"legal_case",Q2145003:"legal_case",Q2307704:"report",Q2309880:"report",Q2677586:"report",Q3000100:"report",Q3922396:"legal_case",Q4343952:"report",Q4690599:"report",Q6451276:"report",Q7968600:"legal_case",Q7918438:"report",Q12038591:"legal_case",Q13433827:"entry",Q15629444:"report",Q17090395:"report",Q17329259:"entry-encyclopedia",Q19355445:"report",Q61704031:"broadcast",Q27027169:"report",Q41274869:"report",Q47126552:"report",Q56013707:"report",Q58089619:"legal_case",Q157394:"motion_picture",Q207601:"broadcast",Q1504425:"article-journal",Q1241826:"broadcast",Q2155186:"broadcast",Q2435927:"broadcast",Q2774197:"article-journal",Q3588923:"broadcast",Q5177022:"broadcast",Q7316896:"article-journal",Q7551315:"motion_picture",Q10709386:"broadcast",Q622812:"broadcast",Q11079003:"broadcast",Q10885494:"article-journal",Q11293915:"broadcast",Q11325507:"broadcast",Q11334197:"broadcast",Q11351206:"broadcast",Q11378697:"broadcast",Q187947:"musical_score",Q11451968:"broadcast",Q11483878:"broadcast",Q11491683:"broadcast",Q12183006:"article-journal",Q18458820:"broadcast",Q56478376:"article-journal",Q58038936:"article-journal",Q58898396:"article-journal",Q58900805:"article-journal",Q58901470:"article-journal",Q58902427:"article-journal",Q59458414:"article-journal",Q4249087:"legal_case",Q5710433:"legal_case",Q60456691:"legal_case",Q17074865:"map",Q18609332:"legal_case",Q29197:"broadcast",Q18011171:"motion_picture",Q506240:"motion_picture",Q653916:"motion_picture",Q240862:"motion_picture",Q914242:"motion_picture",Q5287435:"broadcast",Q5338721:"motion_picture",Q13359539:"broadcast",Q21191265:"broadcast",Q26225765:"motion_picture",Q29555881:"broadcast",Q50062923:"broadcast",Q50914552:"broadcast",Q61220733:"broadcast",Q1924747:"dataset",Q26868375:"dataset",Q61782522:"dataset",Q2033233:"dataset",Q39086821:"review",Q595971:"dataset",Q3539533:"dataset",Q276:"broadcast",Q182415:"broadcast",Q336181:"broadcast",Q356055:"broadcast",Q358942:"broadcast",Q431102:"broadcast",Q661436:"broadcast",Q677466:"motion_picture",Q854995:"broadcast",Q986699:"broadcast",Q1261214:"broadcast",Q1358344:"broadcast",Q1366112:"broadcast",Q1407240:"broadcast",Q1407245:"broadcast",Q1472288:"broadcast",Q1619206:"broadcast",Q1684600:"broadcast",Q1819008:"broadcast",Q1962634:"broadcast",Q1857766:"broadcast",Q1924371:"broadcast",Q1948292:"broadcast",Q2081003:"broadcast",Q2231383:"broadcast",Q2304946:"broadcast",Q3744532:"broadcast",Q5455086:"broadcast",Q6626746:"broadcast",Q7697093:"broadcast",Q14623351:"broadcast",Q3511312:"broadcast",Q10676514:"broadcast",Q202866:"motion_picture",Q1107:"motion_picture",Q581714:"broadcast",Q21191019:"broadcast",Q11086742:"motion_picture",Q11504513:"broadcast",Q14942329:"broadcast",Q15836186:"broadcast",Q16068806:"broadcast",Q16206641:"broadcast",Q17145545:"broadcast",Q18640746:"broadcast",Q19845560:"broadcast",Q19973797:"broadcast",Q21217315:"broadcast",Q25090976:"broadcast",Q27912070:"broadcast",Q28664032:"broadcast",Q34682961:"broadcast",Q46706005:"broadcast",Q118171:"dataset",Q192588:"dataset",Q193351:"dataset",Q212805:"dataset",Q333761:"dataset",Q702448:"dataset",Q1869909:"motion_picture",Q29982285:"broadcast",Q780524:"dataset",Q989016:"dataset",Q1172362:"dataset",Q1235236:"dataset",Q1373925:"dataset",Q1391125:"dataset",Q1393704:"dataset",Q1414426:"dataset",Q1494224:"dataset",Q1519460:"dataset",Q1787017:"dataset",Q1957894:"dataset",Q2599456:"dataset",Q2274762:"dataset",Q2302053:"dataset",Q2404903:"dataset",Q2532732:"dataset",Q2881060:"dataset",Q2912944:"dataset",Q3133368:"dataset",Q3454922:"dataset",Q4117139:"dataset",Q4501235:"dataset",Q4677551:"dataset",Q5062195:"dataset",Q5322831:"dataset",Q5473309:"dataset",Q5572370:"dataset",Q7246853:"dataset",Q7702836:"dataset",Q9067653:"dataset",Q14806568:"dataset",Q15097084:"dataset",Q15100572:"dataset",Q16155335:"dataset",Q17014602:"dataset",Q22811662:"dataset",Q24579448:"dataset",Q28146196:"dataset",Q33270056:"dataset",Q36570165:"dataset",Q45028176:"dataset",Q54933017:"dataset",Q55341040:"dataset",Q59157251:"dataset",Q13406463:"webpage",Q60856733:"dataset",Q521414:"dataset",Q883895:"dataset",Q986756:"dataset",Q1345528:"dataset",Q3404855:"dataset",Q3405306:"dataset",Q3518943:"dataset",Q3664416:"dataset",Q4127466:"dataset",Q4350734:"dataset",Q60557971:"dataset",Q4350735:"dataset",Q4350754:"dataset",Q5058966:"dataset",Q5058970:"dataset",Q5058971:"dataset",Q5058968:"dataset",Q5058969:"dataset",Q5058974:"dataset",Q5058975:"dataset",Q5058972:"dataset",Q5058978:"dataset",Q5058977:"dataset",Q5058981:"dataset",Q5058989:"dataset",Q5334384:"dataset",Q7015254:"dataset",Q10497456:"dataset",Q12058091:"dataset",Q16056280:"dataset",Q19894430:"dataset",Q24934691:"dataset",Q25383554:"dataset",Q26207721:"dataset",Q28730356:"dataset",Q29795177:"dataset",Q8025448:"book",Q1114458:"book",Q3027814:"book",Q3268307:"book",Q3491290:"book",Q4955683:"book",Q5197887:"book",Q6071891:"book",Q5296:"webpage",Q57819011:"legal_case",Q57821094:"legal_case",Q218013:"dataset",Q283579:"dataset",Q426674:"dataset",Q479833:"dataset",Q721795:"dataset",Q838281:"dataset",Q843670:"dataset",Q877809:"dataset",Q900856:"dataset",Q949532:"dataset",Q1265166:"dataset",Q1571814:"dataset",Q2025786:"book",Q2250844:"book",Q4034405:"book",Q5227352:"dataset",Q2115:"dataset",Q14679:"dataset",Q577697:"map",Q5150048:"map",Q16840211:"book",Q21032630:"book",Q8034663:"book",Q11191558:"book",Q13769783:"dataset",Q14902318:"dataset",Q24063789:"dataset",Q25975660:"dataset",Q26260540:"dataset",Q11266439:"webpage",Q26267864:"dataset",Q26987229:"dataset",Q27198004:"dataset",Q28948553:"dataset",Q29053519:"dataset",Q29694587:"dataset",Q41709380:"dataset",Q47459830:"dataset",Q57936091:"book",Q58902997:"book",Q7572716:"dataset",Q59913845:"song",Q2143665:"motion_picture",Q1957385:"motion_picture",Q5769663:"motion_picture",Q5855976:"motion_picture",Q1441669:"broadcast",Q1441929:"broadcast",Q16943561:"broadcast",Q19858063:"broadcast",Q19858074:"broadcast",Q19858077:"broadcast",Q19858082:"broadcast",Q19858080:"broadcast",Q19858086:"broadcast",Q19858087:"broadcast",Q19858088:"broadcast",Q19858095:"broadcast",Q19858093:"broadcast",Q19858098:"broadcast",Q19858107:"broadcast",Q19858110:"broadcast",Q19858108:"broadcast",Q19858123:"broadcast",Q19858126:"broadcast",Q19858124:"broadcast",Q19858125:"broadcast",Q19858142:"broadcast",Q19858143:"broadcast",Q19858140:"broadcast",Q19858141:"broadcast",Q19859744:"broadcast",Q19859780:"broadcast",Q1271915:"dataset",Q2250805:"map",Q2359829:"map",Q2415383:"map",Q2869471:"map",Q4816871:"map",Q5135690:"map",Q11025270:"map",Q21936815:"map",Q21938018:"map",Q26885495:"map",Q333779:"map",Q640492:"map",Q690851:"manuscript",Q1105486:"manuscript",Q1501880:"map",Q1501945:"map",Q1550537:"map",Q1974665:"map",Q2915844:"map",Q54298448:"map",Q21188110:"broadcast",Q918098:"broadcast",Q4765080:"broadcast",Q17113138:"broadcast",Q856314:"manuscript",Q928128:"manuscript",Q19969434:"manuscript",Q5647631:"manuscript",Q1190781:"manuscript",Q1620808:"manuscript",Q1675712:"manuscript",Q3637297:"manuscript",Q18558914:"manuscript",Q492264:"musical_score",Q10590726:"motion_picture",Q60259696:"manuscript",Q60323106:"manuscript",Q60325498:"manuscript",Q60363009:"manuscript",Q2552822:"musical_score",Q7452061:"musical_score",Q3962157:"map",Q16825889:"map",Q1826720:"map",Q3935817:"dataset",Q18616720:"dataset",Q7601206:"dataset",Q7620972:"map",Q1353555:"dataset",Q22961568:"book",Q93204:"motion_picture",Q7832972:"motion_picture",Q312083:"map",Q322943:"treaty",Q459435:"motion_picture",Q587240:"manuscript",Q595819:"treaty",Q850950:"dataset",Q1003870:"treaty",Q1688818:"map",Q1048515:"map",Q1473669:"manuscript",Q1667520:"map",Q2723202:"map",Q2941628:"dataset",Q2981686:"manuscript",Q2981685:"manuscript",Q7551149:"motion_picture",Q2933856:"book",Q266680:"map",Q1702772:"map",Q2035351:"map",Q2073537:"manuscript",Q2204393:"map",Q2325507:"map",Q5469880:"report",Q5469893:"report",Q5469912:"report",Q10438653:"map",Q42793629:"speech",Q2678443:"dataset",Q1923776:"book",Q2981450:"book",Q1413174:"dataset",Q185529:"motion_picture",Q16254232:"motion_picture",Q31803237:"treaty",Q32945468:"dataset",Q59825643:"dataset",Q934552:"dataset",Q200562:"broadcast",Q303064:"broadcast",Q1484397:"broadcast",Q2049337:"broadcast",Q2123557:"broadcast",Q2308891:"report",Q2665960:"report",Q5227671:"broadcast",Q18030695:"report",Q18385907:"broadcast",Q21190411:"broadcast",Q47512784:"report",Q56330488:"book",Q33111614:"motion_picture",Q484692:"song",Q1033831:"song",Q1497584:"book",Q19705:"book",Q628080:"book",Q1535505:"book",Q2333573:"book",Q3357101:"book",Q12041885:"book",Q5151497:"motion_picture",Q7999883:"article",Q18398246:"motion_picture",Q56309057:"manuscript",Q61314299:"dataset",Q234280:"chapter",Q234300:"chapter",Q862334:"book",Q2973181:"motion_picture",Q3072049:"motion_picture",Q1747837:"motion_picture",Q12029612:"dataset",Q50380591:"book",Q51881567:"book",Q60029764:"book",Q914229:"article",Q5465451:"article",Q20135338:"motion_picture",Q1541065:"report",Q2594143:"dataset",Q16664076:"report",Q441261:"dataset",Q457843:"dataset",Q783287:"dataset",Q1115961:"dataset",Q1713174:"dataset",Q3327521:"dataset",Q151:"dataset",Q17123180:"motion_picture",Q15982056:"article-newspaper",Q59191021:"dataset",Q59248059:"dataset",Q59248072:"dataset",Q1371849:"dataset",Q17438413:"dataset",Q61914117:"dataset",Q3352071:"motion_picture",Q25051296:"webpage",Q25054829:"dataset",Q267136:"dataset",Q488053:"book",Q914881:"book",Q1397073:"dataset",Q1662581:"dataset",Q2268965:"dataset",Q3292731:"book",Q3406872:"dataset",Q5033354:"dataset",Q5227322:"dataset",Q5532670:"dataset",Q7515656:"book",Q7598341:"dataset",Q7995661:"dataset",Q14523803:"book",Q17146953:"dataset",Q25110279:"book",Q30008669:"book",Q30009376:"book",Q41623316:"dataset",Q38647918:"book",Q249697:"speech",Q1428914:"dataset",Q255135:"book",Q471894:"book",Q586744:"book",Q956165:"book",Q1569753:"book",Q2939758:"book",Q12040484:"book",Q13583784:"book",Q59351530:"book",Q61020892:"book",Q17086104:"map",Q17147147:"map",Q19393521:"map",Q58884:"broadcast",Q2635894:"broadcast",Q193842:"map",Q261468:"map",Q943929:"song",Q1123037:"song",Q336822:"song",Q336371:"map",Q459798:"map",Q831939:"map",Q865144:"map",Q889561:"map",Q1152543:"map",Q1187667:"broadcast",Q1281814:"map",Q1674401:"map",Q1742009:"broadcast",Q1778220:"map",Q1800237:"map",Q2126801:"map",Q2125867:"broadcast",Q2298569:"map",Q2940627:"map",Q4903803:"map",Q5687679:"map",Q10480692:"map",Q10604395:"map",Q10916116:"book",Q11960416:"map",Q12008992:"map",Q58901209:"dataset",Q19969268:"broadcast",Q20741385:"book",Q21009694:"book",Q24879310:"dataset",Q56028349:"book",Q56240541:"broadcast",Q56697520:"book",Q60586493:"dataset",Q183169:"webpage",Q825914:"book",Q1391116:"dataset",Q1516252:"book",Q1569406:"dataset",Q1609353:"dataset",Q1609504:"dataset",Q1862738:"book",Q2110197:"dataset",Q3237931:"broadcast",Q3956369:"broadcast",Q3962380:"dataset",Q4769616:"dataset",Q4804740:"book",Q5051330:"dataset",Q5615468:"dataset",Q6822329:"dataset",Q6912943:"broadcast",Q7144753:"dataset",Q10688394:"book",Q12331427:"dataset",Q15961983:"broadcast",Q18311760:"broadcast",Q1499601:"dataset",Q5374928:"map",Q7444356:"motion_picture",Q6729489:"motion_picture",Q7444692:"map",Q8036547:"map",Q1383152:"dataset",Q3564515:"speech",Q3890208:"dataset",Q21050458:"dataset",Q21050912:"dataset",Q26721650:"dataset",Q31841013:"dataset",Q1865123:"dataset",Q206290:"dataset",Q1088118:"dataset",Q7502102:"dataset",Q17121221:"map",Q23888763:"book",Q46992920:"speech",Q52506277:"dataset",Q51719975:"broadcast",Q19364663:"book",Q22938710:"book",Q193977:"motion_picture",Q59032066:"song",Q1989725:"song",Q2135500:"manuscript",Q3153927:"speech",Q526877:"broadcast",Q742157:"article-newspaper",Q6899707:"map",Q725377:"book",Q10541153:"book",Q21198407:"book",Q369074:"dataset",Q3249257:"motion_picture",Q4373044:"motion_picture",Q172067:"motion_picture",Q1046788:"motion_picture",Q24886171:"broadcast",Q53746253:"broadcast",Q16709869:"book",Q16960707:"book",Q19941906:"book",Q21660824:"book",Q21818614:"book",Q57987419:"interview",Q57987455:"interview",Q57987589:"interview",Q61725752:"book",Q225672:"book",Q263790:"book",Q284465:"book",Q431193:"book",Q608971:"book",Q634123:"book",Q817063:"book",Q833590:"book",Q1027825:"book",Q1385360:"book",Q1754581:"book",Q2114246:"book",Q2144117:"book",Q2732056:"book",Q2955456:"book",Q4203401:"book",Q7163040:"book",Q7603925:"broadcast",Q12765421:"book",Q15276670:"book",Q15627042:"book",Q6548306:"book",Q12046416:"map",Q472298:"legal_case",Q1261319:"map",Q5563391:"map",Q26644852:"broadcast",Q29167422:"dataset",Q7211:"dataset",Q48473:"dataset",Q217327:"legal_case",Q951437:"dataset",Q636033:"dataset",Q672593:"dataset",Q739047:"dataset",Q891854:"legal_case",Q1207369:"dataset",Q1391014:"dataset",Q1642648:"dataset",Q2859990:"dataset",Q3307317:"dataset",Q4330194:"dataset",Q6813020:"legal_case",Q6901292:"legal_case",Q7251471:"dataset",Q18711682:"legal_case",Q20057286:"dataset",Q23015465:"dataset",Q24243801:"dataset",Q24249534:"dataset",Q25917186:"legal_case",Q27214933:"dataset",Q28934204:"legal_case",Q39740866:"dataset",Q59495116:"dataset",Q60208424:"dataset",Q61037469:"legal_case",Q40426579:"map",Q43037778:"map",Q47008743:"map",Q26225493:"book",Q29043181:"dataset",Q55850593:"song",Q55850643:"song",Q58885732:"song",Q58885754:"song",Q927803:"song",Q430010:"song",Q2292588:"song",Q2499178:"dataset",Q2560570:"dataset",Q3077240:"dataset",Q3491832:"dataset",Q1235234:"dataset",Q7096323:"dataset",Q7831478:"song",Q1564816:"legal_case",Q2698974:"legal_case",Q20089346:"motion_picture",Q5366020:"motion_picture",Q11526166:"speech",Q4167410:"webpage",Q845159:"motion_picture",Q1003021:"dataset",Q4167836:"webpage",Q1249224:"report",Q11382506:"webpage",Q15475226:"webpage",Q15475319:"webpage",Q1991869:"book",Q11690026:"book",Q31209114:"webpage",Q35243371:"webpage",Q48781895:"motion_picture",Q56005592:"webpage",Q17586363:"book",Q20043999:"book",Q59738577:"webpage",Q61033232:"webpage",Q61033736:"dataset",Q61034350:"webpage",Q29573701:"dataset",Q645928:"motion_picture",Q3209941:"report",Q5165404:"bill",Q11078958:"report",Q45182324:"article-journal",Q56119332:"post-weblog",Q60797:"speech",Q1474597:"speech",Q2069352:"book",Q2983424:"motion_picture",Q19359000:"report",Q24067746:"post-weblog",Q51844620:"dataset",Q51539995:"webpage",Q55422400:"broadcast",Q130232:"motion_picture",Q635115:"dataset",Q1553078:"dataset",Q1784036:"book",Q1813223:"book",Q2326951:"book",Q2500820:"book",Q3423635:"dataset",Q4363806:"book",Q14605760:"webpage",Q21875313:"book",Q24633474:"broadcast",Q28136925:"broadcast",Q28135032:"broadcast",Q28472638:"speech",Q28472722:"speech",Q1011299:"broadcast",Q3276244:"broadcast",Q29883647:"treaty",Q42214612:"treaty",Q60215679:"broadcast",Q60215966:"broadcast",Q7033567:"treaty",Q8576:"treaty",Q3257212:"book",Q5166307:"treaty",Q7865023:"treaty",Q8187836:"treaty",Q16923948:"treaty",Q17211914:"treaty",Q20874666:"treaty",Q39233713:"treaty",Q8041497:"patent",Q50823049:"report",Q61715571:"book",Q193934:"book",Q193955:"book",Q990683:"book",Q12047175:"book",Q1250520:"dataset",Q2334774:"song",Q22001389:"dataset",Q61782519:"dataset",Q112762:"song",Q177771:"song",Q178122:"song",Q207683:"song",Q216860:"song",Q261434:"song",Q318894:"song",Q319448:"song",Q380233:"song",Q493169:"song",Q502658:"song",Q523896:"song",Q591990:"song",Q608253:"song",Q744327:"song",Q758422:"song",Q783874:"song",Q784074:"song",Q820119:"song",Q844450:"song",Q873000:"song",Q944800:"song",Q959583:"song",Q988502:"song",Q1009280:"song",Q2281713:"song",Q1033810:"song",Q1033813:"song",Q1151663:"song",Q1195253:"song",Q1195630:"song",Q1228189:"song",Q20477577:"dataset",Q1972954:"dataset",Q842256:"motion_picture",Q643684:"motion_picture",Q1033573:"dataset",Q1205607:"dataset",Q1971947:"dataset",Q2145124:"dataset",Q2819247:"dataset",Q4685824:"dataset",Q7002108:"dataset",Q7200622:"dataset",Q8267601:"dataset",Q9732903:"webpage",Q11002482:"webpage",Q12096573:"webpage",Q16059585:"webpage",Q16059613:"webpage",Q16059624:"webpage",Q19208935:"webpage",Q21450877:"webpage",Q31936067:"dataset",Q47500192:"dataset",Q1229479:"song",Q1232283:"song",Q1236108:"song",Q1288193:"song",Q1372064:"song",Q1382036:"song",Q1779217:"song",Q1779319:"song",Q1899706:"song",Q1905727:"song",Q1942905:"song",Q1956166:"song",Q1963108:"song",Q1966622:"song",Q2038845:"song",Q2058312:"song",Q2108499:"song",Q2165184:"song",Q2235992:"song",Q2298624:"song",Q2312959:"song",Q2358279:"song",Q2544997:"song",Q2707688:"song",Q2737175:"song",Q2891357:"song",Q2894096:"song",Q2956164:"song",Q2956172:"song",Q3033130:"song",Q3246270:"song",Q3299089:"song",Q3482281:"song",Q3562031:"song",Q3843655:"song",Q3889661:"song",Q3918025:"song",Q4056436:"song",Q4130112:"song",Q4528554:"song",Q4770819:"song",Q4797274:"song",Q5031532:"song",Q5037289:"song",Q5747946:"song",Q5766029:"song",Q6109162:"song",Q7148059:"song",Q7314000:"song",Q7561608:"song",Q7824869:"song",Q8053529:"song",Q8261762:"song",Q10677514:"song",Q21653344:"song",Q56572789:"song",Q503354:"song",Q11214531:"song",Q12115862:"song",Q12135013:"song",Q12313565:"song",Q13829124:"song",Q15810872:"song",Q15907187:"song",Q16084298:"song",Q16194930:"song",Q16912992:"song",Q17118203:"song",Q17150323:"song",Q18012876:"song",Q18406550:"song",Q19607140:"song",Q20087039:"song",Q20107778:"song",Q20980372:"song",Q21127215:"song",Q22086714:"song",Q23072435:"song",Q25022242:"song",Q27981708:"song",Q27981857:"song",Q29051387:"song",Q37731261:"song",Q42681239:"song",Q46863086:"song",Q55596270:"song",Q56425213:"song",Q56425237:"song",Q61688673:"song",Q229390:"motion_picture",Q319221:"motion_picture",Q369747:"motion_picture",Q370630:"motion_picture",Q421719:"motion_picture",Q430525:"motion_picture",Q455315:"motion_picture",Q459290:"motion_picture",Q505119:"motion_picture",Q517386:"motion_picture",Q652256:"motion_picture",Q663106:"motion_picture",Q790192:"motion_picture",Q848512:"motion_picture",Q1060398:"motion_picture",Q1146335:"motion_picture",Q1200678:"motion_picture",Q1251417:"motion_picture",Q1320115:"motion_picture",Q1361932:"motion_picture",Q1397462:"motion_picture",Q1933746:"motion_picture",Q1935609:"motion_picture",Q2125170:"motion_picture",Q2156835:"motion_picture",Q2165644:"motion_picture",Q2301591:"motion_picture",Q4382232:"broadcast",Q2321734:"motion_picture",Q2553613:"motion_picture",Q2903140:"motion_picture",Q3072043:"motion_picture",Q3250548:"motion_picture",Q3585697:"motion_picture",Q3648909:"motion_picture",Q3677141:"motion_picture",Q3677185:"motion_picture",Q3745400:"motion_picture",Q3745430:"motion_picture",Q4220915:"motion_picture",Q4484381:"motion_picture",Q5145881:"motion_picture",Q5378150:"motion_picture",Q7130449:"motion_picture",Q7858343:"motion_picture",Q9259727:"motion_picture",Q12309044:"motion_picture",Q12377598:"motion_picture",Q16721823:"motion_picture",Q16909344:"motion_picture",Q19799105:"motion_picture",Q19799133:"motion_picture",Q20442589:"motion_picture",Q20650540:"motion_picture",Q21182682:"motion_picture",Q24887738:"motion_picture",Q28735856:"motion_picture",Q29017630:"motion_picture",Q30070675:"motion_picture",Q30897819:"motion_picture",Q33373157:"motion_picture",Q43079104:"motion_picture",Q54086290:"motion_picture",Q54344007:"motion_picture",Q56192069:"motion_picture",Q58415294:"motion_picture",Q58903570:"motion_picture",Q61283808:"motion_picture",Q219557:"motion_picture",Q226730:"motion_picture",Q24865:"motion_picture",Q24869:"motion_picture",Q31235:"motion_picture",Q3956596:"book",Q20012720:"book",Q27070652:"book",Q738826:"speech",Q2623953:"speech",Q2781658:"speech",Q3479856:"speech",Q7454995:"speech",Q735478:"motion_picture",Q124922:"motion_picture",Q472637:"motion_picture",Q1092621:"motion_picture",Q1323308:"motion_picture",Q1352102:"motion_picture",Q1464369:"motion_picture",Q1474387:"motion_picture",Q1480924:"motion_picture",Q1760864:"motion_picture",Q1800833:"motion_picture",Q2084909:"motion_picture",Q27697957:"motion_picture",Q2670855:"motion_picture",Q3566966:"motion_picture",Q4765076:"motion_picture",Q20732395:"motion_picture",Q1684595:"dataset",Q7168625:"motion_picture",Q8192124:"motion_picture",Q5008290:"dataset",Q220399:"dataset",Q285745:"dataset",Q542475:"motion_picture",Q846544:"motion_picture",Q3072039:"motion_picture",Q23739:"broadcast",Q338632:"broadcast",Q288608:"broadcast",Q3421644:"broadcast",Q5465514:"broadcast",Q5812300:"broadcast",Q18340550:"webpage",Q21232614:"broadcast",Q1224870:"dataset",Q79715:"broadcast",Q278425:"dataset",Q548206:"motion_picture",Q632149:"motion_picture",Q996838:"motion_picture",Q1147986:"motion_picture",Q2258523:"map",Q2514870:"dataset",Q2559958:"broadcast",Q4342538:"map",Q15518544:"broadcast",Q15518777:"broadcast",Q20707560:"dataset",Q20871935:"motion_picture",Q55960075:"motion_picture",Q1224984:"dataset",Q5227308:"dataset",Q12328550:"dataset",Q20089094:"motion_picture",Q21040941:"dataset",Q668312:"motion_picture",Q30047053:"dataset",Q18493502:"legal_case",Q1067692:"motion_picture",Q18655723:"motion_picture",Q844993:"song",Q4763437:"book",Q19894488:"book",Q262533:"speech",Q591055:"speech",Q1851305:"speech",Q3588034:"speech",Q20669604:"speech",Q29642901:"dataset",Q1061420:"map",Q2914518:"map",Q186286:"broadcast",Q940462:"broadcast",Q15823625:"map",Q54328426:"broadcast",Q1713326:"motion_picture",Q4453959:"motion_picture",Q5905221:"musical_score",Q23368955:"motion_picture",Q55848868:"motion_picture",Q3072024:"motion_picture",Q965136:"map",Q3546572:"broadcast",Q5449041:"motion_picture",Q6645282:"broadcast",Q25360500:"broadcast",Q376820:"dataset",Q2422383:"dataset",Q14552560:"article-newspaper",Q219897:"dataset",Q787397:"map",Q14943256:"book",Q15715669:"map",Q3196335:"book",Q4700148:"book",Q11669289:"map",Q56683168:"map",Q6749508:"dataset",Q13039854:"dataset",Q19354904:"legal_case",Q25917154:"legal_case",Q25456031:"dataset",Q47484674:"dataset",Q948454:"dataset",Q1734165:"dataset",Q5441632:"book",Q7321644:"book",Q7890265:"book",Q28406796:"dataset",Q46130774:"dataset",Q54820068:"book",Q17146139:"map",Q23691:"song",Q54251760:"motion_picture",Q851995:"map",Q25336664:"dataset",Q11310550:"dataset",Q18086661:"dataset",Q18086666:"dataset",Q18086667:"dataset",Q18086665:"dataset",Q18086671:"dataset",Q18089574:"dataset",Q18089575:"dataset",Q18099930:"dataset",Q18100125:"dataset",Q18889352:"dataset",Q18922463:"dataset",Q20005020:"dataset",Q798134:"thesis",Q1414362:"thesis",Q30749496:"thesis",Q46629343:"thesis",Q51282441:"thesis",Q52823264:"thesis",Q58210330:"thesis",Q1907875:"thesis",Q23745:"broadcast",Q399811:"broadcast",Q775344:"broadcast",Q1658957:"broadcast",Q1786567:"broadcast",Q4783297:"broadcast",Q5219865:"broadcast",Q7185299:"broadcast",Q7731786:"broadcast",Q7892363:"broadcast",Q11086745:"broadcast",Q20986817:"broadcast",Q60393504:"broadcast",Q16342:"dataset",Q632285:"dataset",Q1751819:"dataset",Q2560532:"dataset",Q6517465:"dataset",Q1898445:"map",Q41436524:"book",Q50310598:"dataset",Q5366501:"broadcast",Q9018710:"broadcast",Q11935070:"broadcast",Q688869:"manuscript",Q962741:"manuscript",Q7797194:"dataset",Q1662452:"motion_picture",Q4499034:"song",Q6009879:"book",Q595801:"book",Q894351:"map",Q1352815:"broadcast",Q1569955:"dataset",Q2538131:"book",Q3348148:"dataset",Q5535082:"dataset",Q7574095:"dataset",Q47214765:"broadcast",Q61990518:"broadcast",Q2933978:"broadcast",Q6537693:"dataset",Q6888313:"book",Q12270042:"book",Q21292860:"broadcast",Q350514:"map",Q357674:"map",Q5191437:"dataset",Q24265951:"dataset",Q25110971:"book",Q29966258:"dataset",Q25894883:"dataset",Q2093973:"book",Q1711400:"broadcast",Q3071014:"broadcast",Q61029068:"webpage",Q61996773:"webpage",Q175902:"dataset",Q1295532:"webpage",Q1474116:"webpage",Q1501313:"dataset",Q1916557:"dataset",Q5333554:"dataset",Q7247749:"dataset",Q4330198:"dataset",Q5570651:"dataset",Q7251500:"dataset",Q7277178:"dataset",Q7689673:"dataset",Q15407973:"webpage",Q15647814:"webpage",Q16335141:"dataset",Q18392279:"dataset",Q15623926:"webpage",Q22808320:"webpage",Q24571879:"webpage",Q24574745:"webpage",Q17362920:"webpage",Q28065731:"webpage",Q28208970:"dataset",Q30432511:"webpage",Q54662266:"webpage",Q56428020:"webpage",Q58036154:"webpage",Q58181524:"webpage",Q58423626:"webpage",Q59541917:"webpage",Q59542487:"webpage",Q5227321:"dataset",Q178840:"broadcast",Q482612:"broadcast",Q662197:"broadcast",Q1054760:"broadcast",Q1273568:"broadcast",Q1676730:"broadcast",Q1802588:"broadcast",Q2388283:"broadcast",Q3189895:"broadcast",Q3951815:"broadcast",Q5778915:"broadcast",Q7050677:"broadcast",Q7135559:"broadcast",Q9335577:"broadcast",Q9671105:"broadcast",Q20061443:"broadcast",Q20220309:"broadcast",Q20267837:"broadcast",Q21233490:"broadcast",Q21191068:"broadcast",Q27868077:"broadcast",Q30939244:"broadcast",Q55082620:"broadcast",Q56320653:"broadcast",Q45787211:"dataset",Q1799894:"broadcast",Q19220511:"dataset",Q7841716:"motion_picture",Q5987970:"book",Q7864671:"motion_picture",Q21504449:"broadcast",Q61896850:"motion_picture",Q61911910:"motion_picture",Q15184295:"webpage",Q29581299:"book",Q3507630:"dataset",Q5571730:"webpage",Q13231199:"webpage",Q15851373:"webpage",Q19692233:"webpage",Q2921195:"book",Q20009925:"webpage",Q21167233:"webpage",Q25456482:"webpage",Q26884324:"webpage",Q28197061:"webpage",Q30032916:"webpage",Q33532284:"webpage",Q37152856:"webpage",Q19887878:"webpage",Q30044873:"report",Q11664270:"broadcast",Q1852859:"map",Q2297927:"motion_picture",Q2188827:"manuscript",Q4922471:"broadcast",Q16247289:"broadcast",Q25381170:"book",Q25696292:"dataset",Q11398:"dataset",Q210918:"dataset",Q267474:"dataset",Q1062352:"dataset",Q548492:"dataset",Q732744:"dataset",Q1520859:"dataset",Q1744559:"dataset",Q2748242:"dataset",Q3445240:"dataset",Q3518464:"dataset",Q3546241:"dataset",Q5172500:"dataset",Q6857882:"dataset",Q7398671:"dataset",Q22808060:"song",Q22298551:"dataset",Q22935148:"dataset",Q23014490:"dataset",Q23015153:"dataset",Q185867:"motion_picture",Q192625:"dataset",Q784969:"dataset",Q917904:"dataset",Q3546232:"dataset",Q4382932:"dataset",Q2357684:"dataset",Q2490652:"dataset",Q562667:"treaty",Q11510761:"treaty",Q39234115:"treaty",Q39235586:"treaty",Q39236188:"treaty",Q39236506:"treaty",Q39237589:"treaty",Q691836:"dataset",Q2299775:"dataset",Q2584888:"dataset",Q934210:"dataset",Q16355541:"dataset",Q57560929:"song",Q59826893:"dataset",Q478216:"dataset",Q1138178:"dataset",Q2621880:"dataset",Q2859969:"dataset",Q2964498:"dataset",Q4223049:"dataset",Q4421014:"dataset",Q16549505:"dataset",Q21441341:"dataset",Q26975748:"dataset",Q5366097:"motion_picture",Q1137588:"song",Q6022825:"broadcast",Q15977715:"broadcast",Q24906243:"broadcast",Q471839:"motion_picture",Q1794431:"motion_picture",Q3080071:"broadcast",Q6942568:"motion_picture",Q11900986:"motion_picture",Q16677772:"motion_picture",Q17517379:"motion_picture",Q20667187:"motion_picture",Q29168811:"motion_picture",Q34487266:"broadcast",Q47486001:"motion_picture",Q57780531:"motion_picture",Q223770:"motion_picture",Q4836991:"motion_picture",Q212781:"motion_picture",Q41270:"song",Q383904:"song",Q564848:"song",Q721644:"song",Q5158512:"song",Q6037387:"song",Q3962943:"motion_picture",Q21759196:"motion_picture",Q60630702:"motion_picture",Q222639:"motion_picture",Q1033891:"motion_picture",Q1535153:"motion_picture",Q1740789:"motion_picture",Q1776156:"motion_picture",Q1894374:"motion_picture",Q2421031:"motion_picture",Q332564:"motion_picture",Q853630:"motion_picture",Q909586:"motion_picture",Q987831:"motion_picture",Q1341051:"motion_picture",Q1342372:"motion_picture",Q1696148:"motion_picture",Q2584671:"motion_picture",Q4174664:"motion_picture",Q883179:"motion_picture",Q4925568:"motion_picture",Q5551875:"motion_picture",Q13377551:"motion_picture",Q16247268:"motion_picture",Q18089587:"motion_picture",Q18355406:"motion_picture",Q18648407:"motion_picture",Q4840473:"motion_picture",Q20656232:"motion_picture",Q23044991:"motion_picture",Q25110269:"motion_picture",Q27959357:"motion_picture",Q28968258:"motion_picture",Q28968511:"motion_picture",Q43911809:"motion_picture",Q1276148:"dataset",Q3546236:"dataset",Q819652:"motion_picture",Q1433443:"motion_picture",Q2096633:"motion_picture",Q10654943:"motion_picture",Q15898171:"motion_picture",Q1502766:"motion_picture",Q22981906:"motion_picture",Q33218678:"dataset",Q33219080:"dataset",Q1502102:"dataset",Q290066:"dataset",Q21473954:"dataset",Q884257:"map",Q1136047:"song",Q3442060:"motion_picture",Q6722594:"motion_picture",Q22802898:"dataset",Q1147354:"song",Q541947:"song",Q762917:"song",Q896981:"song",Q1329536:"song",Q1523875:"song",Q1802243:"song",Q4666464:"song",Q5419334:"song",Q5956747:"song",Q5956766:"song",Q10288496:"song",Q13142456:"song",Q54932319:"broadcast",Q16523070:"book",Q1345076:"dataset",Q1331138:"dataset",Q4984974:"motion_picture",Q5442753:"motion_picture",Q59688552:"motion_picture",Q1030329:"motion_picture",Q2560052:"motion_picture",Q50306849:"dataset",Q9351310:"dataset",Q17093751:"motion_picture",Q55616422:"motion_picture",Q5400070:"motion_picture",Q7097859:"motion_picture",Q2518205:"motion_picture",Q39774781:"song",Q40039114:"song",Q496523:"motion_picture",Q586250:"motion_picture",Q658334:"song",Q1206090:"song",Q2642760:"motion_picture",Q2956178:"song",Q3656521:"song",Q4184716:"song",Q4400497:"song",Q5897543:"motion_picture",Q10743749:"song",Q11989328:"song",Q12623540:"song",Q19367312:"motion_picture",Q47011432:"broadcast",Q61057707:"broadcast",Q1192644:"broadcast",Q1193356:"broadcast",Q1193877:"broadcast",Q1193889:"broadcast",Q1198546:"broadcast",Q1200102:"broadcast",Q1200891:"broadcast",Q1203502:"broadcast",Q1328971:"broadcast",Q15548228:"broadcast",Q18611586:"broadcast",Q27986339:"broadcast",Q16984663:"motion_picture",Q535518:"motion_picture",Q583768:"motion_picture",Q1377546:"motion_picture",Q2254193:"motion_picture",Q2292320:"motion_picture",Q3677202:"motion_picture",Q4044177:"motion_picture",Q4075563:"motion_picture",Q731194:"motion_picture",Q5578091:"motion_picture",Q5768328:"motion_picture",Q6926334:"motion_picture",Q7116678:"motion_picture",Q2527949:"dataset",Q6410349:"song",Q58006100:"dataset",Q1065413:"dataset",Q1334294:"dataset",Q5281480:"dataset",Q14806579:"dataset",Q21629439:"broadcast",Q27965091:"broadcast",Q27965088:"broadcast",Q27965089:"broadcast",Q1117103:"motion_picture",Q15077373:"song",Q21848887:"song",Q42525933:"song",Q1246452:"song",Q1564657:"song",Q1786016:"song",Q4138449:"song",Q26211803:"dataset",Q28107644:"dataset",Q438958:"dataset",Q893182:"dataset",Q1361620:"dataset",Q1744558:"dataset",Q2558761:"broadcast",Q3663344:"dataset",Q5837451:"dataset",Q17080472:"dataset",Q18762344:"dataset",Q22936940:"dataset",Q51282626:"thesis",Q51283070:"thesis",Q51283092:"thesis",Q51283110:"thesis",Q51283164:"thesis",Q51283181:"thesis",Q51283199:"thesis",Q51283219:"thesis",Q51283231:"thesis",Q51283362:"thesis",Q1789476:"dataset",Q1741854:"broadcast",Q11396323:"motion_picture",Q1428162:"song",Q4440575:"song",Q2137852:"motion_picture",Q20443008:"motion_picture",Q9049284:"song",Q2976573:"dataset",Q7247163:"dataset",Q18327786:"dataset",Q18327800:"dataset",Q28444881:"song",Q47009776:"motion_picture",Q4078107:"song",Q12242979:"broadcast",Q1308255:"dataset",Q828962:"dataset",Q2976602:"dataset",Q881912:"broadcast",Q16861376:"dataset",Q59784758:"broadcast",Q829147:"song",Q6457531:"motion_picture",Q28030321:"broadcast",Q28225717:"broadcast",Q4663261:"webpage",Q15145755:"webpage",Q18707678:"webpage",Q18711811:"webpage",Q20160182:"webpage",Q20870830:"webpage",Q22676729:"webpage",Q26214208:"webpage",Q28801937:"webpage",Q30279428:"webpage",Q55510433:"webpage",Q59259626:"webpage",Q20769287:"webpage",Q23894233:"webpage",Q24046192:"webpage",Q24514938:"webpage",Q30330522:"webpage",Q38084761:"webpage",Q58118449:"webpage",Q2886579:"dataset",Q21623879:"webpage",Q28092864:"webpage",Q52147067:"webpage",Q18043430:"webpage",Q18810260:"dataset",Q18889371:"dataset",Q18889411:"dataset",Q20893947:"legal_case",Q43096126:"motion_picture",Q56876503:"webpage",Q58408484:"webpage",Q58492747:"webpage",Q61984657:"webpage",Q3309896:"motion_picture",Q5864844:"motion_picture",Q6190581:"webpage",Q25826840:"webpage",Q220898:"motion_picture",Q2513417:"dataset",Q56885002:"webpage",Q179600:"dataset",Q714750:"dataset",Q15101896:"dataset",Q56558180:"song",Q845648:"webpage",Q58310010:"book",Q16937368:"song",Q28135297:"song",Q50309914:"dataset",Q57560968:"song",Q61740934:"song",Q61729725:"song",Q1047299:"motion_picture",Q2281511:"motion_picture",Q4292083:"motion_picture",Q11446446:"motion_picture",Q11464558:"motion_picture",Q11620244:"motion_picture",Q11673786:"motion_picture",Q16000226:"motion_picture",Q43069510:"motion_picture",Q8066387:"motion_picture",Q16824564:"motion_picture",Q52631698:"song",Q20589414:"song",Q20621902:"song",Q19659229:"song",Q2997685:"song",Q5124548:"song",Q512410:"song",Q23978249:"song",Q6647160:"webpage",Q18170752:"song",Q5881246:"song",Q1723850:"motion_picture",Q169672:"motion_picture",Q622310:"motion_picture",Q3072042:"motion_picture",Q5104880:"motion_picture",Q193605:"song",Q20818018:"dataset",Q1065444:"motion_picture",Q5258881:"motion_picture",Q856638:"dataset",Q5769583:"motion_picture",Q5769580:"motion_picture",Q5769586:"motion_picture",Q5769589:"motion_picture",Q5769592:"motion_picture",Q34848596:"motion_picture",Q2145099:"motion_picture",Q43082648:"broadcast",Q21441352:"dataset",Q2976563:"dataset",Q4680764:"dataset",Q4936202:"dataset",Q4992609:"dataset",Q5281190:"dataset",Q5281191:"dataset",Q5281189:"dataset",Q5281192:"dataset",Q5281193:"dataset",Q5465786:"dataset",Q5575198:"dataset",Q7133628:"dataset",Q7133619:"dataset",Q7133626:"dataset",Q7133625:"dataset",Q7133631:"dataset",Q7133632:"dataset",Q7133633:"dataset",Q7135076:"dataset",Q7136196:"dataset",Q7532102:"dataset",Q7539622:"dataset",Q7539620:"dataset",Q7992082:"dataset",Q7992083:"dataset",Q7992119:"dataset",Q7992116:"dataset",Q7992128:"dataset",Q7992164:"dataset",Q17145514:"dataset",Q28130146:"dataset",Q28130147:"dataset",Q28130145:"dataset",Q28134034:"dataset",Q28134060:"dataset",Q28134100:"dataset",Q28134126:"dataset",Q4179738:"song",Q26829682:"webpage",Q22870229:"webpage",Q22875692:"webpage",Q22876063:"webpage",Q22876332:"webpage",Q25737003:"webpage",Q25830508:"webpage",Q57971242:"webpage",Q5611964:"webpage",Q5613278:"webpage",Q5615491:"webpage",Q5618337:"webpage",Q5620523:"webpage",Q5621344:"webpage",Q5622928:"webpage",Q5624848:"webpage",Q5626725:"webpage",Q5636579:"webpage",Q5827463:"webpage",Q5904431:"webpage",Q5911510:"webpage",Q6072180:"webpage",Q6232685:"webpage",Q6305829:"webpage",Q6372354:"webpage",Q6419146:"webpage",Q6499145:"webpage",Q6584170:"webpage",Q6584434:"webpage",Q6606549:"webpage",Q6622740:"webpage",Q6632234:"webpage",Q7241821:"webpage",Q7485705:"webpage",Q8784047:"webpage",Q10560362:"webpage",Q10584970:"webpage",Q10712699:"webpage",Q10730006:"webpage",Q10805463:"webpage",Q10992965:"webpage",Q11011669:"webpage",Q11052053:"webpage",Q11223110:"webpage",Q11839555:"webpage",Q12930680:"webpage",Q13383621:"webpage",Q13394564:"webpage",Q13492790:"webpage",Q13512760:"webpage",Q13763959:"webpage",Q14335223:"webpage",Q14336297:"webpage",Q14336339:"webpage",Q14358273:"webpage",Q14358335:"webpage",Q14358826:"webpage",Q14358898:"webpage",Q14358899:"webpage",Q14396951:"webpage",Q14404469:"webpage",Q14445515:"webpage",Q22867433:"webpage",Q15709178:"webpage",Q17615621:"webpage",Q18340985:"webpage",Q18881752:"webpage",Q22668105:"webpage",Q22706969:"webpage",Q22830149:"webpage",Q22834716:"webpage",Q22834726:"webpage",Q22838914:"webpage",Q22844738:"webpage",Q22846593:"webpage",Q22846942:"webpage",Q22846954:"webpage",Q22846964:"webpage",Q22858302:"webpage",Q22862005:"webpage",Q22867722:"webpage",Q22869003:"webpage",Q33130924:"motion_picture",Q30415057:"webpage",Q55648788:"webpage",Q4663903:"webpage",Q21528878:"webpage",Q22247630:"webpage",Q249083:"dataset",Q1750705:"dataset",Q955185:"dataset",Q1326107:"dataset",Q1520639:"dataset",Q2943040:"dataset",Q6404298:"dataset",Q7248117:"dataset",Q7674850:"dataset",Q29057009:"webpage",Q35250433:"webpage",Q35779580:"webpage",Q47382471:"webpage",Q47524402:"webpage",Q54734643:"webpage",Q58573615:"webpage",Q61866692:"webpage",Q8615872:"webpage",Q21286738:"webpage",Q21469493:"webpage",Q21479588:"webpage",Q23841178:"webpage",Q24571886:"webpage",Q26211786:"dataset",Q28368760:"webpage",Q28373483:"webpage",Q849666:"motion_picture",Q18089617:"motion_picture",Q18889701:"dataset",Q20010800:"webpage",Q163126:"dataset",Q1967745:"dataset",Q2122972:"dataset",Q2565860:"dataset",Q3516420:"dataset",Q13331174:"webpage",Q15088954:"dataset",Q15885744:"dataset",Q16069643:"dataset",Q17146890:"dataset",Q18435139:"dataset",Q20107258:"dataset",Q23894246:"webpage",Q57733325:"dataset",Q17175676:"motion_picture",Q26196748:"motion_picture",Q21484471:"webpage",Q265147:"song",Q56558213:"song",Q627181:"song",Q1151259:"song",Q7023411:"song",Q190635:"dataset",Q526334:"dataset",Q1982918:"dataset",Q2362354:"dataset",Q22842824:"webpage",Q3129804:"motion_picture",Q22677515:"webpage",Q48552277:"webpage",Q56876519:"webpage",Q11753321:"webpage",Q15671253:"webpage",Q20769160:"webpage",Q24731821:"webpage",Q26142649:"webpage",Q36330215:"webpage",Q6306272:"webpage",Q14385296:"webpage",Q14403646:"webpage",Q20107493:"dataset",Q20743001:"webpage",Q14460829:"webpage",Q11643859:"song",Q16141944:"song",Q17990546:"song",Q20043946:"song",Q44292661:"webpage",Q29075123:"webpage",Q40218570:"webpage",Q910144:"dataset",Q5622823:"webpage",Q13565583:"webpage",Q19648608:"webpage",Q19915239:"dataset",Q21278897:"webpage",Q21441359:"dataset",Q21441363:"dataset",Q23841351:"webpage",Q26932615:"webpage",Q26961029:"webpage",Q27949687:"webpage",Q27949697:"webpage",Q28858528:"webpage",Q29075121:"webpage",Q922853:"song",Q3879286:"song",Q3368338:"dataset",Q10997407:"webpage",Q19842659:"webpage",Q56062113:"webpage"}});var Bo=R(Zt=>{"use strict";Object.defineProperty(Zt,"__esModule",{value:!0});Zt.getLabel=bi;Zt.default=Zt.parse=Zt.parseProp=Kw;Zt.parseType=Lf;var jw=me(),Gw=pr(),Df=vt(),$w=Pf(aa()),If=Pf(Nf());function Pf(e){return e&&e.__esModule?e:{default:e}}var Rf=({P1545:e})=>e?parseInt(e[0]):-1,zw=e=>[].concat(...[e.P1932,e.P1810].filter(Boolean)),Hw=({value:e,qualifiers:t})=>{let[r]=zw(t);return r||(r=typeof e=="string"?e:bi(e)),r=r?(0,Gw.parse)(r):{literal:r},r._ordinal=Rf(t),r},Vw=e=>e.map(Hw).sort((t,r)=>t._ordinal-r._ordinal),Yw=e=>{let t=e.claims.P17[0].value,r=t.claims.P1813.filter(({qualifiers:{P31:i}})=>!i||i[0]!=="Q28840786");return bi(e)+", "+(r[0]||t.claims.P1448[0]).value},Jw=e=>e.claims.P1476?e.claims.P1476[0].value:bi(e),Ww=e=>e.map(({value:t})=>bi(t)).join(","),Xw=e=>({"date-parts":e.map(t=>(0,Df.parse)(t.value)).filter(t=>t&&t["date-parts"]).map(t=>t["date-parts"][0])});function Kw(e,t,r){switch(e){case"type":return Lf(t);case"author":case"director":case"container-author":case"collection-editor":case"composer":case"editor":case"illustrator":case"original-author":case"recipient":case"reviewed-author":case"translator":return Vw(t);case"issued":case"original-date":return(0,Df.parse)(t);case"event-date":return Xw(t);case"keyword":return Ww(t);case"container-title":case"collection-title":case"event":case"medium":case"publisher":case"original-publisher":return Jw(t);case"event-place":case"original-publisher-place":case"publisher-place":return Yw(t);case"collection-number":return Rf(t[0].qualifiers);case"number-of-volumes":return t.length;default:return t}}function Lf(e){return If.default[e]?If.default[e]:(jw.logger.unmapped("[plugin-wikidata]","publication type",e),"book")}function bi(e){if(!e)return;let t=$w.default.langs.find(r=>e.labels[r]);return e.labels[t]}});var Bf=R((SA,Zw)=>{Zw.exports={author:{values:"all",props:["P50","P2093"]},composer:{values:"all",props:["P86"]},"collection-editor":{values:"all",props:["P179.P98"]},"collection-number":{values:"all",props:["P179"]},"collection-title":"P179","container-author":{values:"all",props:["P1433.P50","P1433.P2093","P361.P50","P361.P2093"]},"container-title":{values:"any",props:["P1433","P361"]},"container-title-short":{values:"any",props:["P1433.P1813","P1433.P1160"]},director:{values:"all",props:["P57"]},DOI:"P356",edition:"P393",editor:{values:"all",props:["P98"]},event:"P1433.P4745","event-date":{values:"all",props:["P1433.P4745.P580","P1433.P4745.P582"]},"event-place":"P1433.P4745.P276",illustrator:{values:"all",props:["P110"]},ISBN:{values:"any",props:["P212","P957"]},ISSN:"P1433.P236",issue:"P433",issued:"P577",journalAbbreviation:{values:"any",props:["P1433.P1813","P1433.P1160"]},keyword:{values:"all",props:["P921"]},language:{values:"any",props:["P407.P218","P364.P218"]},medium:{values:"any",props:["P437","P186"]},"number-of-pages":"P1104","number-of-volumes":{values:"all",props:["P179.P527"]},"original-author":{values:"all",props:["P629.P50","P629.P2093"]},"original-date":"P629.P577","original-publisher":"P629.P123","original-publisher-place":{values:"any",props:["P629.P123.P740","P629.P123.P159"]},"original-title":"P629.P1476",page:"P304",PMID:"P698",PMCID:"P932",publisher:"P123","publisher-place":{values:"any",props:["P123.P740","P123.P159"]},recipient:{values:"all",props:["P1817"]},"reviewed-title":"P921.P1476","reviewed-author":{values:"all",props:["P921.P50","P921.P2093"]},scale:"P1752",title:"P1476",translator:{values:"all",props:["P655"]},type:"P31",version:"P348",volume:"P478",URL:{values:"any",props:["P856","P953","P973","P2699"]}}});var Ff=R((CA,e2)=>{e2.exports={P2860:"Cites",P921:"Main subject",P3181:"OpenCitations bibliographic resource ID",P364:"Original language of work"}});var zf=R(Ct=>{"use strict";Object.defineProperty(Ct,"__esModule",{value:!0});Ct.default=Ct.parse=Ct.parseEntities=n2;Ct.parseAsync=Ct.parseEntitiesAsync=a2;Ct.parseEntity=Fo;var t2=me(),jf=i2(Qf()),Mf=Bo(),Uf=Gf(Bf()),r2=Gf(Ff());function Gf(e){return e&&e.__esModule?e:{default:e}}function $f(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,r=new WeakMap;return($f=function(i){return i?r:t})(e)}function i2(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||typeof e!="object"&&typeof e!="function")return{default:e};var r=$f(t);if(r&&r.has(e))return r.get(e);var i={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(a!=="default"&&Object.prototype.hasOwnProperty.call(e,a)){var n=s?Object.getOwnPropertyDescriptor(e,a):null;n&&(n.get||n.set)?Object.defineProperty(i,a,n):i[a]=e[a]}return i.default=e,r&&r.set(e,i),i}function qf(e,t,r){function i([a,...n],{claims:o}){if(n.length){if(o[a]&&o[a].length)return i(n,o[a][0].value)}else return o[a]}let s=e.split(".");return r.delete(s[0]),i(s,t)}function s2(e,t,r){if(typeof e!="object"){let s=qf(e,t,r);return s&&s[0].value}let i=[].concat(...e.props.map(s=>qf(s,t,r)).filter(Boolean));return e.values==="all"?i[0]&&i:i[0]&&i[0].value}function Fo(e){let t={id:e.id,_wikiId:e.id,source:"Wikidata"},r=new Set(Object.keys(e.claims));for(let i in Uf.default){let s=s2(Uf.default[i],e,r);if(s){let a=(0,Mf.parseProp)(i,s,e);a&&(t[i]=a)}}for(let i of r)i in r2.default||t2.logger.unmapped("[plugin-wikidata]","property",i);return t.title||(t.title=(0,Mf.getLabel)(e)),(t["reviewed-title"]||t["reviewed-author"])&&(t.type.slice(0,6)!=="review"&&(t.type="review"),delete t.keyword),t.recipient&&(t.type="personal_communication"),t.event&&(t.type="paper-conference"),t}async function a2({entities:e}){return(await jf.parseAsync(e)).map(Fo)}function n2({entities:e}){return jf.parse(e).map(Fo)}});var Hf=R(oa=>{"use strict";Object.defineProperty(oa,"__esModule",{value:!0});oa.parse=void 0;var o2=e=>e.match(/\/(Q\d+)(?:[#?/]|\s*$)/)[1];oa.parse=o2});var jo=R(Ot=>{"use strict";Object.defineProperty(Ot,"__esModule",{value:!0});Ot.ref=Ot.parsers=Ot.formats=void 0;var l2=me(),Mo=vi(Do()),Uo=vi(zf()),qo=vi(Bo()),Vf=vi(Hf()),yi=vi(Po()),u2=c2(aa());function c2(e){return e&&e.__esModule?e:{default:e}}function Yf(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,r=new WeakMap;return(Yf=function(i){return i?r:t})(e)}function vi(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||typeof e!="object"&&typeof e!="function")return{default:e};var r=Yf(t);if(r&&r.has(e))return r.get(e);var i={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(a!=="default"&&Object.prototype.hasOwnProperty.call(e,a)){var n=s?Object.getOwnPropertyDescriptor(e,a):null;n&&(n.get||n.set)?Object.defineProperty(i,a,n):i[a]=e[a]}return i.default=e,r&&r.set(e,i),i}var Jf="@wikidata";Ot.ref=Jf;var p2={id:Mo,entity:Uo,prop:qo,url:Vf,api:yi};Ot.parsers=p2;var Wf={"@wikidata/id":{parse:Mo.parse,parseType:{dataType:"String",predicate:/^Q\d+$/}},"@wikidata/list+text":{parse(e){return e.trim().split(/(?:[\s,]\s*)/g)},parseType:{dataType:"String",predicate:/^\s*((?:Q\d+(?:[\s,]\s*))*Q\d+)\s*$/}},"@wikidata/api":{parse:yi.parse,parseAsync:yi.parseAsync,parseType:{dataType:"String",predicate:/^(https?:\/\/(?:www\.)?wikidata.org\/w\/api\.php(?:\?.*)?)$/,extends:"@else/url"}},"@wikidata/array+api":{parse:yi.parse,parseAsync:yi.parseAsync,parseType:{dataType:"Array",elementConstraint:"@wikidata/api"}},"@wikidata/url":{parse:Vf.parse,parseType:{dataType:"String",predicate:/\/(Q\d+)(?:[#?/]|\s*$)/,extends:"@else/url"}},"@wikidata/list+object":{parse:Mo.parse,parseType:{dataType:"Array",elementConstraint:"@wikidata/id"}},"@wikidata/object":{parse:Uo.parse,parseAsync:Uo.parseAsync,parseType:{dataType:"SimpleObject",propertyConstraint:{props:"entities"}}},"@wikidata/array+object":{parse(e){return e.reduce((t,{success:r,entities:i})=>(t.success&=r,Object.assign(t.entities,i),t),{})},parseType:{dataType:"Array",elementConstraint:"@wikidata/object"},outputs:"@wikidata/object"},"@wikidata/prop":{parse:qo.parseProp},"@wikidata/type":{parse:qo.parseType}};Ot.formats=Wf;l2.plugins.add(Jf,{input:Wf,config:u2.default})});var Go=R((NA,tm)=>{var pe=me();Nn();Rs();Np();oo();Zp();jo();var h2=Zn(),Xf=pr(),Kf=vt();function Zf(e){let t={};for(let r in e)t[r]=typeof e[r]=="object"?Zf(e[r]):e[r];return t}var em={getAttributedEntry(e,t,r){return e.replace(/^\s*<[a-z]+/i,`$& data-${t}="${r}"`)},getPrefixedEntry(e,t){return em.getAttributedEntry(e,"csl-entry-id",t)},getWrappedEntry(e,t,r){let i=(c,p)=>typeof p=="function"?p(c):p==null?p:"";if(r.prepend==null&&r.append==null)return e;let s=i(t,r.prepend),a=i(t,r.append),n="",o="",u=e.match(/^([^>]+>)([\s\S]+)(<[^<]+)$/i);return u&&(n=u[1],e=u[2],o=u[3]),n+s+e+a+o}};function be(e,t){if(!(this instanceof be))return new be(e,t);let r=new pe.Cite(e,t);this._options=r._options,this.log=r.log,this.data=r.data}be.prototype=Object.create(pe.Cite.prototype);be.async=pe.Cite.async;be.validateOptions=pe.Cite.validateOptions;be.validateOutputOptions=pe.Cite.validateOutputOptions;be.input=pe.plugins.input.chain;be.inputAsync=pe.plugins.input.chainAsync;be.util=Object.assign({attr:em},pe.util);be.version={cite:pe.version,citeproc:h2.PROCESSOR_VERSION};var ke=pe.plugins.config.get("@csl");be.CSL={engine:hi().fetchEngine,item(e){return t=>e.find(r=>r.id===t)},locale(e){return ke.styles.get(ke.styles.has(e)?e:"en-US")},style(e){return ke.templates.get(ke.templates.has(e)?e:"apa")},register:{addTemplate:ke.templates.add.bind(ke.templates),getTemplate:ke.templates.get.bind(ke.templates),hasTemplate:ke.templates.has.bind(ke.templates),addLocale:ke.locales.add.bind(ke.locales),getLocale:ke.locales.get.bind(ke.locales),hasLocale:ke.locales.has.bind(ke.locales)}};be.plugins=Zf(pe.plugins);delete be.plugins.input.util.clean;be.parse=Object.assign({input:{chain:pe.plugins.input.chain,chainAsync:pe.plugins.input.chainAsync,chainLink:pe.plugins.input.chainLink,chainLinkAsync:pe.plugins.input.chainLinkAsync,data:pe.plugins.input.data,dataAsync:pe.plugins.input.dataAsync,type:pe.plugins.input.type,async:{chain:pe.plugins.input.chainAsync,chainLink:pe.plugins.input.chainLinkAsync,data:pe.plugins.input.dataAsync}},name:Xf.parse,date:Kf.parse,csl:pe.plugins.input.util.clean,bibjson:Nn().parsers.json.record,bibtex:((e,t,r)=>({json(i){return i.parse([].concat(i))},prop(i,s){let a=t.parse([{type:"book",properties:{[i]:s}}])[0],n=Object.keys(a).find(([o])=>o!=="type");return[n,a[n]]},text(i){return e["@biblatex/text"].parse(i)},type(i){return r[i]||"book"}}))(Mn().formats,Fn(),ni().target),bibtxt:(e=>({text:e.parse,textEntry:e.textEntry}))(Pn()),doi:(e=>({api:e.parsers.api.parse,id:e.parsers.id.parse,async:{api:e.parsers.api.parseAsync}}))(oo()),json:Sn().parsers.json.parse,wikidata:(e=>({json:e.parsers.entity.parse,list:e.parsers.id.parse,prop:e.parsers.prop.parse,type:e.parsers.prop.parseType,async:{json:e.parsers.entity.parseAsync,prop(...t){return Promise.resolve(e.parsers.prop.parse.apply(this,t))}}}))(jo())},be.plugins.input);be.get=Object.assign({dict:be.plugins.dict,name:Xf.format,date:Kf.format,bibtex:((e,t,r,i)=>({json(s){return t.formatBibtex([s])[0]},label({id:s,"citation-label":a,author:n,issued:o,"year-suffix":u,title:c}){return r.LABEL.toSource(s,a,n,o,u,c)},text(s,a){return e.bibtex(s,{format:a?"html":"text"})},type(s){return i[s]||"misc"}}))(Wn().default,$n(),li().Converters,ni().target),bibtxt:Vn().format,json:vs().default.data,label:vs().default.label},be.plugins.output);tm.exports=be});var cm,jr,mt,er,RS,ha=Oi(()=>{cm="127.0.0.1",jr={PARSING_BIBTEX:"Parsing BibTeX data...",PARSING:"Parsing...",PARSE_BIBTEX:"Parse BibTeX",LOADING:"Loading...",LOOKUP:"Lookup",FETCHING_DATA:"Fetching citation data..."},mt={ZOTERO_PORT_IN_USE:"Port is already in use. Is Zotero or another application running?",ZOTERO_PORT_ACCESS_DENIED:"Permission denied for port. Try a port number above 1024.",BIBLIOGRAPHY_BUILD_FAILED:"Error building bibliography files. Check console for details.",FILE_READ_FAILED:"Failed to read file content",INVALID_CSL_DATA:"Invalid CSL data format",TEMPLATE_PARSE_ERROR:"Failed to parse template",BIBTEX_PARSE_FAILED:"Error parsing BibTeX data. Please check the format and try again.",NO_BIBTEX_DATA:"No valid citation data found in the BibTeX entry",EMPTY_BIBTEX:"Please paste a BibTeX entry"},er={ZOTERO_SERVER_STARTED:"Zotero Connector server listening on port",BIBLIOGRAPHY_BUILDING:"Building bibliography files...",BIBTEX_EXPORTING:"Exporting BibTeX file...",NOTE_CREATED:"Literature note created successfully",TEMPLATE_APPLIED:"Template applied successfully!",BIBTEX_PARSED:"BibTeX data successfully parsed and filled",CITOID_FILLED:"Citation data successfully filled"},RS={MAX_TITLE_LENGTH:255,MAX_ABSTRACT_LENGTH:5e3,MAX_FILE_SIZE:50*1024*1024,MAX_BATCH_IMPORT:100}});var ba={};Ca(ba,{ConnectorServer:()=>Yo});var tr,fm,We,Gr,mm,Vo,nt,dm,gm,y2,Ti,hm,v2,_2,E2,Yo,ya=Oi(()=>{tr=require("obsidian"),fm=Ue(require("http")),We=Ue(require("fs")),Gr=Ue(require("path")),mm=Ue(require("stream")),Vo=Ue(require("url")),nt=Ue(require("crypto")),dm=Ue(require("os")),gm=require("util");ha();y2=(0,gm.promisify)(mm.pipeline),Ti="1.0.7",hm="Obsidian BibLib",v2=3,_2=6e5,E2=18e5,Yo=class{constructor(t,r){this.server=null;this.sessions=new Map;this.processedSnapshots=new Set;this.processedAttachmentPaths=new Map;this.cleanupIntervalId=null;if(this.app=t,this.settings=r,this.tempDir=r.tempPdfPath||Gr.join(dm.tmpdir(),"obsidian-bibliography"),!We.existsSync(this.tempDir))try{We.mkdirSync(this.tempDir,{recursive:!0})}catch(i){console.error(`Failed to create temp directory ${this.tempDir}:`,i),new tr.Notice(`Error: Could not create temp directory for Zotero Connector: ${this.tempDir}`)}}async start(){if(this.server)return;let t=this.settings.zoteroConnectorPort||23119;return this.server=fm.createServer(this.handleRequest.bind(this)),new Promise((r,i)=>{var s,a;(s=this.server)==null||s.listen(t,cm,()=>{new tr.Notice(`${er.ZOTERO_SERVER_STARTED} ${t}`),this.cleanupIntervalId=setInterval(()=>this.cleanupOldSessions(),_2),r()}),(a=this.server)==null||a.on("error",n=>{console.error("Failed to start Zotero Connector server:",n);let o=`Failed to start Zotero Connector server: ${n.message}`;n.code==="EADDRINUSE"?o=`Failed to start Zotero Connector server: Port ${t} ${mt.ZOTERO_PORT_IN_USE}`:n.code==="EACCES"&&(o=`Failed to start Zotero Connector server: ${mt.ZOTERO_PORT_ACCESS_DENIED.replace("port",`port ${t}`)}`),new tr.Notice(o),this.server=null,i(n)})})}stop(){return new Promise(t=>{this.cleanupIntervalId&&(clearInterval(this.cleanupIntervalId),this.cleanupIntervalId=null),this.server?this.server.close(()=>{new tr.Notice("Zotero Connector server stopped",2e3),this.server=null,this.sessions.clear(),t()}):t()})}async handleRequest(t,r){if(r.setHeader("Access-Control-Allow-Origin","*"),r.setHeader("Access-Control-Allow-Methods","GET, POST, OPTIONS"),r.setHeader("Access-Control-Allow-Headers","Content-Type, X-Zotero-Version, X-Zotero-Connector-API-Version, X-Metadata, Authorization"),r.setHeader("Access-Control-Expose-Headers","X-Zotero-Version"),t.method==="OPTIONS"){r.writeHead(204),r.end();return}let s=Vo.parse(t.url||"",!0).pathname||"",a=t.method||"GET";r.setHeader("X-Zotero-Version",hm+" "+Ti);try{if(s.startsWith("/connector/")){let n=s.substring(11);await this.routeConnectorApi(n,t,r)}else s==="/"?this.sendResponse(r,200,{message:"Obsidian Bibliography Connector Server Running",version:Ti}):this.sendResponse(r,404,{error:"Not Found"})}catch(n){console.error(`Connector Server: Error handling ${a} ${s}:`,n),this.sendResponse(r,500,{error:"Internal Server Error",details:n.message})}}async routeConnectorApi(t,r,i){let s=r.method||"GET";switch(t){case"ping":s==="POST"||s==="GET"?await this.handlePing(r,i):this.sendMethodNotAllowed(i,t);break;case"saveItems":s==="POST"?await this.handleSaveItems(r,i):this.sendMethodNotAllowed(i,t);break;case"saveSnapshot":s==="POST"?await this.handleSaveSnapshot(r,i):this.sendMethodNotAllowed(i,t);break;case"saveAttachment":case"saveStandaloneAttachment":s==="POST"?await this.handleSaveAttachment(r,i,t==="saveStandaloneAttachment"):this.sendMethodNotAllowed(i,t);break;case"saveSingleFile":s==="POST"?await this.handleSaveSingleFile(r,i):this.sendMethodNotAllowed(i,t);break;case"getSelectedCollection":s==="GET"||s==="POST"?this.handleGetSelectedCollection(r,i):this.sendMethodNotAllowed(i,t);break;case"sessionProgress":s==="POST"?await this.handleSessionProgress(r,i):this.sendMethodNotAllowed(i,t);break;case"hasAttachmentResolvers":s==="POST"?this.handleHasAttachmentResolvers(r,i):this.sendMethodNotAllowed(i,t);break;case"saveAttachmentFromResolver":s==="POST"?this.handleSaveAttachmentFromResolver(r,i):this.sendMethodNotAllowed(i,t);break;case"getTranslatorCode":case"getTranslators":this.sendResponse(i,200,[]);break;case"delaySync":case"updateSession":this.sendResponse(i,200,{status:"acknowledged"});break;case"installStyle":case"import":case"getClientHostnames":case"proxies":this.handleNotImplemented(i,`Endpoint '${t}' likely not needed for Obsidian`);break;default:this.sendResponse(i,404,{error:`Connector endpoint '/connector/${t}' not found`})}}async handlePing(t,r){var o;let i=t.headers["x-zotero-version"]||"Unknown",s=parseInt(((o=t.headers["x-zotero-connector-api-version"])==null?void 0:o.toString())||"0",10),a="";if(t.method==="POST"){a=await this.readRequestBody(t);try{JSON.parse(a).activeURL}catch(u){}}if(s>v2){this.sendResponse(r,412,{error:"Connector API version mismatch"});return}let n={downloadAssociatedFiles:!0,automaticSnapshots:!0,reportActiveURL:!1,googleDocsAddNoteEnabled:!1,googleDocsCitationExplorerEnabled:!1,supportsAttachmentUpload:!0,translatorsHash:"obsidian-plugin-static-hash-"+Ti,sortedTranslatorHash:"obsidian-plugin-static-hash-sorted-"+Ti};this.sendResponse(r,200,{authenticated:!1,loggedIn:!1,storage:[1,0,0],prefs:n,version:hm+" "+Ti})}async handleSaveItems(t,r){let i=await this.readRequestBody(t),s;try{s=JSON.parse(i)}catch(c){this.sendResponse(r,400,{error:"Invalid JSON data"});return}if(!s.items||!Array.isArray(s.items)||s.items.length===0){this.sendResponse(r,400,{error:"No items provided"});return}let a=s.sessionID||nt.randomUUID(),n=s.uri||"Unknown URI",o=s.items[0],u=new Set;(o.attachments||[]).forEach(c=>{c.linkMode!=="linked_url"&&c.id&&u.add(c.id)}),this.sessions.set(a,{uri:n,items:[o],startTime:Date.now(),attachmentStatus:{},initialRequestData:s,expectedAttachmentIds:u,eventDispatched:!1,processedSnapshots:new Set,processedAttachmentPaths:new Set}),this.sendResponse(r,200,{sessionID:a}),new tr.Notice("Receiving item from Zotero.")}async handleSaveSnapshot(t,r){let i=await this.readRequestBody(t),s;try{s=JSON.parse(i)}catch(h){this.sendResponse(r,400,{error:"Invalid JSON data"});return}let a=s.sessionID||nt.randomUUID(),n=s.url||"Unknown URI",o=s.title||"Web Page Snapshot";if(this.sessions.get(a)){this.sendResponse(r,200,{sessionID:a});return}let c={itemType:"webpage",title:o,url:n,accessDate:new Date().toISOString(),attachments:[],tags:[],creators:s.creators||(s.author?[{creatorType:"author",name:s.author}]:s.byline?[{creatorType:"author",name:s.byline}]:[]),id:s.id||`webpage-${nt.createHash("sha1").update(n).digest("hex").substring(0,10)}`},p=`html-snapshot-${nt.randomUUID().substring(0,8)}`,f=new Set([p]);this.sessions.set(a,{uri:n,items:[c],startTime:Date.now(),attachmentStatus:{[p]:{progress:0}},initialRequestData:s,expectedAttachmentIds:f,eventDispatched:!1,processedSnapshots:new Set,processedAttachmentPaths:new Set}),this.sendResponse(r,200,{sessionID:a}),new tr.Notice(`Receiving snapshot for ${o}.`)}async handleSaveAttachment(t,r,i){var v,b;let a=Vo.parse(t.url||"",!0).query.sessionID;if(!a){this.sendResponse(r,400,{error:"sessionID query parameter is required"});return}let n=this.sessions.get(a);if(!n){this.sendResponse(r,404,{error:"Session not found or expired"});return}let o=t.headers["x-metadata"],u=t.headers["content-type"]||"application/octet-stream";if(!o){this.sendResponse(r,400,{error:"X-Metadata header is required"});return}let c;try{c=JSON.parse(o)}catch(E){this.sendResponse(r,400,{error:"Invalid X-Metadata header"});return}let p=c.id||nt.randomUUID(),f=c.title||"Attachment",h=c.url||n.uri,m=this.generateFilename(f,u,h),g=Gr.join(this.tempDir,m);if(((v=n.attachmentStatus[p])==null?void 0:v.progress)===100&&((b=n.attachmentStatus[p])!=null&&b.localPath)){r.writeHead(201,{"Content-Type":"application/json"}),r.end(JSON.stringify({status:"success",filename:Gr.basename(n.attachmentStatus[p].localPath),canRecognize:u==="application/pdf"&&i}));return}if(n.processedAttachmentPaths&&n.processedAttachmentPaths.has(g)){let E=Object.entries(n.attachmentStatus).find(([x,w])=>w.localPath===g);if(E){n.attachmentStatus[p]=n.attachmentStatus[E[0]],n.expectedAttachmentIds.add(p),r.writeHead(201,{"Content-Type":"application/json"}),r.end(JSON.stringify({status:"success",filename:m,canRecognize:u==="application/pdf"&&i}));return}}let d=n.items[0];if(d&&d.attachments){let E=d.attachments.find(x=>{var w,S;return x.title===f&&x.url===c.url&&x.mimeType===u&&x.id&&((w=n.attachmentStatus[x.id])==null?void 0:w.progress)===100&&((S=n.attachmentStatus[x.id])==null?void 0:S.localPath)});if(E&&E.id){n.attachmentStatus[p]={...n.attachmentStatus[E.id]},n.expectedAttachmentIds.add(p),r.writeHead(201,{"Content-Type":"application/json"}),r.end(JSON.stringify({status:"success",filename:m,canRecognize:u==="application/pdf"&&i}));return}}n.expectedAttachmentIds.has(p)||n.expectedAttachmentIds.add(p),n.attachmentStatus[p]={progress:0};try{await y2(t,We.createWriteStream(g)),n.processedAttachmentPaths.add(g),n.attachmentStatus[p].progress=100,n.attachmentStatus[p].localPath=g;let E=n.items[0];if(E){E.attachments||(E.attachments=[]);let x={id:p,title:f,url:c.url,localPath:g,mimeType:u,parentItem:c.parentItemID||E.id,itemType:"attachment",linkMode:"imported_file"},w=E.attachments.findIndex(S=>S.id===p);w>-1?E.attachments[w]={...E.attachments[w],...x}:E.attachments.push(x)}this.sessions.set(a,n),r.writeHead(201,{"Content-Type":"application/json"}),r.end(JSON.stringify({status:"success",filename:m,canRecognize:u==="application/pdf"&&i})),this.checkAndDispatchIfComplete(a)}catch(E){console.error(`Error saving attachment ${m}:`,E),n.attachmentStatus[p].progress=-1,n.attachmentStatus[p].error=E.message,this.sessions.set(a,n),We.unlink(g,()=>{}),this.sendResponse(r,500,{error:"Failed to save attachment"}),this.checkAndDispatchIfComplete(a)}}async handleSaveSingleFile(t,r){var d,v,b,E;let i=await this.readRequestBody(t),s;try{s=JSON.parse(i)}catch(x){this.sendResponse(r,400,{error:"Invalid JSON data"});return}let a=s.sessionID;if(!a){this.sendResponse(r,400,{error:"sessionID is required"});return}let n=this.sessions.get(a);if(!n){this.sendResponse(r,404,{error:"Session not found or expired"});return}let o=s.snapshotContent;if(typeof o!="string"){this.sendResponse(r,400,{error:"Invalid snapshot content"});return}let u=s.title||((d=n.items[0])==null?void 0:d.title)||"Snapshot";if(n.processedSnapshots&&n.processedSnapshots.size>0){r.writeHead(204),r.end();return}let c=(b=(v=n.items[0])==null?void 0:v.attachments)==null?void 0:b.find(x=>x.mimeType==="text/html");if(c!=null&&c.id&&((E=n.attachmentStatus[c.id])==null?void 0:E.progress)===100){r.writeHead(204),r.end();return}let p=nt.createHash("md5").update(s.url||n.uri).digest("hex").substring(0,10),f=s.id||`html-${p}`,h=this.generateFilename(u,"text/html",s.url||n.uri),m=Gr.join(this.tempDir,h),g;for(let x of n.expectedAttachmentIds)if(x.startsWith("html-snapshot-")){g=x;break}g&&g!==f?(n.expectedAttachmentIds.delete(g),delete n.attachmentStatus[g],n.expectedAttachmentIds.add(f)):n.expectedAttachmentIds.has(f)||n.expectedAttachmentIds.add(f),n.attachmentStatus[f]={progress:0};try{await We.promises.writeFile(m,o,"utf-8"),n.processedSnapshots.add(f),n.attachmentStatus[f].progress=100,n.attachmentStatus[f].localPath=m;let x=n.items[0];if(x){x.attachments||(x.attachments=[]);let w={id:f,title:u,url:s.url||n.uri,localPath:m,mimeType:"text/html",itemType:"attachment",linkMode:"imported_file",charset:"utf-8"},S=x.attachments.findIndex(T=>T.mimeType==="text/html"||T.id===f);S>-1?x.attachments[S]=w:x.attachments.push(w)}this.sessions.set(a,n),r.writeHead(204),r.end(),this.checkAndDispatchIfComplete(a)}catch(x){console.error(`Error saving snapshot ${h}:`,x),n.attachmentStatus[f].progress=-1,n.attachmentStatus[f].error=x.message,this.sessions.set(a,n),We.unlink(m,()=>{}),this.sendResponse(r,500,{error:"Failed to save snapshot"}),this.checkAndDispatchIfComplete(a)}}handleGetSelectedCollection(t,r){this.sendResponse(r,200,{id:"obsidian",name:"Obsidian Vault",libraryID:1,libraryEditable:!0,filesEditable:!0,targets:[{id:"obsidian",name:"Obsidian Vault",type:"library",libraryID:1,level:0,filesEditable:!0}]})}async handleSessionProgress(t,r){let i=await this.readRequestBody(t),s;try{s=JSON.parse(i)}catch(c){this.sendResponse(r,400,{error:"Invalid JSON data"});return}let a=s.sessionID;if(!a||!this.sessions.has(a)){this.sendResponse(r,404,{error:"Session not found"});return}let n=this.sessions.get(a);await new Promise(c=>setTimeout(c,500));let o=this.isSessionComplete(n),u=(n.items||[]).map(c=>{var f;let p=[];for(let h of n.expectedAttachmentIds){let m=n.attachmentStatus[h],g=(c.attachments||[]).find(d=>d.id===h);p.push({id:h,progress:(f=m==null?void 0:m.progress)!=null?f:0,error:m==null?void 0:m.error,title:g==null?void 0:g.title})}return{id:c.id||"unknown-item",progress:100,attachments:p}});this.sendResponse(r,200,{items:u,done:o}),o&&!n.eventDispatched&&this.checkAndDispatchIfComplete(a)}handleHasAttachmentResolvers(t,r){this.sendResponse(r,200,!1)}handleSaveAttachmentFromResolver(t,r){this.sendResponse(r,501,{error:"Attachment resolving not implemented"})}sendResponse(t,r,i){t.headersSent||(t.setHeader("Content-Type","application/json"),t.writeHead(r),t.end(JSON.stringify(i)))}sendMethodNotAllowed(t,r){this.sendResponse(t,405,{error:"Method Not Allowed"})}handleNotImplemented(t,r="Not implemented"){this.sendResponse(t,501,{error:"Not Implemented",reason:r})}async readRequestBody(t){let r=[];for await(let i of t)r.push(Buffer.from(i));return Buffer.concat(r).toString("utf-8")}generateFilename(t,r,i){var o;let s=((o=r.split("/")[1])==null?void 0:o.split("+")[0])||(r==="application/pdf"?"pdf":r==="text/html"?"html":"bin"),n=(t||"Untitled").replace(/[<>:"/\\|?*]/g,"_").replace(/\.+/g,".").replace(/[ _-]+$/,"").replace(/^[ _.-]+/,"").substring(0,100);if(!n||n==="_"||t==="Attachment"||t==="Snapshot"||t==="Untitled"){let u=i||t||nt.randomUUID();n=`attachment_${nt.createHash("sha1").update(u).digest("hex").substring(0,10)}`}return`${n}.${s}`}checkAndDispatchIfComplete(t){let r=this.sessions.get(t);if(r&&!r.eventDispatched&&this.isSessionComplete(r)){let i=Object.values(r.attachmentStatus).filter(s=>s.progress===100&&s.localPath).map(s=>s.localPath);this.dispatchZoteroItemEvent(r.items[0],i,t),r.eventDispatched=!0,this.sessions.set(t,r),this.monitorForAdditionalAttachments(t)}}monitorForAdditionalAttachments(t){let r=0,i=0,s=setInterval(()=>{r++;let a=this.sessions.get(t);if(!a){clearInterval(s);return}let n=Object.values(a.attachmentStatus).filter(o=>o.progress===100&&o.localPath).map(o=>o.localPath);n.length>i&&(this.dispatchAdditionalAttachments(a.items[0].id,n.slice(i),t),i=n.length),r>=300&&clearInterval(s)},1e3)}dispatchAdditionalAttachments(t,r,i){if(typeof document=="undefined")return;let s=new CustomEvent("zotero-additional-attachments",{detail:{itemId:t,files:r,sessionID:i}});document.dispatchEvent(s)}dispatchZoteroItemEvent(t,r,i){if(typeof document=="undefined")return;let s=this.sessions.get(i);if(!s)return;let a=s.items.find(o=>o.id===t.id);if(!a)return;let n=new CustomEvent("zotero-item-received",{detail:{item:JSON.parse(JSON.stringify(a)),files:r,sessionID:i}});document.dispatchEvent(n)}isSessionComplete(t){if(!t||!t.items||t.items.length===0||!t.expectedAttachmentIds||t.expectedAttachmentIds.size===0)return!0;let r=0;for(let i of t.expectedAttachmentIds){let s=t.attachmentStatus[i];s&&(s.progress===100||s.progress===-1)&&r++}return r>=t.expectedAttachmentIds.size}cleanupOldSessions(){let t=Date.now(),r=0;for(let[i,s]of this.sessions.entries())s.eventDispatched&&t-s.startTime>E2&&(this.sessions.delete(i),r++);r>0}}});var w2={};Ca(w2,{default:()=>_a});module.exports=rl(w2);var bm=require("obsidian");var V=require("obsidian");var il=["article","article-journal","article-magazine","article-newspaper","bill","book","broadcast","chapter","classic","collection","dataset","document","entry","entry-dictionary","entry-encyclopedia","event","figure","graphic","hearing","interview","legal_case","legislation","manuscript","map","motion_picture","musical_score","pamphlet","paper-conference","patent","performance","periodical","personal_communication","post","post-weblog","regulation","report","review","review-book","software","song","speech","standard","thesis","treaty","webpage"],Oa=["abstract","annote","archive","archive_location","archive-place","authority","call-number","citation-label","collection-title","container-title","container-title-short","dimensions","DOI","event","event-place","genre","ISBN","ISSN","jurisdiction","keyword","language","license","medium","note","original-publisher","original-publisher-place","original-title","page-first","part","PMCID","PMID","publisher","publisher-place","references","reviewed-title","scale","source","status","title","title-short","URL","year-suffix"],ir=["author","editor","chair","collection-editor","compiler","composer","container-author","contributor","curator","director","editorial-director","executive-producer","guest","host","interviewer","illustrator","narrator","organizer","original-author","performer","producer","recipient","reviewed-author","script-writer","series-creator","translator"],Hr=["chapter-number","citation-number","collection-number","edition","first-reference-note-number","issue","locator","number","number-of-pages","number-of-volumes","page","part-number","section","version","volume"],Vr=["accessed","available-date","event-date","issued","original-date","submitted"],Ke=new Set([...Oa,...ir,...Hr,...Vr]);var nl=require("obsidian");Pt();Yr();var Jr=class{static getSampleData(){return{id:"smith_neural2024",citekey:"smith_neural2024",type:"article-journal",title:"Neural Networks for Climate Prediction",issued:{"date-parts":[[2024,3,15]]},year:2024,month:3,day:15,URL:"https://example.org/10.1234/climate.2024.001",DOI:"10.1234/climate.2024.001",publisher:"Journal of Climate Science","container-title":"Journal of Climate Science",abstract:"This study presents a novel neural network framework for improving climate model accuracy and computational efficiency.",volume:15,issue:2,page:"123-145","collection-title":"","publisher-place":"Cambridge",language:"en",author:[{family:"Smith",given:"John"},{family:"Rodriguez",given:"Maria"},{family:"Zhang",given:"Wei"}],currentDate:new Date().toISOString().split("T")[0],currentTime:new Date().toISOString().split("T")[1].split(".")[0],authors:"J. Smith et al.",authors_raw:[{family:"Smith",given:"John",role:"author"},{family:"Rodriguez",given:"Maria",role:"author"},{family:"Zhang",given:"Wei",role:"author"}],authors_family:["Smith","Rodriguez","Zhang"],authors_given:["John","Maria","Wei"],editors:["Jones"],editors_family:["Jones"],editors_given:["Emily"],pdflink:["biblib/smith_neural2024/paper.pdf"],raw_pdflink:"biblib/smith_neural2024/paper.pdf",htmllink:"biblib/smith_neural2024/supplementary.html",attachments:["[[biblib/smith_neural2024/paper.pdf|PDF]]","[[biblib/smith_neural2024/supplementary.html|HTML]]"],attachment:"[[biblib/smith_neural2024/paper.pdf|PDF]]",quoted_attachments:['"[[biblib/smith_neural2024/paper.pdf|PDF]]"','"[[biblib/smith_neural2024/supplementary.html|HTML]]"'],quoted_attachment:'"[[biblib/smith_neural2024/paper.pdf|PDF]]"',links:["[[Research/Climate Science/Overview]]","[[Projects/ML Applications]]"],linkPaths:["Research/Climate Science/Overview.md","Projects/ML Applications.md"],links_string:"[[Research/Climate Science/Overview]], [[Projects/ML Applications]]"}}static getModeSpecificSampleData(t,r){let i=JSON.parse(JSON.stringify(r||this.getSampleData()));return t==="frontmatter"&&(i.authors=i.authors_family.map((a,n)=>{let o=i.authors_given[n];return o?`${o} ${a}`:a}),i.authors_raw||(i.authors_raw=i.author.map(a=>({...a,role:"author"}))),["editor","translator","contributor"].forEach(a=>{let n=`${a}s`;if(i[n]&&typeof i[n]=="string"){let o=`${a}s_family`,u=`${a}s_given`;i[o]&&Array.isArray(i[o])&&(i[n]=i[o].map((c,p)=>{var h;let f=((h=i[u])==null?void 0:h[p])||"";return f?`${f} ${c}`:c}))}}),i.attachment&&typeof i.attachment=="string"&&!Array.isArray(i.attachments)&&(i.attachments=[i.attachment]),i.raw_pdflink&&typeof i.raw_pdflink=="string"&&!Array.isArray(i.pdflink)&&(i.pdflink=[i.raw_pdflink],i.raw_pdflinks=[i.raw_pdflink]),i.linkPaths&&Array.isArray(i.linkPaths)&&!Array.isArray(i.links)&&(i.links=i.linkPaths.map(a=>`[[${a}]]`),i.links_string=i.links.join(", "))),i}};var ki=class{constructor(t){this.currentMode="normal";this.sampleData=Jr.getSampleData(),this.initialize(t)}initialize(t){this.container=t.createDiv({cls:"template-playground-container"});let r=this.container.createEl("p",{text:"Use this playground to experiment with template syntax and see the results in real-time.",cls:"template-playground-description"}),i=this.container.createDiv({cls:"template-playground-input-container"});i.createEl("label",{text:"Template:",cls:"template-playground-label"}),this.templateField=new nl.TextAreaComponent(i),this.templateField.setPlaceholder("Enter a template to preview (e.g., {{title}} by {{authors}})").setValue(`# {{title}}

By: {{authors}}

Published in: {{container-title}} ({{year}})

{{#abstract}}**Abstract**: {{abstract}}{{/abstract}}`).onChange(this.updatePreview.bind(this)),this.templateField.inputEl.addClass("template-playground-textarea");let s=this.container.createDiv({cls:"template-playground-toolbar"}),a=s.createDiv({cls:"template-playground-modes"});a.createEl("span",{text:"Template mode:",cls:"template-playground-toggle-label"});let n=a.createEl("select",{cls:"template-playground-mode-select"});[{value:"normal",label:"Normal"},{value:"frontmatter",label:"Frontmatter"},{value:"citekey",label:"Citekey"}].forEach(g=>{let d=n.createEl("option",{value:g.value,text:g.label});g.value===this.currentMode&&(d.selected=!0)}),n.addEventListener("change",g=>{let d=g.target;this.currentMode=d.value,this.updatePreview()});let u=s.createDiv({cls:"template-playground-examples"});u.createEl("span",{text:"Examples:",cls:"template-playground-examples-label"});let c=u.createEl("select",{cls:"template-playground-examples-dropdown"});[{label:"Select an example...",value:""},{label:"-- Headers --",value:""},{label:"Basic header",value:"# {{title}}"},{label:"Header with year",value:"# {{title}} ({{year}})"},{label:"Header with linked PDF",value:"# {{#pdflink}}[[{{pdflink}}|{{title}}]]{{/pdflink}}{{^pdflink}}{{title}}{{/pdflink}}"},{label:"Header with emoji prefix",value:"# \u{1F4DD} {{title}} ({{year}})"},{label:"Header with type icon",value:'# {{#type}}{{#==="article-journal"}}\u{1F4F0}{{/==="article-journal"}}{{#==="book"}}\u{1F4DA}{{/==="book"}}{{#==="chapter"}}\u{1F4D1}{{/==="chapter"}}{{#==="webpage"}}\u{1F310}{{/==="webpage"}}{{/type}} {{title}}'},{label:"-- Citations --",value:""},{label:"APA-style citation",value:"{{authors}} ({{year}}). {{title}}. {{#container-title}}{{container-title}}, {{/container-title}}{{#volume}}{{volume}}{{#number}}({{number}}){{/number}}{{/volume}}{{#page}}, {{page}}{{/page}}."},{label:"MLA-style citation",value:'{{authors_family.0}}, {{authors_given.0}}. "{{title}}." {{container-title}}, vol. {{volume}}, no. {{issue}}, {{year}}, pp. {{page}}.'},{label:"Chicago-style citation",value:'{{authors_family.0}}, {{authors_given.0}}. "{{title}}." {{container-title}} {{volume}}, no. {{issue}} ({{year}}): {{page}}. {{#DOI}}https://doi.org/{{DOI}}{{/DOI}}'},{label:"Harvard-style citation",value:'{{authors_family.0}}, {{authors_given.0|abbr1}}. {{#authors_family.1}}and {{authors_family.1}}, {{authors_given.1|abbr1}}. {{/authors_family.1}}({{year}}) "{{title}}", {{container-title}}, {{volume}}({{issue}}), pp. {{page}}.'},{label:"Vancouver-style citation",value:"{{authors_family.0}} {{authors_given.0|abbr1}}{{#authors_family.1}}, {{authors_family.1}} {{authors_given.1|abbr1}}{{/authors_family.1}}{{#authors_family.2}}, et al.{{/authors_family.2}} {{title}}. {{container-title}}. {{year}};{{volume}}({{issue}}):{{page}}."},{label:"-- Links and References --",value:""},{label:"PDF Link",value:"[[{{pdflink}}|{{title}} (PDF)]]"},{label:"HTML Link",value:"[[{{htmllink}}|{{title}} (HTML)]]"},{label:"All Attachments",value:`{{#attachments}}- {{.}}
{{/attachments}}`},{label:"Author List as Wiki Links",value:"{{#authors_family}}[[Author/{{.}}]]{{^@last}}, {{/@last}}{{/authors_family}}"},{label:"Numbered References List",value:`{{#attachments}}{{@number}}. {{.}}
{{/attachments}}`},{label:"DOI with Hover Link",value:'[{{DOI}}](https://doi.org/{{DOI}} "Click to open DOI")'},{label:"Publisher Info Link",value:"{{#publisher}}\u{1F3E2} [{{publisher}}](https://www.google.com/search?q={{publisher|lowercase}}){{/publisher}}"},{label:"-- Conditionals --",value:""},{label:"Conditional Abstract",value:"{{#abstract}}**Abstract**: {{abstract}}{{/abstract}}{{^abstract}}No abstract available{{/abstract}}"},{label:"Conditional Volume/Issue",value:"{{#volume}}Volume {{volume}}{{#issue}}, Issue {{issue}}{{/issue}}{{/volume}}{{^volume}}No volume information{{/volume}}"},{label:"Smart Attachment Link",value:"{{#pdflink}}\u{1F4C4} [[{{pdflink}}|PDF]]{{/pdflink}} {{#htmllink}}\u{1F310} [[{{htmllink}}|HTML]]{{/htmllink}}{{^pdflink}}{{^htmllink}}No attachments available{{/htmllink}}{{/pdflink}}"},{label:"Publication Type Badge",value:'{{#type}}{{#==="article-journal"}}*Article*{{/==="article-journal"}}{{#==="book"}}*Book*{{/==="book"}}{{#==="chapter"}}*Book Chapter*{{/==="chapter"}}{{#==="webpage"}}*Web Page*{{/==="webpage"}}{{/type}}'},{label:"Different by Author Count",value:"{{#authors_family.2}}Multiple authors ({{authors}}){{/authors_family.2}}{{^authors_family.2}}{{#authors_family.1}}Two authors ({{authors}}){{/authors_family.1}}{{^authors_family.1}}Single author ({{authors}}){{/authors_family.1}}{{/authors_family.2}}"},{label:"-- Text Formatting --",value:""},{label:"Title with capitalization",value:"{{title|capitalize}}"},{label:"Text in all uppercase",value:"{{title|uppercase}}"},{label:"Text in all lowercase",value:"{{title|lowercase}}"},{label:"Title case styling",value:"{{title|title}}"},{label:"Sentence case",value:"{{title|sentence}}"},{label:"Abstract truncated",value:"{{abstract|truncate:150}}"},{label:"Abstract with ellipsis",value:"{{abstract|ellipsis:150}}"},{label:"Trim whitespace",value:"{{title|trim}}"},{label:"Add prefix",value:"{{title|prefix:PAPER: }}"},{label:"Add suffix",value:"{{title|suffix: [READ THIS]}}"},{label:"Replace text",value:"{{abstract|replace:neural:AI}}"},{label:"Slice string",value:"{{title|slice:0:10}}..."},{label:"Pad with zeros",value:"{{month|pad:2:0}}/{{day|pad:2:0}}/{{year}}"},{label:"First letter only",value:"{{authors_given.0|abbr1}}. {{authors_family.0}}"},{label:"Multiple formats combined",value:"{{title|uppercase|truncate:20}}"},{label:"Name initials",value:"{{#authors_given}}{{.|abbr1}}.{{/authors_given}}"},{label:"-- Date Formatting --",value:""},{label:"ISO date format",value:"{{issued|date:iso}}"},{label:"Short date format",value:"{{issued|date:short}}"},{label:"Long date format",value:"{{issued|date:long}}"},{label:"Year only",value:"{{issued|date:year}}"},{label:"Month/day/year",value:"{{month|number|pad:2:0}}/{{day|number|pad:2:0}}/{{year}}"},{label:"Current date",value:"{{currentDate}}"},{label:"-- Number Formatting --",value:""},{label:"Format as number",value:"{{volume|number}}"},{label:"Number with decimals",value:"{{volume|number:2}}"},{label:"Count items in array",value:"Author count: {{authors_family|count}}"},{label:"-- URL and Collections --",value:""},{label:"URL encode",value:"{{title|urlencode}}"},{label:"Join array with delimiter",value:"{{authors_family|join: and }}"},{label:"Split string",value:"{{page|split:-}}"},{label:"Convert to JSON",value:"{{authors_raw|json}}"},{label:"-- Citekey Formats --",value:""},{label:"Author + year",value:"{{authors_family.0|lowercase}}{{year}}"},{label:"Author + coauthor initial + year",value:"{{authors_family.0|lowercase}}{{#authors_family.1}}{{authors_family.1|abbr1}}{{/authors_family.1}}{{year}}"},{label:"Author + year + title word",value:"{{authors_family.0|lowercase}}{{year}}{{title|titleword}}"},{label:"First 3 letters + year",value:"{{authors_family.0|abbr3}}{{year}}"},{label:"All initials + year",value:"{{#authors_family}}{{.|abbr1}}{{/authors_family}}{{year}}"},{label:"Author underscore year",value:"{{authors_family.0|lowercase}}_{{year}}"},{label:"Random string + year",value:"{{year}}_{{rand|5}}"},{label:"-- Frontmatter & Arrays --",value:""},{label:"Array with trailing commas",value:'[{{#authors}}"[[Author/{{.}}]]",{{/authors}}]'},{label:"Array with conditional commas",value:'[{{#authors_family}}{{^@first}},{{/@first}}"{{.}}"{{/authors_family}}]'},{label:"Fixed values array",value:'["{{title}}", "{{authors}} ({{year}})", "{{citekey}}"]'},{label:"Common mistake: No commas",value:'[{{#authors_family}}"{{.}}"{{/authors_family}}]'},{label:"Not an array: Dashed list",value:`{{#authors}}- [[Author/{{.}}]]
{{/authors}}`},{label:"Keywords as tags",value:'[{{#keywords}}{{^@first}},{{/@first}}"#{{.|lowercase}}"{{/keywords}}]'},{label:"Related concepts",value:'[{{#title|titleword}}"[[Concept/{{.|capitalize}}]]",{{/title|titleword}}{{#keywords}}{{^@first}},{{/@first}}"[[Concept/{{.|capitalize}}]]"{{/keywords}}]'},{label:"-- Callouts and Admonitions --",value:""},{label:"Abstract Callout",value:`> [!abstract] Abstract
> {{abstract}}`},{label:"Quote Callout",value:`> [!quote] Quote
> {{title}} ({{authors}}, {{year}})`},{label:"Info Callout",value:`> [!info] Metadata
> **Authors**: {{authors}}
> **Year**: {{year}}
> **Source**: {{container-title}}`},{label:"Warning Callout",value:`> [!warning] Important
> This citation has {{#DOI}}a DOI but {{/DOI}}{{^DOI}}no DOI, {{/DOI}}verify details before use.`},{label:"Multi-section Callouts",value:`> [!note] Publication
> {{container-title}} ({{year}})

> [!example] Citation
> {{authors_family.0}} et al. ({{year}}). {{title}}.

> [!tip] Related Topics
> - Topic 1
> - Topic 2`},{label:"-- Advanced Formatter Examples --",value:""},{label:"Citation with URL link",value:"{{authors}} ({{year}}). [{{title|sentence}}]({{#DOI}}https://doi.org/{{DOI}}{{/DOI}}{{^DOI}}{{URL}}{{/DOI}}) *{{container-title|sentence}}*, {{volume}}({{issue}}), {{page}}."},{label:"Formatted date string",value:"Published on {{day|pad:2:0}}/{{month|pad:2:0}}/{{year}} ({{issued|date:long}})"},{label:"Smart DOI link",value:'{{#DOI}}[Direct Link]({{DOI|prefix:https://doi.org/}} "Click to view publication"){{/DOI}}{{^DOI}}No DOI available{{/DOI}}'},{label:"Generate unique identifier",value:"{{citekey}}-{{rand|8}}"},{label:"Search-friendly tags",value:"#paper #{{year}} {{#keywords}}#{{.|lowercase|replace: :_}}{{/keywords}}"},{label:"Combined text operations",value:"{{abstract|truncate:100|replace:neural:AI|suffix:... [read more]}}"},{label:"-- Complete Templates --",value:""},{label:"Academic note",value:`# {{title}}

**Authors**: {{authors}}
**Year**: {{year}}
**Journal**: {{container-title}}
**DOI**: {{#DOI}}{{DOI}}{{/DOI}}{{^DOI}}N/A{{/DOI}}

{{#abstract}}## Abstract

{{abstract}}{{/abstract}}

## Attachments
{{#attachments}}- {{.}}
{{/attachments}}{{^attachments}}- No attachments available{{/attachments}}

## Key Points

- 

## Notes

`},{label:"Book note",value:`# {{title}}

**Author**: {{authors}}
**Year**: {{year}}
**Publisher**: {{publisher}}{{#publisher-place}}, {{publisher-place}}{{/publisher-place}}
**ISBN**: {{ISBN}}

{{#abstract}}## Summary

{{abstract}}{{/abstract}}

## Key Ideas

- 

## Quotes

> 

## Personal Reflections

`},{label:"Compact reference",value:`---
authors: {{authors}}
year: {{year}}
title: {{title}}
source: {{container-title}}
doi: {{DOI}}
tags: [literature, {{type}}]
---

# {{title}}

*{{authors}} ({{year}})*

{{#abstract}}{{abstract|ellipsis:300}}{{/abstract}}

## Highlights

- `},{label:"Zettelkasten note",value:`# {{citekey}}: {{title|capitalize}}

## Summary

{{#abstract}}{{abstract}}{{/abstract}}{{^abstract}}*No abstract available*{{/abstract}}

## Concepts

## Notes

- 

## Connections and Links
{{#DOI}}- DOI: [{{DOI}}](https://doi.org/{{DOI}})
{{/DOI}}{{#URL}}- URL: [Link]({{URL}})
{{/URL}}{{#attachments}}- {{.}}
{{/attachments}}

**Citation**: {{authors}} ({{year}}). {{title}}. {{container-title}}.`},{label:"Literature review entry",value:`# {{title}}

> [!info] Metadata
> - **Authors**: {{authors}}
> - **Year**: {{year}}
> - **Journal**: {{container-title}}
> - **DOI**: {{#DOI}}[{{DOI}}](https://doi.org/{{DOI}}){{/DOI}}{{^DOI}}N/A{{/DOI}}

> [!abstract] Abstract
> {{abstract}}

## Research Question

## Methodology

## Key Findings

## Limitations

## Application to My Research

## References
{{#attachments}}- {{.}}
{{/attachments}}`},{label:"Cornell notes style",value:`# {{title}} ({{year}})

> [!info] Metadata
> **Authors**: {{authors}}
> **Publication**: {{container-title}}

## Cues/Questions
- 
- 
- 

## Notes



## Summary

`},{label:"Scientific paper analysis",value:`# {{title}}

**Citation**: {{authors}} ({{year}}). {{title}}. *{{container-title}}*. {{#DOI}}https://doi.org/{{DOI}}{{/DOI}}

## IMRAD Structure

### Introduction
*What problem is being addressed?*


### Methods
*How did they study the problem?*


### Results
*What did they find?*


### Discussion
*What do the results mean?*


## Evaluation

### Strengths
- 

### Limitations
- 

### Future Research
- 

## Personal Notes

`}].forEach(g=>{let d=c.createEl("option",{value:g.value,text:g.label});g.value===""&&(d.disabled=!0,g.label.startsWith("--")?d.addClass("dropdown-section-header"):d.selected=!0)}),c.addEventListener("change",g=>{let d=g.target;d.value&&(this.templateField.setValue(d.value),this.updatePreview(),d.selectedIndex=0)});let f=this.container.createDiv({cls:"template-playground-preview-container"}),h=f.createDiv({cls:"template-playground-preview-header"});h.createEl("span",{text:"Preview:",cls:"template-playground-preview-label"}),h.createDiv({cls:"template-playground-sample-data"}).createEl("details",{},g=>{var C;g.createEl("summary",{text:"Sample data (click to expand)"});let d=g.createEl("div",{cls:"template-playground-data-container"}),v=d.createEl("div",{cls:"template-playground-tabs"}),b=d.createEl("div",{cls:"template-playground-tab-content"});[{id:"basic",label:"Basic",active:!0},{id:"authors",label:"Authors"},{id:"publishing",label:"Publishing"},{id:"attachments",label:"Attachments"},{id:"misc",label:"Other"}].forEach(A=>{let y=v.createEl("button",{text:A.label,cls:A.active?"tab-button active":"tab-button",attr:{"data-tab":A.id}});y.addEventListener("click",()=>{var k;let _=y.dataset.tab;v.querySelectorAll(".tab-button").forEach(Q=>{Q.removeClass("active")}),b.querySelectorAll(".tab-pane").forEach(Q=>{Q.removeClass("active")}),y.addClass("active"),(k=b.querySelector(`#${_}-tab`))==null||k.addClass("active")})}),b.createEl("div",{cls:"tab-pane active",attr:{id:"basic-tab"}}).createEl("code",{text:`id: "${this.sampleData.id}"
citekey: "${this.sampleData.citekey}"
title: "${this.sampleData.title}"
type: "${this.sampleData.type}"
year: ${this.sampleData.year}
month: ${this.sampleData.month}
day: ${this.sampleData.day}
currentDate: "${this.sampleData.currentDate}"
abstract: "${(C=this.sampleData.abstract)==null?void 0:C.substring(0,50)}..."`}),b.createEl("div",{cls:"tab-pane",attr:{id:"authors-tab"}}).createEl("code",{text:`authors: "${this.sampleData.authors}"
authors_family: ${JSON.stringify(this.sampleData.authors_family)}
authors_given: ${JSON.stringify(this.sampleData.authors_given)}
editors: ${JSON.stringify(this.sampleData.editors)}
editors_family: ${JSON.stringify(this.sampleData.editors_family)}
editors_given: ${JSON.stringify(this.sampleData.editors_given)}`}),b.createEl("div",{cls:"tab-pane",attr:{id:"publishing-tab"}}).createEl("code",{text:`container-title: "${this.sampleData["container-title"]}"
volume: ${this.sampleData.volume}
issue: ${this.sampleData.issue}
page: "${this.sampleData.page}"
publisher: "${this.sampleData.publisher}"
publisher-place: "${this.sampleData["publisher-place"]}"
DOI: "${this.sampleData.DOI}"
URL: "${this.sampleData.URL}"`}),b.createEl("div",{cls:"tab-pane",attr:{id:"attachments-tab"}}).createEl("code",{text:`pdflink: "${this.sampleData.raw_pdflink}"
htmllink: "${this.sampleData.htmllink}"
attachments: ${JSON.stringify(this.sampleData.attachments,null,2)}
quoted_attachments: ${JSON.stringify(this.sampleData.quoted_attachments,null,2)}`}),b.createEl("div",{cls:"tab-pane",attr:{id:"misc-tab"}}).createEl("code",{text:`language: "${this.sampleData.language}"
links: ${JSON.stringify(this.sampleData.links,null,2)}
linkPaths: ${JSON.stringify(this.sampleData.linkPaths,null,2)}
links_string: "${this.sampleData.links_string}"`})}),this.previewContent=f.createEl("div",{cls:"template-playground-preview-content"}),setTimeout(this.updatePreview.bind(this),50)}updatePreview(){try{let t=this.templateField.getValue(),r=this.getModeSpecificSampleData(this.currentMode);switch(this.currentMode){case"frontmatter":this.renderFrontmatterPreview(t,r);break;case"citekey":let i=Ae.render(t,r,{sanitizeForCitekey:!0});this.previewContent.empty(),this.previewContent.createEl("div",{cls:"template-playground-rendered citekey-rendering",text:i});break;case"normal":default:let s=Ae.render(t,r);this.previewContent.empty(),this.previewContent.createEl("div",{cls:"template-playground-rendered",text:s});break}}catch(t){this.previewContent.empty(),this.previewContent.createEl("div",{text:`Error: ${t.message}`,cls:"template-playground-error"})}}getModeSpecificSampleData(t){let r="normal";switch(t){case"frontmatter":r="frontmatter";break;case"citekey":r="citekey";break;case"normal":default:r="normal";break}return Jr.getModeSpecificSampleData(r,this.sampleData)}renderFrontmatterPreview(t,r){try{let i=t.trim().startsWith("[")&&t.trim().endsWith("]"),s=Ae.render(t,r,{yamlArray:i});this.previewContent.empty();let a=this.previewContent.createDiv({cls:"template-playground-rendered"});a.createEl("pre",{cls:"frontmatter-preview-code"}).createEl("code",{text:`---
field: ${t.trim()}
---
`});let n=this.previewContent.createDiv({cls:"yaml-preview-container"});n.createEl("h4",{text:"How frontmatter handles this template:",cls:"yaml-preview-heading"});let o=sl(t,s),{yamlRepresentation:u,yamlBehaviorExplanation:c}=o,p=a.querySelector("code");p&&(p.textContent=u),n.createEl("div",{cls:"yaml-preview-explanation"}).createEl("p",{text:c});let h=n.createEl("div",{cls:"yaml-preview-biblib-note"});h.createEl("h4",{text:"Creating Arrays in BibLib:"});let m=h.createEl("div",{cls:"yaml-guide-container"});m.createEl("p",{text:"To create arrays in BibLib templates, use the JSON array format with square brackets, commas, and quotes:",cls:"biblib-array-explanation"});let g=m.createEl("div",{cls:"yaml-example-container"});g.createEl("p",{text:"Working array template:"}),g.createEl("pre",{},v=>{v.createEl("code",{text:'[{{#authors}}"[[Author/{{.}}]]",{{/authors}}]'})}),g.createEl("p",{text:"Renders correctly in frontmatter:"}),g.createEl("pre",{},v=>{v.createEl("code",{text:'author-links: ["[[Author/John Smith]]","[[Author/Maria Rodriguez]]","[[Author/Wei Zhang]]"]'})}),m.createEl("h5",{text:"Common Mistake:",cls:"yaml-method-heading"});let d=m.createEl("div",{cls:"yaml-example-container"});d.createEl("p",{text:"Using dash prefixes will NOT automatically create arrays:"}),d.createEl("pre",{},v=>{v.createEl("code",{text:`{{#authors}}- [[Author/{{.}}]]
{{/authors}}`})}),d.createEl("p",{text:"This renders as multi-line text, not an array:"}),d.createEl("pre",{},v=>{v.createEl("code",{text:`author-links: |
  - [[Author/John Smith]]
  - [[Author/Maria Rodriguez]]
  - [[Author/Wei Zhang]]`})})}catch(i){this.previewContent.empty(),this.previewContent.createEl("div",{text:`Error: ${i.message}`,cls:"template-playground-error"})}}};var Qi=class extends V.PluginSettingTab{constructor(r,i){super(r,i);this.activeTab="general";this.plugin=i}createFragment(r){let i=document.createDocumentFragment();return r(i),i}createListItem(r,i,s){r.createEl("li",{},a=>{a.createEl("code",{text:i}),s&&a.appendText(` - ${s}`)})}createTemplateExample(r,i,s,a){let n=r.createDiv({cls:"template-example-item"});new V.Setting(n).setName(i).setHeading().setClass("template-example-title"),a&&n.createEl("p",{text:a,cls:"template-example-description"}),n.createEl("pre",{cls:"template-example-code"}).createEl("code",{text:s}),n.createDiv({cls:"template-example-actions"}).createEl("button",{cls:"template-example-copy-button",text:"Use this template"}).addEventListener("click",()=>{this.plugin.settings&&(this.plugin.settings.headerTemplate=s,this.plugin.saveSettings(),this.display(),new V.Notice("Template applied successfully!",2e3))})}createTableRow(r,i,s=!1){r.createEl("tr",{},a=>{i.forEach(n=>{let o=s?"th":"td";a.createEl(o,{},u=>{n.includes("{{")||n.includes("|")||n.includes("`")||n.startsWith("[")?u.createEl("code",{text:n}):u.appendText(n)})})})}createTooltip(r,i){return this.createFragment(s=>{s.appendText(r)})}addHelperText(r,i){var s;(s=r.inputEl.parentElement)==null||s.createDiv({cls:"setting-item-description setting-helper-text",text:i})}enhanceZoteroSettings(){}enhanceBibliographySettings(){}display(){let{containerEl:r}=this;r.empty(),this.createTabNavigation(r);let i=r.createDiv({cls:"biblib-settings-container"});this.renderActiveTab(i),setTimeout(()=>{this.enhanceFilePathSettings(),this.enhanceCitekeySettings(),V.Platform.isMobile||this.enhanceZoteroSettings(),this.enhanceBibliographySettings()},50)}createTabNavigation(r){let i=r.createDiv({cls:"biblib-tab-navigation"}),s=[{id:"general",name:"General"},{id:"files",name:"File Organization"},{id:"templates",name:"Templates"},{id:"citekeys",name:"Citation Keys"},{id:"fields",name:"Custom Fields"},{id:"modal",name:"Modal Configuration"},{id:"zotero",name:"Zotero Integration"},{id:"export",name:"Bibliography Export"}];(V.Platform.isMobile?s.filter(n=>n.id!=="zotero"):s).forEach(n=>{i.createEl("button",{cls:`biblib-tab-button ${this.activeTab===n.id?"active":""}`,text:n.name}).addEventListener("click",()=>{this.activeTab=n.id,this.display()})})}renderActiveTab(r){switch(this.activeTab){case"general":this.renderGeneralSettings(r);break;case"files":this.renderFilePathSettings(r);break;case"templates":this.renderTemplatesSection(r);break;case"citekeys":this.renderCitekeyGenerationSection(r);break;case"fields":this.renderCustomFrontmatterFieldsSection(r),this.renderFavoriteLanguagesSection(r);break;case"modal":this.renderDefaultModalFieldsSection(r),this.renderEditModalSettingsSection(r);break;case"zotero":V.Platform.isMobile||this.renderZoteroConnectorSection(r);break;case"export":this.renderBibliographyBuilderSection(r);break;default:this.renderGeneralSettings(r);break}}renderGeneralSettings(r){new V.Setting(r).setName("Literature note tag").setDesc("Tag used to identify literature notes in frontmatter").addText(i=>i.setValue(this.plugin.settings.literatureNoteTag).onChange(async s=>{this.plugin.settings.literatureNoteTag=s.trim(),await this.plugin.saveSettings()})),new V.Setting(r).setName("Open note on create").setDesc("Automatically open a newly created literature note in the workspace").addToggle(i=>i.setValue(this.plugin.settings.openNoteOnCreate).onChange(async s=>{this.plugin.settings.openNoteOnCreate=s,await this.plugin.saveSettings()}))}enhanceFilePathSettings(){}renderFilePathSettings(r){new V.Setting(r).setName("File organization").setHeading(),new V.Setting(r).setName("Attachment folder path").setDesc(this.createTooltip("The folder where attachment files (PDFs, EPUBs, and other file types) will be stored. Use forward slashes for subfolders.","This path is relative to your vault root. Attachments will be copied here when importing.")).addText(n=>n.setPlaceholder("biblib").setValue(this.plugin.settings.attachmentFolderPath).onChange(async o=>{o=(0,V.normalizePath)(o.trim()),this.plugin.settings.attachmentFolderPath=o,await this.plugin.saveSettings()})),new V.Setting(r).setName("Create subfolder for attachments").setDesc("Create a subfolder for each citation (e.g., biblib/citation-key/citation-key.pdf)").addToggle(n=>n.setValue(this.plugin.settings.createAttachmentSubfolder).onChange(async o=>{this.plugin.settings.createAttachmentSubfolder=o,await this.plugin.saveSettings()})),new V.Setting(r).setName("Literature note location").setDesc('The folder where literature notes will be stored. Use forward slashes for subfolders. Use "/" for vault.').addText(n=>n.setPlaceholder("/").setValue(this.plugin.settings.literatureNotePath).onChange(async o=>{o=(0,V.normalizePath)(o.trim()),o!=="/"&&!o.endsWith("/")&&(o+="/"),this.plugin.settings.literatureNotePath=o,await this.plugin.saveSettings()}));let i=r.createDiv(),s=null;new V.Setting(i).setName("Filename template").setDesc("Template for generating literature note filenames. Uses the same template system as headers and frontmatter.").addTextArea(n=>(s=n.setPlaceholder("@{{citekey}}").setValue(this.plugin.settings.filenameTemplate).onChange(async o=>{this.plugin.settings.filenameTemplate=o,await this.plugin.saveSettings()}),s)).addExtraButton(n=>n.setIcon("reset").setTooltip("Reset to default").onClick(async()=>{this.plugin.settings.filenameTemplate="@{{citekey}}",await this.plugin.saveSettings(),this.display()})),i.createDiv({cls:"template-examples-container"}).createEl("details",{},n=>{n.createEl("summary",{text:"Common filename patterns"});let o=n.createEl("ul");this.createListItem(o,"@{{citekey}}","Standard citekey with @ prefix"),this.createListItem(o,"{{year}}-{{citekey}}","Year and citekey (2023-smith)"),this.createListItem(o,"{{type}}/{{citekey}}","Type-based folders (article/smith2023)"),this.createListItem(o,"{{citekey}} - {{title|capitalize}}","Citekey with title"),this.createListItem(o,"Lit/{{authors_family.0|lowercase}}_{{year}}","Custom prefix with author and year")})}renderCustomFrontmatterFieldsSection(r){new V.Setting(r).setName("Custom frontmatter").setHeading();let i=r.createEl("div",{cls:"setting-item-description"});i.createEl("p",{text:"Define custom frontmatter fields with templated values. These will be added to new literature notes."}),i.createEl("p",{},a=>{a.createEl("strong",{text:"Warning: "}),a.appendText("Do not define templates for CSL-standard fields, as doing so may produce invalid bibliography files. "),a.createEl("a",{text:"See the CSL specification",href:"https://docs.citationstyles.org/en/stable/specification.html#appendix-iv-variables"}),a.appendText(" for a list of standard variables.")});let s=r.createDiv({cls:"custom-frontmatter-fields-container"});this.plugin.settings.customFrontmatterFields&&this.plugin.settings.customFrontmatterFields.forEach(a=>{this.addCustomFieldRow(a,s)}),new V.Setting(r).setName("Add custom frontmatter field").addButton(a=>a.setButtonText("Add field").onClick(async()=>{let n={name:"",template:"",enabled:!0};this.plugin.settings.customFrontmatterFields||(this.plugin.settings.customFrontmatterFields=[]),this.plugin.settings.customFrontmatterFields.push(n),await this.plugin.saveSettings(),this.addCustomFieldRow(n,s)}))}addCustomFieldRow(r,i){let s=i.createDiv({cls:"custom-frontmatter-field"}),a=g=>Ke.has(g),n,o=s.createDiv({cls:"custom-field-warning",attr:{style:"display: none;"}}),u=g=>{var d;if(a(g)){o.empty();let v=o.createDiv({cls:"callout callout-error"});v.createDiv({cls:"callout-title",text:"\u274C CSL Field Conflict"});let b=v.createDiv({cls:"callout-content"});(d=b.createEl("p").createEl("strong",{text:`"${g}"`}).parentElement)==null||d.appendText(" is a standard CSL field and should not be used for custom frontmatter templates."),b.createEl("p",{text:"Using CSL fields in custom templates may cause:"});let E=b.createEl("ul");E.createEl("li",{text:"Conflicts with bibliography export tools"}),E.createEl("li",{text:"Invalid CSL-JSON output"}),E.createEl("li",{text:"Unexpected template behavior"}),b.createEl("p",{text:`Please choose a different field name (e.g., "custom-${g}", "${g}-note", etc.)`}),b.createEl("p").createEl("a",{text:"View CSL specification \u2192",href:"https://docs.citationstyles.org/en/stable/specification.html#appendix-iv-variables",attr:{target:"_blank"}}),o.removeClass("warning-hidden"),o.addClass("warning-visible"),o.style.display="block"}else o.removeClass("warning-visible"),o.addClass("warning-hidden"),o.style.display="none"},c=s.createDiv({cls:"custom-frontmatter-field-header"});new V.Setting(c).addToggle(g=>g.setValue(r.enabled).onChange(async d=>{r.enabled=d,await this.plugin.saveSettings()})).setName("Enabled").setDesc("Include this field in new literature notes").addExtraButton(g=>g.setIcon("trash").setTooltip("Delete field").onClick(async()=>{this.plugin.settings.customFrontmatterFields=this.plugin.settings.customFrontmatterFields.filter(d=>d!==r),await this.plugin.saveSettings(),s.remove()}));let f=s.createDiv();f.createEl("label",{text:"Field name",cls:"setting-item-name"}),n=f.createEl("input",{type:"text",cls:"custom-frontmatter-field-name",attr:{placeholder:"Field name (e.g., tags, keywords)",value:r.name}}),n.addEventListener("change",async g=>{let d=g.target.value;a(d)?(n.addClass("is-invalid"),new V.Notice(`"${d}" is a CSL standard field. Using it may produce invalid bibliography files.`,5e3),u(d)):(n.removeClass("is-invalid"),o.removeClass("warning-visible"),o.addClass("warning-hidden")),r.name=d,await this.plugin.saveSettings()}),r.name&&a(r.name)&&(n.addClass("is-invalid"),u(r.name)),f.appendChild(o);let h=s.createDiv({cls:"custom-frontmatter-template-container"});h.createEl("label",{text:"Template",cls:"setting-item-name"}),h.createEl("div",{text:"Define the template for this frontmatter field.",cls:"setting-item-description"});let m=h.createEl("textarea",{cls:"custom-frontmatter-field-textarea",attr:{placeholder:"Template (e.g., {{authors|capitalize}})",rows:6}});return m.value=r.template,m.addEventListener("change",async g=>{let d=g.target.value;r.template=d,await this.plugin.saveSettings()}),s}addSettingHelpText(r,i){document.querySelectorAll(".setting-item").forEach(s=>{let a=s.querySelector(".setting-item-name");if(a&&a.textContent===r){let n=s.querySelector(".setting-item-description");if(n){let o=document.createElement("div");o.className="setting-helper-text",o.textContent=i,n.appendChild(o)}}})}enhanceCitekeySettings(){}renderCitekeyGenerationSection(r){new V.Setting(r).setName("Citation keys").setHeading(),r.createEl("p",{text:"Configure how citekeys are generated for new literature notes.",cls:"setting-item-description"});let i=r.createDiv(),s=null;new V.Setting(i).setName("Citekey template").setDesc(this.createTooltip("Define the pattern for automatically generated citation keys.","Citation keys are unique identifiers used for referencing sources in academic writing. They are typically composed of author names, year, and sometimes title elements.")).addTextArea(n=>(s=n.setPlaceholder("{{authors_family.0|lowercase}}{{year}}").setValue(this.plugin.settings.citekeyOptions.citekeyTemplate).onChange(async o=>{this.plugin.settings.citekeyOptions.citekeyTemplate=o.trim(),await this.plugin.saveSettings()}),s)).addExtraButton(n=>n.setIcon("reset").setTooltip("Reset to default").onClick(async()=>{this.plugin.settings.citekeyOptions.citekeyTemplate="{{authors_family.0|lowercase}}{{year}}",await this.plugin.saveSettings(),this.display()})),i.createDiv({cls:"template-examples-container"}).createEl("details",{},n=>{n.createEl("summary",{text:"Common citekey patterns"});let o=n.createEl("ul");this.createListItem(o,"{{authors_family.0|lowercase}}{{year}}","Basic author+year format (smith2023)"),this.createListItem(o,"{{authors_family.0|abbr3}}{{year}}","First 3 letters of author + year (smi2023)"),this.createListItem(o,"{{authors_family.0|lowercase}}{{year}}{{title|titleword}}","Author, year, and first significant title word"),this.createListItem(o,"{{authors_family.0|lowercase}}{{#authors_family.1}}{{authors_family.1|abbr1}}{{/authors_family.1}}{{year}}","First author + initial of second author if present"),this.createListItem(o,"{{authors_family.0|lowercase}}_{{authors_family.1|lowercase}}_{{year}}","Multiple authors with underscores")}),new V.Setting(r).setName("Use Zotero keys (if available)").setDesc("When importing from Zotero, use their citekey instead of generating one using the template above.").addToggle(n=>n.setValue(this.plugin.settings.citekeyOptions.useZoteroKeys).onChange(async o=>{this.plugin.settings.citekeyOptions.useZoteroKeys=o,await this.plugin.saveSettings()})),new V.Setting(r).setName("Minimum citekey length").setDesc("Add a random suffix to citekeys shorter than this length").addSlider(n=>n.setLimits(3,10,1).setValue(this.plugin.settings.citekeyOptions.minCitekeyLength).setDynamicTooltip().onChange(async o=>{this.plugin.settings.citekeyOptions.minCitekeyLength=o,await this.plugin.saveSettings()}))}renderTemplatesSection(r){new V.Setting(r).setName("Templates").setHeading(),r.createEl("div",{cls:"setting-item-description"}).createEl("p",{text:"BibLib uses a powerful template system across all content. Templates use a Mustache-like syntax for literature notes, filenames, and frontmatter fields."});let s=r.createDiv({cls:"template-guide-container",attr:{style:"margin-top: 16px; margin-bottom: 24px;"}});new V.Setting(s).setName("Template System Guide").setHeading();let a=s.createEl("details");a.createEl("summary",{text:"Template system guide (Click to expand)"});let n=a.createEl("div",{cls:"template-variables-list"});n.createEl("p",{text:"The template system supports variable replacement, formatting options, conditionals, and loops."}),new V.Setting(n).setName("Basic variables").setHeading();let o=n.createEl("ul");this.createListItem(o,"{{title}}","Title of the work"),this.createListItem(o,"{{citekey}}","Citation key"),this.createListItem(o,"{{year}}, {{month}}, {{day}}","Publication date parts"),this.createListItem(o,"{{container-title}}","Journal or book title containing the work"),this.createListItem(o,"{{authors}}",'List of authors (formatted as "J. Smith et al." for 3+ authors, full names in arrays)'),this.createListItem(o,"{{authors_family}}",'Array of author family names (["Smith", "Jones", ...])'),this.createListItem(o,"{{authors_given}}",'Array of author given names (["John", "Maria", ...])'),this.createListItem(o,"{{pdflink}}","Array of attachment file paths"),this.createListItem(o,"{{attachments}}","Array of formatted attachment links (e.g., [[file.pdf|PDF]])"),this.createListItem(o,"{{DOI}}, {{URL}}","Digital identifiers"),this.createListItem(o,"{{currentDate}}","Today's date (YYYY-MM-DD)"),new V.Setting(n).setName("Special array variables").setHeading(),n.createEl("p",{text:"These variables are arrays that can be used with loop syntax:"});let u=n.createEl("ul");this.createListItem(u,"{{authors}}, {{authors_family}}, {{authors_given}}","Author information arrays"),this.createListItem(u,"{{editors}}, {{translators}}, etc.","Other contributor role arrays (when present)"),this.createListItem(u,"{{pdflink}}, {{attachments}}","Attachment path and link arrays"),this.createListItem(u,"{{links}}","Array of links to related notes"),new V.Setting(n).setName("Creating arrays in frontmatter").setHeading(),n.createEl("p",{text:"To create YAML arrays in frontmatter templates, use JSON array syntax with square brackets:"});let c=n.createEl("ul");this.createListItem(c,'[{{#authors}}"[[Author/{{.}}]]",{{/authors}}]','Creates array like ["[[Author/John Smith]]", "[[Author/Maria Jones]]"]'),this.createListItem(c,'[{{#authors_family}}{{^@first}},{{/@first}}"{{.}}"{{/authors_family}}]',"Array with commas between items (no trailing comma)"),this.createListItem(c,'["{{title}}", {{#DOI}}"{{DOI}}",{{/DOI}} "{{year}}"]',"Fixed array with conditional elements"),n.createEl("p",{text:"Important: Arrays must be valid JSON to be processed correctly. Common issues to avoid:"});let p=n.createEl("ul");this.createListItem(p,"Trailing commas",'Example: ["item1", "item2",] - the last comma breaks the array'),this.createListItem(p,"Missing quotes",'All text items must be quoted: ["ok"] not [ok]'),this.createListItem(p,"Unbalanced brackets","Ensure opening [ has a matching closing ]"),this.createListItem(p,"Use {{^@first}}, {{/@first}} to add commas only between items, not after the last item",""),n.createEl("p",{text:"Use the Template Playground in YAML mode to test your array templates."}),new V.Setting(n).setName("Formatting options").setHeading(),n.createEl("p",{text:"You can format any variable using pipe syntax:"});let f=n.createEl("ul");this.createListItem(f,"{{variable|uppercase}}","ALL UPPERCASE"),this.createListItem(f,"{{variable|lowercase}}","all lowercase"),this.createListItem(f,"{{variable|capitalize}}","Capitalize First Letter Of Each Word"),this.createListItem(f,"{{title|titleword}}","Extract first significant word from title"),new V.Setting(n).setName("Conditionals and loops").setHeading();let h=n.createEl("ul");this.createListItem(h,"{{#variable}}Content shown if variable exists{{/variable}}","Positive conditional"),this.createListItem(h,"{{^variable}}Content shown if variable is empty{{/variable}}","Negative conditional"),this.createListItem(h,"{{#array}}{{.}} is the current item{{/array}}","Loop through arrays ({{.}} refers to current item)"),this.createListItem(h,"{{#array}}{{^@first}}, {{/@first}}{{.}}{{/array}}","Using array position metadata (@first, @last, etc.)"),new V.Setting(n).setName("Loop position metadata").setHeading(),n.createEl("p",{text:"When iterating through arrays, you can use these special variables to control formatting:"});let m=n.createEl("ul");this.createListItem(m,"{{@index}}","Zero-based index (0, 1, 2, ...)"),this.createListItem(m,"{{@number}}","One-based index (1, 2, 3, ...)"),this.createListItem(m,"{{@first}}","Boolean - true if first item"),this.createListItem(m,"{{@last}}","Boolean - true if last item"),this.createListItem(m,"{{@odd}}","Boolean - true for odd-indexed items (1, 3, 5, ...)"),this.createListItem(m,"{{@even}}","Boolean - true for even-indexed items (0, 2, 4, ...)"),this.createListItem(m,"{{@length}}","Total length of the array being iterated"),n.createEl("p",{text:"Example using position metadata:"}),n.createEl("pre",{},T=>{T.createEl("code",{text:`{{#authors}}
  {{@number}}. {{.}}{{^@last}},{{/@last}}{{#@last}}.{{/@last}}
{{/authors}}`})}),n.createEl("p",{text:'Would produce: "1. John Smith, 2. Maria Rodriguez, 3. Wei Zhang."'}),new V.Setting(n).setName("Accessing nested data").setHeading(),n.createEl("p",{text:"Use dot notation to access nested properties and array items:"});let g=n.createEl("ul");this.createListItem(g,"{{authors_family.0}}","First author family name"),this.createListItem(g,"{{issued.date-parts.0.0}}","Year from nested CSL date structure"),this.createListItem(g,"{{#authors}}{{#@first}}First author: {{.}}{{/@first}}{{/authors}}","Conditional within a loop"),n.createEl("p",{},T=>{T.appendText("See the ");let I=T.createEl("a",{text:"full documentation",href:"https://callumalpass.github.io/obsidian-biblib"});T.appendText(" for more details on the template system.")});let d=r.createDiv({cls:"template-playground-wrapper"});new V.Setting(d).setName("Template Playground").setHeading(),d.createEl("p",{text:"Try out different templates and see the results instantly with sample data.",cls:"setting-item-description"}),new ki(d);let v=r.createDiv({cls:"template-settings-container"});new V.Setting(v).setName("Note templates").setHeading(),v.createEl("p",{text:"Configure templates used to generate literature notes.",cls:"setting-item-description"});let b=v.createDiv(),E=null;new V.Setting(b).setName("Note content template").setDesc("Template for the entire note body content. Define the complete structure of your literature notes here including headings, sections, and references. Frontmatter is configured separately.").addExtraButton(T=>T.setIcon("reset").setTooltip("Reset to default").onClick(async()=>{this.plugin.settings.headerTemplate="# {{#title}}{{title}}{{/title}}{{^title}}{{citekey}}{{/title}}",await this.plugin.saveSettings(),this.display()}));let w=b.createDiv({cls:"template-textarea-container"});E=new V.TextAreaComponent(w),E.setPlaceholder(`# {{title}}

## Summary

## Key points

## References
{{#pdflink}}[[{{pdflink}}]]{{/pdflink}}`).setValue(this.plugin.settings.headerTemplate).onChange(async T=>{this.plugin.settings.headerTemplate=T,await this.plugin.saveSettings()}),b.createDiv({cls:"template-examples-container"}).createEl("details",{cls:"template-examples-details"},T=>{T.createEl("summary",{text:"Note template examples"});let I=T.createDiv({cls:"note-template-examples-container"});this.createTemplateExample(I,"Simple title only","# {{title}}","A minimal example that just displays the work's title as a top-level heading."),this.createTemplateExample(I,"Title with year and authors",`# {{title}} ({{year}})

*{{authors}}*`,"Adds the publication year in parentheses and the authors in italics below the title."),this.createTemplateExample(I,"Title with abstract section",`# {{title}}

## Abstract

{{abstract}}`,"Includes the abstract in its own section for academic references."),this.createTemplateExample(I,"Comprehensive note structure",`# {{title}}

## Metadata
- **Authors**: {{authors}}
- **Year**: {{year}}
- **Journal**: {{container-title}}

## Notes

## Key points

## References
{{#DOI}}DOI: {{DOI}}{{/DOI}}`,"A full note structure with metadata section and placeholder headings for notes and key points."),this.createTemplateExample(I,"Research note with quotes section",`# {{title}}

## Summary

## Quotes

## Thoughts

## References
{{#pdflink}}\u{1F4C4} [[{{pdflink}}]]{{/pdflink}}
{{#URL}}\u{1F517} [Source]({{URL}}){{/URL}}`,"Organized for research with sections for quotes, personal thoughts, and reference links."),this.createTemplateExample(I,"Note with drawing canvas",`# {{citekey}}: {{title}}

![[{{citekey}}.excalidraw]]

## Notes

## References
{{#attachments}}{{.}}
{{/attachments}}`,"Includes an excalidraw canvas for visual note-taking, named after the citekey."),this.createTemplateExample(I,"Zettelkasten-style note",`# {{citekey}} - {{title|capitalize}}

## Summary

## Concepts

## Fleeting Notes

## Permanent Notes
- 

## Links
- Related: 
{{#keywords}}{{#.}}- #{{.}}
{{/.}}{{/keywords}}

## References
{{#DOI}}DOI: {{DOI}}{{/DOI}}
{{#URL}}URL: {{URL}}{{/URL}}
{{#authors}}{{#@first}}{{.}} {{year}}{{/@first}}{{/authors}}`,"Structured for Zettelkasten method with sections for fleeting and permanent notes, and concept linking."),this.createTemplateExample(I,"Literature review format",`# {{title}}

**Authors:** {{authors}}
**Year:** {{year}}
**Journal:** {{container-title}}
**Keywords:** {{#keywords}}{{.}}{{^@last}}, {{/@last}}{{/keywords}}

## Problem Statement

## Methodology

## Key Findings

## Limitations

## Future Research

## Relevance to My Research

## Citation
\`\`\`
{{authors_family.0}} et al. ({{year}}). {{title}}. {{container-title}}. {{#DOI}}https://doi.org/{{DOI}}{{/DOI}}
\`\`\``,"Comprehensive template for academic literature reviews with structured analysis sections."),this.createTemplateExample(I,"Cornell notes method",`# {{title}} ({{year}})

> [!cue] Cues
> - Key concepts
> - Main questions
> - Terminology

## Notes



> [!summary] Summary
> 

## Metadata
- **Authors**: {{authors}}
- **Publication**: {{container-title}}
- **Link**: {{#DOI}}https://doi.org/{{DOI}}{{/DOI}}{{^DOI}}{{#URL}}{{URL}}{{/URL}}{{/DOI}}`,"Based on the Cornell note-taking method with cues on the left and summary at the bottom."),this.createTemplateExample(I,"Callout-based template",`# {{title}}

> [!info] Metadata
> - **Authors**: {{authors}}
> - **Year**: {{year}}
> - **Journal**: {{container-title}}
> - **DOI**: {{#DOI}}{{DOI}}{{/DOI}}

> [!abstract] Abstract
> {{abstract}}

> [!quote] Key Quotes
> 

> [!note] Notes
> 

> [!example] Examples
> 

> [!success] Strengths
> 

> [!failure] Weaknesses
> 

> [!question] Questions
> 

> [!tip] Applications
> `,"Uses Obsidian callouts to organize different aspects of literature notes with visual distinction.")})}renderZoteroConnectorSection(r){new V.Setting(r).setName("Zotero integration").setHeading(),r.createEl("p",{text:"Configure settings for the Zotero Connector integration. Note: This feature is only available on desktop.",cls:"setting-item-description"}),new V.Setting(r).setName("Enable Zotero Connector").setDesc("Allow the plugin to receive data from the Zotero Connector browser extension. Note: Zotero should NOT be running when using this feature.").addToggle(a=>a.setValue(this.plugin.settings.enableZoteroConnector).onChange(async n=>{this.plugin.settings.enableZoteroConnector=n,await this.plugin.saveSettings(),n?this.plugin.startConnectorServer():this.plugin.stopConnectorServer()})),new V.Setting(r).setName("Connector port").setDesc("The port to use for the Zotero Connector server. Default is 23119, which is the standard Zotero port.").addText(a=>{var n;return a.setPlaceholder("23119").setValue(((n=this.plugin.settings.zoteroConnectorPort)==null?void 0:n.toString())||"23119").onChange(async o=>{let u=parseInt(o.trim());!isNaN(u)&&u>0&&u<65536&&(this.plugin.settings.zoteroConnectorPort=u,await this.plugin.saveSettings(),this.plugin.settings.enableZoteroConnector&&(this.plugin.stopConnectorServer(),this.plugin.startConnectorServer()))})}),new V.Setting(r).setName("Temporary PDF folder").setDesc("Optional: Specify a custom folder for temporarily storing PDFs downloaded from Zotero. Leave empty to use the system temp directory.").addText(a=>a.setPlaceholder("System temp directory").setValue(this.plugin.settings.tempPdfPath||"").onChange(async n=>{this.plugin.settings.tempPdfPath=n.trim(),await this.plugin.saveSettings()}));let i=r.createEl("div",{cls:"setting-item-description"});new V.Setting(i).setName("How to use the Zotero Connector").setHeading();let s=i.createEl("ol");s.createEl("li",{},a=>{a.appendText("Make sure Zotero desktop application is "),a.createEl("strong",{text:"NOT"}),a.appendText(" running")}),s.createEl("li",{text:"Enable the Zotero Connector option above"}),s.createEl("li",{text:"Use the Zotero Connector browser extension as normal"}),s.createEl("li",{text:"When saving an item, the Zotero Connector will send the data to Obsidian instead of Zotero"}),s.createEl("li",{text:"The bibliography modal will open with the data pre-filled"}),s.createEl("li",{text:"Any PDF attachments will be downloaded and automatically linked"}),i.createEl("p",{text:'Note: You can toggle this feature with the "Toggle Zotero Connector server" command.'})}renderFavoriteLanguagesSection(r){new V.Setting(r).setName("Favorite languages").setHeading(),r.createEl("p",{text:"Configure frequently used languages to appear at the top of language dropdowns in modals.",cls:"setting-item-description"});let i=r.createDiv({cls:"favorite-languages-container"});this.plugin.settings.favoriteLanguages&&this.plugin.settings.favoriteLanguages.forEach((s,a)=>{this.addFavoriteLanguageRow(s,a,i)}),new V.Setting(r).setName("Add favorite language").addButton(s=>s.setButtonText("Add language").onClick(async()=>{let a={code:"",name:""};this.plugin.settings.favoriteLanguages||(this.plugin.settings.favoriteLanguages=[]),this.plugin.settings.favoriteLanguages.push(a),await this.plugin.saveSettings(),this.addFavoriteLanguageRow(a,this.plugin.settings.favoriteLanguages.length-1,i)}))}addFavoriteLanguageRow(r,i,s){let a=s.createDiv({cls:"favorite-language-row"});new V.Setting(a).setName("").addText(n=>n.setPlaceholder("Language code (e.g., en, nb, fi)").setValue(r.code).onChange(async o=>{this.plugin.settings.favoriteLanguages[i].code=o.trim(),await this.plugin.saveSettings()})).addText(n=>n.setPlaceholder("Language name (e.g., English, Norwegian)").setValue(r.name).onChange(async o=>{this.plugin.settings.favoriteLanguages[i].name=o.trim(),await this.plugin.saveSettings()})).addButton(n=>n.setIcon("up-chevron-glyph").setTooltip("Move up").setDisabled(i===0).onClick(async()=>{if(i>0){let o=this.plugin.settings.favoriteLanguages;[o[i-1],o[i]]=[o[i],o[i-1]],await this.plugin.saveSettings(),this.display()}})).addButton(n=>n.setIcon("down-chevron-glyph").setTooltip("Move down").setDisabled(i===this.plugin.settings.favoriteLanguages.length-1).onClick(async()=>{if(i<this.plugin.settings.favoriteLanguages.length-1){let o=this.plugin.settings.favoriteLanguages;[o[i],o[i+1]]=[o[i+1],o[i]],await this.plugin.saveSettings(),this.display()}})).addButton(n=>n.setIcon("trash").setTooltip("Remove").onClick(async()=>{this.plugin.settings.favoriteLanguages.splice(i,1),await this.plugin.saveSettings(),a.remove()}))}renderDefaultModalFieldsSection(r){new V.Setting(r).setName("Default modal fields").setHeading();let i=r.createEl("div",{cls:"setting-item-description"});i.createEl("p",{text:'Configure which CSL-compliant fields appear as primary inputs in the "Create literature note" modal.'}),i.createEl("p",{text:"This is useful for workflows that frequently use specific fields (e.g., archival research needing archive, archive-place, archive_location)."});let s=r.createDiv({cls:"default-modal-fields-container"});this.plugin.settings.defaultModalFields&&this.plugin.settings.defaultModalFields.forEach((a,n)=>{this.addDefaultModalFieldRow(a,n,s)}),new V.Setting(r).setName("Add default modal field").addButton(a=>a.setButtonText("Add field").onClick(async()=>{let n={name:"",label:"",type:"text",description:"",placeholder:"",required:!1,defaultValue:""};this.plugin.settings.defaultModalFields||(this.plugin.settings.defaultModalFields=[]),this.plugin.settings.defaultModalFields.push(n),await this.plugin.saveSettings(),this.addDefaultModalFieldRow(n,this.plugin.settings.defaultModalFields.length-1,s)}))}detectFieldType(r){return Vr.includes(r)?"date":Hr.includes(r)?"number":r==="abstract"||r==="note"||r==="annote"?"textarea":"text"}addDefaultModalFieldRow(r,i,s){let a=s.createDiv({cls:"default-modal-field"}),n=new V.Setting(a).setName("CSL field name").setDesc('The CSL field key (e.g., "archive", "URL")'),o=null,u=null,c=null;if(n.addText(p=>(o=p.inputEl,p.setPlaceholder("e.g., archive").setValue(r.name).onChange(async f=>{let h=f.trim();if(this.plugin.settings.defaultModalFields[i].name=h,Ke.has(h)){let m=this.detectFieldType(h);this.plugin.settings.defaultModalFields[i].type=m,c&&(c.value=m,c.disabled=!0)}else c&&(c.disabled=!1);await this.plugin.saveSettings(),o&&u&&this.updateFieldNameValidation(h,o,u)}),p)).addDropdown(p=>(p.addOption("","Choose from CSL fields..."),Array.from(Ke).sort().forEach(h=>{p.addOption(h,h)}),p.onChange(async h=>{if(h&&h!==""&&o&&u){if(o.value=h,this.plugin.settings.defaultModalFields[i].name=h,Ke.has(h)){let m=this.detectFieldType(h);this.plugin.settings.defaultModalFields[i].type=m,c&&(c.value=m,c.disabled=!0)}else c&&(c.disabled=!1);await this.plugin.saveSettings(),this.updateFieldNameValidation(h,o,u)}}),p)),u=a.createDiv({cls:"modal-field-warning",attr:{style:"display: none;"}}),o&&u&&this.updateFieldNameValidation(r.name,o,u),new V.Setting(a).setName("Display label").setDesc("The label shown in the modal").addText(p=>p.setPlaceholder("e.g., Archive Name").setValue(r.label).onChange(async f=>{this.plugin.settings.defaultModalFields[i].label=f.trim(),await this.plugin.saveSettings()})),new V.Setting(a).setName("Field type").setDesc("The type of input control").addDropdown(p=>(c=p.selectEl,p.addOption("text","Text").addOption("textarea","Text Area").addOption("number","Number").addOption("date","Date").addOption("toggle","Toggle").addOption("dropdown","Dropdown").setValue(r.type).onChange(async f=>{this.plugin.settings.defaultModalFields[i].type=f,await this.plugin.saveSettings(),this.display()}),p)),r.name&&Ke.has(r.name)&&c){let p=this.detectFieldType(r.name);r.type!==p&&(this.plugin.settings.defaultModalFields[i].type=p,c.value=p,this.plugin.saveSettings()),c.disabled=!0}new V.Setting(a).setName("Description").setDesc("Optional help text shown below the field").addText(p=>p.setPlaceholder("Optional description").setValue(r.description||"").onChange(async f=>{this.plugin.settings.defaultModalFields[i].description=f.trim(),await this.plugin.saveSettings()})),new V.Setting(a).setName("Placeholder").setDesc("Optional placeholder text").addText(p=>p.setPlaceholder("Optional placeholder").setValue(r.placeholder||"").onChange(async f=>{this.plugin.settings.defaultModalFields[i].placeholder=f.trim(),await this.plugin.saveSettings()})),new V.Setting(a).setName("Default value").setDesc("Default value for new notes").addText(p=>{var f;return p.setPlaceholder("Optional default value").setValue(((f=r.defaultValue)==null?void 0:f.toString())||"").onChange(async h=>{this.plugin.settings.defaultModalFields[i].defaultValue=h.trim(),await this.plugin.saveSettings()})}),new V.Setting(a).setName("Required field").setDesc("Mark as required (for UI hint only)").addToggle(p=>p.setValue(r.required||!1).onChange(async f=>{this.plugin.settings.defaultModalFields[i].required=f,await this.plugin.saveSettings()})),new V.Setting(a).setName("").addButton(p=>p.setButtonText("Remove field").setWarning().onClick(async()=>{this.plugin.settings.defaultModalFields.splice(i,1),await this.plugin.saveSettings(),a.remove()})),a.createEl("hr")}renderEditModalSettingsSection(r){new V.Setting(r).setName("Edit literature note settings").setHeading(),r.createEl("p",{text:"Configure default behavior when editing existing literature notes.",cls:"setting-item-description"}),new V.Setting(r).setName("Regenerate citekey by default").setDesc("When editing a note, regenerate the citekey if relevant data changes").addToggle(i=>i.setValue(this.plugin.settings.editRegenerateCitekeyDefault).onChange(async s=>{this.plugin.settings.editRegenerateCitekeyDefault=s,await this.plugin.saveSettings()})),new V.Setting(r).setName("Update custom frontmatter by default").setDesc("When editing a note, update custom frontmatter fields from templates").addToggle(i=>i.setValue(this.plugin.settings.editUpdateCustomFrontmatterDefault).onChange(async s=>{this.plugin.settings.editUpdateCustomFrontmatterDefault=s,await this.plugin.saveSettings()})),new V.Setting(r).setName("Regenerate note body by default").setDesc("When editing a note, regenerate the note body from the header template").addToggle(i=>i.setValue(this.plugin.settings.editRegenerateBodyDefault).onChange(async s=>{this.plugin.settings.editRegenerateBodyDefault=s,await this.plugin.saveSettings()})),new V.Setting(r).setName("Rename file on citekey change").setDesc("When the citekey changes during edit, rename the file to match").addToggle(i=>i.setValue(this.plugin.settings.editRenameFileOnCitekeyChange).onChange(async s=>{this.plugin.settings.editRenameFileOnCitekeyChange=s,await this.plugin.saveSettings()}))}renderBibliographyBuilderSection(r){new V.Setting(r).setName("Bibliography export").setHeading(),r.createEl("p",{text:"Configure settings for the bibliography builder command.",cls:"setting-item-description"}),new V.Setting(r).setName("Bibliography JSON path").setDesc("Path where to save the bibliography.json file (relative to vault)").addText(i=>i.setPlaceholder("biblib/bibliography.json").setValue(this.plugin.settings.bibliographyJsonPath).onChange(async s=>{this.plugin.settings.bibliographyJsonPath=(0,V.normalizePath)(s.trim()),await this.plugin.saveSettings()})),new V.Setting(r).setName("Citekey list path").setDesc("Path where to save the citekeylist.md file (relative to vault)").addText(i=>i.setPlaceholder("citekeylist.md").setValue(this.plugin.settings.citekeyListPath).onChange(async s=>{this.plugin.settings.citekeyListPath=(0,V.normalizePath)(s.trim()),await this.plugin.saveSettings()})),new V.Setting(r).setName("BibTeX file path").setDesc("Path where to save the exported BibTeX file (relative to vault)").addText(i=>i.setPlaceholder("biblib/bibliography.bib").setValue(this.plugin.settings.bibtexFilePath).onChange(async s=>{this.plugin.settings.bibtexFilePath=(0,V.normalizePath)(s.trim()),await this.plugin.saveSettings()}))}updateFieldNameValidation(r,i,s){var n,o;if(!r||r.trim()===""){i.removeClass("field-valid","field-invalid"),s.style.display="none";return}if(Ke.has(r))i.removeClass("field-invalid"),i.addClass("field-valid"),s.style.display="none";else{i.removeClass("field-valid"),i.addClass("field-invalid"),s.empty();let u=s.createDiv({cls:"callout callout-warning"});u.createDiv({cls:"callout-title",text:"\u26A0\uFE0F Non-CSL Field"});let c=u.createDiv({cls:"callout-content"});c.createEl("p").appendText(`"${r}" is not a standard CSL field. Default modal fields should be CSL-compliant to ensure compatibility with bibliography tools. Please choose a field from the dropdown or check the `),(n=c.lastElementChild)==null||n.createEl("a",{text:"CSL specification",href:"https://docs.citationstyles.org/en/stable/specification.html#appendix-iv-variables",attr:{target:"_blank"}}),(o=c.lastElementChild)==null||o.appendText("."),s.style.display="block"}}};var ar={attachmentFolderPath:"biblib",literatureNotePath:"/",filenameTemplate:"@{{citekey}}",createAttachmentSubfolder:!0,bibliographyJsonPath:"biblib/bibliography.json",citekeyListPath:"citekeylist.md",bibtexFilePath:"biblib/bibliography.bib",headerTemplate:`# {{#title}}{{title}}{{/title}}{{^title}}{{citekey}}{{/title}} 

 _Notes_`,chapterHeaderTemplate:"# {{#pdflink}}[[{{pdflink}}|{{title}}]]{{/pdflink}}{{^pdflink}}{{title}}{{/pdflink}} (in {{container-title}})",literatureNoteTag:"literature_note",openNoteOnCreate:!0,enableZoteroConnector:!1,zoteroConnectorPort:23119,tempPdfPath:"",customFrontmatterFields:[{name:"year",template:"{{year}}",enabled:!0},{name:"dateCreated",template:"{{currentDate}}",enabled:!0},{name:"reading-status",template:"to-read",enabled:!0},{name:"aliases",template:'["{{title|sentence}}"]',enabled:!0},{name:"author-links",template:'[{{#authors}}"[[Author/{{.}}]]",{{/authors}}]',enabled:!0},{name:"attachment",template:"[{{#attachments}}{{.}},{{/attachments}}]",enabled:!0},{name:"related",template:"[{{links}}]",enabled:!0}],citekeyOptions:{citekeyTemplate:"{{author|lowercase}}{{title|titleword}}{{year}}",useZoteroKeys:!1,minCitekeyLength:6},bulkImportAttachmentHandling:"none",bulkImportAnnoteToBody:!0,bulkImportCitekeyPreference:"imported",bulkImportConflictResolution:"skip",favoriteLanguages:[{code:"en",name:"English"},{code:"de",name:"German"}],defaultModalFields:[],editRegenerateCitekeyDefault:!1,editUpdateCustomFrontmatterDefault:!0,editRegenerateBodyDefault:!1,editRenameFileOnCitekeyChange:!0};var Ni=class{constructor(t){this.plugin=t;this.settings={...ar}}async loadSettings(){let t=await this.plugin.loadData();return this.settings=this.migrateAndValidateSettings(t),this.settings}async saveSettings(){await this.plugin.saveData(this.settings)}async updateSettings(t){return this.settings={...this.settings,...t},t.citekeyOptions&&(this.settings.citekeyOptions={...ar.citekeyOptions,...this.settings.citekeyOptions}),await this.saveSettings(),this.settings}getSettings(){return this.settings}migrateAndValidateSettings(t){let r={...ar};if(!t)return r;let i={...r,...t};return i.citekeyOptions={...ar.citekeyOptions,...t.citekeyOptions||{}},Array.isArray(i.customFrontmatterFields)||(i.customFrontmatterFields=ar.customFrontmatterFields),this.migrateFromLegacySettings(i,t),i}migrateFromLegacySettings(t,r){r.legacyCitekeyOption!==void 0&&t.citekeyOptions&&(t.citekeyOptions.useZoteroKeys=!!r.legacyCitekeyOption),r.oldAttachmentFolder&&!r.attachmentFolderPath&&(t.attachmentFolderPath=r.oldAttachmentFolder)}};var ua=Ue(Go()),LA=Ue(Rs()),$o=Ue(vt());var rm=require("obsidian"),Br=class{constructor(){this.apiUrl="https://en.wikipedia.org/api/rest_v1/data/citation/bibtex/"}async fetchBibTeX(t){let r=encodeURIComponent(t.trim()),i=async s=>{let a=`${s}${r}`,n=await(0,rm.requestUrl)({url:a,method:"GET",headers:{Accept:"application/x-bibtex","User-Agent":"Obsidian-BibLib"}});if(n.status!==200)throw new Error(`Citoid BibTeX fetch failed: ${n.status} at ${a}`);return n.text};try{let s=await i(this.apiUrl);if(!s.trim().startsWith("@")){let a=this.apiUrl;if(a.includes("/mediawiki/")?a=a.replace(/\/mediawiki\/$/,"/bibtex/"):a.includes("/bibtex/")||(a=a.replace(/\/?$/,"/")+"bibtex/"),s=await i(a),!s.trim().startsWith("@"))throw new Error("Fallback Citoid endpoint did not return valid BibTeX")}return s}catch(s){throw console.error("Error fetching BibTeX from Citoid:",s),s}}};var _i=require("obsidian");Pt();var la=class la{static generate(t,r){let i={...la.defaultOptions,...r};if(!t)return console.error("Cannot generate citekey: citationData is null or undefined."),"error_no_data";try{let s=t.key||t.id;if(i.useZoteroKeys&&s&&typeof s=="string"&&s.trim().length>0)return s.trim();if(i.citekeyTemplate&&i.citekeyTemplate.trim()){let u=this.convertToMustacheTemplate(i.citekeyTemplate),c=this.prepareCitekeyVariables(t,i),p=Ae.render(u,c,{sanitizeForCitekey:!0});if(p.length<i.minCitekeyLength){let f=Math.floor(Math.random()*1e3).toString().padStart(3,"0");p+=f}return p||"error_generating_citekey"}console.warn("No template provided for citekey generation, using fallback format");let a=this.extractAuthorPart(t,i)||"unknown",n=this.extractYearPart(t)||new Date().getFullYear().toString(),o=a+n;return/^[a-zA-Z0-9_]/.test(o)||(o="_"+o),o=o.replace(/[^a-zA-Z0-9_:.#$%&\-+?<>~/]/g,""),o.replace(/[:.#$%&\-+?<>~/]+$/g,"")}catch(s){return console.error("Error generating citekey:",s),"error_"+Math.floor(Math.random()*1e3).toString().padStart(3,"0")}}static convertToMustacheTemplate(t){return t.replace(/\[([a-zA-Z0-9_]+)((?::[a-zA-Z0-9(),]+)*)\]/g,(r,i,s)=>{let a=i.toLowerCase();a==="auth"&&(a="author");let n="";return s&&(n=s.slice(1).split(":").filter(o=>o).map(o=>{let u=o.match(/^abbr\((\d+)\)$/);if(u)return`abbr${u[1]}`;let c=o.match(/^words\((\d+)\)$/);return c&&i.toLowerCase()==="title"?"titleword":c&&i.toLowerCase()==="shorttitle"?"shorttitle":o}).join("|"),n&&(n=`|${n}`)),`{{${a}${n}}}`})}static prepareCitekeyVariables(t,r){var s;return{...t,author:this.extractAuthorPart(t,r),year:this.extractYearPart(t),title:t.title||"",shorttitle:this.extractTitlePart(t,3),authors:t.author||((s=t.creators)==null?void 0:s.filter(a=>a.creatorType==="author"))||[]}}static extractTitlePart(t,r=1){let i=t.title||t.Title;if(i&&typeof i=="string"){let a=i.replace(/<[^>]+>/g,"").split(/\s+/),n=new Set(["a","an","the","and","or","but","on","in","at","to","for","with","of","from","by","as","into","like","near","over","past","since","upon","about","above","across","after","against","along","among","around","before","behind","below","beneath","beside","between","beyond","concerning","considering","despite","down","during","except","following","inside","minus","onto","opposite","out","outside","per","plus","regarding","round","save","through","toward","towards","under","underneath","unlike","until","up","versus","via","within","without"]),o=a.map(c=>c.replace(/^[^a-zA-Z0-9]+|[^a-zA-Z0-9]+$/g,"")).filter(c=>c&&!n.has(c.toLowerCase())),u;if(o.length>0)u=o.slice(0,r);else if(a.length>0)u=a.slice(0,r).map(c=>c.replace(/^[^a-zA-Z0-9]+|[^a-zA-Z0-9]+$/g,"")).filter(c=>c);else return"";return u.join("").toLowerCase().replace(/[^a-z0-9]/gi,"")}return""}static extractAuthorPart(t,r){var a;let i="",s=t.author||((a=t.creators)==null?void 0:a.filter(n=>n.creatorType==="author"));if(Array.isArray(s)&&s.length>0)i=this.extractLastNameFromAuthor(s[0]);else if(t.creators&&Array.isArray(t.creators)&&t.creators.length>0){let n=t.creators[0];i=this.extractLastNameFromAuthor(n)}return i||"unknown"}static extractLastNameFromAuthor(t){if(!t)return"";let r="";if(typeof t=="object")r=t.family||t.lastName||"",!r&&t.literal&&(r=t.literal.split(/[\s,-.:;()&/]+/).filter(Boolean)[0]||"");else if(typeof t=="string"){let i=t.indexOf(",");i!==-1?r=t.substring(0,i).trim():r=t.split(" ")[0].trim()}return r?r.toLowerCase().replace(/[^a-z0-9_-]/gi,""):""}static extractYearPart(t){var r,i,s;try{let a=(i=(r=t.issued)==null?void 0:r["date-parts"])==null?void 0:i[0];if(Array.isArray(a)&&a[0]){let n=parseInt(a[0].toString(),10);if(!isNaN(n)&&n>1e3&&n<3e3)return n.toString()}if(t.year){let o=t.year.toString().match(/\b(\d{4})\b/);if(o)return o[1]}if((s=t.issued)!=null&&s.literal&&typeof t.issued.literal=="string"){let n=t.issued.literal.match(/\b(\d{4})\b/);if(n)return n[1]}if(t.date&&typeof t.date=="string"){let n=t.date.match(/\b(\d{4})\b/);if(n)return n[1]}if(t.issued&&typeof t.issued=="string"){let n=t.issued.match(/\b(\d{4})\b/);if(n)return n[1]}}catch(a){console.warn("Error parsing year from citation data:",a)}return""}};la.defaultOptions={citekeyTemplate:"{{author|lowercase}}{{year}}",useZoteroKeys:!0,minCitekeyLength:6};var de=la;var im=e=>{if(!e)return;let t=e.match(/^(\d{4})(?:[-/](\d{1,2}))?(?:[-/](\d{1,2}))?/);if(t){let r=parseInt(t[1],10);if(!isNaN(r)){let i=[[r]];if(t[2]){let s=parseInt(t[2],10);isNaN(s)||i[0].push(s)}if(t[3]){let s=parseInt(t[3],10);!isNaN(s)&&i[0].length===2&&i[0].push(s)}return{"date-parts":i}}}return{raw:e}},am=e=>{var r;if(!e)return;let t=()=>{let i=new Date;return{"date-parts":[[i.getFullYear(),i.getMonth()+1,i.getDate()]]}};if(typeof e=="string"){if(e==="CURRENT"||e==="CURREN"||e==="CURRENT_DATE")return t()}else if(typeof e=="object"&&e!==null){if("raw"in e&&typeof e.raw=="string"&&(e.raw==="CURRENT"||e.raw==="CURREN"||e.raw==="CURRENT_DATE"))return t();if("CURRENT_DATE"in e||((r=e.constructor)==null?void 0:r.name)==="CURRENT_DATE")return t();if(Object.prototype.toString.call(e)==="[object CURRENT_DATE]"||String(e).includes("CURRENT_DATE"))return t()}try{let i;if(typeof e=="string")i=e;else if(typeof e=="object"&&e!==null&&"raw"in e&&typeof e.raw=="string")i=e.raw;else return console.warn(`Unable to process date: ${JSON.stringify(e)}`),{raw:String(e)};let s=i.split("T")[0];if(/^\d{4}(?:-\d{1,2}(?:-\d{1,2})?)?$/.test(s)&&typeof $o.parse=="function"){let a=(0,$o.parse)(s);if(a&&a["date-parts"]&&a["date-parts"][0]&&a["date-parts"][0][0])return a}return im(s)}catch(i){console.warn(`Date parsing failed for "${e}", using fallback:`,i);let s=typeof e=="string"?e:typeof e=="object"&&e!==null&&"raw"in e?String(e.raw):String(e),a="";if(typeof e=="string")a=e;else if(typeof e=="object"&&e!==null&&"raw"in e&&typeof e.raw=="string")a=e.raw;else return{raw:String(e)};return im(a.split("T")[0])}},nm={artwork:"graphic",attachment:"document",audioRecording:"song",bill:"bill",blogPost:"post-weblog",book:"book",bookSection:"chapter",case:"legal_case",computerProgram:"software",conferencePaper:"paper-conference",dictionaryEntry:"entry-dictionary",document:"document",email:"personal_communication",encyclopediaArticle:"entry-encyclopedia",film:"motion_picture",forumPost:"post",hearing:"hearing",instantMessage:"personal_communication",interview:"interview",journalArticle:"article-journal",letter:"personal_communication",magazineArticle:"article-magazine",manuscript:"manuscript",map:"map",newspaperArticle:"article-newspaper",note:"document",patent:"patent",podcast:"song",presentation:"speech",radioBroadcast:"broadcast",report:"report",statute:"legislation",thesis:"thesis",tvBroadcast:"broadcast",videoRecording:"motion_picture",webpage:"webpage"},f2=e=>{if(e){if(e.name)return{literal:e.name};if(e.lastName||e.firstName){let t={family:e.lastName||""};return e.firstName&&(t.given=e.firstName),t}if(e.fullName)return{literal:e.fullName};if(e.displayName)return{literal:e.displayName};if(e.text)return{literal:e.text};for(let t of["fullName","displayName","name","author","text","byline"])if(e[t])return{literal:e[t]};if(typeof e=="string")return{literal:e}}},re={DATE:{toTarget:e=>am(e)},CREATORS:{toTarget:e=>{if(e)return e.map(f2).filter(Boolean)}},TAGS:{toTarget:e=>e&&e.length>0?e.map(t=>t.tag).join(", "):void 0},TYPE:{toTarget:e=>nm[e]||"document"}},m2=[{source:"key",target:"id",zoteroOnly:!0},{source:"itemType",target:"type",convert:re.TYPE},{source:"tags",target:"keyword",convert:re.TAGS},{source:"DOI",target:"DOI"},{source:"ISBN",target:"ISBN"},{source:"ISSN",target:"ISSN"},{source:"url",target:"URL"},{source:"title",target:"title"},{source:"shortTitle",target:"title-short"},{source:"journalAbbreviation",target:"container-title-short",when:{source:{itemType:"journalArticle"}}},{source:"date",target:"issued",convert:re.DATE},{source:"accessDate",target:"accessed",convert:re.DATE},{source:"abstractNote",target:"abstract"},{source:"extra",target:"note",extraField:!0},{source:"place",target:"publisher-place"},{source:"publisher",target:"publisher"},{source:"edition",target:"edition"},{source:"volume",target:"volume"},{source:"issue",target:"issue"},{source:"pages",target:"page"},{source:"numberOfVolumes",target:"number-of-volumes"},{source:"numPages",target:"number-of-pages"},{source:"language",target:"language"},{source:"archive",target:"archive"},{source:"archiveLocation",target:"archive_location"},{source:"libraryCatalog",target:"source"},{source:"callNumber",target:"call-number"},{source:"rights",target:"rights"},{source:"series",target:"collection-title"},{source:"seriesNumber",target:"collection-number"},{source:"seriesTitle",target:"collection-title"},{source:"seriesEditor",target:"collection-editor",convert:re.CREATORS},{source:"author",target:"author",convert:re.CREATORS},{source:"editor",target:"editor",convert:re.CREATORS},{source:"translator",target:"translator",convert:re.CREATORS},{source:"contributor",target:"contributor",convert:re.CREATORS},{source:"bookAuthor",target:"container-author",convert:re.CREATORS,when:{source:{itemType:"bookSection"}}},{source:"reviewedAuthor",target:"reviewed-author",convert:re.CREATORS},{source:"recipient",target:"recipient",convert:re.CREATORS,when:{source:{itemType:["letter","email","personal_communication"]}}},{source:"interviewer",target:"interviewer",convert:re.CREATORS,when:{source:{itemType:"interview"}}},{source:"interviewee",target:"author",convert:re.CREATORS,when:{source:{itemType:"interview"}}},{source:"director",target:"director",convert:re.CREATORS,when:{source:{itemType:["film","videoRecording","tvBroadcast","radioBroadcast"]}}},{source:"producer",target:"producer",convert:re.CREATORS,when:{source:{itemType:["film","videoRecording","tvBroadcast","radioBroadcast"]}}},{source:"scriptwriter",target:"script-writer",convert:re.CREATORS,when:{source:{itemType:["film","videoRecording","tvBroadcast","radioBroadcast"]}}},{source:"artist",target:"author",convert:re.CREATORS,when:{source:{itemType:"artwork"}}},{source:"sponsor",target:"author",convert:re.CREATORS,when:{source:{itemType:"bill"}}},{source:"inventor",target:"author",convert:re.CREATORS,when:{source:{itemType:"patent"}}},{source:"cartographer",target:"author",convert:re.CREATORS,when:{source:{itemType:"map"}}},{source:"composer",target:"composer",convert:re.CREATORS,when:{source:{itemType:["audioRecording","podcast"]}}},{source:"performer",target:"performer",convert:re.CREATORS,when:{source:{itemType:"audioRecording"}}},{source:"presenter",target:"author",convert:re.CREATORS,when:{source:{itemType:"presentation"}}},{source:"programmer",target:"author",convert:re.CREATORS,when:{source:{itemType:"computerProgram"}}},{source:"podcaster",target:"author",convert:re.CREATORS,when:{source:{itemType:"podcast"}}},{source:"guest",target:"guest",convert:re.CREATORS,when:{source:{itemType:["tvBroadcast","radioBroadcast","podcast"]}}},{source:"publicationTitle",target:"container-title",when:{source:{itemType:["journalArticle","magazineArticle","newspaperArticle"]}}},{source:"bookTitle",target:"container-title",when:{source:{itemType:"bookSection"}}},{source:"websiteTitle",target:"container-title",when:{source:{itemType:"webpage"}}},{source:"forumTitle",target:"container-title",when:{source:{itemType:"forumPost"}}},{source:"blogTitle",target:"container-title",when:{source:{itemType:"blogPost"}}},{source:"proceedingsTitle",target:"container-title",when:{source:{itemType:"conferencePaper"}}},{source:"encyclopediaTitle",target:"container-title",when:{source:{itemType:"encyclopediaArticle"}}},{source:"dictionaryTitle",target:"container-title",when:{source:{itemType:"dictionaryEntry"}}},{source:"programTitle",target:"container-title",when:{source:{itemType:["tvBroadcast","radioBroadcast"]}}},{source:"reporter",target:"container-title",when:{source:{itemType:"case"}}},{source:"code",target:"container-title",when:{source:{itemType:["bill","statute"]}}},{source:"dateDecided",target:"issued",convert:re.DATE,when:{source:{itemType:"case"}}},{source:"dateEnacted",target:"issued",convert:re.DATE,when:{source:{itemType:"statute"}}},{source:"issueDate",target:"issued",convert:re.DATE,when:{source:{itemType:"patent"}}},{source:"filingDate",target:"submitted",convert:re.DATE,when:{source:{itemType:"patent"}}},{source:"caseName",target:"title",when:{source:{itemType:"case"}}},{source:"court",target:"authority",when:{source:{itemType:"case"}}},{source:"docketNumber",target:"number",when:{source:{itemType:"case"}}},{source:"reporterVolume",target:"volume",when:{source:{itemType:"case"}}},{source:"firstPage",target:"page",when:{source:{itemType:"case"}}},{source:"history",target:"references",when:{source:{itemType:["bill","case","hearing","statute"]}}},{source:"nameOfAct",target:"title",when:{source:{itemType:"statute"}}},{source:"codeNumber",target:"volume",when:{source:{itemType:"statute"}}},{source:"publicLawNumber",target:"number",when:{source:{itemType:"statute"}}},{source:"session",target:"chapter-number",when:{source:{itemType:["bill","hearing","statute"]}}},{source:"legislativeBody",target:"authority",when:{source:{itemType:["bill","hearing"]}}},{source:"documentNumber",target:"number",when:{source:{itemType:"hearing"}}},{source:"committee",target:"section",when:{source:{itemType:"hearing"}}},{source:"issuingAuthority",target:"authority",when:{source:{itemType:"patent"}}},{source:"legalStatus",target:"status",when:{source:{itemType:"patent"}}},{source:"patentNumber",target:"number",when:{source:{itemType:"patent"}}},{source:"priorityNumbers",target:"issue",when:{source:{itemType:"patent"}}},{source:"references",target:"references",when:{source:{itemType:"patent"}}},{source:"applicationNumber",target:"call-number",when:{source:{itemType:"patent"}}},{source:"billNumber",target:"number",when:{source:{itemType:"bill"}}},{source:"codeVolume",target:"volume",when:{source:{itemType:"bill"}}},{source:"codePages",target:"page",when:{source:{itemType:"bill"}}},{source:"reportNumber",target:"number",when:{source:{itemType:"report"}}},{source:"reportType",target:"genre",when:{source:{itemType:"report"}}},{source:"institution",target:"publisher",when:{source:{itemType:"report"}}},{source:"thesisType",target:"genre",when:{source:{itemType:"thesis"}}},{source:"university",target:"publisher",when:{source:{itemType:"thesis"}}},{source:"websiteType",target:"genre",when:{source:{itemType:["webpage","blogPost"]}}},{source:"subject",target:"title",when:{source:{itemType:"email"}}},{source:"letterType",target:"genre",when:{source:{itemType:"letter"}}},{source:"conferenceName",target:"event-title",when:{source:{itemType:"conferencePaper"}}},{source:"meetingName",target:"event-title",when:{source:{itemType:"presentation"}}},{source:"presentationType",target:"genre",when:{source:{itemType:"presentation"}}},{source:"scale",target:"scale",when:{source:{itemType:"map"}}},{source:"mapType",target:"genre",when:{source:{itemType:"map"}}},{source:"runningTime",target:"dimensions",when:{source:{itemType:["film","videoRecording","audioRecording","tvBroadcast","radioBroadcast","podcast"]}}},{source:"artworkSize",target:"dimensions",when:{source:{itemType:"artwork"}}},{source:"interviewMedium",target:"medium",when:{source:{itemType:"interview"}}},{source:"artworkMedium",target:"medium",when:{source:{itemType:"artwork"}}},{source:"audioRecordingFormat",target:"medium",when:{source:{itemType:["audioRecording","radioBroadcast","podcast"]}}},{source:"videoRecordingFormat",target:"medium",when:{source:{itemType:["film","videoRecording","tvBroadcast"]}}},{source:"label",target:"publisher",when:{source:{itemType:"audioRecording"}}},{source:"studio",target:"publisher",when:{source:{itemType:["film","videoRecording"]}}},{source:"network",target:"publisher",when:{source:{itemType:["tvBroadcast","radioBroadcast"]}}},{source:"episodeNumber",target:"number",when:{source:{itemType:["tvBroadcast","radioBroadcast","podcast"]}}},{source:"company",target:"publisher",when:{source:{itemType:"computerProgram"}}},{source:"programmingLanguage",target:"genre",when:{source:{itemType:"computerProgram"}}},{source:"system",target:"medium",when:{source:{itemType:"computerProgram"}}},{source:"version",target:"version",when:{source:{itemType:"computerProgram"}}},{source:"manuscriptType",target:"genre",when:{source:{itemType:"manuscript"}}},{source:"postType",target:"genre",when:{source:{itemType:"forumPost"}}},{source:"section",target:"section",when:{source:{itemType:"newspaperArticle"}}}],sm={"Original Date":"original-date","Event Date":"event-date","Original Publisher":"original-publisher","Original Publisher Place":"original-publisher-place","Original Title":"original-title","Reviewed Title":"reviewed-title",PMCID:"PMCID",PMID:"PMID"},Fr=["DOI","ISBN","ISSN","PMID","PMCID","URL","ORCID"];function d2(e){if(!e)return{};let t={},r=e.trim().split(`
`);for(let i of r){let s=i.split(": ");if(s.length>=2){let a=s[0].trim(),n=s.slice(1).join(": ").trim();n.startsWith('"')&&n.endsWith('"')&&(n=n.substring(1,n.length-1).replace(/\\n/g,`
`));let o;if(sm[a]?o=sm[a]:Fr.includes(a)?o=a:Fr.some(u=>u.toLowerCase()===a.toLowerCase())?o=Fr.find(u=>u.toLowerCase()===a.toLowerCase())||a:o=a.toLowerCase().replace(/\s+/g,"-"),o.toLowerCase().includes("date")||a.toLowerCase().includes("date")){let u=am(n);u&&(u["date-parts"]||u.raw||u.literal)?t[o]=u:t[o]=n}else t[o]=n}}return t}var pt=class{constructor(t){this.citoid=new Br,this.citekeyOptions=t||de.defaultOptions}async fetchNormalized(t){try{let r=await this.citoid.fetchBibTeX(t),s=new ua.default(r).get({style:"csl",type:"string"}),a=JSON.parse(s),n=Array.isArray(a)?a[0]:a;if(!n)throw new Error("Citoid returned empty or invalid data.");return n.type=n.type||"document",(!n.id||typeof n.id!="string"||n.id.trim()==="")&&(n.id=de.generate(n,this.citekeyOptions)),n}catch(r){throw console.error(`Error fetching/parsing BibTeX from Citoid for ID [${t}]:`,r),new _i.Notice(`Error fetching citation data for ${t}. ${r.message||""}`),r}}parseBibTeX(t){try{let i=new ua.default(t).get({style:"csl",type:"string"}),s=JSON.parse(i),a=Array.isArray(s)?s[0]:s;if(!a)throw new Error("Parsed BibTeX resulted in empty data.");return a.type=a.type||"document",(!a.id||typeof a.id!="string"||a.id.trim()==="")&&(a.id=de.generate(a,this.citekeyOptions)),a}catch(r){throw console.error("Error parsing BibTeX:",r),new _i.Notice(`Error parsing BibTeX. ${r.message||""}`),r}}parseZoteroItem(t){if(!t||typeof t!="object")throw console.error("Invalid Zotero item provided:",t),new _i.Notice("Cannot process invalid Zotero item data."),new Error("Invalid Zotero item provided.");if((!t.creators||!Array.isArray(t.creators)||t.creators.length===0)&&(t.itemType==="webpage"||t.itemType==="newspaperArticle")){if(t.byline)t.creators=[{creatorType:"author",name:t.byline}];else if(t.extra&&t.extra.includes("Author:")){let r=/Author:\s*([^\n]+)/i.exec(t.extra);r&&r[1]&&(t.creators=[{creatorType:"author",name:r[1].trim()}])}}try{let r=this.mapZoteroToCslRobust(t),i=!1;if(r._zoteroKey&&this.citekeyOptions.useZoteroKeys?r.id=r._zoteroKey:(!r.id||r.id===r._zoteroKey)&&(r.id=de.generate(r,this.citekeyOptions),i=!0),delete r._zoteroKey,i&&(r.id===r.DOI||r.id===r.URL)&&console.warn(`Generated citekey ${r.id} conflicts with DOI/URL. Consider refining generation pattern.`),r._extraFieldContent){let s=d2(r._extraFieldContent);for(let a in s)a!=="id"&&a!=="type"?r[a]=s[a]:a==="type"&&s[a]&&console.warn(`Type override attempted via 'extra' field: ${s[a]}`);delete r._extraFieldContent}return r.type||(r.type="document"),r.id||(console.warn("CSL data missing ID after all processing, generating fallback."),r.id=de.generate(r,this.citekeyOptions)),r}catch(r){console.error("Error mapping Zotero item to CSL:",r),console.error("Problematic Zotero Item:",JSON.stringify(t,null,2));try{console.warn("Falling back to Citation.js internal parsing for Zotero data (may be inaccurate).");let s=new ua.default([t],{forceType:"@zotero/json"}).get({style:"csl",type:"string"}),a=JSON.parse(s),n=Array.isArray(a)?a[0]:a;if(!n)throw new Error("Citation.js fallback resulted in empty data.");return n.type=n.type||"document",!n.id||typeof n.id!="string"||n.id.trim()===""?n.id=de.generate(n,this.citekeyOptions):n.id===t.key&&!this.citekeyOptions.useZoteroKeys&&(n.id=de.generate(n,this.citekeyOptions)),n}catch(i){throw console.error("Citation.js fallback also failed:",i),new _i.Notice(`Error processing Zotero data: ${r.message||"Mapping failed"}. Fallback failed.`),r}}}mapZoteroToCslRobust(t){let r={},i=nm[t.itemType]||"document";if(r.type=i,(o=>{var u;return o?typeof o=="string"?o==="CURREN"||o==="CURRENT"||o==="CURRENT_DATE":typeof o=="object"&&o!==null?"raw"in o&&typeof o.raw=="string"?o.raw==="CURREN"||o.raw==="CURRENT"||o.raw==="CURRENT_DATE":"CURRENT_DATE"in o||((u=o.constructor)==null?void 0:u.name)==="CURRENT_DATE"||String(o).includes("CURRENT_DATE")||Object.prototype.toString.call(o)==="[object CURRENT_DATE]":!1:!1})(t.accessDate)){let o=new Date;r.accessed={"date-parts":[[o.getFullYear(),o.getMonth()+1,o.getDate()]]}}let a={...t},n={};if(t.creators&&Array.isArray(t.creators)&&t.creators.forEach(o=>{let u=o.creatorType;if(u&&typeof u=="string")n[u]||(n[u]=[]),n[u].push(o);else{let c="author";n[c]||(n[c]=[]),n[c].push(o),console.warn("Zotero creator found without creatorType:",o)}}),(t.itemType==="newspaperArticle"||t.itemType==="webpage")&&(!n.author||n.author.length===0)&&(!n.reporter||n.reporter.length===0)){if(t.byline)n.author=[{creatorType:"author",name:t.byline}];else if(t.creators&&Array.isArray(t.creators)&&t.creators.length)for(let o of t.creators){let u=o.creatorType||"author";n[u]||(n[u]=[]),n[u].push(o)}}if(Object.assign(a,n),delete a.creators,m2.forEach(o=>{var c,p;let u=!0;if((p=(c=o.when)==null?void 0:c.source)!=null&&p.itemType&&((Array.isArray(o.when.source.itemType)?o.when.source.itemType:[o.when.source.itemType]).includes(t.itemType)||(u=!1)),u){let f=a[o.source];if(f!=null&&f!==""){let h=f;if(o.convert)try{h=o.convert.toTarget(f)}catch(m){console.warn(`Converter error for field "${o.source}" -> "${o.target}":`,m.message," Raw value:",f),h=void 0}if(h!=null)if(o.zoteroOnly)o.source==="key"&&(r._zoteroKey=h);else if(o.extraField)o.source==="extra"&&(r._extraFieldContent=h);else{let m=o.target;Fr.some(g=>g.toLowerCase()===m.toLowerCase())&&(m=Fr.find(g=>g.toLowerCase()===m.toLowerCase())||m),r[m]=h}}}}),!r.issued&&t.year){let o=parseInt(t.year,10);isNaN(o)||(r.issued={"date-parts":[[o]]})}if(r.type==="song"&&!r.author&&r.performer&&(r.author=r.performer),Fr.forEach(o=>{let u=o.toLowerCase();r[u]!==void 0&&r[o]===void 0&&(r[o]=r[u],delete r[u])}),r.accessed&&(u=>{var c;return typeof u!="object"||u===null?!1:"raw"in u&&typeof u.raw=="string"?u.raw==="CURREN"||u.raw==="CURRENT"||u.raw==="CURRENT_DATE":"CURRENT_DATE"in u||((c=u.constructor)==null?void 0:c.name)==="CURRENT_DATE"||String(u).includes("CURRENT_DATE")||Object.prototype.toString.call(u)==="[object CURRENT_DATE]"})(r.accessed)){let u=new Date;r.accessed={"date-parts":[[u.getFullYear(),u.getMonth()+1,u.getDate()]]}}return r}};var ht=class{constructor(t){this.citationService=t}async parseBibTeX(t){try{return this.extractBibTeXEntries(t).map(i=>{try{let s=this.citationService.parseBibTeX(i),a={},n=this.extractBibTeXField(i,"file");if(n)try{let c=n.split(";").map(f=>f.trim()).filter(Boolean),p=[];for(let f of c)if((f.match(/:/g)||[]).length>=2){let m=f.split(":");if(m.length>=3){let g=m.slice(1,-1).join(":");p.push(g)}else p.push(f)}else p.push(f);p.length>0?a.file=p.length===1?p[0]:p:a.file=n}catch(c){console.error(`Error parsing file field: ${c}`),a.file=n}let o=this.extractAllBibTeXFields(i,"annote");o&&o.length>0&&(a.annote=o);let u=s.id||this.extractBibTeXCitekey(i);return{cslData:s,_sourceFields:a,sourceFormat:"bibtex",originalId:u,parsingErrors:[]}}catch(s){return console.error("Error parsing BibTeX entry:",s,i),{cslData:{type:"document",title:"Error parsing entry",id:this.extractBibTeXCitekey(i)||"error"},sourceFormat:"bibtex",parsingErrors:[`Failed to parse entry: ${s instanceof Error?s.message:String(s)}`]}}}).filter(i=>i!==null)}catch(r){throw console.error("Error parsing BibTeX file:",r),new Error(`Failed to parse BibTeX file: ${r instanceof Error?r.message:String(r)}`)}}async parseCslJson(t){try{let r=JSON.parse(t);return(Array.isArray(r)?r:[r]).map(s=>{try{if(!s||typeof s!="object")throw new Error("Invalid CSL-JSON entry format");let a={...s,type:s.type||"document",title:s.title||"Untitled Entry",id:s.id||"unknown"},n={};if(s.file&&(Array.isArray(s.file)?n.file=s.file.filter(o=>typeof o=="string"):typeof s.file=="string"&&(n.file=s.file)),s.annote||s.note){let o=s.annote||s.note;Array.isArray(o)?n.annote=o.filter(u=>typeof u=="string"):typeof o=="string"&&(n.annote=o)}return{cslData:a,_sourceFields:Object.keys(n).length>0?n:void 0,sourceFormat:"csl-json",originalId:s.id,parsingErrors:[]}}catch(a){return console.error("Error processing CSL-JSON entry:",a,s),{cslData:{type:"document",title:"Error parsing entry",id:s.id||"error"},sourceFormat:"csl-json",parsingErrors:[`Failed to parse entry: ${a instanceof Error?a.message:String(a)}`]}}}).filter(s=>s!==null)}catch(r){throw console.error("Error parsing CSL-JSON file:",r),new Error(`Failed to parse CSL-JSON file: ${r instanceof Error?r.message:String(r)}`)}}extractBibTeXEntries(t){let r=/@[A-Za-z]+\s*{[^@]*}/gs;return t.match(r)||[]}extractBibTeXField(t,r){let i=new RegExp(`${r}\\s*=\\s*(?:{((?:[^{}]|{[^{}]*})*)}|"([^"]*)")`,"i"),s=t.match(i);return s&&(s[1]||s[2])||""}extractAllBibTeXFields(t,r){let i=new RegExp(`${r}\\s*=\\s*(?:{((?:[^{}]|{[^{}]*})*)}|"([^"]*)")`,"gi");return[...t.matchAll(i)].map(a=>a[1]||a[2]||"").filter(Boolean)}extractBibTeXCitekey(t){var i;let r=t.match(/@[A-Za-z]+\s*{([^,}]+)/);return(i=r==null?void 0:r[1])==null?void 0:i.trim()}};var Ve=class{buildVariables(t,r,i,s){let a={currentDate:new Date().toISOString().split("T")[0],currentTime:new Date().toISOString().split("T")[1].split(".")[0],authors:this.formatAuthorsForTemplate(r),...t,...this.buildContributorLists(r),citekey:t.id||""};if(a.pdflink=[],a.attachments=[],a.raw_pdflinks=[],a.quoted_attachments=[],a.attachment="",a.raw_pdflink="",a.quoted_attachment="",i&&i.length>0){let n=i.map(o=>{var u;if(o.endsWith(".pdf"))return`[[${o}|PDF]]`;if(o.endsWith(".epub"))return`[[${o}|EPUB]]`;{let c=((u=o.split(".").pop())==null?void 0:u.toUpperCase())||"FILE";return`[[${o}|${c}]]`}});a.pdflink=i,a.attachments=n,a.raw_pdflinks=i,a.quoted_attachments=n.map(o=>`"${o}"`),i.length>0&&(a.raw_pdflink=i[0],a.attachment=n[0],a.quoted_attachment=`"${n[0]}"`)}if(s&&s.length>0){let n=s.map(o=>`[[${o}]]`);a.links=n,a.linkPaths=s,a.links_string=n.join(", ")}else a.links=[],a.linkPaths=[],a.links_string="";return a}formatAuthorsForTemplate(t){let r=t.filter(s=>s.role==="author");if(r.length===0)return"";let i=r.map(this.formatContributorName).filter(s=>!!s);return i.length===0?"":i.length===1?i[0]:i.length===2?`${i[0]} and ${i[1]}`:`${i[0]} et al.`}formatContributorName(t){var a,n,o;let r=(a=t.family)==null?void 0:a.trim(),i=(n=t.given)==null?void 0:n.trim(),s=(o=t.literal)==null?void 0:o.trim();return s||(r?i?`${i.charAt(0).toUpperCase()}. ${r}`:r:i||"")}buildContributorLists(t){let r={},i=t.reduce((s,a)=>{let n=a.role||"author";return s[n]||(s[n]=[]),s[n].push(a),s},{});return Object.entries(i).forEach(([s,a])=>{r[`${s}s_raw`]=a,r[`${s}s`]=a.map(n=>{if(n.literal)return n.literal;let o=n.family||"",u=n.given||"";return o&&u?`${u} ${o}`:o||u||""}).filter(Boolean),r[`${s}s_family`]=a.map(n=>n.family||n.literal||"").filter(n=>n!==""),r[`${s}s_given`]=a.map(n=>n.given||"").filter(n=>n!=="")}),r}};var om=require("obsidian");Pt();Yr();var kt=class{constructor(t){this.templateVariableBuilder=t}async buildYamlFrontmatter(t){try{let{citation:r,contributors:i,additionalFields:s,attachmentPaths:a,pluginSettings:n,relatedNotePaths:o}=t,u={id:r.id,type:r.type,title:r.title,issued:{"date-parts":[[r.year?Number(r.year):void 0,r.month?Number(r.month):void 0,r.day?Number(r.day):void 0].filter(c=>c!==void 0)]},...r["title-short"]&&{"title-short":r["title-short"]},...r.page&&{page:r.page},...r.URL&&{URL:r.URL},...r.DOI&&{DOI:r.DOI},...r["container-title"]&&{"container-title":r["container-title"]},...r.publisher&&{publisher:r.publisher},...r["publisher-place"]&&{"publisher-place":r["publisher-place"]},...r.edition&&{edition:isNaN(Number(r.edition))?r.edition:Number(r.edition)},...r.volume&&{volume:isNaN(Number(r.volume))?r.volume:Number(r.volume)},...r.number&&{number:isNaN(Number(r.number))?r.number:Number(r.number)},...r.language&&{language:r.language},...r.abstract&&{abstract:r.abstract},tags:r.tags&&Array.isArray(r.tags)?[...new Set([...r.tags,n.literatureNoteTag])]:[n.literatureNoteTag]};return this.addContributorsToFrontmatter(u,i),this.addAdditionalFieldsToFrontmatter(u,s),await this.processCustomFrontmatterFields(u,r,i,a,n,o),(0,om.stringifyYaml)(u)}catch(r){throw console.error("Error creating frontmatter:",r),r}}addContributorsToFrontmatter(t,r){r.forEach(i=>{if(i.family||i.given||i.literal){t[i.role]||(t[i.role]=[]);let{role:s,...a}=i;t[i.role].push(a)}})}addAdditionalFieldsToFrontmatter(t,r){r.forEach(i=>{if(!i.name||i.name.trim()==="")return;if(i.type==="date"){if(i.value==null||typeof i.value=="string"&&i.value.trim()===""||typeof i.value=="object"&&(!i.value["date-parts"]||i.value["date-parts"].length===0))return}else if(i.value==null||i.value==="")return;let s=i.value;if(i.type==="date"){if(typeof i.value=="object"&&i.value["date-parts"])s=i.value;else if(typeof i.value=="string"){let a=i.value.split("-").map(Number).filter(n=>!isNaN(n));a.length>0?s={"date-parts":[a]}:s=i.value}}else if(i.type==="number"){let a=String(i.value),n=parseFloat(a);s=isNaN(n)?i.value:n}t[i.name]=s})}async processCustomFrontmatterFields(t,r,i,s,a,n){var c,p,f,h;if(!((c=a==null?void 0:a.customFrontmatterFields)!=null&&c.length))return;let o=this.templateVariableBuilder.buildVariables(r,i,s,n),u=a.customFrontmatterFields.filter(m=>m.enabled);for(let m of u){if(m.name==="pdflink"&&m.template==="{{pdflink}}"){((p=o.pdflink)==null?void 0:p.length)>0&&(t[m.name]=o.pdflink);continue}if(m.name==="attachment"&&m.template==="{{attachment}}"){((f=o.attachments)==null?void 0:f.length)>0&&(t[m.name]=o.attachments);continue}if(t.hasOwnProperty(m.name))continue;let g=m.template.trim().startsWith("[")&&m.template.trim().endsWith("]"),d=Ae.render(m.template,o,{yamlArray:g});if(d.startsWith("[")&&d.endsWith("]")||d.startsWith("{")&&d.endsWith("}"))try{let v=g?sr(d):d;t[m.name]=JSON.parse(v)}catch(v){g&&(d.trim()==="[]"||d.trim()==="[ ]")?t[m.name]=[]:g&&(d.includes("{{pdflink}}")||d.includes("{{attachment}}"))&&((h=o.attachments)==null?void 0:h.length)>0?t[m.name]=o.attachments||[]:t[m.name]=d}else d.trim()===""?g&&(t[m.name]=[]):d.includes("{{pdflink}}")||d.includes("{{attachment}}")||(t[m.name]=d)}}};Pt();var Qt=class{constructor(t,r){this.frontmatterBuilder=t,this.templateVariableBuilder=r}async buildNoteContent(t){try{let{citation:r,contributors:i,additionalFields:s,attachmentPaths:a,pluginSettings:n,annotationContent:o,relatedNotePaths:u}=t,c=await this.frontmatterBuilder.buildYamlFrontmatter({citation:r,contributors:i,additionalFields:s,attachmentPaths:a,pluginSettings:n,relatedNotePaths:u}),p=this.templateVariableBuilder.buildVariables(r,i,a,u);o&&(p.annote_content=o);let f=n.headerTemplate;r.type==="chapter"&&r["container-title"]&&n.chapterHeaderTemplate&&(f=n.chapterHeaderTemplate);let h=Ae.render(f,p),m=`---
${c}---

${h}

`;return o&&!f.includes("{{annote_content}}")&&!o.split(`

---

`).some(d=>d.length>20&&h.includes(d.substring(0,20)))&&(m+=`## Notes

${o}

`),m}catch(r){throw console.error("Error building note content:",r),r}}};var ge=require("obsidian");var Je=class{constructor(t,r){this.app=t,this.settings=r}async findAttachmentInVault(t){var r;try{let i=[];if((r=t._sourceFields)!=null&&r.file&&(Array.isArray(t._sourceFields.file)?i.push(...t._sourceFields.file):i.push(t._sourceFields.file)),i.length===0){let c=t.cslData;if(c.file&&(Array.isArray(c.file)?i.push(...c.file.filter(p=>typeof p=="string")):typeof c.file=="string"&&i.push(c.file)),c.link&&Array.isArray(c.link))for(let p of c.link)p.url&&typeof p.url=="string"&&!p.url.startsWith("http")&&i.push(p.url);for(let p of["pdf","attachment"])c[p]&&(Array.isArray(c[p])?i.push(...c[p].filter(f=>typeof f=="string")):typeof c[p]=="string"&&i.push(c[p]))}let s=i.map(c=>c.replace(/^["']|["']$/g,"").trim()).map(c=>c.replace(/\\:/g,":")).filter(Boolean);if(s.length===0)return null;let a=s.map(c=>{let p=c.split(/[/\\]/);return p[p.length-1]}).filter(Boolean),n=this.app.vault.getFiles();for(let c of a){let p=n.filter(f=>f.name===c);if(p.length>0)return p[0].path}let o=new Set;for(let c of s){let p=c.match(/(?:files|attachments)\/([^\/]+)\//);p&&p[1]&&o.add(p[1])}for(let c of o)for(let p of n)if((p.path.includes(`/files/${c}/`)||p.path.includes(`/attachments/${c}/`))&&a.some(m=>{let g=p.name.substring(0,p.name.lastIndexOf(".")),d=m.includes(".")?m.substring(0,m.lastIndexOf(".")):m;return g.toLowerCase()===d.toLowerCase()||g.toLowerCase().startsWith(d.toLowerCase())}))return p.path;let u=n.filter(c=>!c.path.includes("/files/")||!(c.name.endsWith(".pdf")||c.name.endsWith(".epub"))?!1:a.some(p=>{let f=c.name.substring(0,c.name.lastIndexOf(".")),h=p.includes(".")?p.substring(0,p.lastIndexOf(".")):p;return f.toLowerCase()===h.toLowerCase()}));return u.length>0?u[0].path:null}catch(i){return console.error("Error finding attachment in vault:",i),null}}async importAttachment(t,r){try{if(t.type!=="import"||!t.file)return null;let i=(0,ge.normalizePath)(this.settings.attachmentFolderPath);try{this.app.vault.getAbstractFileByPath(i)||await this.app.vault.createFolder(i)}catch(f){return console.error(`Error creating attachment folder ${i}:`,f),new ge.Notice(`Error creating attachment folder: ${i}`),null}let s=t.file.name.split(".").pop()||"file",a=i;if(this.settings.createAttachmentSubfolder){a=(0,ge.normalizePath)(`${i}/${r}`);try{this.app.vault.getAbstractFileByPath(a)||await this.app.vault.createFolder(a)}catch(f){return console.error(`Error creating attachment subfolder ${a}:`,f),new ge.Notice(`Error creating attachment subfolder: ${a}`),null}}let n=r.replace(/[^a-zA-Z0-9_\-]+/g,"_"),o=this.app.vault.getFiles().filter(f=>f.parent&&f.parent.path===a&&f.extension===s&&f.basename.startsWith(n)),u="";if(o.length>0){let f=o.some(g=>g.basename===n),h=new RegExp(`${n}_(\\d+)$`),m=0;o.forEach(g=>{let d=g.basename.match(h);if(d&&d[1]){let v=parseInt(d[1],10);v>m&&(m=v)}}),f&&m===0?u=`${n}_1.${s}`:u=`${n}_${m+1}.${s}`}else u=`${n}.${s}`;let c=(0,ge.normalizePath)(`${a}/${u}`),p=await t.file.arrayBuffer();return await this.app.vault.createBinary(c,p),new ge.Notice(`Attachment imported to ${c}`),c}catch(i){return console.error("Error importing attachment:",i),new ge.Notice("Error importing attachment. Check console."),null}}resolveLinkedAttachmentPath(t){try{if(t.type!=="link"||!t.path)return null;let r=(0,ge.normalizePath)(t.path);return this.app.vault.getAbstractFileByPath(r)instanceof ge.TFile?r:null}catch(r){return console.error("Error resolving linked attachment path:",r),null}}async organizeImportedAttachment(t,r){try{let i=this.app.vault.getAbstractFileByPath(t);if(!(i instanceof ge.TFile))return console.error(`Source file not found or not a file: ${t}`),null;let s=i.extension,a=(0,ge.normalizePath)(this.settings.attachmentFolderPath);try{this.app.vault.getAbstractFileByPath(a)||await this.app.vault.createFolder(a)}catch(h){return console.error(`Error creating attachment folder ${a}:`,h),new ge.Notice(`Error creating attachment folder: ${a}`),null}let n=a;if(this.settings.createAttachmentSubfolder){n=(0,ge.normalizePath)(`${a}/${r}`);try{this.app.vault.getAbstractFileByPath(n)||await this.app.vault.createFolder(n)}catch(h){return console.error(`Error creating attachment subfolder ${n}:`,h),new ge.Notice(`Error creating attachment subfolder: ${n}`),null}}let o=r.replace(/[^a-zA-Z0-9_\-]+/g,"_"),u=this.app.vault.getFiles().filter(h=>h.parent&&h.parent.path===n&&h.extension===s&&h.basename.startsWith(o)),c="";if(u.length>0){let h=u.some(d=>d.basename===o),m=new RegExp(`${o}_(\\d+)$`),g=0;u.forEach(d=>{let v=d.basename.match(m);if(v&&v[1]){let b=parseInt(v[1],10);b>g&&(g=b)}}),h&&g===0?c=`${o}_1.${s}`:c=`${o}_${g+1}.${s}`}else c=`${o}.${s}`;let p=(0,ge.normalizePath)(`${n}/${c}`),f=await this.app.vault.readBinary(i);return await this.app.vault.createBinary(p,f),new ge.Notice(`Moved attachment to ${p}`),p}catch(i){return console.error(`Error moving attachment to proper location: ${i}`),new ge.Notice(`Error organizing attachment: ${i instanceof Error?i.message:String(i)}`),null}}async trashFile(t){try{let r=this.app.vault.getAbstractFileByPath(t);return r instanceof ge.TFile?(await this.app.vault.trash(r,!1),!0):!1}catch(r){return console.error(`Error trashing file ${t}:`,r),!1}}};var oe=require("obsidian");var ft=class{constructor(t,r,i,s,a){this.app=t,this.settings=r,this.referenceParser=i,this.noteContentBuilder=s,this.attachmentManager=a}async createLiteratureNote(t){try{let{citation:r,contributors:i,additionalFields:s,attachmentData:a,relatedNotePaths:n}=t,o=[];if(a&&a.length>0){for(let f of a)if(f.type!=="none"){let h="";f.type==="import"&&f.file?h=await this.attachmentManager.importAttachment(f,r.id)||"":f.type==="link"&&f.path&&(h=this.attachmentManager.resolveLinkedAttachmentPath(f)||""),h&&o.push(h)}}let u=await this.noteContentBuilder.buildNoteContent({citation:r,contributors:i,additionalFields:s,attachmentPaths:o,relatedNotePaths:n,pluginSettings:this.settings}),c=this.getLiteratureNotePath(r.id,r);if(this.app.vault.getAbstractFileByPath(c)instanceof oe.TFile)return new oe.Notice(`Literature note already exists at ${c}.`),{success:!1,error:new Error(`Literature note already exists at ${c}`)};if(c.includes("/")){let f=c.substring(0,c.lastIndexOf("/"));if(f)try{await this.app.vault.createFolder(f)}catch(h){}}if(await this.app.vault.create(c,u),new oe.Notice(`Literature note "${r.title}" created at ${c}.`),this.settings.openNoteOnCreate){let f=this.app.vault.getAbstractFileByPath(c);f instanceof oe.TFile&&await this.app.workspace.getLeaf(!1).openFile(f)}return{success:!0,path:c}}catch(r){return console.error("Error creating literature note:",r),new oe.Notice("Error creating literature note. Check console."),{success:!1,error:r instanceof Error?r:new Error("Unknown error creating note")}}}async bulkImportFromFile(t,r){var i;try{let s=(i=t.split(".").pop())==null?void 0:i.toLowerCase();if(s!=="bib"&&s!=="json")throw new Error("Only .bib (BibTeX) and .json (CSL-JSON) files are supported");let a=await this.app.vault.adapter.read(t);if(!a)throw new Error("File is empty");let n=t.split("/").pop()||t,o=t.substring(0,t.lastIndexOf("/")+1);return o.endsWith("/")||(o+="/"),this.bulkImportFromString(a,s,n,r,o)}catch(s){return console.error("Error during bulk import:",s),{created:0,skipped:0,errors:[{message:`Failed to import file: ${s instanceof Error?s.message:String(s)}`}],attachmentsImported:0}}}async bulkImportFromString(t,r,i,s,a){var p,f;let n=0,o=0,u=0,c=[];try{if(r!=="bib"&&r!=="json")throw new Error("Only .bib (BibTeX) and .json (CSL-JSON) files are supported");if(!t.trim())throw new Error("Content is empty");let h;r==="bib"?h=await this.referenceParser.parseBibTeX(t):h=await this.referenceParser.parseCslJson(t);let m=h.length;if(m===0)throw new Error("No valid references found in the content");new oe.Notice(`Found ${m} references in ${i}`);for(let g=0;g<h.length;g++){let d="",v=h[g],b=v.cslData.title||"Untitled";new oe.Notice(`Importing reference ${g+1} of ${m}: ${b}`,2e3);try{let E;s.citekeyPreference==="imported"&&(v.originalId||v.cslData.id)?E=v.originalId||v.cslData.id:E=de.generate(v.cslData,this.settings.citekeyOptions),E=E.replace(/[^a-zA-Z0-9_\-]+/g,"_");let x=this.getLiteratureNotePath(E,v.cslData),w=this.app.vault.getAbstractFileByPath(x);if(w instanceof oe.TFile&&s.conflictResolution==="skip"){new oe.Notice(`Skipping existing note: ${E}`,2e3),o++;continue}if(s.attachmentHandling==="import"){if(d=await this.attachmentManager.findAttachmentInVault(v)||"",d)d=await this.attachmentManager.organizeImportedAttachment(d,E)||"",d&&u++;else if(a&&((p=v._sourceFields)!=null&&p.file)){let y=Array.isArray(v._sourceFields.file)?v._sourceFields.file:[v._sourceFields.file];for(let _ of y)try{let k=null;if(!k&&a){let Q=_.replace(/^\/+/,""),O=(0,oe.normalizePath)(`${a}${Q}`),N=this.app.vault.getAbstractFileByPath(O);N instanceof oe.TFile&&(k=N)}if(!k){let Q=_.replace(/^\/+/,""),O=(0,oe.normalizePath)(`/${Q}`),N=this.app.vault.getAbstractFileByPath(O);N instanceof oe.TFile&&(k=N)}if(!k){let Q=_.match(/files\/([^\/]+)\/([^\/]+)$/);if(Q){let O=Q[1],N=Q[2],B=`/files/${O}/${N}`;if(a){let q=(0,oe.normalizePath)(`${a}files/${O}/${N}`),P=this.app.vault.getAbstractFileByPath(q);P instanceof oe.TFile&&(k=P)}if(!k){let q=this.app.vault.getFiles();for(let P of q)if(P.path.includes(B)){k=P;break}}}}if(k)try{let Q=await this.app.vault.readBinary(k),O=k.name,N=new File([Q],O),B={type:"import",file:N,filename:O};if(d=await this.attachmentManager.importAttachment(B,E)||"",d){u++;break}}catch(Q){console.error(`Error reading file ${k.path}:`,Q)}}catch(k){console.error(`Error processing attachment path "${_}":`,k)}}}let S="";if(s.annoteToBody&&((f=v._sourceFields)!=null&&f.annote))if(Array.isArray(v._sourceFields.annote)){let y=new Map,_=k=>k.toLowerCase().replace(/\s+/g," ").trim();v._sourceFields.annote.forEach(k=>{if(!k||k.trim()==="")return;let Q=k.trim(),O=_(Q);y.has(O)||y.set(O,Q)}),S=Array.from(y.values()).join(`

---

`)}else S=v._sourceFields.annote.trim();let{citation:T,contributors:I,additionalFields:C}=this.convertParsedReferenceToInput(v,E),A=await this.noteContentBuilder.buildNoteContent({citation:T,contributors:I,additionalFields:C,annotationContent:S,attachmentPaths:d?[d]:[],pluginSettings:this.settings});if(w instanceof oe.TFile&&s.conflictResolution==="overwrite")await this.app.vault.modify(w,A),new oe.Notice(`Overwritten existing note: ${E}`,2e3);else{if(x.includes("/")){let y=x.substring(0,x.lastIndexOf("/"));if(y)try{await this.app.vault.createFolder(y)}catch(_){}}await this.app.vault.create(x,A)}n++}catch(E){console.error(`Error processing reference ${g+1}:`,E),c.push({message:`Error processing reference: ${E instanceof Error?E.message:String(E)}`,entryTitle:b})}}return new oe.Notice(`Bulk import finished. ${n} notes created, ${o} skipped, ${u} attachments imported.`),{created:n,skipped:o,errors:c,attachmentsImported:u}}catch(h){return console.error("Error during bulk import:",h),c.push({message:`Bulk import failed: ${h instanceof Error?h.message:String(h)}`}),{created:n,skipped:o,errors:c,attachmentsImported:u}}}convertParsedReferenceToInput(t,r){var c;let i=t.cslData,s={id:r,type:i.type||"document",title:i.title||"Untitled",year:this.extractYear(i),month:this.extractMonth(i),day:this.extractDay(i),"title-short":i["title-short"]||"",URL:i.URL||"",DOI:i.DOI||"","container-title":i["container-title"]||"",publisher:i.publisher||"","publisher-place":i["publisher-place"]||"",edition:i.edition||"",volume:i.volume||"",number:i.number||i.issue||"",page:i.page||"",language:i.language||"",abstract:i.abstract||"",tags:[this.settings.literatureNoteTag]},a=this.extractContributors(i),n=new Set(["id","type","title","year","month","day","title-short","URL","DOI","container-title","publisher","publisher-place","edition","volume","number","issue","page","language","abstract","issued","author","editor","translator","tags","_fileField","_annoteField","_annoteFields","_graph","_item","_attachment","annote","file","attachment","note"]),o=Object.entries(i).filter(([p])=>!n.has(p)).map(([p,f])=>{let h="standard";return typeof f=="number"?h="number":typeof f=="object"&&f!==null&&"date-parts"in f&&(h="date"),{name:p,value:f,type:h}}),u;return(c=t._sourceFields)!=null&&c.annote&&(Array.isArray(t._sourceFields.annote)?u=t._sourceFields.annote.join(`

---

`):u=t._sourceFields.annote),{citation:s,contributors:a,additionalFields:o,annotationContent:u}}extractYear(t){return t.issued&&t.issued["date-parts"]&&t.issued["date-parts"][0]&&t.issued["date-parts"][0][0]?t.issued["date-parts"][0][0].toString():t.year?t.year.toString():""}extractMonth(t){return t.issued&&t.issued["date-parts"]&&t.issued["date-parts"][0]&&t.issued["date-parts"][0][1]?t.issued["date-parts"][0][1].toString():t.month?t.month.toString():""}extractDay(t){return t.issued&&t.issued["date-parts"]&&t.issued["date-parts"][0]&&t.issued["date-parts"][0][2]?t.issued["date-parts"][0][2].toString():t.day?t.day.toString():""}extractContributors(t){let r=[],i=["author","editor","translator","contributor","director"];for(let s of i)if(t[s]&&Array.isArray(t[s]))for(let a of t[s])typeof a=="object"&&a!==null&&r.push({role:s,family:a.family||"",given:a.given||"",literal:a.literal||""});return r}getLiteratureNotePath(t,r){let i="";if(this.settings.filenameTemplate){let n=this.settings.filenameTemplate,o={citekey:t,currentDate:new Date().toISOString().split("T")[0]};r&&Object.assign(o,{title:r.title||"",year:r.year||"",type:r.type||"","container-title":r["container-title"]||""});let{TemplateEngine:u}=(Pt(),rl(al));i=u.render(n,o),(!i||i.trim()==="")&&(i=`@${t.replace(/[^a-zA-Z0-9_\-]+/g,"_")}`),i=i.replace(/[\\:"*?<>|]+/g,"_")}else i=`@${t.replace(/[^a-zA-Z0-9_\-]+/g,"_")}`;let s="";if(i.includes("/")){let o=i.split("/").filter(u=>u.trim()!=="");o.length===0?i=`${t}.md`:(o[o.length-1]=o[o.length-1]+".md",i=o.join("/"))}else i=`${i}.md`;let a=(0,oe.normalizePath)(this.settings.literatureNotePath);return a!=="/"&&!a.endsWith("/")&&(a+="/"),a==="/"&&(a=""),s=(0,oe.normalizePath)(`${a}${i}`),s}async getBookEntries(){let t=[],r=this.app.vault.getMarkdownFiles();for(let i of r)try{let s=this.app.metadataCache.getFileCache(i),a=s==null?void 0:s.frontmatter;if(!a)continue;let n=a.tags;if(!n||!Array.isArray(n)||!n.includes(this.settings.literatureNoteTag))continue;let o=a.type;if(!o||!["book","collection","document"].includes(o)||!a.id||!a.title)continue;t.push({id:a.id,title:a.title,path:i.path,frontmatter:a})}catch(s){console.error(`Error processing potential book entry ${i.path}:`,s)}return t.sort((i,s)=>i.title.localeCompare(s.title)),t}async getBookEntryByPath(t){try{let r=this.app.vault.getAbstractFileByPath((0,oe.normalizePath)(t));if(!(r instanceof oe.TFile))return null;let i=this.app.metadataCache.getFileCache(r),s=i==null?void 0:i.frontmatter;return!s||!s.id||!s.title||!s.type||!["book","collection","document"].includes(s.type)?null:{id:s.id,title:s.title,path:r.path,frontmatter:s}}catch(r){return console.error(`Error getting book entry by path ${t}:`,r),null}}};var lm=require("obsidian"),ca=class{constructor(t,r=null){this.statusBarItem=null;this.connectorServer=null;this.app=t,this.connectorServer=r}addZoteroStatusBarItem(t,r){if(this.statusBarItem=t.addStatusBarItem(),!this.statusBarItem){console.error("Failed to create status bar item");return}this.statusBarItem.addClass("zotero-connector-status"),this.updateZoteroStatusBar(),!lm.Platform.isMobile&&r?(this.statusBarItem.onclick=async()=>{await r()},this.statusBarItem.title="Click to toggle Zotero Connector server"):this.statusBarItem.title="Zotero Connector status (mobile not supported)"}updateZoteroStatusBar(){if(this.statusBarItem)if(this.connectorServer){this.statusBarItem.empty(),this.statusBarItem.addClass("active"),this.statusBarItem.removeClass("inactive");let t=this.statusBarItem.createSpan({cls:"status-icon"});t.textContent="\u25CF";let r=this.statusBarItem.createSpan({cls:"status-text"});r.textContent="Zotero connected"}else{this.statusBarItem.empty(),this.statusBarItem.addClass("inactive"),this.statusBarItem.removeClass("active");let t=this.statusBarItem.createSpan({cls:"status-icon"});t.textContent="\u25CB";let r=this.statusBarItem.createSpan({cls:"status-text"});r.textContent="Zotero disconnected"}}setConnectorServer(t){this.connectorServer=t,this.updateZoteroStatusBar()}remove(){this.statusBarItem&&(this.statusBarItem.remove(),this.statusBarItem=null)}};var pa=class{constructor(t,r){this.app=t;this.settings=r;this.initializeServices()}initializeServices(){this.citationService=new pt(this.settings.citekeyOptions),this.templateVariableBuilder=new Ve,this.frontmatterBuilder=new kt(this.templateVariableBuilder),this.noteContentBuilder=new Qt(this.frontmatterBuilder,this.templateVariableBuilder),this.attachmentManager=new Je(this.app,this.settings),this.referenceParserService=new ht(this.citationService),this.noteCreationService=new ft(this.app,this.settings,this.referenceParserService,this.noteContentBuilder,this.attachmentManager),this.statusBarService=new ca(this.app)}updateServices(){this.citationService=new pt(this.settings.citekeyOptions),this.attachmentManager=new Je(this.app,this.settings),this.referenceParserService=new ht(this.citationService),this.noteCreationService=new ft(this.app,this.settings,this.referenceParserService,this.noteContentBuilder,this.attachmentManager)}getCitationService(){return this.citationService}getReferenceParserService(){return this.referenceParserService}getTemplateVariableBuilder(){return this.templateVariableBuilder}getFrontmatterBuilder(){return this.frontmatterBuilder}getNoteContentBuilder(){return this.noteContentBuilder}getAttachmentManager(){return this.attachmentManager}getNoteCreationService(){return this.noteCreationService}getStatusBarService(){return this.statusBarService}updateSettings(t){this.settings=t,this.updateServices()}onUnload(){}};var da=require("obsidian");var K=require("obsidian");var um=require("obsidian"),Mr=class extends um.FuzzySuggestModal{constructor(t,r){super(t),this.markdownFiles=this.app.vault.getMarkdownFiles(),this.onSelect=r,this.setPlaceholder("Search for notes to link...")}getItems(){return this.markdownFiles}getItemText(t){return t.path}onChooseItem(t,r){this.onSelect(t)}};var Ur=class{constructor(t,r,i){this.containerEl=t,this.contributor=r,this.onRemove=i,this.render()}render(){var s,a;let t=this.containerEl.createDiv({cls:"bibliography-contributor"});this.roleSelect=t.createEl("select",{cls:"bibliography-input bibliography-contributor-role"}),ir.forEach(n=>{this.roleSelect.createEl("option",{text:n,value:n})}),this.roleSelect.value=this.contributor.role,this.roleSelect.onchange=()=>{this.contributor.role=this.roleSelect.value},this.givenInput=t.createEl("input",{type:"text",placeholder:"Given name",cls:"bibliography-input bibliography-contributor-given"}),this.givenInput.value=(s=this.contributor.given)!=null?s:"";let r=()=>{this.contributor.given=this.givenInput.value.trim()};this.givenInput.oninput=r,this.givenInput.onchange=r,this.givenInput.onblur=r,this.familyInput=t.createEl("input",{type:"text",placeholder:"Family name",cls:"bibliography-input bibliography-contributor-family"}),this.familyInput.value=(a=this.contributor.family)!=null?a:"";let i=()=>{this.contributor.family=this.familyInput.value.trim()};this.familyInput.oninput=i,this.familyInput.onchange=i,this.familyInput.onblur=i,this.removeButton=t.createEl("button",{text:"Remove",cls:"bibliography-remove-contributor-button"}),this.removeButton.onclick=()=>{this.onRemove(this.contributor),t.remove()}}};var qr=class{constructor(t,r,i){this.warningTextEl=null;this.containerEl=t,this.field=r,this.onRemove=i,this.render()}render(){this.fieldDiv=this.containerEl.createDiv({cls:"bibliography-additional-field"}),this.typeSelect=this.fieldDiv.createEl("select",{cls:"bibliography-input bibliography-field-type"}),["Standard","Number","Date"].forEach(t=>{let r=this.typeSelect.createEl("option",{text:t,value:t.toLowerCase()});this.field.type||(this.field.type="standard"),t.toLowerCase()===this.field.type&&(r.selected=!0)}),this.typeSelect.onchange=()=>{this.field.type=this.typeSelect.value||"standard",this.updateFieldOptions(),this.updateValueInput(),this.updateHighlight()},this.fieldSelect=this.fieldDiv.createEl("select",{cls:"bibliography-input bibliography-field-name"}),this.updateFieldOptions(),this.fieldSelect.onchange=()=>{this.field.name=this.fieldSelect.value,this.updateHighlight()},this.valueInputContainer=this.fieldDiv.createDiv({cls:"bibliography-field-value-container"}),this.updateValueInput(),this.removeButton=this.fieldDiv.createEl("button",{text:"Remove",cls:"bibliography-remove-field-button"}),this.removeButton.onclick=()=>{this.warningTextEl&&this.warningTextEl.remove(),this.onRemove(this.field),this.fieldDiv.remove()},this.updateHighlight()}updateFieldOptions(){let t=this.fieldSelect.value;this.fieldSelect.empty(),(!this.field.type||!["standard","number","date"].includes(this.field.type))&&(this.field.type="standard");let r=[];switch(this.field.type){case"number":r.push(...Hr);break;case"date":r.push(...Vr);break;case"standard":default:r.push(...Oa);break}this.field.name&&!r.includes(this.field.name)&&(Ke.has(this.field.name)||r.push(this.field.name)),r.sort(),r.forEach(i=>{let s=this.fieldSelect.createEl("option",{text:i,value:i});(i===this.field.name||i===t)&&(s.selected=!0,this.field.name!==i&&(this.field.name=i))}),!this.field.name&&this.fieldSelect.value?this.field.name=this.fieldSelect.value:!this.field.name&&r.length>0&&(this.field.name=r[0],this.fieldSelect.value=r[0])}updateValueInput(){this.valueInputContainer.empty();let t="bibliography-input bibliography-field-value",r;if(this.field.type==="number"?r=this.valueInputContainer.createEl("input",{type:"number",placeholder:"Enter number",cls:t}):this.field.type==="date"?r=this.valueInputContainer.createEl("input",{type:"date",cls:t}):this.field.name==="abstract"||this.field.name==="note"?(r=this.valueInputContainer.createEl("textarea",{placeholder:"Enter value",cls:t}),r.rows=2):r=this.valueInputContainer.createEl("input",{type:"text",placeholder:"Enter value",cls:t}),this.field.type==="date"){let i="";if(this.field.value){if(typeof this.field.value=="string")i=this.field.value;else if(this.field.value["date-parts"]&&this.field.value["date-parts"][0]){let a=this.field.value["date-parts"][0];a.length>=3?i=`${a[0]}-${a[1].toString().padStart(2,"0")}-${a[2].toString().padStart(2,"0")}`:a.length>=2?i=`${a[0]}-${a[1].toString().padStart(2,"0")}-01`:a.length>=1&&(i=`${a[0]}-01-01`)}}r.value=i;let s=()=>{let a=r.value.trim();if(a){let n=a.match(/^(\d{4})-(\d{2})-(\d{2})$/);n?this.field.value={"date-parts":[[parseInt(n[1],10),parseInt(n[2],10),parseInt(n[3],10)]]}:this.field.value={raw:a}}else this.field.value=""};r.addEventListener("change",s),r.addEventListener("input",s),r.addEventListener("blur",s)}else r.value=this.field.value!=null?String(this.field.value):"",r.oninput=()=>{this.field.value=r.value.trim()},r.onchange=()=>{this.field.value=r.value.trim()}}updateHighlight(){var i;let t=this.field.name||"";t!==""&&!Ke.has(t)?(this.fieldDiv.addClass("non-csl-field"),this.warningTextEl||(this.warningTextEl=createDiv({cls:"bibliography-field-warning setting-item-description",text:"This field name is not a standard CSL variable and may not be compatible with other tools."}),(i=this.fieldDiv.parentNode)==null||i.insertBefore(this.warningTextEl,this.fieldDiv.nextSibling))):(this.fieldDiv.removeClass("non-csl-field"),this.warningTextEl&&(this.warningTextEl.remove(),this.warningTextEl=null))}};ha();var Nt=class extends K.Modal{constructor(r,i,s=!0){super(r);this.settings=i;this.additionalFields=[];this.contributors=[];this.relatedNotePaths=[];this.importButtonComponent=null;this.linkButtonComponent=null;this.attachmentData=[];this.defaultFieldInputs=new Map;this.isInitialized=!1;this.openedViaCommand=!0;this.citoidService=new Br,this.citationService=new pt(this.settings.citekeyOptions);let a=new Ve,n=new kt(a),o=new Qt(n,a),u=new Je(r,i),c=new ht(this.citationService);this.noteCreationService=new ft(r,i,c,o,u),this.openedViaCommand=s}onOpen(){let{contentEl:r}=this;r.addClass("bibliography-modal"),r.createEl("h2",{text:"Enter bibliographic information"}),this.createCitoidLookupSection(r),this.createAttachmentSection(r),r.createEl("hr"),r.createEl("h3",{text:"Entry details"}),this.createMainForm(r),this.isInitialized=!0}getAttachmentData(){return this.attachmentData}setAttachmentData(r){if(this.attachmentData.push(r),this.isInitialized){if(r.type==="import"){let i=this.contentEl.querySelector(".bibliography-citoid-container");if(i){i.addClass("collapsed");let s=i.querySelector(".bibliography-citoid-toggle");if(s&&!s.querySelector(".bibliography-zotero-notice")){let a=document.createElement("span");a.className="bibliography-zotero-notice",a.textContent="Zotero data loaded - auto-fill section collapsed",s.appendChild(a)}}}this.updateAttachmentsDisplay()}}updateAttachmentsDisplay(){if(!this.attachmentsDisplayEl)return;if(this.attachmentsDisplayEl.empty(),this.attachmentData.length===0){this.attachmentsDisplayEl.setText("No attachments added.");return}let r=this.attachmentsDisplayEl.createEl("ul",{cls:"bibliography-attachments-list"});this.attachmentData.forEach((i,s)=>{let a=r.createEl("li"),n="";i.type==="import"&&i.file?(n=i.filename||i.file.name,a.createSpan({cls:"attachment-type-badge import",text:"IMPORT"})):i.type==="link"&&i.path&&(n=i.path.split("/").pop()||i.path,a.createSpan({cls:"attachment-type-badge link",text:"LINK"}));let o=a.createSpan({text:n}),u=a.createEl("button",{cls:"bibliography-remove-attachment-button",text:"Remove"});u.onclick=()=>{this.attachmentData.splice(s,1),this.updateAttachmentsDisplay()}})}createCitoidLookupSection(r){let i=r.createDiv({cls:"bibliography-citoid-container"}),s=i.createDiv({cls:"bibliography-citoid-toggle"});s.createEl("h3",{text:"Auto-fill"});let a=s.createSpan({cls:"bibliography-citoid-toggle-icon",text:"\u25BC"});this.attachmentData.length>0&&this.attachmentData[0].type==="import"?(s.createSpan({cls:"bibliography-zotero-notice",text:"Zotero data loaded - auto-fill section collapsed"}),i.addClass("collapsed")):this.openedViaCommand||i.addClass("collapsed"),s.addEventListener("click",()=>{i.toggleClass("collapsed",!i.hasClass("collapsed")),a.textContent=i.hasClass("collapsed")?"\u25B6":"\u25BC"});let n=i.createDiv({cls:"bibliography-citoid-content"}),o=new K.Setting(n).setName("Auto-lookup by identifier").setDesc("DOI, ISBN, arXiv ID, URL"),u=o.controlEl.createEl("input",{type:"text",placeholder:"E.g., 10.1038/nrn3241, arXiv:1910.13461"}),c=new K.ButtonComponent(o.controlEl).setButtonText(jr.LOOKUP).setCta().onClick(async()=>{let m=u.value.trim();if(!m){new K.Notice("Please enter an identifier to lookup");return}c.setDisabled(!0),c.setButtonText(jr.LOADING);try{let g=await this.citationService.fetchNormalized(m);g?(this.populateFormFromCitoid(g),new K.Notice("Citation data loaded successfully")):new K.Notice("No citation data found for this identifier")}catch(g){console.error("Error fetching citation data:",g),new K.Notice(`Error fetching citation data: ${g instanceof Error?g.message:String(g)}`)}finally{c.setDisabled(!1),c.setButtonText("Lookup")}});n.createEl("h3",{text:"Auto-fill from BibTeX"});let p=n.createDiv({cls:"bibliography-bibtex-container"}),f=p.createEl("textarea",{placeholder:"Paste BibTeX entry here...",cls:"bibliography-bibtex-input"}),h=p.createEl("button",{text:"Parse BibTeX",cls:"bibliography-bibtex-button"});h.onclick=()=>{let m=f.value.trim();if(!m){new K.Notice(mt.EMPTY_BIBTEX);return}new K.Notice(jr.PARSING_BIBTEX),h.setAttr("disabled","true"),h.textContent=jr.PARSING;try{let g=this.citationService.parseBibTeX(m);if(!g){new K.Notice(mt.NO_BIBTEX_DATA);return}this.populateFormFromCitoid(g),new K.Notice(er.BIBTEX_PARSED)}catch(g){console.error("Error parsing BibTeX data:",g),new K.Notice(mt.BIBTEX_PARSE_FAILED)}finally{h.removeAttribute("disabled"),h.textContent=jr.PARSE_BIBTEX}}}createAttachmentSection(r){let i=r.createDiv({cls:"attachment-container"}),s=i.createEl("div",{cls:"setting-item-heading",text:"Attachments"}),a=new K.Setting(i).setDesc("Add attachments to this citation"),o=a.controlEl.createEl("div").createEl("select",{cls:"dropdown"});this.attachmentTypeSelect=o;let u=o.createEl("option",{value:"import",text:"Import file"}),c=o.createEl("option",{value:"link",text:"Link to existing file"});a.addButton(p=>{p.setButtonText("Add attachment").setCta().onClick(()=>{this.attachmentTypeSelect.value==="import".toString()?this.addImportAttachment():this.attachmentTypeSelect.value==="link".toString()&&this.addLinkAttachment()})}),this.attachmentsDisplayEl=i.createDiv({cls:"bibliography-attachments-display"}),this.updateAttachmentsDisplay(),this.importSettingEl=document.createElement("div"),this.linkSettingEl=document.createElement("div")}addImportAttachment(){let r=document.createElement("input");r.type="file",r.accept="*.*",r.addEventListener("change",()=>{if(r.files&&r.files.length>0){let i=r.files[0],s={type:"import",file:i,filename:i.name};this.attachmentData.push(s),this.updateAttachmentsDisplay()}}),r.click()}addLinkAttachment(){new zo(this.app,r=>{let i={type:"link",path:r.path};this.attachmentData.push(i),this.updateAttachmentsDisplay()}).open()}createMainForm(r){let i=r.createDiv({cls:"bibliography-form"});i.createEl("h4",{text:"Contributors"}),this.contributorsListContainer=i.createDiv({cls:"bibliography-contributors"}),this.addContributorField("author");let s=new K.ButtonComponent(i).setButtonText("Add contributor").onClick(()=>this.addContributorField("author"));i.createEl("hr");let a=i.createDiv({cls:"bibliography-form-core"});new K.Setting(a).setName("Type").setDesc("Type of reference").addDropdown(b=>(b.addOption("article-journal","Journal article"),b.addOption("book","Book"),b.addOption("chapter","Book chapter"),b.addOption("paper-conference","Conference paper"),b.addOption("report","Report"),b.addOption("thesis","Thesis"),b.addOption("webpage","Web page"),b.addOption("divider1","------------------"),[...il].filter(x=>!["article-journal","book","chapter","paper-conference","report","thesis","webpage"].includes(x)).sort().forEach(x=>{let w=x.split("-").map(S=>S.charAt(0).toUpperCase()+S.slice(1)).join(" ");b.addOption(x,w)}),b.setValue("article-journal"),this.typeDropdown=b.selectEl,b.onChange(x=>{x.startsWith("divider")&&b.setValue("article-journal")}),b)),new K.Setting(a).setName("Title").setDesc("Title of the work").addText(b=>(this.titleInput=b.inputEl,b.inputEl.addClass("bibliography-input-full"),b)),new K.Setting(a).setName("Short title").setDesc("Abbreviated title (optional)").addText(b=>(this.titleShortInput=b.inputEl,b)),new K.Setting(a).setName("Pages").setDesc("Page range (e.g., 123-145)").addText(b=>(this.pageInput=b.inputEl,b)),new K.Setting(a).setName("URL").setDesc("Web address").addText(b=>(this.urlInput=b.inputEl,b.inputEl.type="url",b)),new K.Setting(a).setName("Container title").setDesc("Journal, book, or website name").addText(b=>(this.containerTitleInput=b.inputEl,b.inputEl.addClass("bibliography-input-full"),b));let n=a.createDiv({cls:"bibliography-date-container"}),o=new K.Setting(n).setName("Year").setDesc("Publication year");this.yearInput=o.controlEl.createEl("input",{type:"number"}),this.yearInput.placeholder="YYYY";let u=new K.Setting(n).setName("Month").setDesc("Publication month");this.monthDropdown=u.controlEl.createEl("select"),this.monthDropdown.createEl("option",{value:"",text:""}),["January","February","March","April","May","June","July","August","September","October","November","December"].forEach((b,E)=>{let x=(E+1).toString();this.monthDropdown.createEl("option",{value:x,text:x.padStart(2,"0")})});let p=new K.Setting(n).setName("Day").setDesc("Publication day");if(this.dayInput=p.controlEl.createEl("input",{type:"number"}),this.dayInput.placeholder="DD",this.dayInput.min="1",this.dayInput.max="31",new K.Setting(a).setName("Publisher").setDesc("Name of publisher").addText(b=>(this.publisherInput=b.inputEl,b)),new K.Setting(a).setName("Publisher place").setDesc("Location of publisher").addText(b=>(this.publisherPlaceInput=b.inputEl,b)),new K.Setting(a).setName("Edition").setDesc("Edition number or description").addText(b=>(this.editionInput=b.inputEl,b)),new K.Setting(a).setName("Volume").setDesc("Volume number").addText(b=>(this.volumeInput=b.inputEl,b)),new K.Setting(a).setName("Number/Issue").setDesc("Issue or number identifier").addText(b=>(this.numberInput=b.inputEl,b)),new K.Setting(a).setName("Language").setDesc("Primary language of the work").addDropdown(b=>{var w;if(b.addOption("","Select language..."),this.settings.favoriteLanguages&&this.settings.favoriteLanguages.length>0){this.settings.favoriteLanguages.forEach(T=>{T.code&&T.name&&b.addOption(T.code,T.name)});let S=b.selectEl.createEl("option",{text:"\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500",value:"_separator"});S.disabled=!0}let E=[{code:"en",name:"English"},{code:"fr",name:"French"},{code:"de",name:"German"},{code:"es",name:"Spanish"},{code:"it",name:"Italian"},{code:"ja",name:"Japanese"},{code:"zh",name:"Chinese"},{code:"ru",name:"Russian"},{code:"pt",name:"Portuguese"},{code:"ar",name:"Arabic"},{code:"ko",name:"Korean"},{code:"la",name:"Latin"},{code:"el",name:"Greek"},{code:"other",name:"Other"}],x=new Set(((w=this.settings.favoriteLanguages)==null?void 0:w.map(S=>S.code))||[]);return E.forEach(S=>{x.has(S.code)||b.addOption(S.code,S.name)}),this.languageDropdown=b.selectEl,b}),new K.Setting(a).setName("DOI").setDesc("Digital Object Identifier").addText(b=>(this.doiInput=b.inputEl,b)),new K.Setting(a).setName("Abstract").setDesc("Summary of the work").addTextArea(b=>(this.abstractInput=b.inputEl,b.inputEl.rows=4,b.inputEl.addClass("bibliography-input-full"),b)),this.settings.defaultModalFields&&this.settings.defaultModalFields.length>0){i.createEl("h4",{text:"Custom fields"});let b=i.createDiv({cls:"bibliography-default-fields"});this.createDefaultFields(b)}i.createEl("h4",{text:"Additional fields"}),this.additionalFieldsContainer=i.createDiv({cls:"bibliography-additional-fields"});let f=new K.ButtonComponent(i).setButtonText("Add field").onClick(()=>this.addAdditionalField("","","standard"));i.createEl("hr"),i.createEl("h4",{text:"Related notes"});let h=new K.Setting(i).setName("Link related notes").setDesc("Select existing notes in your vault that relate to this entry."),m=i.createDiv({cls:"bibliography-related-notes-display"});this.updateRelatedNotesDisplay(m),h.addButton(b=>b.setButtonText("Add related note").onClick(()=>{new Mr(this.app,E=>{E&&!this.relatedNotePaths.includes(E.path)?(this.relatedNotePaths.push(E.path),this.updateRelatedNotesDisplay(m)):E&&new K.Notice(`Note "${E.basename}" is already selected.`)}).open()})),i.createEl("hr"),i.createEl("h4",{text:"Identifier"}),new K.Setting(i).setName("Citekey").setDesc("Unique citation key used as filename").addText(b=>{this.idInput=b.inputEl,b.setPlaceholder("Autogenerated from author and year");let E=b.inputEl.parentElement;if(!E)return b;let x=new K.ButtonComponent(E).setIcon("reset").setTooltip("Regenerate citekey").onClick(()=>{let w=this.getFormValues();if(w.title||w.author&&w.author.length>0){let S=de.generate(w,this.settings.citekeyOptions);this.idInput.value=S}else new K.Notice("Add author and title first to generate citekey")});return b});let g=i.createDiv({cls:"bibliography-form-buttons"}),d=g.createEl("button",{text:"Cancel",cls:"bibliography-cancel-button"});d.onclick=()=>this.close();let v=g.createEl("button",{text:"Create note",cls:"mod-cta create-button"});v.onclick=async()=>{let b=this.getFormValues();this.validateForm(b)&&(v.disabled=!0,v.textContent="Creating...",await this.handleSubmit(b))}}populateFormFromCitoid(r){if(!this.isInitialized){console.warn("Cannot populate form before it is initialized");return}try{if(r.id&&(this.idInput.value=r.id),!r.id&&(r.author||r.issued)){let o=de.generate(r,this.settings.citekeyOptions);this.idInput.value=o}if(r.type&&(this.typeDropdown.querySelector(`option[value="${r.type}"]`)?this.typeDropdown.value=r.type:(this.typeDropdown.value="article-journal",console.warn(`CSL type "${r.type}" not found in dropdown options`))),this.titleInput.value=r.title||"",this.titleShortInput.value=r["title-short"]||r.shortTitle||"",this.pageInput.value=r.page||"",this.urlInput.value=r.URL||"",this.containerTitleInput.value=r["container-title"]||r.journal||"",this.publisherInput.value=r.publisher||"",this.publisherPlaceInput.value=r["publisher-place"]||"",this.volumeInput.value=r.volume||"",this.numberInput.value=r.number||r.issue||"",this.doiInput.value=r.DOI||"",this.abstractInput.value=r.abstract||"",this.editionInput.value=r.edition||"",r.issued&&r.issued["date-parts"]&&r.issued["date-parts"][0]&&r.issued["date-parts"][0].length>0){let o=r.issued["date-parts"][0];this.yearInput.value=o[0]||"",o.length>1&&(this.monthDropdown.value=o[1].toString()),o.length>2&&(this.dayInput.value=o[2].toString())}else this.yearInput.value=r.year||"",r.month&&(this.monthDropdown.value=r.month.toString()),r.day&&(this.dayInput.value=r.day.toString());r.language&&(this.languageDropdown.querySelector(`option[value="${r.language}"]`)?this.languageDropdown.value=r.language:this.languageDropdown.value="other"),this.contributors=[],this.contributorsListContainer.empty();let i=["author","editor","translator","contributor"],s=!1;i.forEach(o=>{r[o]&&Array.isArray(r[o])&&(s=!0,r[o].forEach(u=>{this.addContributorField(o,u.family,u.given,u.literal)}))}),s||this.addContributorField("author"),this.additionalFields=[],this.additionalFieldsContainer.empty(),this.defaultFieldInputs.forEach((o,u)=>{if(r[u]!==void 0&&r[u]!==null){let c=r[u];if(o instanceof HTMLInputElement&&o.type==="checkbox")o.checked=!!c;else if(o instanceof HTMLInputElement&&o.type==="date"){let p="";if(typeof c=="string")p=c;else if(c&&typeof c=="object"&&"date-parts"in c&&c["date-parts"][0]){let f=c["date-parts"][0];f.length>=3?p=`${f[0]}-${f[1].toString().padStart(2,"0")}-${f[2].toString().padStart(2,"0")}`:f.length>=2?p=`${f[0]}-${f[1].toString().padStart(2,"0")}-01`:f.length>=1&&(p=`${f[0]}-01-01`)}o.value=p}else(o instanceof HTMLSelectElement||o instanceof HTMLTextAreaElement||o instanceof HTMLInputElement)&&(o.value=c.toString())}});let a=new Set(["id","type","title","title-short","page","URL","container-title","publisher","publisher-place","volume","number","issue","DOI","abstract","issued","year","month","day","language","edition","author","editor","translator","contributor","shortTitle","journal","_graph","_item","_attachment","annote","file","attachment"]);this.defaultFieldInputs.forEach((o,u)=>{a.add(u)});let n=!1;for(let[o,u]of Object.entries(r))if(!a.has(o)&&u!==void 0&&u!==null){n=!0;let c="standard";typeof u=="number"?c="number":typeof u=="object"&&u!==null&&"date-parts"in u&&(c="date"),this.addAdditionalField(o,u,c)}}catch(i){console.error("Error populating form from CSL data:",i),new K.Notice("Error populating form. Some fields may be incomplete.")}}addContributorField(r="author",i="",s="",a=""){this.contributorsListContainer.addClass("bibliography-contributors");let n={role:r,family:i,given:s,literal:a};this.contributors.push(n);let o=new Ur(this.contributorsListContainer,n,u=>{let c=this.contributors.findIndex(p=>p.role===u.role&&p.family===u.family&&p.given===u.given&&p.literal===u.literal);c!==-1&&this.contributors.splice(c,1)})}addAdditionalField(r="",i="",s="standard"){this.additionalFieldsContainer.addClass("bibliography-additional-fields");let a={name:r,value:i,type:s},n=new qr(this.additionalFieldsContainer,a,o=>{let u=this.additionalFields.findIndex(c=>c.name===o.name&&c.value===o.value&&c.type===o.type);u!==-1&&this.additionalFields.splice(u,1)});this.additionalFields.push(a)}createDefaultFields(r){this.settings.defaultModalFields.forEach(i=>{let s=new K.Setting(r).setName(i.label).setDesc(i.description||""),a;switch(i.type){case"text":s.addText(n=>(a=n.inputEl,i.placeholder&&n.setPlaceholder(i.placeholder),i.defaultValue&&n.setValue(i.defaultValue.toString()),n));break;case"textarea":s.addTextArea(n=>(a=n.inputEl,i.placeholder&&n.setPlaceholder(i.placeholder),i.defaultValue&&n.setValue(i.defaultValue.toString()),n.inputEl.rows=3,n));break;case"number":s.addText(n=>(a=n.inputEl,n.inputEl.type="number",i.placeholder&&n.setPlaceholder(i.placeholder),i.defaultValue&&n.setValue(i.defaultValue.toString()),n));break;case"date":s.addText(n=>{if(a=n.inputEl,n.inputEl.type="date",i.defaultValue){let o="",u=i.defaultValue;if(typeof u=="string")o=u;else if(typeof u=="object"&&u&&"date-parts"in u){let c=u["date-parts"][0];c&&c.length>=3?o=`${c[0]}-${c[1].toString().padStart(2,"0")}-${c[2].toString().padStart(2,"0")}`:c&&c.length>=2?o=`${c[0]}-${c[1].toString().padStart(2,"0")}-01`:c&&c.length>=1&&(o=`${c[0]}-01-01`)}n.setValue(o)}return n});break;case"toggle":s.addToggle(n=>(a=n.toggleEl,i.defaultValue&&n.setValue(i.defaultValue),n));break;case"dropdown":s.addDropdown(n=>(a=n.selectEl,i.options&&i.options.forEach(o=>{n.addOption(o.value,o.text)}),i.defaultValue&&n.setValue(i.defaultValue.toString()),n));break}a&&this.defaultFieldInputs.set(i.name,a),i.required&&s.nameEl.createSpan({text:" *",cls:"required-indicator"})})}getFormValues(){let r={id:this.idInput.value||de.generate({title:this.titleInput.value,author:this.contributors.filter(n=>n.role==="author")},this.settings.citekeyOptions),type:this.typeDropdown.value,title:this.titleInput.value,"title-short":this.titleShortInput.value||void 0,page:this.pageInput.value||void 0,URL:this.urlInput.value||void 0,"container-title":this.containerTitleInput.value||void 0,publisher:this.publisherInput.value||void 0,"publisher-place":this.publisherPlaceInput.value||void 0,edition:this.editionInput.value||void 0,volume:this.volumeInput.value||void 0,number:this.numberInput.value||void 0,language:this.languageDropdown.value||void 0,DOI:this.doiInput.value||void 0,abstract:this.abstractInput.value||void 0};r.author=this.contributors.filter(n=>n.role==="author"&&(n.family||n.given||n.literal)).map(n=>{let o={};return n.family&&(o.family=n.family),n.given&&(o.given=n.given),n.literal&&!n.family&&!n.given&&(o.literal=n.literal),o}).filter(n=>n.family||n.given||n.literal);let i=this.yearInput.value.trim(),s=this.monthDropdown.value.trim(),a=this.dayInput.value.trim();return i&&(r.year=i,s&&(r.month=s,a&&(r.day=a)),r.issued={"date-parts":[[i?Number(i):void 0,s?Number(s):void 0,a?Number(a):void 0].filter(n=>n!==void 0)]}),this.defaultFieldInputs.forEach((n,o)=>{let u;if(n instanceof HTMLInputElement&&n.type==="checkbox")u=n.checked;else if(n instanceof HTMLInputElement&&n.type==="date"){let c=n.value;if(c){let p=c.match(/^(\d{4})-(\d{2})-(\d{2})$/);p?u={"date-parts":[[parseInt(p[1],10),parseInt(p[2],10),parseInt(p[3],10)]]}:u={raw:c}}}else(n instanceof HTMLSelectElement||n instanceof HTMLTextAreaElement||n instanceof HTMLInputElement)&&(u=n.value);u!==void 0&&u!==""&&!(n instanceof HTMLInputElement&&n.type==="checkbox"&&u===!1)&&(r[o]=u)}),r}updateRelatedNotesDisplay(r){if(r.empty(),this.relatedNotePaths.length===0){r.setText("No notes selected.");return}let i=r.createEl("ul",{cls:"bibliography-related-notes-list"});this.relatedNotePaths.forEach(s=>{let a=i.createEl("li"),n=s.substring(s.lastIndexOf("/")+1);a.createSpan({text:n});let o=a.createEl("button",{cls:"bibliography-remove-related-note-button",text:"Remove"});o.onclick=()=>{this.relatedNotePaths=this.relatedNotePaths.filter(u=>u!==s),this.updateRelatedNotesDisplay(r)}})}validateForm(r){let i=!0,s="Please complete all required fields:";return r.title||(i=!1,s+=`
- Title is required`),r.type||(i=!1,s+=`
- Type is required`),this.contributors.filter(n=>n.role==="author").forEach(n=>{n.family===""&&(n.family=void 0),n.given===""&&(n.given=void 0),n.literal===""&&(n.literal=void 0)}),i||new K.Notice(s),i}async handleSubmit(r){try{let i=await this.noteCreationService.createLiteratureNote({citation:r,contributors:this.contributors,additionalFields:this.additionalFields,attachmentData:this.attachmentData.length>0?this.attachmentData:null,relatedNotePaths:this.relatedNotePaths.length>0?this.relatedNotePaths:void 0});if(i.success)this.close();else throw i.error||new Error("Unknown error creating note")}catch(i){console.error("Error creating literature note:",i);let s=this.contentEl.querySelector(".create-button");s&&(s.disabled=!1,s.textContent="Create note")}}onClose(){let{contentEl:r}=this;r.empty()}},zo=class extends K.FuzzySuggestModal{constructor(t,r){super(t),this.files=this.app.vault.getFiles(),this.onSelect=r}getItems(){return this.files}getItemText(t){return`${t.path} (${t.extension.toUpperCase()})`}onChooseItem(t,r){this.onSelect(t)}};var ie=require("obsidian");var wi=class extends ie.Modal{constructor(r,i,s){super(r);this.settings=i;this.additionalFields=[];this.contributors=[];this.bookEntries=[];this.relatedNotePaths=[];this.selectedBook=null;this.attachmentData=[];this.linkButtonComponent=null;this.importButtonComponent=null;this.citationService=new pt(this.settings.citekeyOptions);let a=new Ve,n=new kt(a),o=new Qt(n,a),u=new Je(r,i),c=new ht(this.citationService);this.noteCreationService=new ft(r,i,c,o,u),this.initialBookPath=s}async loadInitialBook(){if(this.initialBookPath){let r=await this.noteCreationService.getBookEntryByPath(this.initialBookPath);r?(this.selectedBook=r,this.bookDropdown&&(this.bookDropdown.value=r.path,this.populateFromBook(r),this.bookPathDisplay.textContent=`Selected book path: ${r.path}`,this.bookPathDisplay.removeClass("setting-hidden"),this.bookPathDisplay.addClass("setting-visible"))):new ie.Notice(`Could not load initial book: ${this.initialBookPath}`)}}async onOpen(){let{contentEl:r}=this;r.addClass("bibliography-modal"),r.addClass("chapter-modal"),r.createEl("h2",{text:"Create book chapter entry"}),this.bookEntries=await this.noteCreationService.getBookEntries(),this.createMainForm(r),await this.loadInitialBook()}createMainForm(r){new ie.Setting(r).setName("Chapter identification").setHeading(),new ie.Setting(r).setName("Citekey").setDesc("Unique identifier for this chapter").addText(v=>{this.idInput=v.inputEl,v.setPlaceholder("Generated from author and year");let b=v.inputEl.parentElement;if(!b)return v;let E=new ie.ButtonComponent(b).setIcon("reset").setTooltip("Regenerate citekey").onClick(()=>{let x=this.getFormValues();if(x.title||x.author&&x.author.length){let w=de.generate(x,this.settings.citekeyOptions);this.idInput.value=w}else new ie.Notice("Add title and contributors first to generate citekey")});return v}),new ie.Setting(r).setName("Chapter title").setDesc("Title of this specific chapter").addText(v=>(this.titleInput=v.inputEl,v.inputEl.addClass("bibliography-input-full"),v)),new ie.Setting(r).setName("Short title").setDesc("Abbreviated chapter title (optional)").addText(v=>(this.titleShortInput=v.inputEl,v)),new ie.Setting(r).setName("Pages").setDesc("Page range of this chapter (e.g., 123-145)").addText(v=>(this.pageInput=v.inputEl,v)),new ie.Setting(r).setName("Book information").setHeading();let i=new ie.Setting(r).setName("Book").setDesc("Select the book this chapter belongs to");this.bookDropdown=i.controlEl.createEl("select",{cls:"dropdown"}),this.bookDropdown.createEl("option",{value:"",text:"Select a book"}),this.bookEntries.forEach(v=>{this.bookDropdown.createEl("option",{value:v.path,text:v.title||v.id})}),this.bookPathDisplay=r.createEl("div",{cls:"book-path-display setting-item setting-hidden"}),this.bookDropdown.addEventListener("change",()=>{let v=this.bookDropdown.value;if(v){let b=this.bookEntries.find(E=>E.path===v);b&&(this.selectedBook=b,this.populateFromBook(b),this.bookPathDisplay.textContent=`Selected book path: ${v}`,this.bookPathDisplay.removeClass("setting-hidden"),this.bookPathDisplay.addClass("setting-visible"))}else this.selectedBook=null,this.bookPathDisplay.addClass("setting-hidden"),this.bookPathDisplay.removeClass("setting-visible")}),new ie.Setting(r).setName("DOI").setDesc("Digital Object Identifier for this chapter (if available)").addText(v=>(this.doiInput=v.inputEl,v));let s=r.createDiv({cls:"bibliography-date-container"}),a=new ie.Setting(s).setName("Year").setDesc("Publication year (if different from book)");this.yearInput=a.controlEl.createEl("input",{type:"number"}),this.yearInput.placeholder="YYYY";let n=new ie.Setting(s).setName("Month").setDesc("Publication month (if applicable)");this.monthDropdown=n.controlEl.createEl("select"),this.monthDropdown.createEl("option",{value:"",text:""}),["January","February","March","April","May","June","July","August","September","October","November","December"].forEach((v,b)=>{let E=(b+1).toString();this.monthDropdown.createEl("option",{value:E,text:E.padStart(2,"0")})});let u=new ie.Setting(s).setName("Day").setDesc("Publication day (if applicable)");this.dayInput=u.controlEl.createEl("input",{type:"number"}),this.dayInput.placeholder="DD",this.dayInput.min="1",this.dayInput.max="31",new ie.Setting(r).setName("Language").setDesc("Primary language of the chapter").addDropdown(v=>{var x;if(v.addOption("","Select language..."),this.settings.favoriteLanguages&&this.settings.favoriteLanguages.length>0){this.settings.favoriteLanguages.forEach(S=>{S.code&&S.name&&v.addOption(S.code,S.name)});let w=v.selectEl.createEl("option",{text:"\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500",value:"_separator"});w.disabled=!0}let b=[{code:"en",name:"English"},{code:"fr",name:"French"},{code:"de",name:"German"},{code:"es",name:"Spanish"},{code:"it",name:"Italian"},{code:"ja",name:"Japanese"},{code:"zh",name:"Chinese"},{code:"ru",name:"Russian"},{code:"pt",name:"Portuguese"},{code:"ar",name:"Arabic"},{code:"ko",name:"Korean"},{code:"la",name:"Latin"},{code:"el",name:"Greek"},{code:"other",name:"Other"}],E=new Set(((x=this.settings.favoriteLanguages)==null?void 0:x.map(w=>w.code))||[]);return b.forEach(w=>{E.has(w.code)||v.addOption(w.code,w.name)}),v}),new ie.Setting(r).setName("Abstract").setDesc("Chapter summary (optional)").addTextArea(v=>(this.abstractInput=v.inputEl,v.inputEl.rows=4,v.inputEl.addClass("bibliography-input-full"),v)),r.createEl("h4",{text:"Contributors"}),this.contributorsListContainer=r.createDiv({cls:"bibliography-contributors"}),this.addContributorField("author");let c=new ie.ButtonComponent(r).setButtonText("Add contributor").onClick(()=>this.addContributorField("author"));r.createEl("h4",{text:"Additional fields"}),this.additionalFieldsContainer=r.createDiv({cls:"bibliography-additional-fields"});let p=new ie.ButtonComponent(r).setButtonText("Add field").onClick(()=>this.addAdditionalField("","","standard"));r.createEl("h4",{text:"Related notes"});let f=new ie.Setting(r).setName("Link related notes").setDesc("Select existing notes in your vault that relate to this chapter."),h=r.createDiv({cls:"bibliography-related-notes-display"});this.updateRelatedNotesDisplay(h),f.addButton(v=>v.setButtonText("Add Related Note").onClick(()=>{new Mr(this.app,b=>{b&&!this.relatedNotePaths.includes(b.path)?(this.relatedNotePaths.push(b.path),this.updateRelatedNotesDisplay(h)):b&&new ie.Notice(`Note "${b.basename}" is already selected.`)}).open()})),this.createAttachmentSection(r);let m=r.createDiv({cls:"bibliography-form-buttons"}),g=m.createEl("button",{text:"Cancel",cls:"bibliography-cancel-button"});g.onclick=()=>this.close();let d=m.createEl("button",{text:"Create chapter note",cls:"mod-cta create-button"});d.onclick=async()=>{let v=this.getFormValues();this.validateForm(v)&&(d.disabled=!0,d.textContent="Creating...",await this.handleSubmit(v))}}createAttachmentSection(r){let i=r.createDiv({cls:"attachment-container"});i.createEl("div",{cls:"setting-item-heading",text:"Chapter attachments"});let s=new ie.Setting(i).setDesc("Add attachments to this chapter");this.attachmentTypeSelect=s.controlEl.createEl("select",{cls:"dropdown"}),this.attachmentTypeSelect.createEl("option",{value:"import",text:"Import new file"}),this.attachmentTypeSelect.createEl("option",{value:"link",text:"Link to existing file"}),s.addButton(n=>{n.setButtonText("Add attachment").setCta().onClick(()=>{this.attachmentTypeSelect.value==="import".toString()?this.addImportAttachment():this.attachmentTypeSelect.value==="link".toString()&&this.addLinkAttachment()})});let a=i.createDiv({cls:"bibliography-attachments-display"});this.updateAttachmentsDisplay(a),this.importSettingEl=document.createElement("div"),this.linkSettingEl=document.createElement("div")}addImportAttachment(){let r=document.createElement("input");r.type="file",r.accept="*.*",r.addEventListener("change",()=>{if(r.files&&r.files.length>0){let i=r.files[0],s={type:"import",file:i,filename:i.name};this.attachmentData.push(s),this.updateAttachmentsDisplay()}}),r.click()}addLinkAttachment(){new Ho(this.app,r=>{let i={type:"link",path:r.path};this.attachmentData.push(i),this.updateAttachmentsDisplay()}).open()}updateAttachmentsDisplay(r){let i=r||this.contentEl.querySelector(".bibliography-attachments-display");if(!i)return;if(i.empty(),this.attachmentData.length===0){i.setText("No attachments added.");return}let s=i.createEl("ul",{cls:"bibliography-attachments-list"});this.attachmentData.forEach((a,n)=>{let o=s.createEl("li"),u="";a.type==="import"&&a.file?(u=a.filename||a.file.name,o.createSpan({cls:"attachment-type-badge import",text:"IMPORT"})):a.type==="link"&&a.path&&(u=a.path.split("/").pop()||a.path,o.createSpan({cls:"attachment-type-badge link",text:"LINK"}));let c=o.createSpan({text:u}),p=o.createEl("button",{cls:"bibliography-remove-attachment-button",text:"Remove"});p.onclick=()=>{this.attachmentData.splice(n,1),this.updateAttachmentsDisplay(i)}})}addContributorField(r="author",i="",s="",a=""){this.contributorsListContainer.addClass("bibliography-contributors"),i=i||"",s=s||"",a=a||"";let n={role:r,family:i,given:s,literal:a};this.contributors.push(n);let o=new Ur(this.contributorsListContainer,n,u=>{let c=this.contributors.findIndex(p=>p.role===u.role&&p.family===u.family&&p.given===u.given&&p.literal===u.literal);c!==-1&&this.contributors.splice(c,1)});return n}addAdditionalField(r="",i="",s="standard"){this.additionalFieldsContainer.addClass("bibliography-additional-fields");let a={name:r,value:i,type:s},n=new qr(this.additionalFieldsContainer,a,o=>{let u=this.additionalFields.findIndex(c=>c.name===o.name&&c.value===o.value&&c.type===o.type);u!==-1&&this.additionalFields.splice(u,1)});r&&this.additionalFields.push(a)}populateFromBook(r){if(!r)return;let i=r.frontmatter;if((!this.idInput.value||this.idInput.value.includes(".ch"))&&(this.idInput.value=`${r.id}.ch1`),!this.contributors.some(o=>o.family||o.given||o.literal)){this.contributorsListContainer.empty(),this.contributors=[];let o=[];i.editor&&Array.isArray(i.editor)?o=i.editor.map(c=>({...c,role:"editor"})):i.editor&&typeof i.editor=="object"&&!Array.isArray(i.editor)?o=[{...i.editor,role:"editor"}]:i.editor&&typeof i.editor=="string"&&i.editor.trim()&&(o=[{role:"editor",literal:i.editor.trim()}]),o.length>0&&o.forEach(c=>{if(typeof c=="object"){let p=c.family||"",f=c.given||"",h=c.literal||"";this.addContributorField("editor",p,f,h)}else typeof c=="string"&&c.trim()&&this.addContributorField("editor","","",c.trim())});let u=[];i.author&&Array.isArray(i.author)?u=i.author.map(c=>({...c,role:"container-author"})):i.author&&typeof i.author=="object"&&!Array.isArray(i.author)?u=[{...i.author,role:"container-author"}]:i.author&&typeof i.author=="string"&&i.author.trim()&&(u=[{role:"container-author",literal:i.author.trim()}]),u.length>0&&u.forEach(c=>{if(typeof c=="object"){let p=c.family||"",f=c.given||"",h=c.literal||"";this.addContributorField("container-author",p,f,h)}else typeof c=="string"&&c.trim()&&this.addContributorField("container-author","","",c.trim())}),this.addContributorField("author")}let a=[];if(i.attachment_path){let o=this.extractPathFromAttachment(i.attachment_path);o&&a.push(o)}else if(i.attachment){if(Array.isArray(i.attachment))for(let o of i.attachment){let u=this.extractPathFromAttachment(o);u&&a.push(u)}else if(typeof i.attachment=="string"){let o=this.extractPathFromAttachment(i.attachment);o&&a.push(o)}}if(a.length>0){this.attachmentData=[];for(let o of a)this.attachmentData.push({type:"link",path:o});this.updateAttachmentsDisplay()}let n=["publisher","publisher-place","volume","edition","ISBN"];this.additionalFields=[],this.additionalFieldsContainer.empty();for(let o of n)i[o]&&this.addAdditionalField(o,i[o],"standard")}updateRelatedNotesDisplay(r){if(r.empty(),this.relatedNotePaths.length===0){r.setText("No notes selected.");return}let i=r.createEl("ul",{cls:"bibliography-related-notes-list"});this.relatedNotePaths.forEach(s=>{let a=i.createEl("li"),n=s.substring(s.lastIndexOf("/")+1);a.createSpan({text:n});let o=a.createEl("button",{cls:"bibliography-remove-related-note-button",text:"Remove"});o.onclick=()=>{this.relatedNotePaths=this.relatedNotePaths.filter(u=>u!==s),this.updateRelatedNotesDisplay(r)}})}extractPathFromAttachment(r){let i=r.match(/\[\[(.*?)(?:\|.*?)?\]\]/);if(i&&i[1])return i[1];let s=r.match(/\[.*?\]\((.*?)\)/);return s&&s[1]?s[1]:r.endsWith(".pdf")||r.endsWith(".epub")?r:""}getFormValues(){if(!this.selectedBook)throw new Error("No book selected");let r=this.selectedBook.frontmatter,i={id:this.idInput.value||de.generate({title:this.titleInput.value,author:this.contributors.filter(o=>o.role==="author")},this.settings.citekeyOptions),type:"chapter",title:this.titleInput.value,"title-short":this.titleShortInput.value||void 0,"container-title":r.title,publisher:r.publisher,"publisher-place":r["publisher-place"],page:this.pageInput.value||void 0,DOI:this.doiInput.value||void 0,abstract:this.abstractInput.value||void 0,"container-author":this.contributors.filter(o=>o.role==="container-author"),volume:r.volume,edition:r.edition,isbn:r.ISBN},s=this.yearInput.value.trim(),a=this.monthDropdown.value.trim(),n=this.dayInput.value.trim();return s?(i.year=s,a&&(i.month=a,n&&(i.day=n)),i.issued={"date-parts":[[s?Number(s):void 0,a?Number(a):void 0,n?Number(n):void 0].filter(o=>o!==void 0)]}):r.issued&&(i.issued=r.issued,r.year&&(i.year=r.year),r.month&&(i.month=r.month),r.day&&(i.day=r.day)),i.author=this.contributors.filter(o=>o.role==="author"&&(o.family||o.given||o.literal)).map(o=>{let u={};return o.family&&(u.family=o.family),o.given&&(u.given=o.given),o.literal&&!o.family&&!o.given&&(u.literal=o.literal),u}).filter(o=>o.family||o.given||o.literal),i.bookID=this.selectedBook.id,i}validateForm(r){let i=!0,s="Please complete all required fields:";return r.title||(i=!1,s+=`
- Chapter title is required`),this.selectedBook||(i=!1,s+=`
- You must select a book`),r.id||(i=!1,s+=`
- Citekey is required`),i||new ie.Notice(s),i}async handleSubmit(r){if(!this.selectedBook){new ie.Notice("No book selected");return}try{let i=[];if(this.selectedBook.frontmatter){let u=this.contributors.filter(f=>f.family||f.given||f.literal),c=["editor","translator","director","contributor"];for(let f of c){let h=this.selectedBook.frontmatter[f];h&&Array.isArray(h)&&h.forEach(m=>{typeof m=="object"?i.push({role:f,family:m.family||"",given:m.given||"",literal:m.literal||""}):typeof m=="string"&&m.trim()&&i.push({role:f,family:"",given:"",literal:m.trim()})})}!u.some(f=>f.role==="author")&&this.selectedBook.frontmatter.author&&Array.isArray(this.selectedBook.frontmatter.author)&&this.selectedBook.frontmatter.author.forEach(f=>{typeof f=="object"?i.push({role:"author",family:f.family||"",given:f.given||"",literal:f.literal||""}):typeof f=="string"&&f.trim()&&i.push({role:"author",family:"",given:"",literal:f.trim()})})}let s=[...this.contributors.filter(u=>u.family||u.given||u.literal),...i],a={name:"book_path",value:this.selectedBook.path,type:"standard"},n=[...this.additionalFields,a],o=await this.noteCreationService.createLiteratureNote({citation:r,contributors:s,additionalFields:n,attachmentData:this.attachmentData.length>0?this.attachmentData:null,relatedNotePaths:this.relatedNotePaths.length>0?this.relatedNotePaths:void 0});if(o.success)this.close();else throw o.error||new Error("Unknown error creating chapter note")}catch(i){console.error("Error creating chapter note:",i);let s=this.contentEl.querySelector(".create-button");s&&(s.disabled=!1,s.textContent="Create Chapter Note"),new ie.Notice(`Error creating chapter note: ${i instanceof Error?i.message:String(i)}`)}}onClose(){let{contentEl:r}=this;r.empty()}},Ho=class extends ie.FuzzySuggestModal{constructor(t,r){super(t),this.files=this.app.vault.getFiles(),this.onSelect=r}getItems(){return this.files}getItemText(t){return`${t.path} (${t.extension.toUpperCase()})`}onChooseItem(t,r){this.onSelect(t)}};var Fe=require("obsidian"),fa=class extends Fe.Modal{constructor(r,i,s){super(r);this.selectedFile=null;this.selectedFileName="";this.settings=i,this.noteCreationService=s,this.importSettings={attachmentHandling:i.bulkImportAttachmentHandling,annoteToBody:i.bulkImportAnnoteToBody,citekeyPreference:i.bulkImportCitekeyPreference,conflictResolution:i.bulkImportConflictResolution}}onOpen(){let{contentEl:r}=this;r.empty(),r.addClass("bibliography-bulk-import-modal"),r.createEl("h2",{text:"Bulk import references"}),r.createDiv({cls:"bulk-import-warning"}).createEl("p",{text:"Warning: This operation may create or overwrite many files. Consider backing up your vault first."});let s=r.createDiv({cls:"bulk-import-instructions"});s.createEl("h3",{text:"Importing from Zotero"});let a=s.createEl("ol");a.createEl("li",{text:'In Zotero, select items and use "Export Items..." (not Better BibTeX)'}),a.createEl("li",{text:'Select format "BibTeX" and check "Export Files"'}),a.createEl("li",{text:"Save the exported bibliography.bib and files/ folder to your vault"}),a.createEl("li",{text:"Select the bibliography.bib file in this dialog"}),s.createEl("p",{text:"Important: You must move the entire export folder (with the files/ subdirectory) into your vault before importing to ensure attachments are found."}),new Fe.Setting(r).setName("Import file").setDesc("Select a BibTeX (.bib) or CSL-JSON (.json) file to import").addButton(c=>c.setButtonText("Choose file").onClick(()=>{let p=document.createElement("input");p.type="file",p.accept=".bib,.json",p.multiple=!1,p.onchange=async f=>{let h=f.target.files[0];if(h){this.selectedFile=h,this.selectedFileName=h.name;let m=r.querySelector(".file-info");m&&(m.textContent=`Selected: ${this.selectedFileName}`,m.addClass("has-file"))}},p.click()}));let n=r.createDiv({cls:"file-info",text:"No file selected"});r.createEl("h3",{text:"Import settings"}),new Fe.Setting(r).setName("Attachment handling").setDesc("Choose how to handle attachments referenced in the import file").addDropdown(c=>c.addOptions({none:"Ignore attachments",import:"Import attachments to vault"}).setValue(this.importSettings.attachmentHandling).onChange(p=>{this.importSettings.attachmentHandling=p})),new Fe.Setting(r).setName("Include annotations").setDesc('Include content from BibTeX "annote" field in the body of literature notes').addToggle(c=>c.setValue(this.importSettings.annoteToBody).onChange(p=>{this.importSettings.annoteToBody=p})),new Fe.Setting(r).setName("Citekey preference").setDesc("Choose whether to use citekeys from the import file or generate new ones").addDropdown(c=>c.addOptions({imported:"Use imported citekeys",generate:"Generate new citekeys"}).setValue(this.importSettings.citekeyPreference).onChange(p=>{this.importSettings.citekeyPreference=p})),new Fe.Setting(r).setName("Conflict resolution").setDesc("What to do when a literature note with the same citekey already exists").addDropdown(c=>c.addOptions({skip:"Skip existing notes",overwrite:"Overwrite existing notes"}).setValue(this.importSettings.conflictResolution).onChange(p=>{this.importSettings.conflictResolution=p}));let u=r.createDiv({cls:"import-button-container"}).createEl("button",{text:"Start import",cls:"mod-cta"});u.onclick=async()=>{var c;if(!this.selectedFile){new Fe.Notice("Please select a file to import");return}if(confirm("Are you sure you want to proceed with the bulk import? This operation may create multiple files in your vault.")){u.disabled=!0,u.textContent="Importing...";try{this.settings.bulkImportAttachmentHandling=this.importSettings.attachmentHandling,this.settings.bulkImportAnnoteToBody=this.importSettings.annoteToBody,this.settings.bulkImportCitekeyPreference=this.importSettings.citekeyPreference,this.settings.bulkImportConflictResolution=this.importSettings.conflictResolution;let p=await this.readFileContent(this.selectedFile),f=(c=this.selectedFileName.split(".").pop())==null?void 0:c.toLowerCase();this.importSettings.attachmentHandling==="import"&&(new Fe.Notice("To import attachments, you need to use a file-based import method or move attachments to your vault first.",5e3),(this.selectedFile.name==="bibliography.bib"||this.selectedFile.name.includes("export"))&&new Fe.Notice('Tip: If this is a Zotero export, make sure the "files" folder and BibTeX file are both in your vault.',5e3)),await this.noteCreationService.bulkImportFromString(p,f||"",this.selectedFileName,this.importSettings),this.close()}catch(p){console.error("Bulk import failed:",p),new Fe.Notice(`Import failed: ${p.message||"Unknown error"}`),u.disabled=!1,u.textContent="Start import"}}}}readFileContent(r){return new Promise((i,s)=>{let a=new FileReader;a.onload=()=>{if(typeof a.result=="string")i(a.result);else if(a.result instanceof ArrayBuffer){let n=new TextDecoder("utf-8");i(n.decode(a.result))}else s(new Error("Failed to read file content"))},a.onerror=n=>s(n),a.readAsText(r)})}onClose(){let{contentEl:r}=this;r.empty()}};var at=require("obsidian");Pt();Yr();var ma=class extends Nt{constructor(t,r,i){super(t,r,!1),this.fileToEdit=i,this.regenerateCitekeyOnSave=r.editRegenerateCitekeyDefault,this.updateCustomFrontmatterOnSave=r.editUpdateCustomFrontmatterDefault,this.regenerateBodyOnSave=r.editRegenerateBodyDefault}onOpen(){let t=this.app.metadataCache.getCache(this.fileToEdit.path);if(this.parsedFrontmatter=t==null?void 0:t.frontmatter,!this.parsedFrontmatter){new at.Notice("No frontmatter found in the selected file"),this.close();return}super.onOpen();let r=this.contentEl.querySelector("h2");r&&(r.textContent="Edit literature note"),this.addRegenerationOptions(),this.populateFormFromCSLFrontmatter(this.parsedFrontmatter)}addRegenerationOptions(){let t=this.contentEl.querySelectorAll(".bibliography-form-buttons"),r=t[t.length-1];if(!r||!r.parentElement)return;let i=r.parentElement.createDiv({cls:"edit-options-container"});r.parentElement.insertBefore(i,r),i.createEl("h4",{text:"Update options"});let s=i.createEl("p",{cls:"setting-item-description",text:"Choose which parts of the note should be updated when saving changes:"});new at.Setting(i).setName("Regenerate citekey").setDesc("Generate a new citekey based on current data (may rename the file)").addToggle(o=>{this.regenerateCitekeyToggle=o,o.setValue(this.regenerateCitekeyOnSave).onChange(u=>{this.regenerateCitekeyOnSave=u})}),new at.Setting(i).setName("Update templated frontmatter").setDesc("Re-evaluate custom frontmatter field templates with current data").addToggle(o=>{this.updateCustomFrontmatterToggle=o,o.setValue(this.updateCustomFrontmatterOnSave).onChange(u=>{this.updateCustomFrontmatterOnSave=u})});let a=new at.Setting(i).setName("Regenerate note body").setDesc("Replace the entire note body with the header template").addToggle(o=>{this.regenerateBodyToggle=o,o.setValue(this.regenerateBodyOnSave).onChange(u=>{this.regenerateBodyOnSave=u,this.updateBodyWarningVisibility(u,n)})}),n=i.createDiv({cls:"edit-body-warning",attr:{style:this.regenerateBodyOnSave?"display: block;":"display: none;"}});n.createEl("div",{cls:"callout callout-warning"},o=>{o.createEl("div",{cls:"callout-title",text:"\u26A0\uFE0F Warning"}),o.createEl("div",{cls:"callout-content",text:"Regenerating the note body will replace all content you've added to this note with the header template. This action cannot be undone."})})}updateBodyWarningVisibility(t,r){r.style.display=t?"block":"none"}populateFormFromCSLFrontmatter(t){let r={},i={};for(let[a,n]of Object.entries(t))a.startsWith("cssclass")||a==="tags"||a==="aliases"||(ir.includes(a)&&Array.isArray(n)?i[a]=n:r[a]=n);for(let[a,n]of Object.entries(i))r[a]=n;if(t.attachment||t.pdflink){let a=t.attachment||t.pdflink;Array.isArray(a)?a.filter(o=>typeof o=="string"&&o.trim().length>0).forEach(o=>{this.attachmentData.push({type:"link",path:o})}):typeof a=="string"&&a.trim().length>0&&this.attachmentData.push({type:"link",path:a})}if(t.related||t.links){let a=t.related||t.links;Array.isArray(a)?this.relatedNotePaths=a.filter(n=>typeof n=="string"&&n.trim().length>0):typeof a=="string"&&a.trim().length>0&&(this.relatedNotePaths=[a])}this.populateFormFromCitoid(r),this.attachmentsDisplayEl&&this.updateAttachmentsDisplay();let s=this.contentEl.querySelector(".bibliography-related-notes-display");s instanceof HTMLElement&&this.updateRelatedNotesDisplay(s)}async handleSubmit(t){var r;try{let i={citation:this.getFormValues(),contributors:this.contributors,additionalFields:this.additionalFields,attachmentData:this.attachmentData,relatedNotePaths:this.relatedNotePaths},s=await this.app.vault.read(this.fileToEdit),a=this.parsedFrontmatter||{},n=a.id||a.citekey,o=n;this.regenerateCitekeyOnSave&&(o=de.generate(i.citation,this.settings.citekeyOptions),i.citation.id=o);let u={...a};for(let[m,g]of Object.entries(i.citation))g!==void 0&&g!==""&&(u[m]=g);let c={};i.contributors.forEach(m=>{c[m.role]||(c[m.role]=[]);let g={};m.family&&(g.family=m.family),m.given&&(g.given=m.given),m.literal&&(g.literal=m.literal),Object.keys(g).length>0&&c[m.role].push(g)});for(let[m,g]of Object.entries(c))g.length>0?u[m]=g:delete u[m];if(ir.forEach(m=>{!c[m]&&u[m]&&delete u[m]}),i.additionalFields.forEach(m=>{if(!(!m.name||m.name.trim()===""))if(m.type==="date"){if(m.value==null||typeof m.value=="string"&&m.value.trim()===""||typeof m.value=="object"&&(!m.value["date-parts"]||m.value["date-parts"].length===0))return;if(typeof m.value=="object"&&m.value!==null)u[m.name]=m.value;else if(typeof m.value=="string"&&m.value!==""){let g=m.value.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(g){let d={"date-parts":[[parseInt(g[1],10),parseInt(g[2],10),parseInt(g[3],10)]]};u[m.name]=d}else{let d={raw:m.value};u[m.name]=d}}}else m.value!=null&&m.value!==""&&(u[m.name]=m.value)}),i.attachmentData.length>0){let m=i.attachmentData.map(g=>g.path);u.attachment=m}else delete u.attachment,delete u.pdflink;if(i.relatedNotePaths.length>0?u.related=i.relatedNotePaths:(delete u.related,delete u.links),this.updateCustomFrontmatterOnSave){let g=new Ve().buildVariables(u,i.contributors,i.attachmentData.map(d=>d.path).filter(d=>d!==void 0),i.relatedNotePaths);for(let d of this.settings.customFrontmatterFields)if(d.enabled)try{if(u.hasOwnProperty(d.name))continue;let v=d.template.trim().startsWith("[")&&d.template.trim().endsWith("]"),b=Ae.render(d.template,g,{yamlArray:v});if(b.startsWith("[")&&b.endsWith("]")||b.startsWith("{")&&b.endsWith("}"))try{let E=v?sr(b):b;u[d.name]=JSON.parse(E)}catch(E){v&&(b.trim()==="[]"||b.trim()==="[ ]")?u[d.name]=[]:(console.warn(`Failed to parse JSON for field ${d.name}: ${b}`),u[d.name]=b)}else u[d.name]=b}catch(v){console.error(`Error rendering custom field ${d.name}:`,v)}}let p=(0,at.stringifyYaml)(u),f;if(this.regenerateBodyOnSave){let g=new Ve().buildVariables(u,i.contributors,i.attachmentData.map(d=>d.path).filter(d=>d!==void 0),i.relatedNotePaths);f=Ae.render(this.settings.headerTemplate,g)}else{let m=/^---\n[\s\S]*?\n---\n*/,g=s.match(m);g?f=s.substring(g[0].length):f=s}let h=`---
${p.trim()}
---

${f.trim()}`;if(await this.app.vault.modify(this.fileToEdit,h),o!==n&&this.settings.editRenameFileOnCitekeyChange){let m=await this.generateFileName(u),g=(r=this.fileToEdit.parent)!=null&&r.path?`${this.fileToEdit.parent.path}/${m}.md`:`${m}.md`;g!==this.fileToEdit.path&&await this.app.fileManager.renameFile(this.fileToEdit,g)}new at.Notice("Literature note updated successfully"),this.close()}catch(i){console.error("Error updating literature note:",i),new at.Notice(`Failed to update note: ${i.message}`)}}async generateFileName(t){let i=new Ve().buildVariables(t,this.contributors,this.attachmentData.map(a=>a.path).filter(a=>a!==void 0),this.relatedNotePaths),s=Ae.render(this.settings.filenameTemplate,i);return s=s.replace(/[\\/:*?"<>|]/g,"-"),s}};var ye=require("obsidian"),pm=Ue(Go()),zC=Ue(Rs());var xi=class{constructor(t,r){this.app=t,this.settings=r,this.attachmentManager=new Je(t,r)}async buildBibliography(){let t=await this.findLiteratureNotes();if(t.length===0){new ye.Notice("No literature notes found in the vault.");return}try{await this.createCitekeyList(t),await this.createBibliographyJson(t),new ye.Notice(`Bibliography files created/updated with ${t.length} entries.`)}catch(r){}}async findLiteratureNotes(){let t=[],r=this.app.vault.getMarkdownFiles();for(let i of r)try{let s=this.app.metadataCache.getFileCache(i),a=s==null?void 0:s.frontmatter;if(!a)continue;let n=a.tags;if(!n||!Array.isArray(n)||!n.includes(this.settings.literatureNoteTag)||!a.id)continue;t.push({file:i,frontmatter:a})}catch(s){console.error(`Error processing file ${i.path}:`,s)}return t}async createCitekeyList(t){let r=t.map(u=>u.frontmatter.id).sort(),i=r.join(`
`),s=r.map(u=>`@${u}`).join(`
`),a=(0,ye.normalizePath)(this.settings.attachmentFolderPath),n=(0,ye.normalizePath)(`${a}/citekeylist.txt`),o=(0,ye.normalizePath)(this.settings.citekeyListPath);try{this.app.vault.getAbstractFileByPath(a)||await this.app.vault.createFolder(a)}catch(u){console.error(`Error ensuring biblib directory exists (${a}):`,u)}try{let u=this.app.vault.getAbstractFileByPath(n);u instanceof ye.TFile?await this.app.vault.modify(u,i):(u&&await this.attachmentManager.trashFile(u.path),await this.app.vault.create(n,i));let c=this.app.vault.getAbstractFileByPath(o);c instanceof ye.TFile?await this.app.vault.modify(c,s):(c&&await this.attachmentManager.trashFile(c.path),await this.app.vault.create(o,s))}catch(u){throw console.error(`Error writing citekey list files (${n}, ${o}):`,u),new ye.Notice("Error creating citekey list files. Check console."),u}}async createBibliographyJson(t){let r=t.map(a=>{let{position:n,tags:o,...u}=a.frontmatter;return{...u,obsidianPath:a.file.path}}),i=JSON.stringify(r,null,2),s=(0,ye.normalizePath)(this.settings.bibliographyJsonPath);try{let a=this.app.vault.getAbstractFileByPath(s);a instanceof ye.TFile?await this.app.vault.modify(a,i):(a&&await this.attachmentManager.trashFile(a.path),await this.app.vault.create(s,i))}catch(a){throw console.error(`Error writing bibliography JSON file (${s}):`,a),new ye.Notice("Error creating bibliography JSON file. Check console."),a}}async exportBibTeX(){let t=await this.findLiteratureNotes();if(t.length===0){new ye.Notice("No literature notes found to export BibTeX.");return}try{let r=t.map(n=>{let o={...n.frontmatter},u=["issued","accessed","container","event-date","original-date","submitted"];for(let c of u)if(o[c]&&typeof o[c]=="object"&&o[c]["date-parts"]&&Array.isArray(o[c]["date-parts"])){let p=o[c]["date-parts"],f=!1;if(p.length>0){for(let h of p)if(Array.isArray(h)&&h.length>0&&h.some(g=>g!=null&&!isNaN(Number(g)))){f=!0;break}}f||delete o[c]}return o}),i=new pm.default(r).get({style:"bibtex",type:"string"}),s=this.settings.bibtexFilePath;s=(0,ye.normalizePath)(s);let a=this.app.vault.getAbstractFileByPath(s);a instanceof ye.TFile?await this.app.vault.modify(a,i):(a&&await this.attachmentManager.trashFile(a.path),await this.app.vault.create(s,i)),new ye.Notice(`BibTeX file exported to ${s}`)}catch(r){console.error("Error exporting BibTeX file:",r),new ye.Notice("Error exporting BibTeX file. See console for details.")}}};ha();var ga=class{constructor(t,r,i,s){this.app=t;this.plugin=r;this.settings=i;this.noteCreationService=s}registerCommands(){this.registerLiteratureNoteCommands(),this.registerBibliographyCommands()}registerLiteratureNoteCommands(){this.plugin.addCommand({id:"create-literature-note",name:"Create literature note",callback:()=>{new Nt(this.app,this.settings,!0).open()}}),this.plugin.addCommand({id:"edit-literature-note",name:"Edit literature note",checkCallback:t=>{let r=this.app.workspace.getActiveFile();if(!r)return!1;let i=this.app.metadataCache.getFileCache(r);if(!i||!i.frontmatter)return!1;let a=i.frontmatter.tags;return!a||!Array.isArray(a)||!a.includes(this.settings.literatureNoteTag)?!1:(t||new ma(this.app,this.settings,r).open(),!0)}}),this.plugin.addCommand({id:"create-chapter-entry",name:"Create book chapter entry",callback:()=>{new wi(this.app,this.settings).open()}}),this.plugin.addCommand({id:"bulk-import-references",name:"Bulk import references",callback:()=>{new fa(this.app,this.settings,this.noteCreationService).open()}}),this.plugin.addCommand({id:"create-chapter-from-current-book",name:"Create chapter from current book",checkCallback:t=>{let r=this.app.workspace.getActiveFile();if(!r)return!1;let i=this.app.metadataCache.getFileCache(r);if(!i||!i.frontmatter)return!1;let s=i.frontmatter;if(!s.type||!["book","collection","document"].includes(s.type))return!1;let a=s.tags;return!a||!Array.isArray(a)||!a.includes(this.settings.literatureNoteTag)?!1:(t||new wi(this.app,this.settings,r.path).open(),!0)}})}registerBibliographyCommands(){this.plugin.addCommand({id:"build-bibliography",name:"Build bibliography",callback:async()=>{try{new da.Notice(er.BIBLIOGRAPHY_BUILDING),await new xi(this.app,this.settings).buildBibliography()}catch(t){console.error("Error building bibliography:",t),new da.Notice(mt.BIBLIOGRAPHY_BUILD_FAILED)}}}),this.plugin.addCommand({id:"export-bibtex",name:"Export bibliography as BibTeX",callback:async()=>{try{new da.Notice(er.BIBTEX_EXPORTING),await new xi(this.app,this.settings).exportBibTeX()}catch(t){}}})}};var he=require("obsidian");var va=class{constructor(t,r,i,s,a){this.app=t;this.plugin=r;this.settings=i;this.citationService=s;this.statusBarService=a;this.connectorServer=null;this.activeZoteroModal=null;this.activeZoteroItemId=null;this.processedSessionIds=new Set;this.processingItem=!1}async initialize(){if(!he.Platform.isMobile)try{let{ConnectorServer:t}=await Promise.resolve().then(()=>(ya(),ba));this.registerEventListeners(),this.registerToggleCommand(t),this.settings.enableZoteroConnector&&await this.startConnectorServer(t)}catch(t){console.error("Failed to load ConnectorServer module:",t),new he.Notice("Failed to load Zotero Connector feature. Check console for details.")}}registerEventListeners(){let t=this.handleZoteroItemReceived.bind(this);document.addEventListener("zotero-item-received",t);let r=this.handleAdditionalAttachments.bind(this);document.addEventListener("zotero-additional-attachments",r),this.plugin.register(()=>{document.removeEventListener("zotero-item-received",t),document.removeEventListener("zotero-additional-attachments",r)})}registerToggleCommand(t){this.plugin.addCommand({id:"toggle-zotero-connector",name:"Toggle Zotero Connector server",callback:async()=>{this.connectorServer?(this.stopConnectorServer(),this.settings.enableZoteroConnector=!1,await this.plugin.saveData(this.settings),new he.Notice("Zotero Connector server stopped")):(await this.startConnectorServer(t),this.connectorServer&&(this.settings.enableZoteroConnector=!0,await this.plugin.saveData(this.settings),new he.Notice("Zotero Connector server started")))}})}async toggleZoteroConnector(){if(this.connectorServer)this.stopConnectorServer(),this.settings.enableZoteroConnector=!1,await this.plugin.saveData(this.settings),new he.Notice("Zotero Connector server stopped");else try{let{ConnectorServer:t}=await Promise.resolve().then(()=>(ya(),ba));await this.startConnectorServer(t),this.connectorServer&&(this.settings.enableZoteroConnector=!0,await this.plugin.saveData(this.settings),new he.Notice("Zotero Connector server started"))}catch(t){console.error("Failed to load ConnectorServer module:",t),new he.Notice("Failed to load Zotero Connector feature.")}}async startConnectorServer(t){if(!he.Platform.isMobile&&!this.connectorServer){if(!t){console.error("ConnectorServer class was not provided to startConnectorServer. Cannot start."),new he.Notice("Internal error: Failed to initialize Zotero Connector.");return}try{this.connectorServer=new t(this.app,this.settings),this.connectorServer?(await this.connectorServer.start(),this.statusBarService.setConnectorServer(this.connectorServer)):(console.error("ConnectorServer instance is null immediately after instantiation."),new he.Notice("Failed to start Zotero Connector: Instance creation error."),this.connectorServer=null)}catch(r){console.error("Failed to start connector server:",r),new he.Notice(`Failed to start Zotero Connector server: ${r.message}`),this.connectorServer=null,this.statusBarService.setConnectorServer(null)}}}stopConnectorServer(){if(this.connectorServer)try{this.connectorServer.stop(),this.connectorServer=null,this.statusBarService.setConnectorServer(null)}catch(t){console.error("Error stopping connector server:",t),this.connectorServer=null,this.statusBarService.setConnectorServer(null)}}initializeStatusBar(){this.statusBarService.addZoteroStatusBarItem(this.plugin,this.toggleZoteroConnector.bind(this))}handleZoteroItemReceived(t){let{item:r,files:i,sessionID:s}=t.detail;if(!r){new he.Notice("Invalid Zotero item received"),console.error("Invalid Zotero item data in event detail:",t.detail);return}let a=r.id||"unknown";if(!(s&&this.processedSessionIds.has(s))){if(this.processingItem){if(this.activeZoteroItemId===a&&this.activeZoteroModal){this.processZoteroAttachments(i,this.activeZoteroModal);return}return}if(this.processingItem=!0,this.activeZoteroItemId=a,s&&(this.processedSessionIds.add(s),setTimeout(()=>{this.processedSessionIds.delete(s)},10*60*1e3),this.processedSessionIds.size>50)){let n=this.processedSessionIds.values();for(let o=0;o<10;o++){let u=n.next().value;u&&this.processedSessionIds.delete(u)}}try{(!r.creators||!Array.isArray(r.creators)||r.creators.length===0)&&(r.itemType==="webpage"||r.itemType==="newspaperArticle")&&r.byline&&(r.creators||(r.creators=[]),r.creators.push({creatorType:"author",name:r.byline}));let n=this.citationService.parseZoteroItem(r);if(!n)throw new Error("Failed to parse Zotero data.");let o=new Nt(this.app,this.settings,!1);this.activeZoteroModal=o,o.open(),(0,he.debounce)(()=>{try{o.populateFormFromCitoid(n),this.processZoteroAttachments(i,o),new he.Notice("Zotero data loaded")}catch(c){console.error("Error populating modal:",c),new he.Notice("Error displaying Zotero data in modal."),o.close(),this.resetZoteroProcessing()}},150)(),o.onClose=()=>{this.resetZoteroProcessing()}}catch(n){console.error("Error processing Zotero item:",n),new he.Notice("Error processing Zotero item. Check console for details."),this.resetZoteroProcessing()}}}processZoteroAttachments(t,r){if(!t||!Array.isArray(t)||t.length===0)return;let i=0,s=new Set,a=r.getAttachmentData();for(let n of a)if(n.filename)s.add(n.filename);else if(n.file)s.add(n.file.name);else if(n.path){let o=n.path.split(/[/\\]/).pop()||"";o&&s.add(o)}for(let n of t)try{if(n instanceof File){if(s.has(n.name))continue;let o={type:"import",file:n,filename:n.name};r.setAttachmentData(o),s.add(n.name),i++}else if(typeof n=="string"&&!he.Platform.isMobile){let o=require("fs");if(o.existsSync(n)){let u=n.split(/[/\\]/).pop()||"document.pdf";if(s.has(u)||s.has(n))continue;let c=o.readFileSync(n),p="application/octet-stream",f=u.toLowerCase().split(".").pop();f==="pdf"?p="application/pdf":f==="html"||f==="htm"?p="text/html":f==="epub"&&(p="application/epub+zip");let h=new File([c],u,{type:p}),m={type:"import",file:h,filename:u};r.setAttachmentData(m),s.add(u),s.add(n),i++}}}catch(o){console.error(`Error processing attachment file ${n}:`,o),new he.Notice(`Error processing Zotero attachment: ${typeof n=="string"?n.split(/[/\\]/).pop():"Unknown file"}`)}i>0&&new he.Notice(`${i} attachment(s) added to Zotero item`)}handleAdditionalAttachments(t){let{itemId:r,files:i,sessionID:s}=t.detail;!i||!Array.isArray(i)||i.length===0||this.activeZoteroItemId===r&&this.activeZoteroModal&&this.processZoteroAttachments(i,this.activeZoteroModal)}resetZoteroProcessing(){setTimeout(()=>{this.processingItem=!1,this.activeZoteroItemId=null,this.activeZoteroModal=null},100)}getConnectorServer(){return this.connectorServer}isServerRunning(){return this.connectorServer!==null}onUnload(){this.stopConnectorServer()}};var _a=class extends bm.Plugin{constructor(){super(...arguments);this.zoteroConnectorManager=null}async onload(){this.settingsManager=new Ni(this),this.settings=await this.settingsManager.loadSettings(),this.serviceManager=new pa(this.app,this.settings),this.commandRegistry=new ga(this.app,this,this.settings,this.serviceManager.getNoteCreationService()),this.commandRegistry.registerCommands(),this.initializeZoteroConnector(),this.addSettingTab(new Qi(this.app,this))}async initializeZoteroConnector(){this.zoteroConnectorManager=new va(this.app,this,this.settings,this.serviceManager.getCitationService(),this.serviceManager.getStatusBarService()),await this.zoteroConnectorManager.initialize(),this.zoteroConnectorManager.initializeStatusBar()}async saveSettings(){await this.settingsManager.saveSettings(),this.serviceManager.updateSettings(this.settings)}async startConnectorServer(){if(this.zoteroConnectorManager){let{ConnectorServer:r}=await Promise.resolve().then(()=>(ya(),ba));await this.zoteroConnectorManager.startConnectorServer(r)}}stopConnectorServer(){this.zoteroConnectorManager&&this.zoteroConnectorManager.stopConnectorServer()}async updateSettings(r){this.settings=await this.settingsManager.updateSettings(r),this.serviceManager.updateSettings(this.settings)}onunload(){this.zoteroConnectorManager&&this.zoteroConnectorManager.onUnload(),this.serviceManager.onUnload()}};
/*! Bundled license information:

ieee754/index.js:
  (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)

buffer/index.js:
  (*!
   * The buffer module from node.js, for the browser.
   *
   * @author   Feross Aboukhadijeh <https://feross.org>
   * @license  MIT
   *)
*/

/* nosourcemap */